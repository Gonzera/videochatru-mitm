<html>

<head>
  <title>videochatru-mitm remote control</title>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

  <style>
    * {
      font-family: "Trebuchet MS", sans-serif;
    }

    button {
      height: 24px
    }
  </style>

  <script type="text/javascript">

    var host = 1

    function toObject(from = {}, to = {}) {
      for (let key in from) {
        let value = from[key]

        if (typeof value === 'object' && value && !Array.isArray(value)) {
          toObject(value, from[key])
          continue
        }

        to[key] = value
      }
    }

    /**
     * @param {string} tagName 
     * @param {Partial<HTMLElement> & {ref(v: HTMLDivElement) => void}} options 
     * @param {HTMLElement[]} childs 
     */
    function createElement(tagName = '', options = {}, childs = []) {
      const element = document.createElement(tagName)

      toObject(options, element)

      for (let child of childs)
        element.appendChild(child)

      if (typeof options.ref == 'function')
        options.ref(element)

      return element
    }



    function injectControls() {
      controls = createElement('center', {
        style: "position: absolute; width:500px; top:0px; user-select: none;"
      }, [
        createElement('div', {
          id: "left",
          style: "position:absolute; left:0; top:0;",
        }, [
          createElement('button', {
            id: "leftScreen",
          }, [
            createElement('b', {
              innerText: "üì•"
            })
          ]),
          createElement('button', {
            id: "leftMute",
          }, [
            createElement('b', {
              id: "remoteMuted",
              innerText: "üîä"
            })
          ]),
          createElement('button', {
            id: "leftSkip",
          }, [
            createElement('b', {
              innerText: "‚è©"
            })
          ]),
        ]),
        createElement('div', {
          style: `  display: block;
          margin-left: auto;
          margin-right: auto;`,
          id: "main"
        }, [
          createElement('button', {
            id: "leftDiscord",
          }, [
            createElement('b', {
              innerText: "ü§°"
            })
          ]),
          createElement('button', {
            id: "leftMusic",
          }, [
            createElement('b', {
              innerText: "üéµ"
            })
          ]),
          createElement('b', {
            innerText: "videochatru-mitm",
            style: "display: none",
            id: "connectionStatus"
          }),
          createElement('button', {
            id: "leftMic",
          }, [
            createElement('b', {
              innerText: "üé§"
            })
          ]),
          createElement('button', {
            id: "rightMic",
          }, [
            createElement('b', {
              innerText: "üé§"
            })
          ]),
          createElement('button', {
            id: "rightMusic",
          }, [
            createElement('b', {
              innerText: "üéµ"
            })
          ]),
          createElement('button', {
            id: "rightDiscord",
          }, [
            createElement('b', {
              innerText: "ü§°"
            })
          ])
        ]),

        createElement('div', {
          style: "position:absolute; right:0; top:0;",
          id: "right"
        }, [
          createElement('button', {
            id: "rightSkip",
          }, [
            createElement('b', {
              innerText: "‚è™"
            })
          ]),
          createElement('button', {
            id: "rightMute"
          }, [
            createElement('b', {
              id: "localMuted",
              innerText: "üîä"
            })
          ]),
          createElement('button', {
            id: "rightScreen"
          }, [
            createElement('b', {
              innerText: "üì•"
            })
          ]),
        ]),
      ])

      description = createElement('div', {
        innerHTML: `</br><b>–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:</b>
<ul>
  <li><b>PAGE UP</b> ‚Äî –Ω–∞–ª–æ–∂–∏—Ç—å –∑–≤—É–∫ –∏–∑ –¥–∏—Å–∫–æ—Ä–¥–∞ –Ω–∞ –∞—É–¥–∏–æ, –∏–¥—É—â–µ–µ –æ—Ç –ª–µ–≤–æ–≥–æ</li>
  <li><b>PAGE DOWN</b> ‚Äî –Ω–∞–ª–æ–∂–∏—Ç—å –∑–≤—É–∫ –∏–∑ –¥–∏—Å–∫–æ—Ä–¥–∞ –Ω–∞ –∞—É–¥–∏–æ, –∏–¥—É—â–µ–µ –æ—Ç –ø—Ä–∞–≤–æ–≥–æ</li>
  <li>‚¨ÜÔ∏è ‚Äî —Å—Ç–æ–ø –¥–ª—è –≤—Å–µ—Ö</li>
  <li>‚û°Ô∏è ‚Äî —Å–∫–∏–ø–Ω—É—Ç—å –ø—Ä–∞–≤–æ–≥–æ</li>
  <li>‚¨ÖÔ∏è ‚Äî —Å–∫–∏–ø–Ω—É—Ç—å –ª–µ–≤–æ–≥–æ</li>
  <li>‚¨áÔ∏è ‚Äî —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –ª–µ–≤–æ–≥–æ –∏ –ø—Ä–∞–≤–æ–≥–æ</li>
</ul>
<b>–£–¥–∞–ª–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</b>
<ul>
  <li><b>üì• ‚Äî —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –ª–µ–≤–æ–≥–æ</b></li>
  <li><b>üîä ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –ª–µ–≤–æ–≥–æ</b></li>
  <ul>
    <li>–ü–ö–ú ‚Äî –≤–∫–ª/–≤—ã–∫–ª —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é –∑–≤—É–∫–∞ —Ö–æ—Å—Ç—É</li>
  </ul>
  <li><b>‚è© ‚Äî —Å–∫–∏–ø–Ω—É—Ç—å –ª–µ–≤–æ–≥–æ</b></li>
  <ul>
    <li>–ü–ö–ú ‚Äî —Å—Ç–æ–ø –ª–µ–≤–æ–≥–æ</li>
  </ul>
  <li><b>ü§° ‚Äî –Ω–∞–ª–æ–∂–∏—Ç—å –∑–≤—É–∫ –∏–∑ –¥–∏—Å–∫–æ—Ä–¥–∞ –Ω–∞ –∞—É–¥–∏–æ, –∏–¥—É—â–µ–µ –æ—Ç –ª–µ–≤–æ–≥–æ</b></li>
  <ul>
    <li>–õ–ö–ú ‚Äî push-to-talk</li>
    <li>–ü–ö–ú ‚Äî toggle</li>
  </ul>
  <li><b>üéµ ‚Äî –Ω–∞–ª–æ–∂–∏—Ç—å –∑–≤—É–∫ –∏–∑ –ø–ª–µ–µ—Ä–∞ –Ω–∞ –∞—É–¥–∏–æ, –∏–¥—É—â–µ–µ –æ—Ç –ª–µ–≤–æ–≥–æ</b></li>
  <ul>
    <li>–ü–ö–ú ‚Äî –≤–∫–ª/–≤—ã–∫–ª —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é –∑–≤—É–∫–∞ –∏–∑ –ø–ª–µ–µ—Ä–∞ –≤ –¥–∏—Å–∫–æ—Ä–¥</li>
  </ul>
  <li><b>üé§ ‚Äî –Ω–∞–ª–æ–∂–∏—Ç—å –∑–≤—É–∫ –∏–∑ –º–∏–∫—Ä–æ —Ö–æ—Å—Ç–∞ –Ω–∞ –∞—É–¥–∏–æ, –∏–¥—É—â–µ–µ –æ—Ç –ª–µ–≤–æ–≥–æ</b></li>
  <ul>
    <li>–õ–ö–ú ‚Äî push-to-talk</li>
    <li>–ü–ö–ú ‚Äî toggle</li>
  </ul>
  <li><b>üé§ ‚Äî –Ω–∞–ª–æ–∂–∏—Ç—å –∑–≤—É–∫ –∏–∑ –º–∏–∫—Ä–æ —Ö–æ—Å—Ç–∞ –Ω–∞ –∞—É–¥–∏–æ, –∏–¥—É—â–µ–µ –æ—Ç –ø—Ä–∞–≤–æ–≥–æ</b></li>
  <ul>
    <li>–õ–ö–ú ‚Äî push-to-talk</li>
    <li>–ü–ö–ú ‚Äî toggle</li>
  </ul>
  <li><b>üéµ ‚Äî –Ω–∞–ª–æ–∂–∏—Ç—å –∑–≤—É–∫ –∏–∑ –ø–ª–µ–µ—Ä–∞ –Ω–∞ –∞—É–¥–∏–æ, –∏–¥—É—â–µ–µ –æ—Ç –ø—Ä–∞–≤–æ–≥–æ</b></li>
  <ul>
    <li>–ü–ö–ú ‚Äî –í–∫–ª/–≤—ã–∫–ª —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é –∑–≤—É–∫–∞ –∏–∑ –ø–ª–µ–µ—Ä–∞ –≤ –¥–∏—Å–∫–æ—Ä–¥</li>
  </ul>
  <li><b>ü§° ‚Äî –Ω–∞–ª–æ–∂–∏—Ç—å –∑–≤—É–∫ –∏–∑ –¥–∏—Å–∫–æ—Ä–¥–∞ –Ω–∞ –∞—É–¥–∏–æ, –∏–¥—É—â–µ–µ –æ—Ç –ø—Ä–∞–≤–æ–≥–æ</b></li>
  <ul>
    <li>–õ–ö–ú ‚Äî push-to-talk</li>
    <li>–ü–ö–ú ‚Äî toggle</li>
  </ul>
  <li><b>‚è© ‚Äî —Å–∫–∏–ø–Ω—É—Ç—å –ø—Ä–∞–≤–æ–≥–æ</b></li>
  <ul>
    <li>–ü–ö–ú ‚Äî —Å—Ç–æ–ø –ø—Ä–∞–≤–æ–≥–æ</li>
  </ul>
  <li><b>üîä ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –ø—Ä–∞–≤–æ–≥–æ</b></li>
  <ul>
    <li>–ü–ö–ú ‚Äî –≤–∫–ª/–≤—ã–∫–ª —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é –∑–≤—É–∫–∞ —Ö–æ—Å—Ç—É</li>
  </ul>
  <li><b>üì• ‚Äî —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∞–≤–æ–≥–æ</b></li>
</ul>
        `,
        style: "margin-top:30px"
      })
      document.getElementsByTagName("body")[0].appendChild(controls)
      document.getElementsByTagName("body")[0].appendChild(description)


      function syncEvent(e) {
        if (e.type == "mouseup" || e.type == "mousedown")
          if (e.button != 0) {
            e.preventDefault()
            return
          }
        for (let el of e.path) {
          if (el.tagName == "BUTTON") {
            ws.send(JSON.stringify(
              {
                "to": host,
                "id": el.id,
                "event": e.type
              }
            ))
            break
          }
        }
        e.preventDefault()
      }

      for (let item of left.children) {
        item.addEventListener("click", syncEvent)
        item.addEventListener("contextmenu", syncEvent)
      }

      for (let item of right.children) {
        item.addEventListener("click", syncEvent)
        item.addEventListener("contextmenu", syncEvent)
      }

      for (let item of main.children) {
        item.addEventListener("click", syncEvent)
        item.addEventListener("mousedown", syncEvent)
        item.addEventListener("mouseup", syncEvent)
        item.addEventListener("contextmenu", syncEvent)
      }
    }

    var ws;

    function init() {

      // Connect to Web Socket
      ws = new WebSocket("ws://qrlk.me:5555/");

      // Set event handlers.
      ws.onopen = function (e) {
        console.log(e)
      };

      ws.onmessage = function (e) {
        let mes = JSON.parse(e.data)

        if (mes["sync"]) {
          if (mes.sync != host)
            return

          if (mes.innerText.localMuted == "no") {
            mes.innerText.localMuted = "üîä"
          } else {
            mes.innerText.localMuted = "üîá"
          }

          if (mes.innerText.remoteMuted == "no") {
            mes.innerText.remoteMuted = "üîä"
          } else {
            mes.innerText.remoteMuted = "üîá"
          }

          Object.keys(mes["innerText"]).forEach(function (key) {
            document.getElementById(key).innerText = mes["innerText"][key]
          });

          Object.keys(mes["backgroundColor"]).forEach(function (key) {
            document.getElementById(key).style.backgroundColor = mes["backgroundColor"][key]
          });
        }
      };

      ws.onclose = function (e) {
        console.log(e)
      };

      ws.onerror = function (e) {
        console.log(e)
      };
    }

    function triggerMouseEvent(node, eventType) {
      var clickEvent = document.createEvent('MouseEvents');
      clickEvent.initEvent(eventType, true, true);
      node.dispatchEvent(clickEvent);
    }

    function injectKeys() {
      document.addEventListener('keydown', e => {
        switch (e.key) {
          case "PageDown":
            triggerMouseEvent(rightDiscord, "mousedown");
            e.preventDefault()
            break;

          case "PageUp":
            triggerMouseEvent(leftDiscord, "mousedown");
            e.preventDefault()
            break;
        }
      });

      document.addEventListener('keyup', e => {
        switch (e.key) {
          case "ArrowLeft":
            leftSkip.click()
            e.preventDefault()
            break;

          case "ArrowRight":
            rightSkip.click()
            e.preventDefault()
            break;

          case "ArrowUp":
            triggerMouseEvent(leftSkip, "contextmenu");
            triggerMouseEvent(rightSkip, "contextmenu");
            e.preventDefault()
            break;

          case "ArrowDown":
            leftScreen.click()
            rightScreen.click()
            e.preventDefault()
            break;

          case "PageDown":
            triggerMouseEvent(rightDiscord, "mouseup");
            e.preventDefault()
            break;

          case "PageUp":
            triggerMouseEvent(leftDiscord, "mouseup");
            e.preventDefault()
            break;
        }
      });
    }

    window.addEventListener("DOMContentLoaded", function () {
      init()
      injectControls()
      injectKeys()
    }, false);

  </script>

</head>

<body>
</body>

</html>