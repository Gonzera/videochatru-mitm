/*! For license information please see index.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.mapgl=e():t.mapgl=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=16)}([function(t,e,n){window,t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=97)}([function(t,e,n){"use strict";n.d(e,"c",(function(){return c})),n.d(e,"d",(function(){return l})),n.d(e,"e",(function(){return d})),n.d(e,"h",(function(){return f})),n.d(e,"i",(function(){return m})),n.d(e,"j",(function(){return v})),n.d(e,"g",(function(){return _})),n.d(e,"f",(function(){return g})),n.d(e,"b",(function(){return b})),n.d(e,"a",(function(){return x}));var r=n(5),i=n(2),o=n(69),a=n(24),s=n(70);function c(t){for(var e=0,n=0;n<t.length;n++)e+=t[n]*Math.pow(256,t.length-1-n);return e}function l(t){for(var e=new Uint8Array(6),n=0;n<6;n++)e[n]=255&Math.floor(t/Math.pow(256,5-n));return encodeURIComponent(o.encode(e))}var u={label_halign:"labelHAlign",label_valign:"labelVAlign",db_icon_priority:"dbIconPriority",db_label_priority:"dbLabelPriority",db_label2_priority:"dbLabel2Priority",height:"styleHeight"};function d(t){if(u[t])return u[t];var e=t.replace(/^(db_|tech_db_|g_)/,"");return(e=e.replace(/_zpt$/,"")).split("_").map((function(t,e){return e>0?function(t){return(t=t.toLowerCase())[0].toUpperCase()+t.slice(1)}(t):t})).join("")}function f(t){var e={};return t.forEach((function(t,n){e[n]="svg"===t.format?function(t,e){return Object(r.a)(Object(r.a)({},t),{type:a.d.Static,isSvg:!0,rasters:[],index:e})}(t,n):function(t,e){var n=t.rasters.map((function(t){return Object(r.a)(Object(r.a)({},t),{x:0,y:0,atlasIndex:0,isPacked:!1})}));return Object(r.a)(Object(r.a)({},t),{type:a.d.Static,isSvg:!1,anchorX:.5,anchorY:.5,rasters:n,index:e})}(t,n)})),e}var h,p,m=(h=s.b,p={},h.forEach((function(t,e){p[d(t)]=e})),p),v=Object.keys(m).length;function _(t){var e=function(t,e){var n={};t.forEach((function(t,e){n[d(t)]=e}));var r=t.length;for(var i in n.selected=r++,n.hovered=r++,n.dpi=r++,n.isRealtime=r++,n.trafficOn=r++,n.pixelDensityPreset=r++,e)void 0===n[i]&&(n[i]=r++);return n}(t.tileProps,t.defaultProps),n=t.objectClasses&&Object(i.E)(t.objectClasses),r={};for(var o in t.defaultProps)r[o]={index:e[o],value:t.defaultProps[o]};return{version:t.version,classes:t.classes,sublayers:t.sublayers,sublayersByIndex:Object(i.E)(t.sublayers),objectClassesByIndex:n,objectClasses:t.objectClasses,tileProps:e,exportConfig:t.exportConfig||{},defaultProps:r}}function g(t){for(var e=t.groups,n=t.table,r={},i=0;i<n.length;i++){var o=n[i],a=e[i];r[a]={};for(var s=0;s<o.length;s++){var c=e[s];r[a][c]=n[i][s]}}var l=e.reduce((function(t,e,n){return t[e]=n,t}),{});return{indexToGroup:e,groupToIndex:l,table:r}}var y=0,b={beginningIsCut:y++,class:y++,componentDistanceEnd:y++,componentDistanceStart:y++,dbIconPriority:y++,dbLabelPriority:y++,dbLabel2Priority:y++,dpi:y++,endingIsCut:y++,height:y++,hiddenByPlanBuildingId:y++,id:y++,isRealtime:y++,label:y++,label2:y++,nextPointX:y++,nextPointY:y++,objectClass:y++,objectLength:y++,pixelDensityPreset:y++,previousPointX:y++,previousPointY:y++,region:y++,selected:y++,hovered:y++,sublayer:y++,trafficColor:y++,trafficOn:y++,trafficRoadClass:y++},x={version:"0.0.0",tileProps:b,defaultProps:{},classes:{},sublayers:{},sublayersByIndex:{},objectClasses:{},objectClassesByIndex:{},exportConfig:{}}},function(t,e,n){"use strict";n.r(e),n.d(e,"MAP_DEFAULTS",(function(){return i})),n.d(e,"tiles",(function(){return o})),n.d(e,"modelCacheSize",(function(){return a})),n.d(e,"loadModelsInfoStyleZoom",(function(){return s})),n.d(e,"atlasSize",(function(){return c})),n.d(e,"urls",(function(){return l})),n.d(e,"customStyleServerUrl",(function(){return u})),n.d(e,"traffic",(function(){return d})),n.d(e,"fonts",(function(){return f})),n.d(e,"events",(function(){return h})),n.d(e,"analytics",(function(){return p})),n.d(e,"workerResetDebounceTime",(function(){return m})),n.d(e,"styleMaxDpi",(function(){return v})),n.d(e,"forcedDensityPresetIndex",(function(){return _})),n.d(e,"houseHover",(function(){return g})),n.d(e,"tileAnimation",(function(){return y})),n.d(e,"buildingAnimation",(function(){return b})),n.d(e,"entranceAnimation",(function(){return x})),n.d(e,"identify",(function(){return w})),n.d(e,"labeling",(function(){return S})),n.d(e,"render",(function(){return O})),n.d(e,"defaultLang",(function(){return M})),n.d(e,"zoom",(function(){return j})),n.d(e,"inertia",(function(){return I})),n.d(e,"camera",(function(){return T})),n.d(e,"floors",(function(){return E})),n.d(e,"fences",(function(){return A})),n.d(e,"performanceCheck",(function(){return L})),n.d(e,"branchPoiSublayers",(function(){return C})),n.d(e,"transportPoiSublayerMetroExit",(function(){return P})),n.d(e,"transportPoiSublayers",(function(){return k})),n.d(e,"commercialSublayers",(function(){return N})),n.d(e,"personalSublayers",(function(){return R})),n.d(e,"landmarkPoiSublayers",(function(){return z})),n.d(e,"floorsDefaultPoiSublayer",(function(){return B})),n.d(e,"commercialRasterSizes",(function(){return F})),n.d(e,"landmarkRasterSizes",(function(){return D})),n.d(e,"cityNameSublayers",(function(){return U})),n.d(e,"defaultMarkerIcon",(function(){return Z})),n.d(e,"defaultMarkerAnchor",(function(){return H}));var r=n(5),i={minZoom:2,maxZoom:20},o={protocol:"https",server:"tile{subdomain}.maps.2gis.com",subdomains:"0123",tileSet:"vector_b",tileKey:"empty",appId:"empty",cacheRatio:2,maxUniverseZoom:8,maxRegionalZoom:15,maxDetailLevel:17,displayBounds:!1},a=100,s=13.5,c=[2048,2048],l={tiles:"{protocol}://{host}/vt?r={request}&ts={tileSet}&key={tileKey}&appId={appId}&lang={lang}&default_lang={defaultLang}&s={sessionId}",metatile:"{protocol}://{host}/metafiles/{hash}/metatile.json?ts={tileSet}",modelInfo:"{protocol}://{host}/metafiles/{regionId}/models.json?ts={tileSet}",model:"{protocol}://{host}/metafiles/{regionId}/{name}?ts={tileSet}",convertData:"{protocol}://{host}/metafiles/{hash}/convert.json?ts={tileSet}",defaultZss:"{protocol}://{host}/metafiles/{hash}/default.zss?ts={tileSet}",dynamicPoi:"{protocol}://{host}/metafiles/{regionId}/poi/{id}_{width}_{height}.png?ts={tileSet}"},u="https://styles.api.2gis.com/styles/{id}",d={host:"traffic0.edromaps.2gis.com",url:"{protocol}://{host}/tiles?tls={tiles}&reg={regions}&tm={time}&fmt=json&z={z}",timestampUrl:"{protocol}://{host}/meta?reg={regions}&time&score",updateInterval:12e4,minZoom:10,maxZoom:16,maxDetailLevel:17},f={url:"https://mapgl.2gis.com/api/fonts",gamma:.08,baseSize:24,baseLineHeight:1.2,bomCharCode:65279},h={doubleClickTime:185,dragThreshold:2,pitchWaitingTime:200,pitchThreshold:7},p={gaCode:"UA-25529177-4",gaName:"mapglEngine"},m=3e3,v=[155,230,300,400,520],_=-1,g={inAnimationTime:180,inAnimationType:"linear",outAnimationTime:800,outAnimationType:"linear"},y={time:300,type:"linear"},b={minStyleZoom:16,duration:500,easing:"easeOutQuint"},x={bounceType:"easeOutElastic",bounceTime:750,growType:"easeInOutQuad",growTime:750,stagger:0},w={pixelDensity:.5,sceneOpacity:0,cacheDebounceTime:400,pickDistance:3},S={interval:300,animationTime:250,animationType:"linear",tileMultiplier:1.5,axisAngleToleranceDeg:45,axisCheckDistancePx:12,boundsDead:!1,boundsAlive:!1,commercialBoundsDead:!1,commercialBoundsAlive:!1,boundsUnused:!1,labelSourceLines:!1,oneWaySourceLines:!1,commercialMargins:{visibleLeftRight:60,visibleTopBottom:60,appearLeftRight:70,appearTopBottom:70},lineLabelsHidePitchDeg:40,maxLabelLength:30},O={alwaysRerender:!1},M="en",j={mouseDelta:.65,macTouchDelta:.0018,animDuration:400,throttleDelay:100,mouseRotateDelta:2.5,mousePitchDelta:2.5,mobilePinchDelta:1,mobileTapDelta:10},I={duration:1300,maxSpeed:8,minSpeed:.02,nonLinearity:5},T={fov:60,near:1e3,far:Math.pow(2,34),minCalculationScreenHeight:1e3,hidePointObjectsAtPitch:30,viewportLimitRatio:2},E={enabled:!0,url:"https://floors.api.2gis.ru",displayStyleZoom:17,wallHeight:800,islandHeight:400,wallMinBrightness:.8265,wallMaxBrightness:.95,viewportPadding:200},A={lightIntensity:.1},L={fpsCaveat:10},C=["Commercial_poi_custom","Commercial_poi_navi","Commercial_poi_default","Anchor","Transport_poi","High_zoom_poi","High_zoom_poi_navigator","Medium_zoom_poi","Medium_zoom_poi_navigator","Low_zoom_poi","Low_zoom_poi_navigator"],P=["Subway_exit","Subway_exit_on_floor"],k=Object(r.e)(["Transport_stop"],P),N=["Commercial_poi_default","Commercial_poi_custom","Commercial_poi_navi"],R=["s_personal_poi"],z=["Landmark_poi"],B="Anchor",F=[96,84,72,60,48,36,24],D=[105,84,63,42,21],U=["City_2gis_medium","City_2gis_big","Capital_2gis"],Z="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzBweCIgaGVpZ2h0PSI0OHB4IiB2aWV3Qm94PSIwIDAgMzAgNDgiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA1MS4yICg1NzUxOSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+PHRpdGxlPlBhZ2UgMSBDb3B5PC90aXRsZT48ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz48ZGVmcz48bGluZWFyR3JhZGllbnQgeDE9IjUwJSIgeTE9IjUwJSIgeDI9IjUwJSIgeTI9IjAlIiBpZD0ibGluZWFyR3JhZGllbnQtMSI+PHN0b3Agc3RvcC1jb2xvcj0iIzFCODlFRSIgb2Zmc2V0PSIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9IiMzMTk4RUMiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGlkPSJSZWNvdmVyeS0wMSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTgzOS4wMDAwMDAsIC00MjUuMDAwMDAwKSI+PGcgaWQ9IlBhZ2UtMS1Db3B5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4MzkuMDAwMDAwLCA0MjUuMDAwMDAwKSI+PGVsbGlwc2UgaWQ9Ik92YWwtMyIgZmlsbD0iIzAwMDAwMCIgb3BhY2l0eT0iMC4wMzYzODA1OTciIGN4PSIxNSIgY3k9IjQ1LjUiIHJ4PSIzIiByeT0iMS41Ij48L2VsbGlwc2U+PGVsbGlwc2UgaWQ9Ik92YWwtMy1Db3B5IiBmaWxsPSIjMDAwMDAwIiBvcGFjaXR5PSIwLjAzNjM4MDU5NyIgY3g9IjE1IiBjeT0iNDUuNSIgcng9IjQuNSIgcnk9IjIuNSI+PC9lbGxpcHNlPjxwYXRoIGQ9Ik0xNSw0NS44ODM2MzUzIEwxNS44ODIzNTI5LDQ1Ljg4MzYzNTMgQzE1Ljg4MjM1MjksMjkuMjE3NzUyOSAyMC43NzY3NjQ3LDIzLjc5NzQ1ODggMjcuOTg3MzUyOSwyMy43OTc0NTg4IEwyOC4zMjk3MDU5LDIzLjc5NzQ1ODggQzI5LjA3Nzk0MTIsMjEuNTkwNjk0MSAzMCwxNy45OTE1NzY1IDMwLDE1LjAwMDQgQzMwLDcuMTQzOTI5NDEgMjMuNzY3OTQxMiwwLjAwMDQgMTUsMC4wMDA0IEM2LjIzMjA1ODgyLDAuMDAwNCAwLDcuMTQzOTI5NDEgMCwxNS4wMDA0IEMwLDE3Ljk5MTU3NjUgMC45MjIwNTg4MjQsMjEuNTkwNjk0MSAxLjY3MDI5NDEyLDIzLjc5NzQ1ODggTDIuMDEyNjQ3MDYsMjMuNzk3NDU4OCBDOS4yMjQxMTc2NSwyMy43OTc0NTg4IDE0LjExNzY0NzEsMjkuMjE3NzUyOSAxNC4xMTc2NDcxLDQ1Ljg4MzYzNTMgTDE1LDQ1Ljg4MzYzNTMgWiIgaWQ9IkZpbGwtMSIgZmlsbD0idXJsKCNsaW5lYXJHcmFkaWVudC0xKSI+PC9wYXRoPjwvZz48L2c+PC9nPjwvc3ZnPg==",H=[15,43]},function(t,e,n){"use strict";n.d(e,"i",(function(){return l})),n.d(e,"e",(function(){return u})),n.d(e,"H",(function(){return d})),n.d(e,"u",(function(){return f})),n.d(e,"p",(function(){return p})),n.d(e,"q",(function(){return m})),n.d(e,"K",(function(){return _})),n.d(e,"h",(function(){return g})),n.d(e,"B",(function(){return y})),n.d(e,"F",(function(){return b})),n.d(e,"A",(function(){return w})),n.d(e,"y",(function(){return M})),n.d(e,"z",(function(){return j})),n.d(e,"G",(function(){return I})),n.d(e,"f",(function(){return T})),n.d(e,"k",(function(){return E})),n.d(e,"m",(function(){return A})),n.d(e,"o",(function(){return L})),n.d(e,"C",(function(){return C})),n.d(e,"w",(function(){return P})),n.d(e,"x",(function(){return k})),n.d(e,"d",(function(){return N})),n.d(e,"J",(function(){return R})),n.d(e,"D",(function(){return z})),n.d(e,"b",(function(){return B})),n.d(e,"E",(function(){return F})),n.d(e,"n",(function(){return D})),n.d(e,"t",(function(){return H})),n.d(e,"v",(function(){return G})),n.d(e,"I",(function(){return W})),n.d(e,"a",(function(){return V})),n.d(e,"l",(function(){return q})),n.d(e,"r",(function(){return Y})),n.d(e,"s",(function(){return X})),n.d(e,"j",(function(){return K})),n.d(e,"c",(function(){return J})),n.d(e,"g",(function(){return Q}));var r=n(5),i=n(7),o=n(4),a=n(18),s=n(1),c=n(3);function l(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function u(t,e,n){return t=Math.max(t,e),Math.min(t,n)}function d(t){return 0==(t=+t)||Number.isNaN(t)?t:t>0?1:-1}function f(t,e){return[e[0]/t[0]*2-1,-e[1]/t[1]*2+1]}function h(t){var e=t.split("?"),n=e[0],r=e[1];if(!r)return n;var i=r.split("&").map((function(t){return t.split("=")})).filter((function(t){return"undefined"!==t[1]})).map((function(t){return t.join("=")})).join("&");return i.length?n+"?"+i:n}function p(t,e){var n=_(e.host,{subdomain:e.subdomain});return h(_(s.urls[t],Object(r.a)(Object(r.a)({},e),{host:n})))}function m(t,e){return h(_(t,e))}var v=/\{(\w+)\}/g;function _(t,e){return t.replace(v,(function(t,n){return e[n]}))}function g(t){return t*Math.PI/180}function y(t){return t/Math.PI*180}function b(t,e){var n=e.center,r=e.rotation,i=e.zoom,o=e.pitch,a=e.size,s=Object(c.u)(i,a),l=Math.max(s*Math.sin(o),1);t[0]=n[0]+Math.sin(r)*l,t[1]=n[1]-Math.cos(r)*l,t[2]=s*Math.cos(o)}var x,w=(x=a.b(),function(t,e){var n=o.d();return I(x,t),function(t,e,n,r){if(b(O,r),a.e(S,n),t[0]=(e[0]-r.viewport.left)/r.size[0]*2-1,t[1]=-(e[1]-r.viewport.top)/r.size[1]*2+1,t[2]=0,o.t(t,t,S),t[0]-=O[0],t[1]-=O[1],t[2]-=O[2],o.n(t,t),0!==t[2]){var i=-O[2]/t[2];i>=0?(t[0]=O[0]+t[0]*i,t[1]=O[1]+t[1]*i,t[2]=O[2]+t[2]*i):t[0]=t[1]=t[2]=0}else t[0]=t[1]=t[2]=0}(n,e,x,t),n}),S=a.b(),O=o.d(),M=function(){var t=a.b();return function(e,n){var r=[0,0,0];return I(t,e),j(r,n,t,e.size,e.viewport),r}}();function j(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],c=r[0]/2,l=r[1]/2,u=n[3]*o+n[7]*a+n[11]*s+n[15];t[0]=c+i.left+(n[0]*o+n[4]*a+n[12])*c/u,t[1]=l+i.top-(n[1]*o+n[5]*a+n[9]*s+n[13])*l/u}function I(t,e,n,r,i){void 0===n&&(n=s.camera.near),void 0===r&&(r=s.camera.far);var o=e.center,c=e.size,l=e.padding,u=s.camera.fov;b(O,e);var d=Math.max(0,l.top-l.bottom)*Math.tan(e.pitch),f=T(c[1])+d,h=void 0!==i?i:{x:0+(l.right-l.left)/2,y:0+(l.bottom-l.top)/2,width:c[0],height:c[1]};h.y+=(f-c[1])/2;var p=[c[0],f];a.n(t,u,n,r,p,o,O,h)}function T(t){return Math.max(t,s.camera.minCalculationScreenHeight)}function E(t,e,n){var i=w(t,e),a=w(Object(r.a)(Object(r.a)({},t),n),e),s=o.d();return o.r(s,i,a),s}function A(t,e){return{a:t[1]-e[1],b:e[0]-t[0],c:t[0]*e[1]-e[0]*t[1]}}function L(t){var e=t[0][0],n=t[0][1],r=t[1][0],i=t[1][1],o=t[2][0],a=t[2][1],s=t[3][0],c=t[3][1];return{min:[Math.min(e,r,o,s),Math.min(n,i,a,c)],max:[Math.max(e,r,o,s),Math.max(n,i,a,c)]}}function C(t,e){var n,r,i,o;if(r=L(e),i=(n=t).min[0]<=r.max[0]&&r.min[0]<=n.max[0],o=n.min[1]<=r.max[1]&&r.min[1]<=n.max[1],!i||!o)return!1;for(var a=[A(e[3],e[2]),A(e[1],e[0]),A(e[0],e[3]),A(e[2],e[1])],s=[t.min,t.max,[t.min[0],t.max[1]],[t.max[0],t.min[1]]],c=0;c<a.length;c++){for(var l=a[c],u=!0,d=0;d<s.length;d++){var f=s[d];if(l.a*f[0]+l.b*f[1]+l.c<0){u=!1;break}}if(u)return!1}return!0}function P(t,e){return Math.abs(e.a*t[0]+e.b*t[1]+e.c)/Math.sqrt(e.a*e.a+e.b*e.b)}function k(t){return t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16)}function N(t){var e=new Blob([t],{type:"image/png"}),n=URL.createObjectURL(e),r=document.createElement("img");return new Promise((function(e){r.onload=function(){URL.revokeObjectURL(n),e(r)},0===t.byteLength?r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=":r.src=n}))}function R(t,e,n){var r=document.createElement("img");return r.width=e,r.height=n,new Promise((function(e){r.onload=function(){return e(r)},r.src="data:image/svg+xml;base64,"+btoa(t)}))}function z(t,e){if(e[0]===t.width&&e[1]===t.height)return t;var n=document.createElement("canvas"),r=n.getContext("2d");return n.width=e[0],n.height=e[1],r.shadowColor="transparent",r.shadowBlur=0,r.drawImage(t,0,0,e[0],e[1]),n}function B(t,e){var n=Object(r.a)({},e);for(var i in t)void 0!==t[i]&&(n[i]=t[i]);return n}function F(t){var e={};for(var n in t)e[t[n]]=n;return e}function D(t,e){for(var n=0,r=0;r<e.length;r++)n+=e.charCodeAt(r);return t[n%t.length]}var U=i.d(),Z=i.d();function H(t,e,n){i.q(U,n.center,t),i.q(Z,e,t);var r=i.g(U,Z)/i.k(U);return Math.atan2(r,t[2])}function G(t,e){for(var n={},r=0,i=e;r<i.length;r++){var o=i[r];n[o]=t[o]}return n}function W(t,e){var n=[];for(var r in t)e[r]||n.push(t[r]);return n}function V(t,e,n){return u((n-t)/(e-t),0,1)}function q(t){return t%1}function Y(t,e,n){return t>=e&&t<=n}function X(t){var e=t[0],n=t[1];return Y(e,-180,180)&&Y(n,-90,90)}function K(t,e){if(t.size!==e.size)return!1;for(var n=0,r=Array.from(t);n<r.length;n++){var i=r[n];if(!e.has(i))return!1}return!0}function J(t){var e={};return t.forEach((function(t,n){e[t]=n})),e}function Q(t,e){if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e){var n=Array.isArray(t),r=Array.isArray(e),i=void 0,o=void 0,a=void 0;if(n&&r){if((o=t.length)!==e.length)return!1;for(i=o;0!=i--;)if(!Q(t[i],e[i]))return!1;return!0}if(n!==r)return!1;var s=t instanceof Date,c=e instanceof Date;if(s!==c)return!1;if(s&&c)return t.getTime()===e.getTime();var l=t instanceof RegExp,u=e instanceof RegExp;if(l!==u)return!1;if(l&&u)return t.toString()===e.toString();var d=Object.keys(t);if((o=d.length)!==Object.keys(e).length)return!1;for(i=o;0!=i--;)if(!Object.prototype.hasOwnProperty.call(e,d[i]))return!1;for(i=o;0!=i--;)if(!Q(t[a=d[i]],e[a]))return!1;return!0}return t!=t&&e!=e}},function(t,e,n){"use strict";n.d(e,"q",(function(){return l})),n.d(e,"k",(function(){return u})),n.d(e,"l",(function(){return d})),n.d(e,"m",(function(){return f})),n.d(e,"u",(function(){return h})),n.d(e,"i",(function(){return p})),n.d(e,"v",(function(){return m})),n.d(e,"n",(function(){return v})),n.d(e,"f",(function(){return g})),n.d(e,"h",(function(){return y})),n.d(e,"r",(function(){return b})),n.d(e,"t",(function(){return x})),n.d(e,"x",(function(){return w})),n.d(e,"w",(function(){return S})),n.d(e,"b",(function(){return O})),n.d(e,"p",(function(){return M})),n.d(e,"j",(function(){return j})),n.d(e,"o",(function(){return I})),n.d(e,"c",(function(){return T})),n.d(e,"e",(function(){return E})),n.d(e,"g",(function(){return A})),n.d(e,"d",(function(){return L})),n.d(e,"a",(function(){return C})),n.d(e,"s",(function(){return P}));var r=n(7),i=n(4),o=n(2),a=n(8),s=n(1),c=n(14);function l(t,e,n){t[0]=e[0]*n.size/65535+n.offset[0],t[1]=e[1]*n.size/65535+n.offset[1],t[2]=e[2]*a.j/65535}function u(t,e,n){t[0]=65535*(e[0]-n.offset[0])/n.size,t[1]=65535*(e[1]-n.offset[1])/n.size,t[2]=65535*e[2]/a.j}function d(t){var e=a.l/2,n=Math.sin(Object(o.h)(t[1])),r=t[0]*a.l/360,s=Math.log((1+n)/(1-n))*a.l/(4*Math.PI);return i.i(Object(o.e)(r,-e,e),Object(o.e)(s,-e,e),0)}function f(t){var e=[0,0];e[0]=360*t[0]/a.l;var n=-2*Math.PI/a.l;return e[1]=90-2*Object(o.B)(Math.atan(Math.exp(t[1]*n))),e}function h(t,e){return Object(o.f)(e[1])*a.l/(2*a.k*Math.tan(Object(o.h)(s.camera.fov)/2)*Math.pow(2,t))}function p(t,e){return Math.log(Object(o.f)(e[1])*a.l/(2*a.k*Math.tan(Object(o.h)(s.camera.fov)/2)*t))/Math.LN2}function m(t){return a.m*Math.pow(2,-t)}function v(t){return Math.max(0,Math.log(a.m/t)/Math.LN2)}function _(t){var e=f(t)[1],n=1/(2*Math.cos(Object(o.h)(e)));return Math.log(n)/Math.log(2)}function g(t,e){var n=_(e)*Object(o.a)(9,10,t);return t+Object(o.e)(n,-1,0)}function y(t,e){var n=_(e),r=n*Object(o.a)(9,10+n,t);return t-Object(o.e)(r,-1,0)}function b(t){return Math.pow(2,32-t)}function x(t,e){return t*Math.pow(2,e)*a.k/a.l}function w(t,e){return t*Math.pow(2,-e)*a.l/a.k}function S(t,e){return a.b*(t/a.n)/e}function O(t,e){return e*(a.l/40075e3)*function(t){return 1/Math.cos(t[1]*Math.PI/180)}(t)}function M(t){var e=b(t[2]);return i.i(t[0]*e-2147483648,t[1]*e-2147483648,0)}function j(t){return[t[0]+2147483648,t[1]+2147483648,32,32]}function I(t){var e=b(t[2]);return i.i((t[0]+.5)*e-2147483648,(t[1]+.5)*e-2147483648,0)}function T(t){var e=c.e(r.b(t.center),r.b(t.center)),n=E(t);return c.f(e,n[0]),c.f(e,n[1]),c.f(e,n[2]),c.f(e,n[3]),e}function E(t){var e=t.size,n=t.zoom,r=t.viewport,i=[Object(o.A)(t,[r.left,e[1]+r.top]),Object(o.A)(t,[e[0]+r.left,e[1]+r.top]),Object(o.A)(t,[e[0]+r.left,r.top]),Object(o.A)(t,[r.left,r.top])],a=Object(o.m)(i[0],i[1]),c=Object(o.w)(i[2],a),l=w(e[1],n)*s.camera.viewportLimitRatio;if(c>l){var u=l/c;i[2]=[(i[2][0]-i[1][0])*u+i[1][0],(i[2][1]-i[1][1])*u+i[1][1]],i[3]=[(i[3][0]-i[0][0])*u+i[0][0],(i[3][1]-i[0][1])*u+i[0][1]]}return i}function A(t,e){var n=b(e);return[(t[0]-n/2+2147483648)/n,(t[1]-n/2+2147483648)/n,e,e]}function L(t,e){void 0===e&&(e=1);var n=Math.max(t.max[0]-t.min[0],t.max[1]-t.min[1],1)*e,i=32-Math.log(n)/Math.LN2,o=r.d();return c.a(o,t),A(o,i)}function C(t,e){var n=Math.PI/180,r=t[1]*n,i=e[1]*n,o=Math.sin((e[1]-t[1])*n/2),a=Math.sin((e[0]-t[0])*n/2),s=o*o+Math.cos(r)*Math.cos(i)*a*a,c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return Math.round(6371e3*c)}var P=c.e([-a.l/2,-a.l/2],[a.l/2,a.l/2])},function(t,e,n){"use strict";n.d(e,"d",(function(){return i})),n.d(e,"b",(function(){return o})),n.d(e,"k",(function(){return a})),n.d(e,"i",(function(){return s})),n.d(e,"c",(function(){return c})),n.d(e,"q",(function(){return l})),n.d(e,"a",(function(){return u})),n.d(e,"m",(function(){return d})),n.d(e,"l",(function(){return f})),n.d(e,"o",(function(){return h})),n.d(e,"p",(function(){return p})),n.d(e,"n",(function(){return m})),n.d(e,"g",(function(){return v})),n.d(e,"e",(function(){return _})),n.d(e,"t",(function(){return g})),n.d(e,"s",(function(){return y})),n.d(e,"h",(function(){return b})),n.d(e,"r",(function(){return x})),n.d(e,"f",(function(){return w})),n.d(e,"j",(function(){return S}));var r=n(13);function i(){var t=new r.a(3);return t[0]=0,t[1]=0,t[2]=0,t}function o(t){var e=new r.a(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function s(t,e,n){var i=new r.a(3);return i[0]=t,i[1]=e,i[2]=n,i}function c(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function l(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function u(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function d(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function f(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function h(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function p(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function m(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function v(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function _(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],c=n[2];return t[0]=i*c-o*s,t[1]=o*a-r*c,t[2]=r*s-i*a,t}function g(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function y(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function b(t,e){var n=t[0],i=t[1],o=t[2],a=e[0],s=e[1],c=e[2];return Math.abs(n-a)<=r.b*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=r.b*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-c)<=r.b*Math.max(1,Math.abs(o),Math.abs(c))}var x=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},w=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)},S=a;i()},function(t,e,n){"use strict";n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"d",(function(){return s})),n.d(e,"e",(function(){return c}));var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))}function s(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function c(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return o}));var r=0,i={sublayer:r++,labelPriority:r++,label2Priority:r++,iconPriority:r++,iconGroupPriority:r++,labelGroupPriority:r++,hAlign:r++,vAlign:r++,font:r++,fontSize:r++,font2:r++,font2Size:r++,lineHeight:r++,letterSpacing:r++,symbol:r++,phase:r++,idHi:r++,idLo:r++,color:r++,fontColor:r++,haloColor:r++,haloRadius:r++,font2Color:r++,halo2Color:r++,halo2Radius:r++,rasterSet:r++,offsetX:r++,offsetY:r++,minWidth:r++,maxWidth:r++,minWidthScale:r++,maxWidthScale:r++,iconWidth:r++,possibleLabelPlacements:r++,labelingGroup:r++,iconLabelingGroup:r++,textLabelingGroup:r++,duplicationSpacing:r++,iconVisibleMarginLeftRight:r++,iconVisibleMarginTopBottom:r++,iconAppearMarginLeftRight:r++,iconAppearMarginTopBottom:r++,textVisibleMarginLeftRight:r++,textVisibleMarginTopBottom:r++,textAppearMarginLeftRight:r++,textAppearMarginTopBottom:r++,text2LabelingGroup:r++,text2AppearMarginLeftRight:r++,text2AppearMarginTopBottom:r++,text2VisibleMarginLeftRight:r++,text2VisibleMarginTopBottom:r++,componentDistanceStart:r++,componentDistanceEnd:r++,componentDistanceStartWorld:r++,objectLengthWorld:r++,minStyleZoom:r++,maxStyleZoom:r++,minDisplayStyleZoom:r++,maxDisplayStyleZoom:r++,detailLevel:r++,labelStartIndex:r++,labelFinishIndex:r++,label2StartIndex:r++,label2FinishIndex:r++,anchorStartIndex:r++,anchorFinishIndex:r++,lineEndingOffsets:r++,labelMargins:r++,identifyIndex:r++,identifyPoiLabelIndex:r++,borderColor:r++,borderWidth:r++,width:r++,wingWidthMultiplier:r++,tipHeightMultiplier:r++,wingHeightMultiplier:r++,length:r++,poiLabelOffset:r++,label2Offset:r++,maxSymbolsPerLine:r++},o=80},function(t,e,n){"use strict";n.d(e,"d",(function(){return i})),n.d(e,"b",(function(){return o})),n.d(e,"j",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"o",(function(){return c})),n.d(e,"a",(function(){return l})),n.d(e,"q",(function(){return u})),n.d(e,"m",(function(){return d})),n.d(e,"l",(function(){return f})),n.d(e,"f",(function(){return h})),n.d(e,"k",(function(){return p})),n.d(e,"n",(function(){return m})),n.d(e,"g",(function(){return v})),n.d(e,"i",(function(){return _})),n.d(e,"h",(function(){return g})),n.d(e,"p",(function(){return y})),n.d(e,"e",(function(){return b}));var r=n(13);function i(){var t=new r.a(2);return t[0]=0,t[1]=0,t}function o(t){var e=new r.a(2);return e[0]=t[0],e[1]=t[1],e}function a(t,e){var n=new r.a(2);return n[0]=t,n[1]=e,n}function s(t,e){return t[0]=e[0],t[1]=e[1],t}function c(t,e,n){return t[0]=e,t[1]=n,t}function l(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function u(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function d(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function f(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function h(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}function p(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function m(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t}function v(t,e){return t[0]*e[0]+t[1]*e[1]}function _(t,e){return t[0]===e[0]&&t[1]===e[1]}function g(t,e){var n=t[0],i=t[1],o=e[0],a=e[1];return Math.abs(n-o)<=r.b*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=r.b*Math.max(1,Math.abs(i),Math.abs(a))}var y=u,b=h;i()},function(t,e,n){"use strict";n.d(e,"k",(function(){return r})),n.d(e,"l",(function(){return i})),n.d(e,"j",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"n",(function(){return s})),n.d(e,"m",(function(){return c})),n.d(e,"e",(function(){return l})),n.d(e,"g",(function(){return u})),n.d(e,"h",(function(){return d})),n.d(e,"f",(function(){return f})),n.d(e,"d",(function(){return h})),n.d(e,"c",(function(){return p})),n.d(e,"a",(function(){return m})),n.d(e,"i",(function(){return v}));var r=256,i=Math.pow(2,32),o=Math.pow(2,20),a=2.54,s=96,c=i/(r/s*a),l=.7071067811865475,u=4294967295,d=1175494351e-47,f=3402823466e29,h=["Arial","Helvetica","HelveticaNeueCyr","Open_Sans","Open_Sans_Semibold","Open_Sans_Italic","Segoe_UI","PT_Sans_Caption","PT_Sans","Verdana","Verdana_bold","Noto_Sans","Noto_Sans_Semibold","Noto_Sans_Italic","SuisseIntl_Bold"],p="Noto_Sans",m=1,v=-3},function(t,e,n){"use strict";var r=function(){function t(e,n){this._initData=e,this.byteLength=void 0!==e.byteLength?e.byteLength:e,this.type=t.ArrayBuffer,this.drawType=t.StaticDraw,this.options=Object.assign({},t.defaultOptions,n),this._glBuffer=null,this._glContext=null}return t.prototype.bind=function(e,n,r){return this._glBuffer||this.prepare(e),this.type===t.ArrayBuffer?(e.bindBuffer(e.ARRAY_BUFFER,this._glBuffer),r=r||this.options,e.vertexAttribPointer(n,r.itemSize,this._toGlParam(e,r.dataType),r.normalized,r.stride,r.offset)):this.type===t.ElementArrayBuffer&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._glBuffer),this},t.prototype.remove=function(){return this._unprepare(),this},t.prototype.subData=function(t,e,n){return t.bindBuffer(this._toGlParam(t,this.type),this._glBuffer),t.bufferSubData(this._toGlParam(t,this.type),e,n),this},t.prototype.prepare=function(t){return this._glContext=t,this._glBuffer=t.createBuffer(),t.bindBuffer(this._toGlParam(t,this.type),this._glBuffer),t.bufferData(this._toGlParam(t,this.type),this._initData,this._toGlParam(t,this.drawType)),this._initData=null,this},t.prototype._unprepare=function(){this._glBuffer&&(this._glContext.deleteBuffer(this._glBuffer),this._glBuffer=null,this._glContext=null)},t.prototype._toGlParam=function(e,n){return n===t.ArrayBuffer?e.ARRAY_BUFFER:n===t.ElementArrayBuffer?e.ELEMENT_ARRAY_BUFFER:n===t.StaticDraw?e.STATIC_DRAW:n===t.DynamicDraw?e.DYNAMIC_DRAW:n===t.Byte?e.BYTE:n===t.Short?e.SHORT:n===t.Int?e.INT:n===t.Float?e.FLOAT:n===t.UnsignedByte?e.UNSIGNED_BYTE:n===t.UnsignedShort?e.UNSIGNED_SHORT:n===t.UnsignedInt?e.UNSIGNED_INT:null},t}();r.ArrayBuffer=1,r.ElementArrayBuffer=2,r.StaticDraw=10,r.DynamicDraw=11,r.Float=20,r.UnsignedByte=21,r.UnsignedShort=22,r.UnsignedInt=23,r.Byte=24,r.Short=25,r.Int=26,r.defaultOptions={itemSize:3,dataType:r.Float,stride:0,offset:0,normalized:!1},e.a=r},function(t,e,n){"use strict";n.d(e,"s",(function(){return o})),n.d(e,"l",(function(){return a})),n.d(e,"r",(function(){return s})),n.d(e,"q",(function(){return c})),n.d(e,"h",(function(){return l})),n.d(e,"n",(function(){return u})),n.d(e,"p",(function(){return d})),n.d(e,"f",(function(){return f})),n.d(e,"g",(function(){return h})),n.d(e,"c",(function(){return p})),n.d(e,"d",(function(){return m})),n.d(e,"i",(function(){return v})),n.d(e,"j",(function(){return _})),n.d(e,"a",(function(){return g})),n.d(e,"o",(function(){return y})),n.d(e,"k",(function(){return b})),n.d(e,"b",(function(){return x})),n.d(e,"e",(function(){return w})),n.d(e,"m",(function(){return S}));var r=n(8),i=n(7);function o(t,e){return t*e}function a(t,e){return t/e}function s(t,e){return t*Math.pow(2,-e)*r.l/r.k}function c(t,e){return 0===t?-1/0:-Math.log(e*r.k/(t*r.l))/Math.LN2}function l(t){return t[0]>=0&&t[0]<=65535&&t[1]>=0&&t[1]<=65535}function u(t,e){return t*r.l/(65535*Math.pow(2,e))}function d(t){return t/r.j*65535}function f(t,e,n,r,i){if(e!==r||n!==i){var o=i-n,a=e-r,s=1/Math.sqrt(o*o+a*a);t[0]=o*s,t[1]=a*s}else t[0]=0,t[1]=0}function h(t,e,n,r){var i=0;if(t!==n||e!==r){var o=r-e,a=t-n,s=1/Math.sqrt(o*o+a*a);i=(a=127*(a*=s)+(a<0?-.5:.5)<<24>>>16)+(o=127*(o*=s)+(o<0?-.5:.5)<<24>>>24)}return i}function p(t,e,n,r,i){if(e!==r||n!==i){var o=r-e,a=i-n,s=1/Math.sqrt(o*o+a*a);t[0]=o*s,t[1]=a*s}else t[0]=0,t[1]=0}function m(t,e,n,r,i){var o=e+r,a=n+i,s=e*o+n*a;if(0!==s){var c=1/s;t[0]=o*c,t[1]=a*c}else t[0]=0,t[1]=0}function v(t,e){return(127*e+(e<0?-.5:.5)<<24>>>16)+(127*t+(t<0?-.5:.5)<<24>>>24)}function _(t){var e=127*t[0]+(t[0]<0?-.5:.5)<<24>>>24;return(127*t[1]+(t[1]<0?-.5:.5)<<24>>>16)+e}function g(t,e,n,r,i){t[0]=e*r+n*i,t[1]=n*r-e*i}function y(t,e){t[0]=-e[1],t[1]=e[0]}function b(t){return 0===t[0]&&0===t[1]}function x(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])}function w(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}function S(t,e){var n=Math.cos(e)*t[0]-Math.sin(e)*t[1],r=Math.sin(e)*t[0]+Math.cos(e)*t[1];i.o(t,n,r)}},function(t,e,n){"use strict";n.d(e,"e",(function(){return d})),n.d(e,"c",(function(){return f})),n.d(e,"i",(function(){return h})),n.d(e,"o",(function(){return p})),n.d(e,"r",(function(){return m})),n.d(e,"s",(function(){return v})),n.d(e,"d",(function(){return _})),n.d(e,"n",(function(){return g})),n.d(e,"h",(function(){return y})),n.d(e,"k",(function(){return b})),n.d(e,"l",(function(){return x})),n.d(e,"j",(function(){return S})),n.d(e,"q",(function(){return O})),n.d(e,"p",(function(){return M})),n.d(e,"a",(function(){return j})),n.d(e,"b",(function(){return I})),n.d(e,"f",(function(){return T})),n.d(e,"g",(function(){return E})),n.d(e,"m",(function(){return A}));var r=n(7),i=n(69),o=n(52),a=n.n(o),s=n(0),c=n(2),l=n(3),u=n(82);function d(t){return{coords:t,size:Object(l.r)(t[2]),offset:Object(l.p)(t)}}function f(t){return t[0]+"_"+t[1]+"_"+t[2]+"_"+t[3]}function h(t,e){return f(t)+"_"+e.stringify()}function p(t){var e=t.split("_");return[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3],10)]}function m(t){var e=new a.a(t),n=u.TileResponseData.read(e).tileGroups[0],r=n.x,i=n.y,o=n.zoom;return n.tiles.map((function(t){var e=t.regionId,n=t.hash,a=t.data;return a||(console.warn("Tile "+o+"_"+r+"_"+i+" from region "+e+" is corrupt (has no data)"),a=new Uint8Array(0)),{data:a,regionId:e,metatileHash:Object(s.c)(n)}}))}function v(t){return t.map((function(t){return{regionId:t.regionId,metatileHash:t.metatileHash}}))}function _(t){var e=4*Math.ceil(t.byteLength/4),n=new ArrayBuffer(e);return new Uint8Array(n).set(t),n}function g(t,e){var n=t[0],r=t[1],i=t[2],o={min:Object(l.p)([n,r,i,i]),max:Object(l.p)([n+1,r+1,i,i])};return Object(c.C)(o,e)}function y(t,e,n){for(var r=Object(c.o)(t),i=Object(l.r)(e),o=Math.pow(2,e)-1,a=Math.max(Math.floor((r.min[0]+2147483648)/i),0),s=Math.min(Math.floor((r.max[0]+2147483648)/i),o),u=Math.max(Math.floor((r.min[1]+2147483648)/i),0),d=Math.min(Math.floor((r.max[1]+2147483648)/i),o),h=[],p=a;p<=s;p++)for(var m=u;m<=d;m++){var v=[p,m,e,n];g(v,t)&&h.push(f(v))}return h}function b(t,e,n,r,o,s,l,d,f,h){var p=new a.a,m={tiles:[{x:o[0],y:o[1],zoom:o[2]}]};return u.TileRequestUrl.write(m,p),Object(c.p)("tiles",{host:t,tileSet:e,tileKey:s,sessionId:h,protocol:n,appId:l,lang:d,defaultLang:f,subdomain:r[Math.abs(o[0]+o[1])%r.length],request:encodeURIComponent(i.encode(p.finish()))})}function x(t,e){var n=t.coords,r=e.coords,i=n[2],o=r[2];return i===o?n[0]===r[0]&&n[1]===r[1]:i<o?w(t,e):w(e,t)}function w(t,e){if(e.zoomLevel<t.zoomLevel)return!1;if(e.zoomLevel===t.zoomLevel)return e.coords[0]===t.coords[1]&&e.coords[1]===t.coords[1]&&e.detailLevel>t.detailLevel;var n=Math.pow(2,e.coords[2]-t.coords[2]),r=t.coords[0]*n,i=r+n,o=t.coords[1]*n,a=o+n,s=e.coords[0],c=e.coords[1];return s>=r&&s<i&&c>=o&&c<a}function S(t,e,n){var r=t.coords,i=Math.min(e,n),o=Math.pow(2,t.zoomLevel-i);return f([Math.floor(r[0]/o),Math.floor(r[1]/o),i,e])}function O(t,e,n,r){return t[S(e,n,r)]}function M(t,e){var n=[];for(var r in t){var i=t[r];w(e,i)&&n.push(i)}return n}function j(t,e,n){return r.f(t,Object(l.o)(e.coords))-r.f(t,Object(l.o)(n.coords))}function I(t,e){return t[1]-e[1]||t[0]-e[0]}function T(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++){var r=t[n],i=e[n];if(r[0]!==i[0]||r[1]!==i[1])return!1}return!0}function E(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r];e.has(i)&&n.push(i)}return n}function A(t){return t>=1&&t<=65535}},function(t,e,n){"use strict";n.d(e,"f",(function(){return v})),n.d(e,"e",(function(){return _})),n.d(e,"a",(function(){return g})),n.d(e,"d",(function(){return y})),n.d(e,"b",(function(){return b})),n.d(e,"c",(function(){return x}));var r=n(5),i=n(24),o=n(41),a=n(0),s=n(8),c=n(23),l=n(75),u=[[0,0,0]],d={type:i.d.Static,isSvg:!1,name:"",fileName:"",rasters:[],index:-1,anchorX:.5,anchorY:.5},f=["default","marker","markerText","htmlLabel"],h={default:0,marker:1,markerText:2,htmlLabel:3},p={default:{default:!0,marker:!1,markerText:!0,htmlLabel:!0},marker:{default:!1,marker:!1,markerText:!0,htmlLabel:!1},markerText:{default:!0,marker:!0,markerText:!0,htmlLabel:!1},htmlLabel:{default:!0,marker:!1,markerText:!1,htmlLabel:!1}},m=new Set(["color","color2","color3","contourColor","dashColor","dash2Color","spaceColor","space2Color","wallColor","spaceLength","dashLength","dash2Length","length","borderColor","width","width2","width3","borderWidth","tipMovementAmplitude","fontSize","fontColor","font2Size","font2Color","haloColor","halo2Color","poiLabelOffset","height","outerEdgeWidth","duplicationSpacing","label2Offset","shift","iconWidth","opacity"]);function v(t){for(var e=[],n=Object.keys(a.b).length,r=0;r<n;r++)e[r]=NaN;for(var i in t){if(void 0===a.b[i])throw new Error("No such tile prop '"+i+"'");e[a.b[i]]=t[i]}return e}function _(t){for(var e=[],n=Object.keys(a.i).length,r=0;r<n;r++)e[r]=NaN;for(var i in t){if(void 0===a.i[i])throw new Error("No such style prop '"+i+"'");e[a.i[i]]=t[i]}return e}var g=function(){function t(){this.style={id:-1,ast:{rules:{},selector:[],children:void 0},curves:[],rasterSets:{},labelingGroups:{indexToGroup:f,groupToIndex:h,table:p},fonts:s.d,urls:{icons:{png:"",svg:""}},styleStateKeys:[]},this.emptyCurveIndices=[],this.addCurve(Object(o.a)("#ff0000")),this.addCurve(Object(o.a)("#00ff00")),this.addCurve(Object(o.a)("#0000ff")),this.addCurve(1)}return t.prototype.getStyle=function(){return this.style},t.prototype.appendRasterSet=function(t){this.style.rasterSets[t.index]=t},t.prototype.removeRasterSet=function(t){this.style.rasterSets[t]=d},t.prototype.getFontIndex=function(t){var e=this.style.fonts,n=e.indexOf(t);return-1===n?(console.log("Font '"+t+"' not found, using "+e[0]+" instead"),0):n},t.prototype.getLabelingGroupIndex=function(t){var e=this.style.labelingGroups.groupToIndex;return void 0!==e[t]?e[t]:e.default},t.prototype.addCurve=function(t){var e=this.emptyCurveIndices.shift()||this.style.curves.length;return this.updateCurve(e,t),e},t.prototype.updateCurve=function(t,e){this.style.curves[t]=Array.isArray(e)?e:[[0,e,1]]},t.prototype.removeCurve=function(t){this.style.curves[t]=u;for(var e=0;e<this.emptyCurveIndices.length;e++){var n=this.emptyCurveIndices[e];if(n>t){this.emptyCurveIndices=Object(r.e)(this.emptyCurveIndices.slice(0,n),[t],this.emptyCurveIndices.slice(n));break}}},t.prototype.extractCurvesFromStyle=function(t){var e={};for(var n in t)m.has(n)?e[n]=this.addCurve(t[n]):e[n]=t[n];return e},t.prototype.removeExtractedCurves=function(t){for(var e in t)m.has(e)&&this.removeCurve(t[e])},t}();function y(t,e){return(0!==e?Array.isArray(t)?t:[[0,t,1]]:[[0,0,0]]).map((function(t){return[t[0],t[1]+2*e,t[2]]}))}function b(t){return Array.isArray(t)?t.map((function(t){return[t[0],Object(o.a)(t[1]),t[2]]})):[[0,Object(o.a)(t),1]]}function x(t){return Object(c.c)(t)?Object(l.a)(t):t}},function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return s}));var r=1e-6,i="undefined"!=typeof Float64Array?Float64Array:Array,o=Math.random,a=Math.PI/180;function s(t){return t*a}},function(t,e,n){"use strict";n.d(e,"e",(function(){return a})),n.d(e,"g",(function(){return s})),n.d(e,"f",(function(){return c})),n.d(e,"d",(function(){return l})),n.d(e,"h",(function(){return u})),n.d(e,"a",(function(){return d})),n.d(e,"b",(function(){return f})),n.d(e,"c",(function(){return h}));var r=n(7),i=n(2),o=n(3);function a(t,e){return{min:t||r.j(1/0,1/0),max:e||r.j(-1/0,-1/0)}}function s(t){return a(Object(o.l)(t.southWest),Object(o.l)(t.northEast))}function c(t,e){r.m(t.min,t.min,e),r.l(t.max,t.max,e)}function l(t,e){t.min[0]=e.min[0],t.max[0]=e.max[0],t.min[1]=e.min[1],t.max[1]=e.max[1]}function u(t){t.min[0]=1/0,t.max[0]=-1/0,t.min[1]=1/0,t.max[1]=-1/0}function d(t,e){t[0]=e.min[0]+(e.max[0]-e.min[0])/2,t[1]=e.min[1]+(e.max[1]-e.min[1])/2}function f(t,e,n){t[0]=Object(i.e)(n[0],e.min[0],e.max[0]),t[1]=Object(i.e)(n[1],e.min[1],e.max[1])}function h(t,e){return e[0]<=t.max[0]&&e[0]>=t.min[0]&&e[1]<=t.max[1]&&e[1]>=t.min[1]}},function(t,e,n){"use strict";var r,i,o;n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return o})),function(t){t[t.Tile=0]="Tile",t[t.Floor=1]="Floor",t[t.DynamicObject=2]="DynamicObject",t[t.PersonalPoi=3]="PersonalPoi"}(r||(r={})),function(t){t[t.Dead=0]="Dead",t[t.Alive=1]="Alive",t[t.Unused=2]="Unused",t[t.CommercialAlive=3]="CommercialAlive",t[t.CommercialDead=4]="CommercialDead"}(i||(i={})),function(t){t[t.Text=0]="Text",t[t.Icon=1]="Icon",t[t.PoiText=2]="PoiText",t[t.PoiText2=3]="PoiText2",t[t.OneWayLine=4]="OneWayLine",t[t.LineText=5]="LineText",t[t.Box=6]="Box"}(o||(o={}))},function(t,e,n){"use strict";var r,i;n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i})),function(t){t[t.Main=0]="Main",t[t.Parser=1]="Parser",t[t.Labeling=2]="Labeling",t[t.All=3]="All",t[t.Source=4]="Source"}(r||(r={})),function(t){t[t.FunctionUse=0]="FunctionUse",t[t.FunctionResult=1]="FunctionResult"}(i||(i={}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a}));var r=n(21);function i(t,e,n,i){return function(t,e){var n=s(t,e);if(0===n)return l(t[0][1]);if(n===t.length)return l(t[t.length-1][1]);var i=c(t,e,n),o=l(t[n-1][1]),a=l(t[n][1]);return r.k(o,o,1-i),r.k(a,a,i),r.a(o,o,a),o}(t.getStyle(e).curves[n],i)}function o(t,e,n,r){return a(t.getStyle(e).curves[n],r)}function a(t,e){var n=s(t,e);if(0===n)return t[0][1];if(n===t.length)return function(t,e){var n=t[t.length-1],r=n[2];return 1===r?n[1]:n[1]*Math.pow(r,e-n[0])}(t,e);var r=c(t,e,n);return(1-r)*t[n-1][1]+r*t[n][1]}function s(t,e){for(var n=0;n<t.length&&!(e<t[n][0]);)n++;return n}function c(t,e,n){var r=t[n-1][2],i=t[n][0]-t[n-1][0],o=e-t[n-1][0];return 1===r?o/i:(Math.pow(r,o)-1)/(Math.pow(r,i)-1)}function l(t){var e=t>>>24;return[(((t<<24>>>24)*e+127)/255>>>0)/255,(((t<<16>>>24)*e+127)/255>>>0)/255,(((t<<8>>>24)*e+127)/255>>>0)/255,e/255]}},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"m",(function(){return a})),n.d(e,"e",(function(){return s})),n.d(e,"h",(function(){return c})),n.d(e,"l",(function(){return l})),n.d(e,"k",(function(){return u})),n.d(e,"c",(function(){return d})),n.d(e,"j",(function(){return f})),n.d(e,"i",(function(){return h})),n.d(e,"f",(function(){return p})),n.d(e,"g",(function(){return m})),n.d(e,"d",(function(){return v})),n.d(e,"n",(function(){return _}));var r=n(13);function i(){var t=new r.a(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function s(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],c=e[6],l=e[7],u=e[8],d=e[9],f=e[10],h=e[11],p=e[12],m=e[13],v=e[14],_=e[15],g=n*s-r*a,y=n*c-i*a,b=n*l-o*a,x=r*c-i*s,w=r*l-o*s,S=i*l-o*c,O=u*m-d*p,M=u*v-f*p,j=u*_-h*p,I=d*v-f*m,T=d*_-h*m,E=f*_-h*v,A=g*E-y*T+b*I+x*j-w*M+S*O;return A?(A=1/A,t[0]=(s*E-c*T+l*I)*A,t[1]=(i*T-r*E-o*I)*A,t[2]=(m*S-v*w+_*x)*A,t[3]=(f*w-d*S-h*x)*A,t[4]=(c*j-a*E-l*M)*A,t[5]=(n*E-i*j+o*M)*A,t[6]=(v*b-p*S-_*y)*A,t[7]=(u*S-f*b+h*y)*A,t[8]=(a*T-s*j+l*O)*A,t[9]=(r*j-n*T-o*O)*A,t[10]=(p*w-m*b+_*g)*A,t[11]=(d*b-u*w-h*g)*A,t[12]=(s*M-a*I-c*O)*A,t[13]=(n*I-r*M+i*O)*A,t[14]=(m*y-p*x-v*g)*A,t[15]=(u*x-d*y+f*g)*A,t):null}function c(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],u=e[7],d=e[8],f=e[9],h=e[10],p=e[11],m=e[12],v=e[13],_=e[14],g=e[15],y=n[0],b=n[1],x=n[2],w=n[3];return t[0]=y*r+b*s+x*d+w*m,t[1]=y*i+b*c+x*f+w*v,t[2]=y*o+b*l+x*h+w*_,t[3]=y*a+b*u+x*p+w*g,y=n[4],b=n[5],x=n[6],w=n[7],t[4]=y*r+b*s+x*d+w*m,t[5]=y*i+b*c+x*f+w*v,t[6]=y*o+b*l+x*h+w*_,t[7]=y*a+b*u+x*p+w*g,y=n[8],b=n[9],x=n[10],w=n[11],t[8]=y*r+b*s+x*d+w*m,t[9]=y*i+b*c+x*f+w*v,t[10]=y*o+b*l+x*h+w*_,t[11]=y*a+b*u+x*p+w*g,y=n[12],b=n[13],x=n[14],w=n[15],t[12]=y*r+b*s+x*d+w*m,t[13]=y*i+b*c+x*f+w*v,t[14]=y*o+b*l+x*h+w*_,t[15]=y*a+b*u+x*p+w*g,t}function l(t,e,n){var r,i,o,a,s,c,l,u,d,f,h,p,m=n[0],v=n[1],_=n[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*_+e[12],t[13]=e[1]*m+e[5]*v+e[9]*_+e[13],t[14]=e[2]*m+e[6]*v+e[10]*_+e[14],t[15]=e[3]*m+e[7]*v+e[11]*_+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],l=e[6],u=e[7],d=e[8],f=e[9],h=e[10],p=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=c,t[6]=l,t[7]=u,t[8]=d,t[9]=f,t[10]=h,t[11]=p,t[12]=r*m+s*v+d*_+e[12],t[13]=i*m+c*v+f*_+e[13],t[14]=o*m+l*v+h*_+e[14],t[15]=a*m+u*v+p*_+e[15]),t}function u(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function d(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],c=i+i,l=o+o,u=a+a,d=i*c,f=i*l,h=i*u,p=o*l,m=o*u,v=a*u,_=s*c,g=s*l,y=s*u,b=r[0],x=r[1],w=r[2];return t[0]=(1-(p+v))*b,t[1]=(f+y)*b,t[2]=(h-g)*b,t[3]=0,t[4]=(f-y)*x,t[5]=(1-(d+v))*x,t[6]=(m+_)*x,t[7]=0,t[8]=(h+g)*w,t[9]=(m-_)*w,t[10]=(1-(d+p))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function f(t,e,n,r,i){var o=1/Math.tan(e/2),a=1/(r-i);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*a,t[15]=0,t}function h(t,e,n,r,i,o,a){var s=1/(e-n),c=1/(r-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*c,t[14]=(a+o)*l,t[15]=1,t}function p(t,e,n,i){var o,a,s,c,l,u,d,f,h,p,m=e[0],v=e[1],_=e[2],g=i[0],y=i[1],b=i[2],x=n[0],w=n[1],S=n[2];return Math.abs(m-x)<r.b&&Math.abs(v-w)<r.b&&Math.abs(_-S)<r.b?mat4.identity(t):(d=m-x,f=v-w,h=_-S,o=y*(h*=p=1/Math.sqrt(d*d+f*f+h*h))-b*(f*=p),a=b*(d*=p)-g*h,s=g*f-y*d,(p=Math.sqrt(o*o+a*a+s*s))?(o*=p=1/p,a*=p,s*=p):(o=0,a=0,s=0),c=f*s-h*a,l=h*o-d*s,u=d*a-f*o,(p=Math.sqrt(c*c+l*l+u*u))?(c*=p=1/p,l*=p,u*=p):(c=0,l=0,u=0),t[0]=o,t[1]=c,t[2]=d,t[3]=0,t[4]=a,t[5]=l,t[6]=f,t[7]=0,t[8]=s,t[9]=u,t[10]=h,t[11]=0,t[12]=-(o*m+a*v+s*_),t[13]=-(c*m+l*v+u*_),t[14]=-(d*m+f*v+h*_),t[15]=1,t)}var m=c;function v(t,e,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function _(t,e,n,i,o,a,s,c){var l=o[0]/o[1],u=n*Math.tan(r.d(e)/2),d=2*u,f=l*d,h=-f/2;c&&(h+=c.x*f/o[0],u-=c.y*d/o[1],f*=c.width/o[0],d*=c.height/o[1]);var p,m=h+f,v=u-d,_=2*n/(m-h),g=(m+h)/(m-h),y=(u+v)/(u-v),b=2*n/(u-v),x=-(i+n)/(i-n),w=-2*i*n/(i-n),S=0,O=0,M=s[0]-a[0],j=s[1]-a[1],I=s[2]-a[2],T=M*M+j*j+I*I;T>0&&(M*=p=1/Math.sqrt(T),j*=p,I*=p),(T=j*j+M*M)>0&&(S=-j*(p=1/Math.sqrt(T)),O=M*p);var E=-I*O,A=I*S,L=M*O-j*S,C=-(S*s[0]+O*s[1]),P=-(E*s[0]+A*s[1]+L*s[2]),k=-(M*s[0]+j*s[1]+I*s[2]);return t[0]=_*S+g*M,t[1]=b*E+y*M,t[2]=x*M,t[3]=-M,t[4]=_*O+g*j,t[5]=b*A+y*j,t[6]=x*j,t[7]=-j,t[8]=g*I,t[9]=b*L+y*I,t[10]=x*I,t[11]=-I,t[12]=_*C+g*k,t[13]=b*P+y*k,t[14]=x*k+w,t[15]=-k,t}},function(t,e,n){"use strict";var r={};n.r(r),n.d(r,"sinks",(function(){return B})),n.d(r,"checkRequiredAttrs",(function(){return F})),n.d(r,"processComponent",(function(){return D}));var i={};n.r(i),n.d(i,"sinks",(function(){return Z})),n.d(i,"checkRequiredAttrs",(function(){return H})),n.d(i,"processComponent",(function(){return G}));var o={};n.r(o),n.d(o,"sinks",(function(){return bt})),n.d(o,"checkRequiredAttrs",(function(){return xt})),n.d(o,"processComponent",(function(){return wt}));var a={};n.r(a),n.d(a,"sinks",(function(){return Ot})),n.d(a,"checkRequiredAttrs",(function(){return Mt})),n.d(a,"processComponent",(function(){return jt}));var s={};n.r(s),n.d(s,"sinks",(function(){return Ct})),n.d(s,"checkRequiredAttrs",(function(){return Pt})),n.d(s,"processComponent",(function(){return kt}));var c={};n.r(c),n.d(c,"sinks",(function(){return Ft})),n.d(c,"checkRequiredAttrs",(function(){return Dt})),n.d(c,"processComponent",(function(){return Ut}));var l={};n.r(l),n.d(l,"checkRequiredAttrs",(function(){return $t})),n.d(l,"sinks",(function(){return te})),n.d(l,"processComponent",(function(){return ee}));var u={};n.r(u),n.d(u,"sinks",(function(){return he})),n.d(u,"processElement",(function(){return pe})),n.d(u,"getLabelingInfo",(function(){return me}));var d={};n.r(d),n.d(d,"sinks",(function(){return ge})),n.d(d,"processElement",(function(){return ye})),n.d(d,"getLabelingInfo",(function(){return be}));var f={};n.r(f),n.d(f,"sinks",(function(){return Ne})),n.d(f,"processElement",(function(){return Re})),n.d(f,"getLabelingInfo",(function(){return ze}));var h=n(5),p=n(0),m=n(8),v=n(7),_=n(2),g=n(10),y=v.d(),b=v.d(),x=v.d(),w=v.d(),S=v.d(),O=v.d(),M=v.d(),j=v.d(),I=0,T=0;function E(t,e,n,r,i,o,a,s,c){if(!(r<2)){if(Object(g.c)(y,e[0],n[0],e[1],n[1]),I=0,i){var l=void 0!==s?s[0]:0,u=void 0!==c?c[0]:0;L(t,e[0],n[0],-y[0],-y[1],l,u,a)}for(var d=1;d<r;d++)A(t,e,n,d,r,a,s,c);o&&(l=void 0!==s?s[r-1]:0,u=void 0!==c?c[r-1]:0,L(t,e[r-1],n[r-1],y[0],y[1],l,u,a))}}function A(t,e,n,r,i,o,a,s){var c=r===i-1;if(v.o(S,e[r-1],n[r-1]),v.o(O,e[r],n[r]),void 0!==a&&void 0!==s?(v.o(x,a[r-1],s[r-1]),v.o(w,a[r],s[r])):(v.o(x,0,0),v.o(w,0,0)),Object(g.o)(j,y),c)T=0;else{v.o(M,e[r+1],n[r+1]),Object(g.c)(b,O[0],O[1],M[0],M[1]);var l=Object(_.e)(v.g(y,b),-1,1);if(l<=0)T=0,L(t,O[0],O[1],y[0],y[1],w[0],w[1],o);else{var u=Math.sqrt((1-l)/(1+l)),d=Object(_.H)(v.g(j,b));T=u*d}}!function(t,e,n,r,i,o,a){var s=t.indices.buffer,c=t.indices.offset,l=t.elements.offset;s[c]=l+0,s[c+1]=l+1,s[c+2]=l+3,s[c+3]=l+3,s[c+4]=l+1,s[c+5]=l+2,t.indices.offset=c+6}(t);var f=j[0]*m.e,h=j[1]*m.e;C(t,S[0],S[1],(j[0]+y[0]*I)*m.e,(j[1]+y[1]*I)*m.e,f,h,x[0],x[1],o),C(t,S[0],S[1],(-j[0]-y[0]*I)*m.e,(-j[1]-y[1]*I)*m.e,-f,-h,x[0],x[1],o),C(t,O[0],O[1],(-j[0]+y[0]*T)*m.e,(-j[1]+y[1]*T)*m.e,-f,-h,w[0],w[1],o),C(t,O[0],O[1],(j[0]-y[0]*T)*m.e,(j[1]-y[1]*T)*m.e,f,h,w[0],w[1],o),c||(v.c(y,b),I=T)}function L(t,e,n,r,i,o,a,s){!function(t,e,n,r){var i=t.indices.buffer,o=t.indices.offset,a=t.elements.offset;i[o]=a+0,i[o+1]=a+1,i[o+2]=a+2,t.indices.offset=o+3}(t);var c=.01*-r,l=.01*-i;C(t,e,n,r+c,i+l,r,i,o,a,s),C(t,e,n,-i+c,r+l,-i,r,o,a,s),C(t,e,n,i+c,-r+l,i,-r,o,a,s)}function C(t,e,n,r,i,o,a,s,c,l){var u=t.elements.offset*t.elements.stride,d=u>>1,f=u>>2;t.position[d]=e,t.position[d+1]=n,t.extender[u]=127*r,t.extender[u+1]=127*i,t.normal[u]=127*o,t.normal[u+1]=127*a,void 0!==t.shift&&(t.shift[f]=s,t.shift[f+1]=c),void 0!==t.localID&&(t.localID[f]=l),t.elements.offset++}var P,k,N,R,z=new Float64Array(12),B={solid:{stride:12,binder:function(t,e){t.position=new Uint16Array(e),t.extender=new Int8Array(e,4),t.normal=new Int8Array(e,6),t.localID=new Uint32Array(e,8)},packUniforms:function(t,e,n,r){return t[0]=e[n.color],t[1]=e[n.color2],t[2]=e[n.color3],t[3]=e[n.width],t[4]=e[n.width2],t[5]=e[n.width3],t[6]=e[n.minZoom],t[7]=e[n.maxZoom],t[8]=e[n.phase],t[9]=e[n.phase2],t[10]=e[n.phase3],t[11]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],color2:e[1],color3:e[2],width:e[3],width2:e[4],width3:e[5],minStyleZoom:e[6],maxStyleZoom:e[7],phase:e[8],phase2:e[9],phase3:e[10],styleId:e[11]}}}},F=function(t){var e=!Number.isNaN(t[p.i.color])&&!Number.isNaN(t[p.i.width]);return Number.isNaN(t[p.i.phase2])||(e=e&&!Number.isNaN(t[p.i.color2])&&!Number.isNaN(t[p.i.width2])),Number.isNaN(t[p.i.phase3])||(e=e&&!Number.isNaN(t[p.i.color3])&&!Number.isNaN(t[p.i.width3])),e},D=function(t,e,n,r,i,o,a,s){var c=n.tileProps;if(!Number.isNaN(i[p.i.phase])){var l=!Number.isNaN(o[c.beginningIsCut])&&0!==o[c.beginningIsCut],u=!Number.isNaN(o[c.endingIsCut])&&0!==o[c.endingIsCut],d=r.idIndexer.getIndex(o[c.id],i[p.i.phase],o[c.sublayer],t);E(r.getBucket(t,"solid",B.solid.packUniforms(z,i,p.i,e.id),B.solid.binder),a[0],a[1],s,!l,!u,d)}},U=new Float64Array(13),Z={solid:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.extender=new Int8Array(e,4),t.normal=new Int8Array(e,6),t.shift=new Float32Array(e,8)},packUniforms:function(t,e,n,r){return t[0]=e[n.color],t[1]=e[n.color2],t[2]=e[n.color3],t[3]=e[n.width],t[4]=e[n.width2],t[5]=e[n.width3],t[6]=e[n.minZoom],t[7]=e[n.maxZoom],t[8]=e[n.phase],t[9]=e[n.phase2],t[10]=e[n.phase3],t[11]=e[n.shift],t[12]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],color2:e[1],color3:e[2],width:e[3],width2:e[4],width3:e[5],minStyleZoom:e[6],maxStyleZoom:e[7],phase:e[8],phase2:e[9],phase3:e[10],shift:e[11],styleId:e[12]}}}},H=function(t){var e=!Number.isNaN(t[p.i.color])&&!Number.isNaN(t[p.i.width]);return Number.isNaN(t[p.i.phase2])||(e=e&&!Number.isNaN(t[p.i.color2])&&!Number.isNaN(t[p.i.width2])),Number.isNaN(t[p.i.phase3])||(e=e&&!Number.isNaN(t[p.i.color3])&&!Number.isNaN(t[p.i.width3])),e},G=function(t,e,n,r,i,o,a,s){var c=n.tileProps;if(!Number.isNaN(i[p.i.phase])){var l=!Number.isNaN(o[c.beginningIsCut])&&0!==o[c.beginningIsCut],u=!Number.isNaN(o[c.endingIsCut])&&0!==o[c.endingIsCut];E(r.getBucket(t,"solid",Z.solid.packUniforms(U,i,p.i,e.id),Z.solid.binder),a[0],a[1],s,!l,!u,0,a[2],a[3])}},W=n(55),V=n(56),q=n(71);!function(t){t[t.Striped=0]="Striped",t[t.Entrance=1]="Entrance"}(P||(P={})),function(t){t[t.Line=0]="Line",t[t.Arrow=1]="Arrow",t[t.StartBorder=2]="StartBorder",t[t.LineEnding=3]="LineEnding"}(k||(k={})),function(t){t[t.TileCut=0]="TileCut",t[t.ObjectEnding=1]="ObjectEnding"}(N||(N={})),function(t){t[t.Flat=0]="Flat",t[t.Circle=1]="Circle"}(R||(R={}));var Y,X,K=[.5,.5],J=[.5,.5],Q=[.5,.5],$=[.5,.5],tt=[0,0],et=null,nt=0,rt=0,it=0,ot=0,at={x:0,y:0,xn2:0,yn2:0,xn1:0,yn1:0,noTurn:!0,leftTurn:!1,sharpTurn:!1,reverseTurn:!1,extender:[.5,.5],faExtender:[.5,.5],saExtender:[.5,.5]};function st(t,e,n,r,i,o,a,s,c,l,u,d){var f,h,p,m,v,_,y,b,x,w;if(0!==t)if(et=u,Y=(X=d).indices,rt=X.elements.offset,nt=0,it=0,ot=0,1===t)f=e[0],h=n[0],w=0,vt(Y,rt,0,2,1,1,2,3),pt(X,et,0,f,h,1,-1,1,-1,w,!1),pt(X,et,0,f,h,-1,-1,-1,-1,w,!1),pt(X,et,0,f,h,1,1,1,1,w,!1),pt(X,et,0,f,h,-1,1,-1,1,w,!1),nt+=4;else{switch(p=e[0],m=n[0],v=e[1],_=n[1],w=0,i){case N.TileCut:Object(g.f)(K,p,m,a,s),Object(g.f)(Q,v,_,p,m),(x=ct(v,_,K[0],K[1],Q[0],Q[1])).noTurn?dt(p,m,Q[0],Q[1],w):ut(0,p,m,K[0],K[1],Q[0],Q[1],w);break;case N.ObjectEnding:Object(g.f)(Q,v,_,p,m),r===R.Flat?dt(p,m,Q[0],Q[1],w):(dt(p,m,-Q[0],-Q[1],w),ut(0,p,m,-Q[0],-Q[1],Q[0],Q[1],w));break;default:throw new Error("LoftedLine: unknown Ending Type")}for(var S=t-1,O=1;O<S;O++){p=e[O-1],m=n[O-1],v=e[O],_=n[O],y=e[O+1],b=n[O+1];var M=v-p,j=_-m;w+=Math.sqrt(M*M+j*j)/65536,Object(g.f)(K,v,_,p,m),Object(g.f)(Q,y,b,v,_),ut(O,v,_,K[0],K[1],Q[0],Q[1],w)}p=e[t-2],m=n[t-2];var I=(v=e[S])-p,T=(_=n[S])-m;switch(w+=Math.sqrt(I*I+T*T)/65536,o){case N.TileCut:Object(g.f)(K,v,_,p,m),Object(g.f)(Q,c,l,v,_),(x=ct(v,_,K[0],K[1],Q[0],Q[1])).noTurn?ft(S,v,_,Q[0],Q[1],w):ht(S,w,x);break;case N.ObjectEnding:Object(g.f)(Q,v,_,p,m),ft(S,v,_,Q[0],Q[1],w),r===R.Circle&&ut(S,v,_,Q[0],Q[1],-Q[0],-Q[1],w);break;default:throw new Error("LoftedLine: unknown Ending Type")}}}function ct(t,e,n,r,i,o){var a=function(t,e,n,r,i,o){var a=at;a.x=t,a.y=e,a.xn2=n,a.yn2=r,a.xn1=i,a.yn1=o;var s=n*i+r*o;return a.noTurn=s>.9999,a.leftTurn=n*-o+r*i<0,a.sharpTurn=s<0,a.reverseTurn=s<-.9999,a}(t,e,n,r,i,o);if(a.noTurn||a.reverseTurn)a.extender[0]=0,a.extender[1]=0,a.faExtender[0]=0,a.faExtender[1]=0,a.saExtender[0]=0,a.saExtender[1]=0;else{Object(g.d)(J,n,r,i,o);var s=J[0],c=J[1];a.extender[0]=s,a.extender[1]=c,a.faExtender[0]=s-2*n,a.faExtender[1]=c-2*r,a.saExtender[0]=s-2*i,a.saExtender[1]=c-2*o}return a}function lt(t,e,n,r,i,o,a,s){Object(g.d)(J,r,i,o,a),r*-a+i*o<0?pt(X,et,t,e,n,-J[0],-J[1],-J[0],-J[1],s,!1):pt(X,et,t,e,n,J[0],J[1],J[0],J[1],s,!1),nt++}function ut(t,e,n,r,i,o,a,s){var c=ct(e,n,r,i,o,a);ht(t,s,c),function(t,e,n){if(!n.noTurn){var r,i,o=n.sharpTurn?2:1;n.reverseTurn?(r=ot,i=it):n.leftTurn?(r=it,i=nt+o):(r=nt+o,i=ot);var a=nt;if(n.leftTurn,mt(Y,rt,it,ot,a),n.sharpTurn){var s=nt+1;n.leftTurn?vt(Y,rt,a,s,r,r,s,i):vt(Y,rt,a,i,s,s,i,r)}else n.leftTurn,mt(Y,rt,a,i,r);n.sharpTurn?(n.leftTurn?Object(g.f)($,n.xn2,n.yn2,n.xn1,n.yn1):Object(g.f)($,n.xn1,n.yn1,n.xn2,n.yn2),lt(t,n.x,n.y,n.xn2,n.yn2,$[0],$[1],e),lt(t,n.x,n.y,$[0],$[1],n.xn1,n.yn1,e)):lt(t,n.x,n.y,n.xn2,n.yn2,n.xn1,n.yn1,e),n.reverseTurn||(n.leftTurn?pt(X,et,t,n.x,n.y,-n.xn1,-n.yn1,-n.xn1,-n.yn1,e,!1):pt(X,et,t,n.x,n.y,n.xn1,n.yn1,n.xn1,n.yn1,e,!1),nt++),ot=i,it=r}}(t,s,c),function(t,e,n){if(!n.noTurn&&!n.reverseTurn){var r=nt+1,i=nt;n.leftTurn?(pt(X,et,t,n.x,n.y,-n.xn1,-n.yn1,n.saExtender[0],n.saExtender[1],e,!1),pt(X,et,t,n.x,n.y,n.xn1,n.yn1,n.extender[0],n.extender[1],e,!1)):(pt(X,et,t,n.x,n.y,-n.xn1,-n.yn1,-n.extender[0],-n.extender[1],e,!1),pt(X,et,t,n.x,n.y,n.xn1,n.yn1,-n.saExtender[0],-n.saExtender[1],e,!1)),nt+=2,n.leftTurn?vt(Y,rt,ot,i,it,it,i,r):vt(Y,rt,it,ot,r,r,ot,i),ot=i,it=r}}(t,s,c)}function dt(t,e,n,r,i){pt(X,et,0,t,e,-n,-r,-n,-r,i,!1),pt(X,et,0,t,e,n,r,n,r,i,!1),nt+=2,it=1,ot=0}function ft(t,e,n,r,i,o){var a=nt+1,s=nt;pt(X,et,t,e,n,-r,-i,-r,-i,o,!1),pt(X,et,t,e,n,r,i,r,i,o,!1),nt+=2,vt(Y,rt,ot,s,it,it,s,a),it=a,ot=s}function ht(t,e,n){if(!n.noTurn){var r=nt+1,i=nt;if(n.reverseTurn?(pt(X,et,t,n.x,n.y,-n.xn2,-n.yn2,-n.xn2,-n.yn2,e,!1),pt(X,et,t,n.x,n.y,n.xn2,n.yn2,n.xn2,n.yn2,e,!1)):n.leftTurn?(pt(X,et,t,n.x,n.y,-n.xn2,-n.yn2,n.faExtender[0],n.faExtender[1],e,!0),pt(X,et,t,n.x,n.y,n.xn2,n.yn2,n.extender[0],n.extender[1],e,!0)):(pt(X,et,t,n.x,n.y,-n.xn2,-n.yn2,-n.extender[0],-n.extender[1],e,!0),pt(X,et,t,n.x,n.y,n.xn2,n.yn2,-n.faExtender[0],-n.faExtender[1],e,!0)),nt+=2,vt(Y,rt,ot,i,it,it,i,r),ot=i,it=r,!n.reverseTurn){var o=nt+1,a=nt;n.leftTurn?(pt(X,et,t,n.x,n.y,-n.xn2,-n.yn2,-n.xn2,-n.yn2,e,!1),pt(X,et,t,n.x,n.y,0,0,0,0,e,!1),vt(Y,rt,r,i,o,o,i,a)):(pt(X,et,t,n.x,n.y,0,0,0,0,e,!1),pt(X,et,t,n.x,n.y,n.xn2,n.yn2,n.xn2,n.yn2,e,!1),vt(Y,rt,i,a,r,r,a,o)),nt+=2,ot=a,it=o}}}function pt(t,e,n,r,i,o,a,s,c,l,u){var d=t.elements.offset*e.offsetMultiplier,f=d>>1;if(t.position[d]=r,t.position[d+1]=i,t.extender[d]=Math.floor(s*m.e*127+.5),t.extender[d+1]=Math.floor(c*m.e*127+.5),e.type===P.Striped)t.vertexDistance[f]=l,t.objectLength[f]=e.oLen,t.texExtender[d]=Object(g.i)(o*m.e,a*m.e),t.componentDistance[f]=e.cDist;else if(e.type===P.Entrance){var h=e.px,p=e.py,v=0===n,_=n===e.count-1,y=v?n:n-1,b=v?n+1:n;Object(g.c)(tt,h[y],p[y],h[b],p[b]),t.direction[d]=Math.round(127*tt[0]),t.direction[d+1]=Math.round(127*tt[1]),t.texExtender[d]=Object(g.i)(o*(u||_?-1:1)*m.e,a*(u||_?-1:1)*m.e),t.type[f]=_?k.LineEnding:k.Line,t.vertexDistance[f]=l,t.objectLength[f]=e.oLen}t.localID[f]=e.localID,t.elements.offset++}function mt(t,e,n,r,i){var o=t.buffer,a=t.offset;o[a]=e+n,o[a+1]=e+r,o[a+2]=e+i,t.offset=a+3}function vt(t,e,n,r,i,o,a,s){var c=t.buffer,l=t.offset;c[l]=e+n,c[l+1]=e+r,c[l+2]=e+i,c[l+3]=e+o,c[l+4]=e+a,c[l+5]=e+s,t.offset=l+6}var _t=n(25),gt=new Float64Array(14),yt={type:P.Striped,cDist:0,oLen:0,localID:0,offsetMultiplier:14},bt={stroke:{stride:28,binder:function(t,e){t.position=new Uint16Array(e),t.extender=new Int16Array(e,4),t.texExtender=new Uint16Array(e,8),t.vertexDistance=new Float32Array(e,12),t.componentDistance=new Float32Array(e,16),t.objectLength=new Float32Array(e,20),t.localID=new Uint32Array(e,24)},packUniforms:function(t,e,n,r){return t[0]=e[n.width],t[1]=Number.isNaN(e[n.width2])?e[n.width]:e[n.width2],t[2]=e[n.dashColor],t[3]=Number.isNaN(e[n.dash2Color])?e[n.dashColor]:e[n.dash2Color],t[4]=e[n.spaceColor],t[5]=e[n.borderColor],t[6]=e[n.dashLength],t[7]=Number.isNaN(e[n.dash2Length])?e[n.dashLength]:e[n.dash2Length],t[8]=e[n.spaceLength],t[9]=e[n.minZoom],t[10]=e[n.maxZoom],t[11]=e[n.phase],t[12]=e[n.phase2],t[13]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{width:e[0],width2:e[1],dashColor:e[2],dash2Color:e[3],spaceColor:e[4],borderColor:e[5],dashLength:e[6],dash2Length:e[7],spaceLength:e[8],minStyleZoom:e[9],maxStyleZoom:e[10],phase:e[11],phase2:e[12],styleId:e[13]}}}},xt=function(t){switch(_t.a[t[p.i.symbol]]){case"stripedLine":return function(t){return!(Number.isNaN(t[p.i.width])||Number.isNaN(t[p.i.dashColor])||Number.isNaN(t[p.i.borderColor])||Number.isNaN(t[p.i.spaceColor])||Number.isNaN(t[p.i.dashLength])||Number.isNaN(t[p.i.spaceLength]))}(t);case"dashedLine":return function(t){return!(Number.isNaN(t[p.i.width])||Number.isNaN(t[p.i.dashColor])||Number.isNaN(t[p.i.dashLength])||Number.isNaN(t[p.i.spaceLength]))}(t);default:return!0}},wt=function(t,e,n,r,i,o,a,s){var c=n.tileProps;if(!Number.isNaN(i[p.i.phase])){var l=r.getBucket(t,"stroke",bt.stroke.packUniforms(gt,i,p.i,e.id),bt.stroke.binder),u=r.idIndexer.getIndex(o[c.id],i[p.i.phase],o[c.sublayer],t),d=function(t,e,n){return yt.cDist=t,yt.oLen=e,yt.localID=n,yt}(o[c.componentDistanceStart]/65536,o[c.objectLength]/65536,u),f=!Number.isNaN(o[c.beginningIsCut])&&0!==o[c.beginningIsCut],h=!Number.isNaN(o[c.endingIsCut])&&0!==o[c.endingIsCut];st(s,a[0],a[1],R.Flat,f?N.TileCut:N.ObjectEnding,h?N.TileCut:N.ObjectEnding,o[c.previousPointX],o[c.previousPointY],o[c.nextPointX],o[c.nextPointY],d,l)}},St=new Float64Array(6),Ot={stroke:{stride:8,binder:function(t,e){t.position=new Uint16Array(e),t.extender=new Int8Array(e,4),t.normal=new Int8Array(e,6),t.localID=new Uint32Array(e,8)},packUniforms:function(t,e,n,r){return t[0]=e[n.color],t[1]=e[n.width],t[2]=e[n.minZoom],t[3]=e[n.maxZoom],t[4]=e[n.phase],t[5]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],width:e[1],minStyleZoom:e[2],maxStyleZoom:e[3],phase:e[4],styleId:e[5]}}}},Mt=function(t){return!Number.isNaN(t[p.i.color])},jt=function(t,e,n,r,i,o,a,s){Number.isNaN(i[p.i.phase])||E(r.getBucket(t,"stroke",Ot.stroke.packUniforms(St,i,p.i,e.id),Ot.stroke.binder),a[0],a[1],s,!0,!0,0)},It=n(65),Tt=new Float64Array(14),Et=v.d(),At=v.d(),Lt={type:P.Entrance,offsetMultiplier:18,cDist:0,oLen:0,px:null,py:null,count:0,localID:0},Ct={stroke:{stride:36,binder:function(t,e){t.position=new Uint16Array(e),t.segmentEnd=new Uint16Array(e,4),t.texExtender=new Uint16Array(e,8),t.arrowExtender=new Uint16Array(e,10),t.extender=new Int16Array(e,12),t.direction=new Int16Array(e,16),t.vertexDistance=new Float32Array(e,20),t.objectLength=new Float32Array(e,24),t.type=new Float32Array(e,28),t.localID=new Uint32Array(e,32)},packUniforms:function(t,e,n,r,i){return t[0]=e[n.width],t[1]=e[n.wingHeightMultiplier],t[2]=e[n.wingWidthMultiplier],t[3]=e[n.tipHeightMultiplier],t[4]=e[n.color],t[5]=e[n.borderColor],t[6]=e[n.borderWidth],t[7]=e[n.tipMovementAmplitude],t[8]=r>2?1:0,t[9]=e[n.minZoom],t[10]=e[n.maxZoom],t[11]=e[n.phase],t[12]=i,t[13]=e[n.groupId],t},unpackUniforms:function(t){var e=new Float64Array(t),n={width:e[0],wingHeightMultiplier:e[1],wingWidthMultiplier:e[2],tipHeightMultiplier:e[3],color:e[4],borderColor:e[5],borderWidth:e[6],tipMovementAmplitude:e[7],isLongArrow:!!e[8],minStyleZoom:e[9],maxStyleZoom:e[10],phase:e[11],styleId:e[12]};return n.wingNormal=v.j(-n.wingWidthMultiplier,-n.wingHeightMultiplier),v.n(n.wingNormal,n.wingNormal),n.tipNormal=v.j(n.wingWidthMultiplier,n.tipHeightMultiplier),v.n(n.tipNormal,n.tipNormal),n}}},Pt=function(t){return!(Number.isNaN(t[p.i.width])||Number.isNaN(t[p.i.wingWidthMultiplier])||Number.isNaN(t[p.i.wingHeightMultiplier])||Number.isNaN(t[p.i.tipHeightMultiplier])||Number.isNaN(t[p.i.color])||Number.isNaN(t[p.i.borderColor]))},kt=function(t,e,n,r,i,o,a,s){var c=n.tileProps,l=a[0],u=a[1],d=a[2];if(!Number.isNaN(i[p.i.phase])){var f=r.getBucket(t,"stroke",Ct.stroke.packUniforms(Tt,i,p.i,s,e.id),Ct.stroke.binder),h=r.idIndexer.getIndex(o[c.id],i[p.i.phase],o[c.sublayer],t),m=function(t,e,n){return Lt.px=t[0],Lt.py=t[1],Lt.oLen=t[2][e-1]/65536,Lt.count=e,Lt.localID=n,Lt}(a,s,h);st(s,a[0],a[1],R.Flat,N.ObjectEnding,N.ObjectEnding,0,0,0,0,m,f),Nt(f,k.StartBorder,l[0],u[0],l[1],u[1],0,0,0,d[s-1],h);for(var v=0;v<s-1;v++)Nt(f,k.Arrow,l[v],u[v],l[v+1],u[v+1],-1,0,d[v],d[s-1],h)}};function Nt(t,e,n,r,i,o,a,s,c,l,u){!function(t,e,n,r,i,o,a){var s=t.elements,c=t.indices,l=c.buffer,u=c.offset,d=s.offset;l[u]=d+1,l[u+1]=d+2,l[u+2]=d+0,l[u+3]=d+0,l[u+4]=d+2,l[u+5]=d+3,c.offset=u+6}(t),Rt(t,e,n,r,i,o,a,s,-1,-1,c,l,!0,u),Rt(t,e,n,r,i,o,a,s,1,-1,c,l,!1,u),Rt(t,e,n,r,i,o,a,s,1,1,c,l,!1,u),Rt(t,e,n,r,i,o,a,s,-1,1,c,l,!0,u)}function Rt(t,e,n,r,i,o,a,s,c,l,u,d,f,h){var p=t.elements,v=p.stride*p.offset>>1,_=v>>1;Object(g.c)(Et,n,r,i,o),Object(g.o)(At,Et),t.position[v]=n,t.position[v+1]=r,t.segmentEnd[v]=i,t.segmentEnd[v+1]=o,t.texExtender[v]=Object(g.i)(At[0]*l*(f?-1:1)*m.e,At[1]*l*(f?-1:1)*m.e),t.arrowExtender[v]=Object(g.i)(c*m.e,l*m.e);var y=c+a,b=l+s,x=Et[0]*y+At[0]*b,w=Et[1]*y+At[1]*b;t.extender[v]=Math.round(x*m.e*127),t.extender[v+1]=Math.round(w*m.e*127),t.direction[v]=Math.round(127*Et[0]),t.direction[v+1]=Math.round(127*Et[1]),t.vertexDistance[_]=u/65536,t.objectLength[_]=d/65536,t.type[_]=e,t.localID[_]=h,t.elements.offset++}var zt=n(68),Bt=new Float64Array(10),Ft={fill:{stride:12,binder:function(t,e){t.position=new Uint16Array(e),t.extender=new Int16Array(e,4),t.localID=new Uint32Array(e,8)},packUniforms:function(t,e,n){return t[0]=e[p.i.color],t[1]=e[p.i.color2],t[2]=e[p.i.color3],t[3]=e[p.i.width],t[4]=e[p.i.width2],t[5]=e[p.i.width3],t[6]=e[p.i.minZoom],t[7]=e[p.i.maxZoom],t[8]=e[p.i.phase],t[9]=n,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],color2:e[1],color3:e[2],width:e[3],width2:e[4],width3:e[5],minStyleZoom:e[6],maxStyleZoom:e[7],phase:e[8],phase2:e[8],phase3:e[8],styleId:e[9]}}}},Dt=function(){return!0},Ut=function(t,e,n,r,i,o,a){var s=n.tileProps,c=r.getBucket(t,"fill",Ft.fill.packUniforms(Bt,i,e.id),Ft.fill.binder),l=r.idIndexer.getIndex(o[s.id],i[p.i.phase],o[s.sublayer],t),u=a[0][0],d=a[1][0];!function(t,e,n,r,i,o,a){var s=t.elements,c=t.indices,l=c.buffer,u=c.offset,d=s.offset;l[u]=d+0,l[u+1]=d+2,l[u+2]=d+1,l[u+3]=d+0,l[u+4]=d+3,l[u+5]=d+2,c.offset=u+6}(c),Zt(c,u,d,-1,-1,l),Zt(c,u,d,-1,1,l),Zt(c,u,d,1,1,l),Zt(c,u,d,1,-1,l)};function Zt(t,e,n,r,i,o){var a=t.elements.offset*t.elements.stride>>1,s=a>>1;t.position[a]=e,t.position[a+1]=n,t.extender[a]=r,t.extender[a+1]=i,t.localID[s]=o,t.elements.offset++}var Ht=n(50),Gt=n(39),Wt=n(34),Vt=new Float64Array(6),qt=new Float64Array(7),Yt=new Float64Array(6),Xt=v.d(),Kt=v.d(),Jt=v.d(),Qt=v.d(),$t=function(t){return!(Number.isNaN(t[p.i.borderColor])||Number.isNaN(t[p.i.wallColor])||Number.isNaN(t[p.i.borderWidth])||Number.isNaN(t[p.i.styleHeight]))},te={fill:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.normal=new Uint16Array(e,8)},packUniforms:function(t,e,n,r){return t[0]=e[n.styleHeight],t[1]=e[n.wallColor],t[2]=e[n.minZoom],t[3]=e[n.maxZoom],t[4]=e[n.phase],t[5]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{height:e[0],color:e[1],minStyleZoom:e[2],maxStyleZoom:e[3],phase:e[4],styleId:e[5]}}},roofStroke:{stride:12,binder:function(t,e){t.position=new Uint16Array(e),t.directionDistance=new Int8Array(e,8)},packUniforms:function(t,e,n,r){return t[0]=e[n.styleHeight],t[1]=e[n.borderColor],t[2]=e[n.borderWidth],t[3]=e[n.minZoom],t[4]=e[n.maxZoom],t[5]=e[n.phase],t[6]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{height:e[0],color:e[1],width:e[2],minStyleZoom:e[3],maxStyleZoom:e[4],phase:e[5],styleId:e[6]}}},wallStroke:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.distance=new Int16Array(e,6),t.normals=new Uint16Array(e,8),t.direction=new Uint16Array(e,12)},packUniforms:function(t,e,n,r){return t[0]=e[n.styleHeight],t[1]=e[n.wallColor],t[2]=e[n.minZoom],t[3]=e[n.maxZoom],t[4]=e[n.phase],t[5]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{height:e[0],color:e[1],minStyleZoom:e[2],maxStyleZoom:e[3],phase:e[4],styleId:e[5]}}}},ee=function(t,e,n,r,i,o,a,s){var c=a[0],l=a[1];if(!Number.isNaN(i[p.i.phase])){for(var u=r.getBucket(t,"fill",te.fill.packUniforms(Vt,i,p.i,e.id),te.fill.binder),d=r.getBucket(t,"roofStroke",te.roofStroke.packUniforms(qt,i,p.i,e.id),te.roofStroke.binder),f=r.getBucket(t,"wallStroke",te.wallStroke.packUniforms(Yt,i,p.i,e.id),te.wallStroke.binder),h=0;h<s-1;h++){var m=c[h],_=l[h],g=c[h+1],y=l[h+1];v.o(Xt,m,g),v.o(Kt,_,y),v.o(Jt,g,m),v.o(Qt,y,_),Object(Ht.a)(u,2,Xt,Kt,void 0,1),Object(Gt.a)(d,m,_,1,g,y,1),Object(Wt.a)(f,2,Xt,Kt,void 0),Object(Wt.a)(f,2,Jt,Qt,void 0),Object(Wt.b)(f,2,Xt,Kt,void 0,1)}v.o(Xt,c[s-1],c[0]),v.o(Kt,l[s-1],l[0]),Object(Wt.b)(f,2,Xt,Kt,void 0,1)}},ne=n(73),re=n(61),ie=n(57),oe=n(74),ae=n(3),se=n(40),ce=n(1),le=n(17),ue=new Float64Array(11),de=[0,0,0],fe=[0,0],he={raster:{stride:28,binder:function(t,e){t.position=new Uint16Array(e),t.texCoords=new Uint16Array(e,8),t.cornerOffset=new Float32Array(e,12),t.styleZoomLimits=new Float32Array(e,20)},packUniforms:function(t,e,n,r){return t[0]=e.font,t[1]=e.color,t[2]=e.haloColor,t[3]=e.fontSize,t[4]=e.haloRadius,t[5]=e.phase,t[6]=e.styleId,t[7]=n,t[8]=r,t[9]=e.minDisplayStyleZoom,t[10]=e.maxDisplayStyleZoom,t},unpackUniforms:function(t){var e=new Float64Array(t);return{font:e[0],fontColor:e[1],haloColor:e[2],fontSize:e[3],haloRadius:e[4],phase:e[5],styleId:e[6],animDirection:e[7],range:e[8],minStyleZoom:e[9],maxStyleZoom:e[10]}}}},pe=function(t,e,n,r,i,o,a,s){for(var c=r.label,l=r.anchorPosition,u=r.anchorSegmentIndex,d=r.halfLabelWidth,f=c.fontSize,h=c.axis,p=c.letterSpacing,m=t.curves,v=a.center,y=a.styleZoom,b={},x=0,w=c.ranges;x<w.length;x++){var S=w[x];b[S]=n.getBucket("labelLine","raster",he.raster.packUniforms(ue,c,i,S),he.raster.binder)}var O=c.textMetrics.lines[0],M=Object(le.c)(m[f],y)/ce.fonts.baseSize,j=O.glyphs,I=function(t,e,n,r){var i=t.interpolate(e-n,t.getSegmentIndex(e-n)),o=t.interpolate(e+n,t.getSegmentIndex(e+n)),a=Math.atan2(o[1]-i[1],o[0]-i[0])-r;return Math.cos(a)<0}(h,l,d,a.rotation);fe[0]=-O.width/2,fe[1]=0;for(var T=0;T<j.length;T++){for(var E=j[T],A=(fe[0]+E.left+E.width/2)*M*(I?-1:1),L=Object(_.H)(A)||1,C=-1/0,P=1/0,k=u;k>=1&&k<h.vertexCount&&!(P<r.overflowStyleZoom);k+=L,P=C){var N=1===L?k:k-1;C=Object(ae.f)(Object(g.q)(A,h.lengths[N]-l),v);var R=h.interpolate(l,k);Object(ae.k)(de,R,s),Object(g.h)(de)&&void 0!==E.bitmap&&Object(se.a)(b[E.range],de,fe,E,R[3]+(I?Math.PI:0),Math.max(C,r.overflowStyleZoom),P)}fe[0]+=E.advance+ce.fonts.baseSize*p}},me=function(){},ve=new Float64Array(13),_e=[0,0,0],ge={raster:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.direction=new Uint16Array(e,8),t.widenDirection=new Uint16Array(e,12)},packUniforms:function(t,e,n){return t[0]=e.color,t[1]=e.borderColor,t[2]=e.width,t[3]=e.length,t[4]=e.borderWidth,t[5]=e.tipHeightMultiplier,t[6]=e.wingHeightMultiplier,t[7]=e.wingWidthMultiplier,t[8]=e.styleId,t[9]=e.phase,t[10]=n,t[11]=e.minDisplayStyleZoom,t[12]=e.maxDisplayStyleZoom,t},unpackUniforms:function(t){var e=new Float64Array(t),n={color:e[0],borderColor:e[1],width:e[2],length:e[3],borderWidth:e[4],tipHeightMultiplier:e[5],wingHeightMultiplier:e[6],wingWidthMultiplier:e[7],styleId:e[8],phase:e[9],animDirection:e[10],minStyleZoom:e[11],maxStyleZoom:e[12]};return n.wingNormal=v.j(-n.wingWidthMultiplier,-n.wingHeightMultiplier),v.n(n.wingNormal,n.wingNormal),n.tipNormal=v.j(n.wingWidthMultiplier,n.tipHeightMultiplier),v.n(n.tipNormal,n.tipNormal),n}}},ye=function(t,e,n,r,i,o,a,s){var c=r.label,l=r.anchorWorld;if(Object(ae.k)(_e,l,s),Object(g.h)(_e)){var u=n.getBucket("oneWayLine","raster",ge.raster.packUniforms(ve,c,i),ge.raster.binder);Object(se.b)(u,_e,l[3])}},be=function(){},xe=n(64),we=n(72),Se=n(60),Oe=n(46),Me=n(47),je=n(22),Ie=n(15),Te=new Float64Array(6),Ee=new Float64Array(13),Ae=new Se.a,Le=new we.a,Ce=[0,0,0];function Pe(t,e){t.position=new Uint16Array(e),t.cornerOffset=new Int16Array(e,8),t.texCoords=new Uint16Array(e,12),t.localID=new Uint32Array(e,16)}function ke(t){var e=new Float64Array(t);return{font:e[0],fontColor:e[1],haloColor:e[2],fontSize:e[3],haloRadius:e[4],offsetX:e[5],offsetY:e[6],phase:e[7],styleId:e[8],animDirection:e[9],range:e[10],minStyleZoom:e[11],maxStyleZoom:e[12]}}var Ne={raster:{stride:24,binder:function(t,e){t.position=new Uint16Array(e),t.cornerOffset=new Int16Array(e,8),t.texCoords=new Uint16Array(e,12),t.scales=new Int16Array(e,16),t.localID=new Uint32Array(e,20)},packUniforms:function(t,e,n,r,i,o,a){return t[0]=n,t[1]=e,t[2]=a,t[3]=r,t[4]=i,t[5]=o,t},unpackUniforms:function(t){var e=new Float64Array(t);return{atlasIndex:e[0],phase:e[1],styleId:e[2],animDirection:e[3],minStyleZoom:e[4],maxStyleZoom:e[5]}}},text:{stride:20,binder:Pe,packUniforms:function(t,e,n,r,i,o){return t[0]=e.font,t[1]=e.fontColor,t[2]=e.haloColor,t[3]=e.fontSize,t[4]=e.haloRadius,t[5]=n[0],t[6]=-n[1],t[7]=e.phase,t[8]=o,t[9]=r,t[10]=i,t[11]=e.minDisplayStyleZoom,t[12]=e.maxDisplayStyleZoom,t},unpackUniforms:ke},text2:{stride:20,binder:Pe,packUniforms:function(t,e,n,r,i,o){return t[0]=e.font2,t[1]=e.font2Color,t[2]=e.halo2Color,t[3]=e.font2Size,t[4]=e.halo2Radius,t[5]=n[0],t[6]=-n[1],t[7]=e.phase,t[8]=o,t[9]=r,t[10]=i,t[11]=e.minDisplayStyleZoom,t[12]=e.maxDisplayStyleZoom,t},unpackUniforms:ke}},Re=function(t,e,n,r,i,o,a,s){var c=r.label,l=t.rasterSets[c.rasterSet],u=Object(Oe.a)(t.curves,l.rasters,c.iconWidth,c.minWidth,c.maxWidth,c.minWidthScale,c.maxWidthScale,o);if(Ae.calculate(l.rasters,u,o),!Ae.isEmpty()){var d=Ae.getActivePlacement(a.styleZoom).rasterIndex,f=l.rasters[d],h=[f.w/o,f.h/o],p=Object(je.b)([f.anchorX,f.anchorY],h);switch(r.type){case Ie.c.Icon:!function(t,e,n,r,i,o){var a=n.label,s=t.rasterSets[a.rasterSet];if(Object(ae.k)(Ce,a.anchorWorld,i),Object(g.h)(Ce)){Object(xe.b)(ce.atlasSize,s.rasters,Ae,Le);var c=Ae.getActivePlacement(r),l=c.index,u=c.rasterIndex,d=s.rasters[u].atlasIndex;e.atlasPacker.addRastersToLoad(a.styleId,s,Ae);var f=e.getBucket(a.symbol,"raster",Ne.raster.packUniforms(Te,a.phase,d,o,a.minDisplayStyleZoom,a.maxDisplayStyleZoom,t.id),Ne.raster.binder);Object(xe.a)(Ce[0],Ce[1],Ce[2],Le,l,f,-1/0,1/0,a.identifyIndex)}}(t,n,r,a.styleZoom,s,i);break;case Ie.c.PoiText:!function(t,e,n,r,i,o,a,s){var c=n.label,l=c.textMetrics;if(Object(ae.k)(Ce,c.anchorWorld,o),Object(g.h)(Ce)){for(var u=Object(le.c)(t.curves[c.fontSize],i),d=u/ce.fonts.baseSize,f=c.lineHeight*u*l.lines.length,h=l.maxWidth*d,p=Number.isNaN(c.poiLabelOffset)?0:Object(le.c)(t.curves[c.poiLabelOffset],i),m=Object(je.c)(c.possibleLabelPlacements),v=Object(je.d)(m[n.placementIndex],r,[h,f],s,p),_={},y=0,b=c.ranges;y<b.length;y++){var x=b[y];_[x]=e.getBucket(c.symbol,"text",Ne.text.packUniforms(Ee,c,v,a,x,t.id),Ne.text.binder)}Object(se.c)(_,c,Ce,c.textMetrics)}}(t,n,r,h,a.styleZoom,s,i,p);break;case Ie.c.PoiText2:!function(t,e,n,r,i,o,a,s){var c=n.label,l=c.textMetrics,u=c.textMetrics2;if(u&&(Object(ae.k)(Ce,c.anchorWorld,o),Object(g.h)(Ce))){var d=Object(le.c)(t.curves[c.font2Size],i),f=d/ce.fonts.baseSize,h=c.lineHeight*d*u.lines.length,p=u.maxWidth*f,m=Number.isNaN(c.poiLabelOffset)?0:Object(le.c)(t.curves[c.poiLabelOffset],i),v=Number.isNaN(c.label2Offset)?0:Object(le.c)(t.curves[c.label2Offset],i),_=Object(le.c)(t.curves[c.fontSize],i),y=c.lineHeight*_*l.lines.length,b=Object(je.c)(c.possibleLabelPlacements),x=Object(je.d)(b[n.placementIndex],r,[p,y],s,m);x[1]+=y/2+h/2+v;for(var w={},S=0,O=c.ranges;S<O.length;S++){var M=O[S];w[M]=e.getBucket(c.symbol,"text",Ne.text2.packUniforms(Ee,c,x,a,M,t.id),Ne.text2.binder)}Object(se.c)(w,c,Ce,u)}}(t,n,r,h,a.styleZoom,s,i,p)}}},ze=function(t,e,n,r,i,o){var a=e.rasterSets[t.rasterSet],s=Object(Oe.a)(e.curves,a.rasters,t.iconWidth,t.minWidth,t.maxWidth,t.minWidthScale,t.maxWidthScale,o);if(Ae.calculate(a.rasters,s,o),!Ae.isEmpty()){var c=Ae.getActivePlacement(r.styleZoom).rasterIndex,l=a.rasters[c],u=[l.w/o,l.h/o],d=new Me.a(t,Ie.c.Icon,t.anchorWorld,r,i,e,Object(je.e)(t.sublayer,n)),f=Object(je.b)([l.anchorX,l.anchorY],u);d.boxes.push([-u[0]/2+f[0],-u[1]/2+f[1],u[0]/2+f[0],u[1]/2+f[1]]),t.labelingElements[0]=d,t.label.length>0&&!Number.isNaN(t.font)&&(function(t,e,n,r,i,o){var a=t.textMetrics,s=Object(le.c)(e.curves[t.fontSize],r.styleZoom),c=s/ce.fonts.baseSize,l=Number.isNaN(t.poiLabelOffset)?0:Object(le.c)(e.curves[t.poiLabelOffset],r.styleZoom),u=t.lineHeight*s*a.lines.length,d=a.maxWidth*c,f=Object(je.c)(t.possibleLabelPlacements),h=new Me.a(t,Ie.c.PoiText,t.anchorWorld,r,i,e);h.parent=t.labelingElements[0];for(var p=0;p<f.length;p++){var m=f[p],v=Object(je.d)(m,n,[d,u],o,l);h.boxes.push([v[0]-d/2,v[1]-u/2,v[0]+d/2,v[1]+u/2])}t.labelingElements[1]=h}(t,e,u,r,i,f),t.label2&&function(t,e,n,r,i,o){var a=t.textMetrics,s=t.textMetrics2;if(s){var c=t.labelingElements[1],l=Object(le.c)(e.curves[t.font2Size],r.styleZoom),u=l/ce.fonts.baseSize,d=Number.isNaN(t.poiLabelOffset)?0:Object(le.c)(e.curves[t.poiLabelOffset],r.styleZoom),f=Number.isNaN(t.label2Offset)?0:Object(le.c)(e.curves[t.label2Offset],r.styleZoom),h=t.lineHeight*l*s.lines.length,p=s.maxWidth*u,m=Object(le.c)(e.curves[t.fontSize],r.styleZoom),v=t.lineHeight*m*a.lines.length,_=Object(je.c)(t.possibleLabelPlacements),g=new Me.a(t,Ie.c.PoiText2,t.anchorWorld,r,i,e);g.parent=t.labelingElements[0],g.firstLabel=c;for(var y=0;y<_.length;y++){var b=_[y],x=Object(je.d)(b,n,[p,v],o,d);x[1]+=v/2+h/2+f,g.boxes.push([x[0]-p/2,x[1]-h/2,x[0]+p/2,x[1]+h/2])}t.labelingElements[2]=g}}(t,e,u,r,i,f))}},Be=n(53),Fe=n(32);function De(t){var e=t.collector,n=t.generator,r=t.args;do{n.apply(void 0,Object(h.e)([e],r))}while(e.isOverloaded())}n.d(e,"a",(function(){return De})),n.d(e,"f",(function(){return Ye})),n.d(e,"e",(function(){return Xe})),n.d(e,"c",(function(){return Ke})),n.d(e,"d",(function(){return Je})),n.d(e,"b",(function(){return Qe}));var Ue={line:r,area:W,phasedArea:W,building:V,point:q,dashedLine:o,stripedLine:o,pixelLine:a,polyline:r,shiftedLine:i,polygon:W,entrance:s,circleMarker:c,fence:l},Ze={labelPoint:ie,labelLine:ie,oneWayLine:ie,poi:ie},He={labelPoint:oe,labelLine:u,oneWayLine:d,poi:f,marker:f},Ge={model:It},We={floor:zt},Ve={stretchableImage:Be,rect:ne,rectWithTexture:re},qe=function(t){var e=Ue[t]||He[t]||Ge[t]||We[t]||Ve[t];return e?e.sinks:void 0};function Ye(t,e,n){var r=qe(t);return r?r[e].unpackUniforms(n):{}}function Xe(t,e){var n=qe(t);return n?n[e].stride:0}function Ke(t,e,n,r,i,o,a,s,c,l,u,d,f,h){var p=Ue[t]||Ze[t];if(p){var m=n.tileProps;if(!p.checkRequiredAttrs(i,e))return void Object(Fe.c)(n.sublayersByIndex[o[m.sublayer]]);do{p.processComponent(t,e,n,r,i,o,a,s,c,l,u,d,f,h)}while(r.isOverloaded())}}function Je(t,e,n,r,i,o,a,s,c){var l=He[t];if(l)do{l.processElement(e,n,r,i,o,a,s,c)}while(r.isOverloaded())}function Qe(t,e,n,r,i,o,a){var s=He[t];s&&s.getLabelingInfo(e,n,r,i,o,a)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return l}));var r=1e5;function i(t){return[t%r,Math.floor(t/r)%r,0,0]}function o(t){for(var e=0,n=0;n<4;n++){var i=4294967296*t[n]+e;e=Math.floor(i/r),t[n]=i%r}}function a(t){for(var e=4,n=0;--e>=0;)n=n*r+t[e];return n}function s(t){t="00000000000000000000".slice(t.length)+t;for(var e=[0,0,0,0],n=0;n<4;n++){var r=parseInt(t.slice(5*n,5*(n+1)),10);e[3-n]=r}return e}function c(t,e){var n=i(t),a=i(e);return o(a),function(t,e){for(var n=0,i=0;i<4;i++){var o=t[i]+e[i]+n;n=Math.floor(o/r),t[i]=o%r}}(a,n),function(t){for(var e=!0,n=4,r="";--n>=0;){var i=String(t[n]);e?0!==t[n]&&(r+=i,e=!1):r+="00000".slice(i.length)+i}return r.length||(r="0"),r}(a)}function l(t){var e=s(t),n=i(0);!function(t,e){for(var n=4294967296,i=4,o=0;--i>=0;){var a=o*r+e[i],s=Math.floor(a/n);o=a-s*n,t[i]=s}}(n,e);var c=a(n);return o(n),function(t,e){for(var n=0,i=0;i<4;i++){var o=t[i]-e[i]-n;o<0?(o+=r,n=1):n=0,t[i]=o}}(e,n),[a(e),c]}},function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"g",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"l",(function(){return c})),n.d(e,"a",(function(){return l})),n.d(e,"k",(function(){return u})),n.d(e,"h",(function(){return d})),n.d(e,"m",(function(){return f})),n.d(e,"j",(function(){return h})),n.d(e,"d",(function(){return p})),n.d(e,"i",(function(){return m})),n.d(e,"f",(function(){return v})),n.d(e,"e",(function(){return _}));var r,i=n(13);function o(t){var e=new i.a(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(t,e,n,r){var o=new i.a(4);return o[0]=t,o[1]=e,o[2]=n,o[3]=r,o}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function c(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function l(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function u(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function d(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}function f(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function h(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a),t}function p(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function m(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t}function v(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _(t,e){var n=t[0],r=t[1],o=t[2],a=t[3],s=e[0],c=e[1],l=e[2],u=e[3];return Math.abs(n-s)<=i.b*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-c)<=i.b*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(o-l)<=i.b*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-u)<=i.b*Math.max(1,Math.abs(a),Math.abs(u))}(r=new i.a(4))[0]=0,r[1]=0,r[2]=0,r[3]=0},function(t,e,n){"use strict";n.d(e,"a",(function(){return u})),n.d(e,"c",(function(){return f})),n.d(e,"b",(function(){return h})),n.d(e,"d",(function(){return p})),n.d(e,"e",(function(){return m})),n.d(e,"f",(function(){return v})),n.d(e,"i",(function(){return _})),n.d(e,"h",(function(){return g})),n.d(e,"j",(function(){return y})),n.d(e,"g",(function(){return b}));var r=n(1),i=new Set(r.commercialSublayers),o=new Set(r.personalSublayers),a=new Set(r.branchPoiSublayers),s=new Set(r.transportPoiSublayers),c=new Set(r.cityNameSublayers),l=new Set(r.landmarkPoiSublayers),u={NoLabel:0,BottomCenter:1,BottomRight:2,BottomLeft:4,CircleBottomRight:8,RightBottom:16,RightCenter:32,RightTop:64,CircleTopRight:128,TopCenter:256,TopRight:512,TopLeft:1024,CircleTopLeft:2048,LeftTop:4096,LeftCenter:8192,LeftBottom:16384,CircleBottomLeft:32768,CenterCenter:65536},d=[u.BottomCenter,u.RightCenter,u.TopCenter,u.LeftCenter,u.BottomRight,u.TopRight,u.BottomLeft,u.RightBottom,u.RightTop,u.TopLeft,u.LeftTop,u.LeftBottom];function f(t){for(var e,n,r=[],i=0;i<d.length;i++)n=t,((e=d[i])===u.NoLabel||0!=(n&e))&&r.push(d[i]);return r}function h(t,e){return[(.5-t[0])*e[0],(.5-t[1])*e[1]]}function p(t,e,n,r,i){var o=e[0],a=e[1],s=n[0],c=n[1],l=0,d=0,f=c/2+a/2,h=c/2-a/2,p=-f,m=-h,v=s/2+o/2,_=s/2-o/2,g=-v,y=-_;switch(t){case u.BottomCenter:d=f+i;break;case u.RightCenter:l=v+i;break;case u.TopCenter:d=p-i;break;case u.LeftCenter:l=g-i;break;case u.BottomRight:l=_,d=f+i;break;case u.TopRight:l=_,d=p-i;break;case u.BottomLeft:l=y,d=f+i;break;case u.RightBottom:l=v+i,d=m;break;case u.RightTop:l=v+i,d=h;break;case u.TopLeft:l=y,d=p-i;break;case u.LeftTop:l=g-i,d=h;break;case u.LeftBottom:l=g-i,d=m}return[l+r[0],d+r[1]]}function m(t,e){return v(e.sublayersByIndex[t])}function v(t){return i.has(t)}function _(t){return o.has(t)}function g(t,e){return l.has(e.sublayersByIndex[t])}function y(t,e){return s.has(e.sublayersByIndex[t])}function b(t,e){var n=e.sublayersByIndex[t];return!a.has(n)&&!s.has(n)&&!c.has(n)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"d",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return c}));var r=n(1),i=n(8);function o(t){for(var e=0;e<r.styleMaxDpi.length;e++)if(t<=r.styleMaxDpi[e])return e;return r.styleMaxDpi.length}function a(t){return i.n*t}function s(t){return t/i.n}function c(t){return t&&"interpolate"===t[0]&&t[1]&&("linear"===t[1][0]||"exponential"===t[1][0])&&t[2]&&"zoom"===t[2][0]}},function(t,e,n){"use strict";var r;n.d(e,"d",(function(){return r})),function(t){t[t.Static=0]="Static",t[t.Unique=1]="Unique",t[t.Loaded=2]="Loaded"}(r||(r={}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));var r={0:"line",1:"area",2:"building",3:"point",4:"labelPoint",5:"labelLine",6:"dashedLine",7:"oneWayLine",8:"poi",9:"pixelLine",10:"model",11:"phasedArea",12:"stripedLine",13:"floor",14:"line",15:"fence",16:"marker",17:"circleMarker",18:"shiftedLine"},i=Object.keys(r).reduce((function(t,e){return t[r[e]]=e,t}),{})},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(t){void 0===t&&(t=[]),this.map={};for(var e=0;e<t.length;e++)this.add(t[e])}return t.prototype.has=function(t){var e=this.map[t[1]];return void 0!==e&&void 0!==e[t[0]]},t.prototype.add=function(t){var e=this.map[t[1]];e||(e=this.map[t[1]]={}),e[t[0]]=!0},t.prototype.addFromFlatArray=function(t){for(var e=this.map,n=0;n<t.length/2;n++){var r=t[2*n+1],i=e[r];i||(i=e[r]={}),i[t[2*n]]=!0}},t.prototype.toFlatArray=function(){var t=this.map,e=[];for(var n in t){var r=t[n];for(var i in r)e.push(Number(i),Number(n))}return e},t}()},function(t,e,n){"use strict";function r(t,e){return 0===t?0:Math.min(2*t-1,2*(e-t))}n.d(e,"a",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"d",(function(){return o})),n.d(e,"e",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return c}));var r=n(1);function i(t){for(var e="",n=0;n<t.length;){var r=t[n++];if(r>127){if(r>191&&r<224){if(n>=t.length)return console.error("Incomplete 2-byte sequence"),e;r=(31&r)<<6|63&t[n]}else if(r>223&&r<240){if(n+1>=t.length)return console.error("Incomplete 3-byte sequence"),e;r=(15&r)<<12|(63&t[n])<<6|63&t[++n]}else{if(!(r>239&&r<248))return console.error("Unknown multibyte start 0x"+r.toString(16)+" at index "+(n-1)),e;if(n+2>=t.length)return console.error("Incomplete 4-byte sequence"),e;r=(7&r)<<18|(63&t[n])<<12|(63&t[++n])<<6|63&t[++n]}++n}if(r<=65535)e+=String.fromCharCode(r);else{if(!(r<=1114111))return console.error("Code point 0x"+r.toString(16)+" exceeds UTF-16 reach"),e;r-=65536,e+=String.fromCharCode(r>>10|55296),e+=String.fromCharCode(1023&r|56320)}}return e}function o(t){for(var e=new Uint8Array(4*t.length),n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(i<128)e[n++]=i;else{if(i<2048)e[n++]=i>>6|192;else{if(i>55295&&i<56320){if(++r===t.length)return console.error("Incomplete surrogate pair"),e.subarray(0,n);var o=t.charCodeAt(r);if(o<56320||o>57343)return console.error("Second char code 0x"+o.toString(16)+" at index "+r+" in surrogate pair out of range"),e.subarray(0,n);i=65536+((1023&i)<<10)+(1023&o),e[n++]=i>>18|240,e[n++]=i>>12&63|128}else e[n++]=i>>12|224;e[n++]=i>>6&63|128}e[n++]=63&i|128}}return e.subarray(0,n)}function a(t,e){if(t.length<=e||-1!==t.indexOf("\n"))return t;var n=[];return t.split(" ").forEach((function(t){var r=n.length-1;0===n.length||n[r].length+t.length>=e?n.push(t):n[r]+=" "+t})),n.join("\n")}function s(t){return Math.floor(t/256)}function c(t,e){for(var n=new Set,i=0;i<t.length;i++)(o=t.charCodeAt(i))!==r.fonts.bomCharCode&&n.add(s(o));if(void 0!==e)for(i=0;i<e.length;i++){var o;(o=e.charCodeAt(i))!==r.fonts.bomCharCode&&n.add(s(o))}return Array.from(n)}},function(t,e,n){"use strict";function r(t){var e=256*Math.log(t);return e+(e<0?-.5:.5)<<16>>16}function i(t){return 32768*t+.5<<16>>>16}function o(t){return 256*Math.log(t)+.5<<16>>16}n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return o}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(){this.events={}}return t.prototype.on=function(t,e){var n=this.events[t];return n||(n=this.events[t]=[]),n.push(e),this},t.prototype.once=function(t,e){var n=this,r=function(i){n.off(t,r),e.call(n,i)};return this.on(t,r),this},t.prototype.off=function(t,e){var n=this.events[t];if(!n)return this;var r=n.indexOf(e);return-1!==r&&n.splice(r,1),this},t.prototype.emit=function(t,e){var n=this.events[t];if(!n)return this;for(var r=n.slice(),i=0;i<r.length;i++)r[i].call(this,e);return this},t}()},function(t,e,n){"use strict";function r(t){for(var e=[],n=[],r=0;r<t.length/2;r++)e[r]=t[2*r],n[r]=t[2*r+1];return{x:e,y:n,count:e.length}}function i(t){for(var e=new Uint16Array(t.length/2),n=0;n<t.length/2;n++)e[n]=t[2*n]|t[2*n+1]<<8;return e}n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return s}));var r=n(28);function i(t){s("Sublayer "+t+" is missing a required property. Objects will not be rendered. Check your ZSS.")}function o(t,e){s("No glyph for character "+t+" (code = "+e+", range = "+Object(r.b)(e)+")")}var a=new Set;function s(t){a.has(t)||(console.log(t),a.add(t))}},function(t,e,n){"use strict";function r(t,e){var n=new XMLHttpRequest;if(n.open("GET",t.url,!0),n.responseType="arraybuffer",t.headers)for(var r in t.headers)n.setRequestHeader(r,t.headers[r]);return n.onerror=function(){e({status:0,message:"Network error"},new ArrayBuffer(0))},n.onload=function(){n.status>=200&&n.status<300&&n.response?e(void 0,n.response):e({status:n.status,message:n.statusText},new ArrayBuffer(0))},n.send(),n}function i(t,e){var n=new XMLHttpRequest;if(n.open("GET",t.url,!0),t.headers)for(var r in t.headers)n.setRequestHeader(r,t.headers[r]);return n.onerror=function(){e({status:0,message:"Network error"},{})},n.onload=function(){if(0===n.response.byteLength&&200===n.status)return e({status:0,message:"No content"},{});if(n.status>=200&&n.status<300&&n.response&&n.response.length){var t=void 0;try{t=JSON.parse(n.response),e(void 0,t)}catch(t){e({status:0,message:"Json parse error"},{})}}else e({status:n.status,message:n.statusText},{})},n.send(),n}n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return c}));var r=n(27),i=n(10),o=[.5,.5],a=[.5,.5];function s(t,e,n,o,s){for(var c=t.elements.offset,l=Object(r.a)(e-1,e),h=n[l],p=o[l],m=s?s[l]:0,_=c,g=0;g<e;g++){var y=Object(r.a)(g,e),b=g===e-1,x=n[y],w=o[y],S=s?s[y]:b?0:1;0!==m&&(Object(i.c)(a,h,p,x,w),v(t,c,S,b?_:c+4),u(t.position,t.distance,c,h,p,x,w),d(t.normals,c,Object(i.i)(a[1],-a[0])),f(t.direction,c,Object(i.j)(a)),c+=4),h=x,p=w,m=S}t.elements.offset=c}function c(t,e,n,s,c,u){var d=t.elements.offset,f=Object(r.a)(e-2,e),_=Object(r.a)(e-1,e),g=n[_],y=s[_],b=c?c[f]:1,x=c?c[_]:0;Object(i.f)(o,n[f],s[f],g,y);for(var w=o[0],S=o[1],O=0;O<e;O++){var M=Object(r.a)(O,e),j=O===e-1,I=n[M],T=s[M],E=c?c[M]:j?0:1;Object(i.c)(a,g,y,I,T);var A=a[1],L=-a[0];0!==b&&(0===x?(o[0]=w,o[1]=S):l(o,w,S,A,L),Object(i.a)(a,w,S,o[0],o[1]),v(t,d,0,0),h(t.position,t.distance,d,g,y,u),p(t.normals,d,Object(i.j)(o),Object(i.j)(a)),m(t.direction,d),d+=4),g=I,y=T,b=x,x=E,w=A,S=L}t.elements.offset=d}function l(t,e,n,r,i){var o,a,s;e*r+n*i>0?(o=e+r,a=n+i,s=1/Math.sqrt(o*o+a*a),t[0]=o*s,t[1]=a*s):(a=e-r,0!=(o=i-n)&&0!==a?(s=1/Math.sqrt(o*o+a*a),t[0]=o*s,t[1]=a*s):(t[0]=0,t[1]=0))}function u(t,e,n,r,i,o,a){t[n*=8]=r,t[n+1]=i,t[n+2]=0,e[n]=0,t[n+8]=r,t[n+9]=i,t[n+10]=0,e[n+8]=-32767,t[n+16]=o,t[n+17]=a,t[n+18]=0,e[n+16]=-32767,t[n+24]=o,t[n+25]=a,t[n+26]=0,e[n+24]=0}function d(t,e,n){t[e*=8]=n,t[e+1]=127,t[e+8]=n,t[e+9]=127,t[e+16]=n,t[e+17]=127,t[e+24]=n,t[e+25]=127}function f(t,e,n){t[e*=8]=n,t[e+1]=0,t[e+8]=n,t[e+9]=0,t[e+16]=n,t[e+17]=0,t[e+24]=n,t[e+25]=0}function h(t,e,n,r,i,o){t[n*=8]=r,t[n+1]=i,t[n+2]=0,e[n]=32767,t[n+8]=r,t[n+9]=i,t[n+10]=0,e[n+8]=-32767,t[n+16]=r,t[n+17]=i,t[n+18]=o,e[n+16]=-32767,t[n+24]=r,t[n+25]=i,t[n+26]=o,e[n+24]=32767}function p(t,e,n,r){t[e*=8]=n,t[e+1]=r,t[e+8]=n,t[e+9]=r,t[e+16]=n,t[e+17]=r,t[e+24]=n,t[e+25]=r}function m(t,e){t[e*=8]=0,t[e+1]=127,t[e+8]=0,t[e+9]=127,t[e+16]=0,t[e+17]=127,t[e+24]=0,t[e+25]=127}function v(t,e,n,r){var i=t.indices.buffer,o=t.indices.offset;i[o++]=e,i[o++]=e+1,i[o++]=e+3,i[o++]=e+3,i[o++]=e+1,i[o++]=e+2,0!==n&&(i[o++]=e+2,i[o++]=r+1,i[o++]=r+0),t.indices.offset=o}},function(t,e,n){"use strict";function r(t,e,n){var r,i,o,a,s=function(){var c=Date.now()-o;c<e&&c>=0?r=setTimeout(s,e-c):(r=null,n||(a=t.apply(void 0,i),r||(i=null)))};return function(){for(var c=[],l=0;l<arguments.length;l++)c[l]=arguments[l];i=c,o=Date.now();var u=n&&!r;return r||(r=setTimeout(s,e)),u&&(a=t.apply(void 0,i),i=null),a}}n.d(e,"a",(function(){return r}))},function(t,e){},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return l}));var r=n(25),i=Math.pow(2,32)-1,o=i-1,a={},s=["main","parser","labeling"],c=0;s.forEach((function(t){var e=c+Math.floor(o/s.length);a[t]={min:c,max:e-1e6},c=e}));var l=function(){function t(t){this.minIdentifyIndex=a[t].min,this.maxIdentifyIndex=a[t].max,this.index=this.minIdentifyIndex,this.ids=[],this.phases=[],this.sublayers=[],this.symbols=[],this.instanceIds=[],this.objectClasses=[],this.strings={}}return t.prototype.getIndex=function(t,e,n,o,a,s){if(void 0===s&&(s=0),!Array.isArray(t))return i;var c=this.index+this.ids.length/2;return this.ids.push(t[0],t[1]),this.phases.push(e),this.sublayers.push(n),this.symbols.push(r.b[o]),this.instanceIds.push(s),"string"==typeof a?(this.objectClasses.push(0,0),this.strings[c]={objectClass:a}):a?this.objectClasses.push(a[0],a[1]):this.objectClasses.push(i,0),c},t.prototype.getPacked=function(){var t=new Uint32Array(this.ids).buffer,e=new Float32Array(this.phases).buffer,n=new Uint32Array(this.sublayers).buffer,r=new Uint8Array(this.symbols).buffer,i=new Uint8Array(this.instanceIds).buffer,o=new Uint32Array(this.objectClasses).buffer,a=this.index,s=this.index+this.ids.length-1;this.index=this.index+this.ids.length,this.index>this.maxIdentifyIndex&&(this.index=this.minIdentifyIndex);var c=this.strings;return this.ids=[],this.phases=[],this.sublayers=[],this.symbols=[],this.instanceIds=[],this.objectClasses=[],this.strings={},{idBuffer:t,startIndex:a,endIndex:s,phaseBuffer:e,sublayerBuffer:n,symbolBuffer:r,instanceIdBuffer:i,objectClassBuffer:o,strings:c}},t}()},function(t,e,n){"use strict";var r;n.d(e,"b",(function(){return r})),function(t){t[t.WallSide=0]="WallSide",t[t.WallTop=1]="WallTop",t[t.IslandTop=2]="IslandTop"}(r||(r={}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(4),i=r.d(),o=r.d(),a=r.d();function s(t,e,n,s,l,u,d){r.q(i,e,n,s),r.q(o,l,u,d),r.r(a,o,i),r.h(o,i)||(r.n(a,a),r.o(a,a,127)),function(t,e,n,r,i,o,a){var s=t.indices.buffer,c=t.indices.offset,l=t.elements.offset;s[c]=l+0,s[c+1]=l+1,s[c+2]=l+3,s[c+3]=l+3,s[c+4]=l+1,s[c+5]=l+2,t.indices.offset=c+6}(t),c(t,i,a,1),c(t,i,a,-1),c(t,o,a,-1),c(t,o,a,1)}function c(t,e,n,r){var i=t.elements.offset*t.elements.stride,o=i>>1;t.position[o]=e[0],t.position[o+1]=e[1],t.position[o+2]=e[2],t.directionDistance[i]=n[0],t.directionDistance[i+1]=n[1],t.directionDistance[i+2]=n[2],t.directionDistance[i+3]=r,t.elements.offset++}},function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return c})),n.d(e,"d",(function(){return l}));var r=n(37),i=n(1),o=[0,0];function a(t,e,n,a){for(var s=e.vAlign,c=e.hAlign,d=e.lineHeight,f=e.identifyPoiLabelIndex,h=e.letterSpacing,p=a.lines,m=a.maxWidth,v=d*i.fonts.baseSize,_=f!==r.b?f:void 0,g=l(s,v,p.length),y=0;y<p.length;y++){var b=p[y].width,x=0;switch(c){case 0:x=-m/2;break;case 1:x=-b/2;break;case 2:x=m/2-b}o[0]=x,o[1]=g;for(var w=p[y].glyphs,S=0;S<w.length;S++){var O=w[S];void 0!==O.bitmap&&u(t[O.range],n,o,O,_),o[0]+=O.advance+i.fonts.baseSize*h}g-=v}}function s(t,e,n,r,i,o,a){var s=n[1]+r.top,c=n[0]+r.left,l=s-r.height,u=c+r.width,d=Math.sin(i),h=Math.cos(i),m=c*h-s*d,v=c*d+s*h,_=u*h-s*d,g=u*d+s*h,y=c*h-l*d,b=c*d+l*h,x=u*h-l*d,w=u*d+l*h,S=t.elements.offset;f(t,e,m,v,r.texLeft,r.texTop,o,a),f(t,e,_,g,r.texRight,r.texTop,o,a),f(t,e,y,b,r.texLeft,r.texBottom,o,a),f(t,e,x,w,r.texRight,r.texBottom,o,a),p(t.indices,S,1,0,3,2,3,0)}function c(t,e,n){var r=t.elements.offset,i=127*Math.cos(n),o=127*Math.sin(n);h(t,e,i,o,-1,-1),h(t,e,i,o,1,-1),h(t,e,i,o,1,1),h(t,e,i,o,-1,1),p(t.indices,r,0,1,2,2,3,0)}function l(t,e,n){var r;switch(t){case 0:r=e/2+e*(n-1);break;case 2:r=-e/2;break;default:r=1&n?e*(n>>1):e/2+e*(n-1>>1)}return r}function u(t,e,n,r,i){var o=n[1]+r.top,a=n[0]+r.left,s=o-r.height,c=a+r.width,l=t.elements.offset;d(t,e,a,o,r.texLeft,r.texTop,i),d(t,e,c,o,r.texRight,r.texTop,i),d(t,e,a,s,r.texLeft,r.texBottom,i),d(t,e,c,s,r.texRight,r.texBottom,i),p(t.indices,l,1,0,3,2,3,0)}function d(t,e,n,r,i,o,a){var s=t.elements,c=s.stride*s.offset>>1,l=c>>1;t.position[c]=e[0],t.position[c+1]=e[1],t.position[c+2]=e[2],t.cornerOffset[c]=n,t.cornerOffset[c+1]=r,t.texCoords[c]=i,t.texCoords[c+1]=o,void 0!==a&&(t.localID[l]=a),s.offset++}function f(t,e,n,r,i,o,a,s){var c=t.elements,l=c.stride*c.offset>>1;t.position[l]=e[0],t.position[l+1]=e[1],t.position[l+2]=e[2],t.texCoords[l]=i,t.texCoords[l+1]=o,l>>=1,t.cornerOffset[l]=n,t.cornerOffset[l+1]=r,t.styleZoomLimits[l]=a,t.styleZoomLimits[l+1]=s,c.offset++}function h(t,e,n,r,i,o){var a=t.elements,s=a.stride*a.offset/2;t.position[s]=e[0],t.position[s+1]=e[1],t.direction[s]=n,t.direction[s+1]=r,t.widenDirection[s]=i,t.widenDirection[s+1]=o,a.offset++}function p(t,e,n,r,i,o,a,s){var c=t.buffer,l=t.offset;c[l]=e+n,c[l+1]=e+r,c[l+2]=e+i,c[l+3]=e+o,c[l+4]=e+a,c[l+5]=e+s,t.offset=l+6}},function(t,e,n){"use strict";function r(t){var e,n,r,o,a=i(t),s=a[0],c=a[1],l=a[2];return e=a[3],n=l,r=c,o=s,Math.pow(2,24)*e+Math.pow(2,16)*n+Math.pow(2,8)*r+o}function i(t){return 7===(t=function(t){var e=t.split(".")[0],n=e.toLowerCase(),r=new RegExp("^#[a-f0-9]{"+(e.length-1)+"}$"),i=function(t){return r.test(n)?t:"#000000"};if(7===e.length||9===e.length)return i(n);if(4===e.length||5===e.length){for(var o="",a=0,s=n.slice(1);a<s.length;a++){var c=s[a];o+=""+c+c}return i("#"+o)}return"#000000"}(t)).length&&(t+="ff"),[parseInt(t[1]+t[2],16),parseInt(t[3]+t[4],16),parseInt(t[5]+t[6],16),parseInt(t[7]+t[8],16)]}n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}))},function(t,e){},function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return l})),n.d(e,"c",(function(){return u}));var r=n(5),i=n(24),o=10001,a={w:0,h:0,anchorX:.5,anchorY:.5,x:0,y:0,atlasIndex:0,isPacked:!1},s={};function c(t,e,n){var c=t[0]+"_"+t[1];return s[c]||(s[c]={type:i.d.Unique,isSvg:!1,index:o++,name:"",fileName:"",id:t,regionId:n,rasters:e.map((function(t){return Object(r.a)(Object(r.a)({},a),{w:t,h:t})}))}),s[c]}function l(t){return{type:i.d.Loaded,isSvg:!1,index:o++,name:"",fileName:"",rasters:t}}function u(t,e,n){for(var r,i=1/0,o=0;o<t.length;o++){var a=t[o];if(!n||a.isPacked){var s=Math.abs(a.w-e);s<i&&(r=o,i=s)}}return r}},function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}));var r=n(5),i=n(16),o=n(30),a=function(t){function e(){var e=t.call(this)||this;return e.workers=new Map,e}return Object(r.c)(e,t),e.prototype.addWorker=function(t,e){var n=this;this.workers.set(t,e),e.addEventListener("message",(function(e){var r=e.data,i=r.to,o=r.msg,a=r.transferable,s={from:t,to:i,msg:o,transferable:a};n.routeMessage(s)}))},e.prototype.send=function(t,e,n){var r=this.workers.get(t);if(r){var o={to:t,from:i.b.Main,msg:e,transferable:n};void 0!==n?r.postMessage(o,n):r.postMessage(o)}},e.prototype.broadcast=function(t){this.workers.forEach((function(e,n){var r={to:n,from:i.b.Main,msg:t};e.postMessage(r)}))},e.prototype.routeMessage=function(t){var e=t.from,n=t.to,r=t.transferable,o=t.msg.type;if(n===i.b.Main)this.emit("message",t);else if(n===i.b.All)e!==i.b.Main&&this.emit(o,t),this.workers.forEach((function(n,i){i!==e&&(void 0!==r?n.postMessage(t,r):n.postMessage(t))}));else{var a=this.workers.get(n);a&&(void 0!==r?a.postMessage(t,r):a.postMessage(t))}},e}(o.a),s=function(t){function e(e){var n=t.call(this)||this;return n.worker=e,e.addEventListener("message",(function(t){var e=t.data;n.emit("message",e)})),n}return Object(r.c)(e,t),e.prototype.send=function(t,e,n){var r={to:t,msg:e,transferable:n};this.worker.postMessage(r,n)},e.prototype.broadcast=function(t){var e={to:i.b.All,msg:t};this.worker.postMessage(e)},e}(o.a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(16),i=function(){function t(t){var e=this;this.onMessage=function(t){var n=t.from,i=t.msg;switch(i.type){case r.a.FunctionUse:e.onFunctionUse(i,n);break;case r.a.FunctionResult:e.onFunctionResult(i)}},this.connector=t,this.functions=new Map,this.functionIdCounter=0,this.pendingFunctions=new Map,t.on("message",this.onMessage)}return t.prototype.set=function(t,e){this.functions.set(t,e)},t.prototype.get=function(t,e){var n=this;return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var a=n.functionIdCounter++,s=new Promise((function(t){n.pendingFunctions.set(a,t)})),c={type:r.a.FunctionUse,data:{id:a,name:e,args:i}};return n.connector.send(t,c),s}},t.prototype.onFunctionUse=function(t,e){var n=this,r=t.data,i=r.name,o=r.args,a=r.id,s=this.functions.get(i);if(s){var c=s.apply(void 0,o);c&&c.then?Promise.resolve(c).then((function(t){return n.sendFunctionResult(e,a,t)})):this.sendFunctionResult(e,a,c)}else console.error("FnRegistry#onFunctionUse: function "+i+" not found")},t.prototype.sendFunctionResult=function(t,e,n){var i={type:r.a.FunctionResult,data:{id:e,result:n}};n&&n.transferable?this.connector.send(t,i,n.transferable):this.connector.send(t,i)},t.prototype.onFunctionResult=function(t){var e=t.data,n=e.id,r=e.result,i=this.pendingFunctions.get(n);i?(i(r),this.pendingFunctions.delete(n)):console.error("FnRegistry#onFunctionResult: pending function "+n+" not found")},t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(8),i=n(3),o=n(10);function a(t,e,n,i,o){var a=function(t,e,n,r,i){return 1/r+(1/i-1/r)*(t-e)/(n-e)}(t,e,n,i,o);return a>1e-8?1/a:r.f}function s(t,e,n,s,l,u,d,f){return Number.isNaN(n)||void 0===n?function(t,e,n,s,l,u){var d=[];if(e<n&&l<s){for(var f=Object(o.l)(t[0].w,u),h=r.h,p=1;p<t.length;p++){var m=Object(o.l)(t[p].w,u),v=a(Math.sqrt(m*f),e,n,s,l);h<=s&&v>=l&&d.push([Object(i.n)(v),Object(o.l)(t[p-1].w,u),0]),f=m,h=v}h<=s&&d.push([0,Object(o.l)(t[t.length-1].w,u),0])}else d.push([0,c(e,t,u),0]);return d.reverse(),d}(e,s,l,u,d,f):t[n]}function c(t,e,n){for(var r=0,i=Object(o.s)(t,n);r<e.length&&i<=e[r].w;)r++;return r>0&&(r===e.length||e[r-1].w/i<i/e[r].w)&&r--,Object(o.l)(e[r].w,n)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(21),i=n(2),o=n(15),a=new Map,s=function(t,e,n,s,c,l,u){void 0===u&&(u=!1),this.type=e,this.label=t,this.id=t.id+"_"+e+"_"+Math.floor(n[0]/1e3)+"_"+Math.floor(n[1]/1e3),this.anchorWorld=r.b(n),this.anchorWorld[2]*=s.buildingHeight,this.anchorScreen=[0,0],Object(i.z)(this.anchorScreen,this.anchorWorld,c,s.size,s.viewport),this.anchorPosition=0,this.anchorSegmentIndex=0,this.halfLabelWidth=0;var d=t.iconGroupPriority,f=t.labelGroupPriority,h=e===o.c.Icon||(e===o.c.PoiText||e===o.c.PoiText2)&&f>d;this.groupPriority=h?d:f,this.itemPriority=e===o.c.Icon?t.iconPriority:t.labelPriority,u&&(a.has(this.id)?this.commercialPriority=a.get(this.id):(this.commercialPriority=Math.random(),a.set(this.id,this.commercialPriority)));var p=l.labelingGroups,m=p.indexToGroup,v=p.table;switch(e===o.c.Icon?this.labelingGroup=m[t.iconLabelingGroup]:e===o.c.PoiText?this.labelingGroup=m[t.textLabelingGroup]:e===o.c.PoiText2?this.labelingGroup=m[t.text2LabelingGroup]:this.labelingGroup=m[t.labelingGroup],this.labelingGroupTable=v,e){case o.c.PoiText:this.appearMarginTopBottom=t.textAppearMarginTopBottom,this.appearMarginLeftRight=t.textAppearMarginLeftRight,this.visibleMarginTopBottom=t.textVisibleMarginTopBottom,this.visibleMarginLeftRight=t.textVisibleMarginLeftRight;break;case o.c.PoiText2:this.appearMarginTopBottom=t.text2AppearMarginTopBottom,this.appearMarginLeftRight=t.text2AppearMarginLeftRight,this.visibleMarginTopBottom=t.text2VisibleMarginTopBottom,this.visibleMarginLeftRight=t.text2VisibleMarginLeftRight;break;default:this.appearMarginTopBottom=t.iconAppearMarginTopBottom,this.appearMarginLeftRight=t.iconAppearMarginLeftRight,this.visibleMarginTopBottom=t.iconVisibleMarginTopBottom,this.visibleMarginLeftRight=t.iconVisibleMarginLeftRight}this.overflowStyleZoom=-1/0,this.boxes=[],this.placementIndex=0}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(){this.map={}}return t.prototype.set=function(t,e,n){void 0===this.map[t]&&(this.map[t]={}),this.map[t][e]=n},t.prototype.get=function(t,e){var n=this.map[t];if(void 0!==n)return n[e]},t.prototype.has=function(t,e){var n=this.map[t];return void 0!==n&&void 0!==n[e]},t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n(9),n(1);var r=n(19),i=n(12),o=(n(15),n(0)),a={id:-1};function s(t,e){var n=[new Uint16Array([0,65535,65535,0,0]),new Uint16Array([0,0,65535,65535,0])],s=Object(i.e)({color:0,width:3,phase:0}),c=Object(i.f)({});Object(r.c)("pixelLine",a,o.a,t,s,c,n,5,e,-1,-1)}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(10),i=n(27);function o(t,e,n,o,u,d,f){for(var h=t.elements.offset,p=0;p<e;p++){var m=Object(i.a)(p,e),v=p===e-1;if(u&&1===u[m]||!u&&!v){var _=n[m],g=o[m],y=(p+1)%e,b=Object(i.a)(y,e),x=n[b],w=o[b];l(t,h),a(t.position,h,_,g,x,w,d),s(t.normal,h,Object(r.g)(_,g,x,w)),void 0!==f&&c(t.localID,h,f),h+=4}}t.elements.offset=h}function a(t,e,n,r,i,o,a){t[e*=8]=n,t[e+1]=r,t[e+2]=0,t[e+8]=n,t[e+9]=r,t[e+10]=a,t[e+16]=i,t[e+17]=o,t[e+18]=0,t[e+24]=i,t[e+25]=o,t[e+26]=a}function s(t,e,n){t[e*=8]=n,t[e+1]=0,t[e+8]=n,t[e+9]=0,t[e+16]=n,t[e+17]=0,t[e+24]=n,t[e+25]=0}function c(t,e,n){t[e*=4]=n,t[e+4]=n,t[e+8]=n,t[e+12]=n}function l(t,e){var n=t.indices.buffer,r=t.indices.offset;n[r++]=e,n[r++]=e+3,n[r++]=e+1,n[r++]=e,n[r++]=e+2,n[r++]=e+3,t.indices.offset=r}},function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,s,c,l,u,h,m,v=e&&e.length,_=v?e[0]*n:t.length,g=i(t,0,_,n,!0),y=[];if(!g||g.next===g.prev)return y;if(v&&(g=function(t,e,n,r){var a,s,c,l=[];for(a=0,s=e.length;a<s;a++)(c=i(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r,!1))===c.next&&(c.steiner=!0),l.push(p(c));for(l.sort(d),a=0;a<l.length;a++)f(l[a],n),n=o(n,n.next);return n}(t,e,g,n)),t.length>80*n){r=c=t[0],s=l=t[1];for(var b=n;b<_;b+=n)(u=t[b])<r&&(r=u),(h=t[b+1])<s&&(s=h),u>c&&(c=u),h>l&&(l=h);m=0!==(m=Math.max(c-r,l-s))?1/m:0}return a(g,y,n,r,s,m),y}function i(t,e,n,r,i){var o,a;if(i===M(t,e,n,r)>0)for(o=e;o<n;o+=r)a=w(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=w(o,t[o],t[o+1],a);return a&&g(a,a.next)&&(S(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==_(r.prev,r,r.next))r=r.next;else{if(S(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function a(t,e,n,r,i,d,f){if(t){!f&&d&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=h(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,c,l=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<l&&(s++,r=r.nextZ);e++);for(c=l;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(t,r,i,d);for(var p,m,v=t;t.prev!==t.next;)if(p=t.prev,m=t.next,d?c(t,r,i,d):s(t))e.push(p.i/n),e.push(t.i/n),e.push(m.i/n),S(t),t=m.next,v=m.next;else if((t=m)===v){f?1===f?a(t=l(t,e,n),e,n,r,i,d,2):2===f&&u(t,e,n,r,i,d):a(o(t),e,n,r,i,d,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(_(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(m(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&_(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function c(t,e,n,r){var i=t.prev,o=t,a=t.next;if(_(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,c=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,l=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,d=h(s,c,e,n,r),f=h(l,u,e,n,r),p=t.prevZ,v=t.nextZ;p&&p.z>=d&&v&&v.z<=f;){if(p!==t.prev&&p!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,v!==t.prev&&v!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&_(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;p&&p.z>=d;){if(p!==t.prev&&p!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;v&&v.z<=f;){if(v!==t.prev&&v!==t.next&&m(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&_(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function l(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!g(i,o)&&y(i,r,r.next,o)&&b(i,o)&&b(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),S(r),S(r.next),r=t=o),r=r.next}while(r!==t);return r}function u(t,e,n,r,i,s){var c=t;do{for(var l=c.next.next;l!==c.prev;){if(c.i!==l.i&&v(c,l)){var u=x(c,l);return c=o(c,c.next),u=o(u,u.next),a(c,e,n,r,i,s),void a(u,e,n,r,i,s)}l=l.next}c=c.next}while(c!==t)}function d(t,e){return t.x-e.x}function f(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n.prev;var c,l=n,u=n.x,d=n.y,f=1/0;for(r=n.next;r!==l;)i>=r.x&&r.x>=u&&i!==r.x&&m(o<d?i:a,o,u,d,o<d?a:i,o,r.x,r.y)&&((c=Math.abs(o-r.y)/(i-r.x))<f||c===f&&r.x>n.x)&&b(r,t)&&(n=r,f=c),r=r.next;return n}(t,e)){var n=x(e,t);o(n,n.next)}}function h(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function m(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&y(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&b(t,e)&&b(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)}function _(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function y(t,e,n,r){return!!(g(t,e)&&g(n,r)||g(t,r)&&g(n,e))||_(t,e,n)>0!=_(t,e,r)>0&&_(n,r,t)>0!=_(n,r,e)>0}function b(t,e){return _(t.prev,t,t.next)<0?_(t,e,t.next)>=0&&_(t,t.prev,e)>=0:_(t,e,t.prev)<0||_(t,t.next,e)<0}function x(t,e){var n=new O(t.i,t.x,t.y),r=new O(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function w(t,e,n,r){var i=new O(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function O(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}t.exports=r,t.exports.default=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(M(t,0,o,n));if(i)for(var s=0,c=e.length;s<c;s++){var l=e[s]*n,u=s<c-1?e[s+1]*n:t.length;a-=Math.abs(M(t,l,u,n))}var d=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,h=r[s+1]*n,p=r[s+2]*n;d+=Math.abs((t[f]-t[p])*(t[h+1]-t[f+1])-(t[f]-t[h])*(t[p+1]-t[f+1]))}return 0===a&&0===d?0:Math.abs((d-a)/a)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},function(t,e,n){"use strict";t.exports=i;var r=n(90);function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function o(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function a(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function s(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function c(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function l(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function u(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function d(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function f(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function h(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function p(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function m(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function v(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function _(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function g(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function y(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5,i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=_(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=y(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_(this.buf,this.pos)+4294967296*_(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=_(this.buf,this.pos)+4294967296*y(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return a(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return a(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return a(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return a(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return a(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return a(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,n){for(var r="",i=e;i<n;){var o,a,s,c=t[i],l=null,u=c>239?4:c>223?3:c>191?2:1;if(i+u>n)break;1===u?c<128&&(l=c):2===u?128==(192&(o=t[i+1]))&&(l=(31&c)<<6|63&o)<=127&&(l=null):3===u?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((l=(15&c)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===u&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,u=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=u}return r}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==i.Bytes)return t.push(this.readVarint(e));var n=o(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==i.Bytes)return t.push(this.readSVarint());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==i.Bytes)return t.push(this.readBoolean());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==i.Bytes)return t.push(this.readFloat());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==i.Bytes)return t.push(this.readDouble());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed32());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed32());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed64());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed64());var e=o(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),g(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),g(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),g(this.buf,-1&t,this.pos),g(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),g(this.buf,-1&t,this.pos),g(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&s(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),r.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),r.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&s(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,i.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,l,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,u,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,v,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},function(t,e,n){"use strict";n.r(e);var r=n(29),i=n(8);function o(t,e){var n=t.reduce((function(t,e){return t.concat(e)}),[0]).concat(e),r=n.length-1;return{coords:n.slice(n[0]===n[1]?1:0,n[r-1]===n[r]?r:r+1),isOddStretchable:a(t)}}function a(t){var e;return!(null===(e=null==t?void 0:t[0])||void 0===e?void 0:e[0])}function s(t){var e=t.coords;if(e.length<2)throw new Error("The source coords array must have at least two coordinates");var n=e[e.length-1]+2*i.a;return e.map((function(t,r){return(t+i.a*(0===r?0:r===e.length-1?2:1))/n}))}function c(t,e){for(var n=function(t){var e=t.coords,n=t.isOddStretchable;if(e.length<2)throw new Error("An axis must have at least two coordinates");if(2===e.length)return{stretchSize:e[e.length-1],fixSize:0};for(var r=0,i=n?0:1;i<e.length-1;i+=2)r+=e[i+1]-e[i];return{stretchSize:r,fixSize:e[e.length-1]-r}}(t),r=n.stretchSize,i=n.fixSize,o=t.coords,a=t.isOddStretchable,s=e<i?i:e,c=[o[0]],l=1;l<o.length;l++){var u=o[l-1],d=o[l],f=l%2==(a?1:0),h=c[c.length-1];f?c.push(Math.round((s-i)*(d-u)/r)+h):c.push(h+d-u)}return c}function l(t,e){void 0===e&&(e=0);var n=t[t.length-1]-t[0];return t.map((function(t){return Math.round(t-n/2+e)}))}function u(t){return t.map((function(t){return t*window.devicePixelRatio}))}var d=n(0);n.d(e,"sinks",(function(){return h})),n.d(e,"generateStretchableImage",(function(){return p}));var f=new Float64Array(5),h={fill:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.vrtxOffset=new Int16Array(e,4),t.txtrCoords=new Uint16Array(e,8),t.localID=new Uint32Array(e,12)},packUniforms:function(t,e,n,r,i){return t[0]=e[n.phase],t[1]=e[n.minZoom],t[2]=e[n.maxZoom],t[3]=i,t[4]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{phase:e[0],minStyleZoom:e[1],maxStyleZoom:e[2],textureIndex:e[3],styleId:e[4]}}}};function p(t,e,n,r,i,a,p,_,g,y){var b=p.tileProps,x=_[d.i.phase];if(!Number.isNaN(x)){var w,S,O,M,j,I,T,E,A=t.idIndexer.getIndex(g[b.id],x,g[b.sublayer],"stretchableImage"),L=t.getBucket("stretchableImage","fill",h.fill.packUniforms(f,_,d.i,a.id,y),h.fill.binder),C=(O=void 0===(S=(w=e).stretchX)?[]:S,j=void 0===(M=w.stretchY)?[]:M,T=(I=w.size)[0],E=I[1],{x:o(O,T),y:o(j,E)});!function(t,e,n,r,i){for(var o=e[0],a=e[1],s=n[0],c=n[1],l=r[0],u=r[1],d=t.elements.offset,f=o.length,h=a.length,p=0;p<f-1;p++)for(var _=o[p],g=o[p+1],y=s[p],b=s[p+1],x=0;x<h-1;x++){var w=a[x],S=a[x+1],O=c[x],M=c[x+1];v(t.indices,d,0,1,2,2,1,3),m(t,d++,l,u,y,O,_,w,i),m(t,d++,l,u,b,O,g,w,i),m(t,d++,l,u,y,M,_,S,i),m(t,d++,l,u,b,M,g,S,i)}t.elements.offset=d}(L,function(t){var e=t.y;return[s(t.x),s(e)]}(C),function(t,e){var n=t.x,r=t.y,i=e.targetSize,o=i[0],a=i[1],s=e.offset,d=s[0],f=s[1];return[u(l(c(n,o),d)),u(l(c(r,a),f))]}(C,{targetSize:n,offset:r}),i,A)}}function m(t,e,n,i,o,a,s,c,l){e*=8,t.position[e]=n,t.position[e+1]=i,t.vrtxOffset[e]=o,t.vrtxOffset[e+1]=-a,t.txtrCoords[e]=Object(r.c)(s),t.txtrCoords[e+1]=Object(r.c)(c),e>>=1,t.localID[e]=l}function v(t,e,n,r,i,o,a,s){var c=t.buffer,l=t.offset;c[l]=e+n,c[l+1]=e+r,c[l+2]=e+i,c[l+3]=e+o,c[l+4]=e+a,c[l+5]=e+s,t.offset=l+6}},function(t,e,n){"use strict";var r=n(52),i=n.n(r),o=n(66),a=n(28),s=function(){this.name="",this.range="",this.glyphs={}},c=function(){this.id=0,this.range=0,this.bitmap=null,this.top=0,this.left=0,this.advance=0,this.x=0,this.y=0,this.width=0,this.height=0,this.texTop=0,this.texLeft=0,this.texRight=0,this.texBottom=0},l=function(t,e){this.stacks=t.readFields(u,[],e)};function u(t,e,n){if(1===t){var r=n.readMessage(d,new s);e.push(r)}}function d(t,e,n){switch(t){case 1:e.name=n.readString();break;case 2:e.range=n.readString();break;case 3:var r=n.readMessage(f,new c);e.glyphs[r.id]=r}}function f(t,e,n){switch(t){case 1:e.id=n.readVarint(),e.range=Object(a.b)(e.id);break;case 2:e.bitmap=n.readBytes();break;case 3:e.width=n.readVarint()+6;break;case 4:e.height=n.readVarint()+6;break;case 5:e.left=n.readSVarint()-3;break;case 6:e.top=n.readSVarint()+17+3;break;case 7:e.advance=n.readVarint()}}var h=n(29),p=n(2),m=n(1),v=n(32);n.d(e,"a",(function(){return g})),n.d(e,"b",(function(){return y}));var _=function(t,e,n){for(var r=[],i=0,o=0;o<t.length;o++){var a=t.charCodeAt(o),s=e[a];s?(r.push(s),i+=s.advance):a!==m.fonts.bomCharCode&&Object(v.b)(t[o],a)}this.glyphs=r,this.width=i+m.fonts.baseSize*n*(t.length-1)};function g(t,e,n){for(var r={lines:[],maxWidth:0},i=t.split("\n"),o=0;o<i.length;o++){var a=new _(i[o],n,e);r.lines.push(a),a.width>r.maxWidth&&(r.maxWidth=a.width)}return r}function y(t){var e=new l(new i.a(new Uint8Array(t))).stacks[0].glyphs,n=function(t){for(var e=[],n=new o.a(512,512,{autoResize:!0}),r=Object.keys(t),i=0;i<r.length;i++)(a=t[r[i]]).bitmap&&e.push({glyph:a,width:a.width,height:a.height});for(n.pack(e,{inPlace:!0}),n.shrink(),i=0;i<e.length;i++){var a;(a=e[i].glyph).x=e[i].x,a.y=e[i].y}return{width:Object(p.x)(n.w),height:Object(p.x)(n.h)}}(e),r=n.width,a=n.height;return function(t,e,n){for(var r=Object.keys(t),i=0;i<r.length;i++){var o=t[r[i]];o.bitmap&&(o.texTop=Object(h.c)(o.y/n),o.texLeft=Object(h.c)(o.x/e),o.texBottom=Object(h.c)((o.y+o.height)/n),o.texRight=Object(h.c)((o.x+o.width)/e))}}(e,r,a),{glyphData:e,bitmap:function(t,e,n){for(var r=new Uint8Array(e*n),i=Object.keys(t),o=0;o<i.length;o++){var a=t[i[o]];if(a.bitmap)for(var s=0;s<a.height;s++)for(var c=e*(a.y+s)+a.x,l=a.width*s,u=0;u<a.width;u++)r[c+u]=a.bitmap[l+u]}return r.buffer}(e,r,a),width:r,height:a}}},function(t,e,n){"use strict";n.r(e),n.d(e,"sinks",(function(){return d})),n.d(e,"checkRequiredAttrs",(function(){return f})),n.d(e,"processComponent",(function(){return h}));var r=n(20),i=n(27),o=n(39),a=n(37),s=n(0),c=new Float64Array(7),l=new Float64Array(9),u=[NaN,NaN],d={fill:{stride:8,binder:function(t,e){t.position=new Uint16Array(e),t.localID=new Uint32Array(e,4)},packUniforms:function(t,e,n,r,i){return t[0]=e[n.color],t[1]=e[n.minZoom],t[2]=e[n.maxZoom],t[3]=e[n.phase],t[4]=r[0],t[5]=r[1],t[6]=i,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],minStyleZoom:e[1],maxStyleZoom:e[2],phase:e[3],hiddenObjectId:Number.isNaN(e[4])?void 0:Object(r.a)(e[4],e[5]),styleId:e[6]}}},stroke:{stride:8,binder:function(t,e){t.position=new Uint16Array(e),t.directionDistance=new Int8Array(e,4)},packUniforms:function(t,e,n,r,i,o){return t[0]=e[n.borderColor],t[1]=e[n.borderWidth],t[2]=e[n.minZoom],t[3]=e[n.maxZoom],t[4]=o,t[5]=e[n.color],t[6]=r[0],t[7]=r[1],t[8]=i,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],width:e[1],minStyleZoom:e[2],maxStyleZoom:e[3],phase:e[4],fillColor:e[5],hiddenObjectId:Number.isNaN(e[6])?void 0:Object(r.a)(e[6],e[7]),styleId:e[8]}}}},f=function(){return!0},h=function(t,e,n,r,f,h,v,_,g,y,b,x){var w=v[0],S=v[1],O=v[2],M=n.tileProps,j=f[s.i.phase],I="phasedArea"===t?f[s.i.borderPhase]:j,T=h[M.id],E=!Number.isNaN(T)&&x&&x.has(T)?T:u;if(!Number.isNaN(j)&&!Number.isNaN(f[s.i.color])){var A=h[M.hovered]?a.b:r.idIndexer.getIndex(T,j,h[M.sublayer],t);!function(t,e,n,r,i){var o=t.indices.buffer,a=t.indices.offset,s=t.elements.offset,c=s;p(t,s++,n[0],r[0],i),p(t,s++,n[1],r[1],i);for(var l=2;l<e;l++)m(o,a,c,l),p(t,s++,n[l],r[l],i),a+=3;t.elements.offset=s,t.indices.offset=a}(r.getBucket(t,"fill",d.fill.packUniforms(c,f,s.i,E,e.id),d.fill.binder),_,w,S,A)}Number.isNaN(I)||Number.isNaN(f[s.i.borderColor])||function(t,e,n,r,a){for(var s=0;s<e;s++){var c=Object(i.a)(s,e);if(1===a[c]){var l=Object(i.a)((s+1)%e,e);Object(o.a)(t,n[c],r[c],0,n[l],r[l],0)}}}(r.getBucket(t,"stroke",d.stroke.packUniforms(l,f,s.i,E,e.id,I),d.stroke.binder),_,w,S,O)};function p(t,e,n,r,i){e*=4,t.position[e]=n,t.position[e+1]=r,e>>=1,t.localID[e]=i}function m(t,e,n,r){r%2==0?(t[e]=n+r-2,t[e+1]=n+r-1,t[e+2]=n+r):(t[e]=n+r-1,t[e+1]=n+r-2,t[e+2]=n+r)}},function(t,e,n){"use strict";n.r(e),n.d(e,"sinks",(function(){return v})),n.d(e,"checkRequiredAttrs",(function(){return _})),n.d(e,"processComponent",(function(){return g}));var r=n(27),i=n(10),o=n(20),a=n(50),s=n(34),c=n(39),l=n(37),u=n(0),d=new Float64Array(7),f=new Float64Array(9),h=[NaN,NaN];function p(t,e,n,r,i,o){return t[0]=r,t[1]=e[n.minZoom],t[2]=e[n.maxZoom],t[3]=e[n.phase],t[4]=i[0],t[5]=i[1],t[6]=o,t}function m(t){var e=new Float64Array(t);return{color:e[0],minStyleZoom:e[1],maxStyleZoom:e[2],phase:e[3],hiddenObjectId:Number.isNaN(e[4])?void 0:Object(o.a)(e[4],e[5]),styleId:e[6]}}var v={fill:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.normal=new Uint16Array(e,8),t.localID=new Uint32Array(e,12)},packUniforms:p,unpackUniforms:m},wallStroke:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.distance=new Int16Array(e,6),t.normals=new Uint16Array(e,8),t.direction=new Uint16Array(e,12)},packUniforms:p,unpackUniforms:m},roofStroke:{stride:12,binder:function(t,e){t.position=new Uint16Array(e),t.directionDistance=new Int8Array(e,8)},packUniforms:function(t,e,n,r,i){return t[0]=e[n.borderColor],t[1]=e[n.borderWidth],t[2]=e[n.minZoom],t[3]=e[n.maxZoom],t[4]=e[n.phase],t[5]=r[0],t[6]=r[1],t[7]=e[n.color],t[8]=i,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],width:e[1],minStyleZoom:e[2],maxStyleZoom:e[3],phase:e[4],hiddenObjectId:Number.isNaN(e[5])?void 0:Object(o.a)(e[5],e[6]),fillColor:e[7],styleId:e[8]}}}},_=function(t){return!Number.isNaN(t[u.i.color])&&!Number.isNaN(t[u.i.borderColor])&&!Number.isNaN(t[u.i.wallColor])},g=function(t,e,n,o,p,m,_,g,x,w,S,O,M,j,I){var T,E=_[0],A=_[1],L=_[2],C=n.tileProps;if(!Number.isNaN(p[u.i.phase])){var P=m[C.hovered],k=Math.round(Object(i.p)(m[C.height])),N=m[C.id],R=P?l.b:o.idIndexer.getIndex(N,p[u.i.phase],m[C.sublayer],t),z=!Number.isNaN(N)&&O&&O.has(N)?N:h;k>0&&(T=o.getBucket(t,"fill",v.fill.packUniforms(d,p,u.i,p[u.i.wallColor],z,e.id),v.fill.binder),Object(a.a)(T,g,E,A,L,k,R),T=o.getBucket(t,"wallStroke",v.wallStroke.packUniforms(d,p,u.i,p[u.i.wallColor],z,e.id),v.wallStroke.binder),I||(Object(s.a)(T,g,E,A,L),Object(s.b)(T,g,E,A,L,k))),function(t,e,n,r,i,o){var a=t.elements.offset,s=a;y(t,a++,n[0],r[0],i,o),y(t,a++,n[1],r[1],i,o);for(var c=2;c<e;c++)b(t,s,c),y(t,a++,n[c],r[c],i,o);t.elements.offset=a}(T=o.getBucket(t,"fill",v.fill.packUniforms(d,p,u.i,p[u.i.color],z,e.id),v.fill.binder),g,E,A,k,R),function(t,e,n,i,o,a){for(var s=0;s<e;s++){var l=Object(r.a)(s,e);if(1===o[l]){var u=Object(r.a)((s+1)%e,e);Object(c.a)(t,n[l],i[l],a,n[u],i[u],a)}}}(T=o.getBucket("building","roofStroke",v.roofStroke.packUniforms(f,p,u.i,z,e.id),v.roofStroke.binder),g,E,A,L,k)}};function y(t,e,n,r,i,o){e*=8,t.position[e]=n,t.position[e+1]=r,t.position[e+2]=i,t.normal[e]=0,t.normal[e+1]=127,e>>=1,t.localID[e]=o}function b(t,e,n){var r=t.indices.buffer,i=t.indices.offset;n%2==0?(r[i++]=e+n-2,r[i++]=e+n-1,r[i++]=e+n):(r[i++]=e+n-1,r[i++]=e+n-2,r[i++]=e+n),t.indices.offset=i}},function(t,e,n){"use strict";n.r(e),n.d(e,"checkRequiredAttrs",(function(){return _})),n.d(e,"getOptionalAttrOrDefault",(function(){return y})),n.d(e,"processComponent",(function(){return b}));var r=n(10),i=n(60),o=n(46),a=n(3),s=n(6),c=n(23),l=n(37),u=n(43),d=n(22),f=n(25),h=n(1),p=n(0),m=new i.a,v=new Uint8Array(0),_=function(t,e){switch(f.a[t[p.i.symbol]]){case"labelPoint":return function(t){return!Number.isNaN(t[p.i.font])&&!Number.isNaN(t[p.i.fontSize])&&!Number.isNaN(t[p.i.color])}(t);case"labelLine":return function(t){return!(Number.isNaN(t[p.i.font])||Number.isNaN(t[p.i.fontSize])||Number.isNaN(t[p.i.color])||Number.isNaN(t[p.i.duplicationSpacing])||Number.isNaN(t[p.i.lineEndingOffsets])||Number.isNaN(t[p.i.labelMargins]))}(t);case"poi":case"marker":return function(t,e){if(Number.isNaN(t[p.i.rasterSet]))return!1;var n=!(Number.isNaN(t[p.i.minWidth])||Number.isNaN(t[p.i.maxWidth])||Number.isNaN(t[p.i.minWidthZLevel])||Number.isNaN(t[p.i.maxWidthZLevel])),r=void 0!==p.i.iconWidth&&!Number.isNaN(t[p.i.iconWidth]),i=n||r,o=e.rasterSets[t[p.i.rasterSet]].isSvg,a=!o&&i||o&&r;return Number.isNaN(t[p.i.font])||(a=a&&!Number.isNaN(t[p.i.fontSize])&&!Number.isNaN(t[p.i.fontColor])),a}(t,e);case"oneWayLine":return function(t){return!(Number.isNaN(t[p.i.width])||Number.isNaN(t[p.i.length])||Number.isNaN(t[p.i.duplicationSpacing])||Number.isNaN(t[p.i.wingWidthMultiplier])||Number.isNaN(t[p.i.wingHeightMultiplier])||Number.isNaN(t[p.i.tipHeightMultiplier])||Number.isNaN(t[p.i.color])||Number.isNaN(t[p.i.borderColor])||Number.isNaN(t[p.i.borderWidth]))}(t);default:return!0}};function g(t,e){return Number.isNaN(t)?e:t}function y(t,e,n){return void 0===e?n:g(t[e],n)}var b=function(t,e,n,i,f,_,b,x,w,S,O,M,j,I){var T=n.tileProps,E=e.rasterSets,A=f[p.i.phase];if(!(Number.isNaN(A)||"poi"===t&&j&&Object(d.e)(_[T.sublayer],n))){var L=Math.max(1,Object(a.v)(f[p.i.minWidthZLevel])),C=Math.max(1,Object(a.v)(f[p.i.maxWidthZLevel])),P=Object(d.e)(_[T.sublayer],n),k=Object(d.h)(_[T.sublayer],n);if(I){if(P||k)return;var N=E[f[p.i.rasterSet]],R=Object(c.b)(_[T.dpi]),z=Object(o.a)(e.curves,N.rasters,f[p.i.iconWidth],f[p.i.minWidth],f[p.i.maxWidth],L,C,R);return i.atlasPacker.pack(N,z,R),m.calculate(N.rasters,z,R),void i.atlasPacker.addRastersToLoad(e.id,N,m)}var B=i.getFreeLabelItem(),F=B.f32,D=B.u32,U=f[p.i.rasterSet];if("poi"===t){if(N=E[U],R=Object(c.b)(_[T.dpi]),P||k){var Z=P?h.commercialRasterSizes:h.landmarkRasterSizes;U=(N=Object(u.b)(_[T.id],Z,O)).index,i.atlasPacker.addNewRasterSet(e.id,N)}z=Object(o.a)(e.curves,N.rasters,f[p.i.iconWidth],f[p.i.minWidth],f[p.i.maxWidth],L,C,R),i.atlasPacker.pack(N,z,R),D[s.a.identifyIndex]=i.idIndexer.getIndex(_[T.id],f[p.i.phase],_[T.sublayer],t,_[T.objectClass]),D[s.a.identifyPoiLabelIndex]=i.idIndexer.getIndex(_[T.id],f[p.i.phase],_[T.sublayer],t,_[T.objectClass],1)}else D[s.a.identifyIndex]=l.b,D[s.a.identifyPoiLabelIndex]=l.b;F[s.a.minWidthScale]=L,F[s.a.maxWidthScale]=C,D[s.a.hAlign]=g(f[p.i.labelHAlign],1),D[s.a.vAlign]=g(f[p.i.labelVAlign],1),D[s.a.labelPriority]=g(f[p.i.labelPriority],_[T.dbLabelPriority]),D[s.a.label2Priority]=y(f,p.i.label2Priority,_[T.dbLabel2Priority]),D[s.a.iconPriority]=g(f[p.i.iconPriority],_[T.dbIconPriority]),D[s.a.iconGroupPriority]=g(f[p.i.iconGroupPriority],g(f[p.i.objectGroupPriority],0)),D[s.a.labelGroupPriority]=g(f[p.i.labelGroupPriority],g(f[p.i.objectGroupPriority],0)),F[s.a.font]=f[p.i.font],F[s.a.font2]=y(f,p.i.font2,NaN),D[s.a.symbol]=f[p.i.symbol],D[s.a.sublayer]=_[T.sublayer],F[s.a.phase]=A;var H=_[T.id];D[s.a.idLo]=H[0],D[s.a.idHi]=H[1],D[s.a.color]=f[p.i.color],D[s.a.fontColor]=f[p.i.fontColor],F[s.a.haloColor]=f[p.i.haloColor],D[s.a.font2Color]=y(f,p.i.font2Color,f[p.i.fontColor]),F[s.a.halo2Color]=y(f,p.i.halo2Color,f[p.i.haloColor]),F[s.a.fontSize]=f[p.i.fontSize],F[s.a.font2Size]=y(f,p.i.font2Size,f[p.i.fontSize]),F[s.a.lineHeight]=g(f[p.i.lineHeight],1.2),F[s.a.letterSpacing]=g(f[p.i.letterSpacing],0),F[s.a.haloRadius]=g(f[p.i.haloRadius],0),F[s.a.halo2Radius]=y(f,p.i.halo2Radius,f[p.i.haloRadius]),F[s.a.offsetX]=g(f[p.i.offsetX],0),F[s.a.offsetY]=g(f[p.i.offsetY],0),F[s.a.iconVisibleMarginTopBottom]=g(f[p.i.iconVisibleMarginTopBottom],0),F[s.a.iconVisibleMarginLeftRight]=g(f[p.i.iconVisibleMarginLeftRight],0),F[s.a.iconAppearMarginTopBottom]=Math.max(g(f[p.i.iconAppearMarginTopBottom],0),F[s.a.iconVisibleMarginTopBottom]+2),F[s.a.iconAppearMarginLeftRight]=Math.max(g(f[p.i.iconAppearMarginLeftRight],0),F[s.a.iconVisibleMarginLeftRight]+2),F[s.a.textVisibleMarginTopBottom]=g(f[p.i.textVisibleMarginTopBottom],0),F[s.a.textVisibleMarginLeftRight]=g(f[p.i.textVisibleMarginLeftRight],0),F[s.a.textAppearMarginTopBottom]=Math.max(g(f[p.i.textAppearMarginTopBottom],0),F[s.a.textVisibleMarginTopBottom]+2),F[s.a.textAppearMarginLeftRight]=Math.max(g(f[p.i.textAppearMarginLeftRight],0),F[s.a.textVisibleMarginLeftRight]+2),F[s.a.text2VisibleMarginTopBottom]=y(f,p.i.text2VisibleMarginTopBottom,F[s.a.textVisibleMarginTopBottom]),F[s.a.text2VisibleMarginLeftRight]=y(f,p.i.text2VisibleMarginLeftRight,F[s.a.textVisibleMarginLeftRight]),F[s.a.text2AppearMarginTopBottom]=Math.max(y(f,p.i.text2AppearMarginTopBottom,0),F[s.a.text2VisibleMarginTopBottom]+2),F[s.a.text2AppearMarginLeftRight]=Math.max(y(f,p.i.text2AppearMarginLeftRight,0),F[s.a.text2VisibleMarginLeftRight]+2),D[s.a.componentDistanceStart]=_[T.componentDistanceStart],D[s.a.componentDistanceEnd]=_[T.componentDistanceEnd],F[s.a.componentDistanceStartWorld]=Number.isNaN(_[T.componentDistanceStart])?0:Object(r.n)(_[T.componentDistanceStart],w[2]),F[s.a.objectLengthWorld]=Number.isNaN(_[T.componentDistanceStart])?0:Object(r.n)(_[T.objectLength],w[2]),F[s.a.minStyleZoom]=g(f[p.i.minZoom],-1/0),F[s.a.maxStyleZoom]=g(f[p.i.maxZoom],1/0),F[s.a.minDisplayStyleZoom]=y(f,p.i.minDisplayZoom,F[s.a.minStyleZoom]),F[s.a.maxDisplayStyleZoom]=y(f,p.i.maxDisplayZoom,F[s.a.maxStyleZoom]),D[s.a.detailLevel]=w[3],D[s.a.rasterSet]=U,F[s.a.minWidth]=f[p.i.minWidth],F[s.a.maxWidth]=f[p.i.maxWidth],F[s.a.iconWidth]=y(f,p.i.iconWidth,NaN),D[s.a.possibleLabelPlacements]=g(f[p.i.possibleLabelPlacements],1);var G=e.labelingGroups.groupToIndex.default;D[s.a.labelingGroup]=g(f[p.i.labelingGroup],G),D[s.a.iconLabelingGroup]=g(f[p.i.iconLabelingGroup],G),D[s.a.textLabelingGroup]=g(f[p.i.textLabelingGroup],G),D[s.a.text2LabelingGroup]=y(f,p.i.text2LabelingGroup,D[s.a.textLabelingGroup]),F[s.a.duplicationSpacing]=f[p.i.duplicationSpacing],F[s.a.lineEndingOffsets]=g(f[p.i.lineEndingOffsets],0),F[s.a.labelMargins]=g(f[p.i.labelMargins],0),F[s.a.borderColor]=f[p.i.borderColor],F[s.a.borderWidth]=f[p.i.borderWidth],F[s.a.width]=f[p.i.width],F[s.a.length]=f[p.i.length],F[s.a.wingWidthMultiplier]=f[p.i.wingWidthMultiplier],F[s.a.tipHeightMultiplier]=f[p.i.tipHeightMultiplier],F[s.a.wingHeightMultiplier]=f[p.i.wingHeightMultiplier],F[s.a.poiLabelOffset]=f[p.i.poiLabelOffset],F[s.a.label2Offset]=y(f,p.i.label2Offset,NaN),D[s.a.maxSymbolsPerLine]=g(f[p.i.maxSymbolsPerLine],h.labeling.maxLabelLength),B.label=g(_[T.label],v),B.label2=y(_,T.label2,v),B.px=b[0],B.py=b[1],B.pz=0!==f[p.i.withHeight]?b[2]:void 0,B.vertexCount=x}}},function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return l})),n.d(e,"a",(function(){return u}));var r=n(67),i="rgb(128,128,128)";function o(t){switch(t[0]){case"#":return t;case"h":return function(t){var e=s(t);e[0]/=360,e[1]/=100,e[2]/=100;var n=function(t,e,n){if(0===e)return[255*n,255*n,255*n];var r=n<.5?n*(1+e):n+e-n*e,i=2*n-r;return[255*c(i,r,t+1/3),255*c(i,r,t),255*c(i,r,t-1/3)]}(e[0],e[1],e[2]);return a(n[0],n[1],n[2],void 0!==e[3]?255*e[3]:255)}(t);case"r":return function(t){var e=s(t),n=e[0],r=e[1],i=e[2],o=e[3];return a(n,r,i,void 0!==o?255*o:255)}(t)}return"#ff0000"}function a(t,e,n,r){var i=Math.round(t).toString(16),o=Math.round(e).toString(16),a=Math.round(n).toString(16),s=Math.round(r).toString(16);return 1===s.length&&(s="0"+s),1===i.length&&(i="0"+i),1===o.length&&(o="0"+o),1===a.length&&(a="0"+a),"#"+i+o+a+s}function s(t){return t.split("(")[1].split(")")[0].split(",").map((function(t){return parseFloat(t)}))}function c(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function l(t,e){return"string"==typeof t?o(t):Array.isArray(t)?function(t){if(Array.isArray(t)){var e=new Array;if(t.forEach((function(t){3===t.length&&"string"==typeof t[1]&&"number"==typeof t[0]&&"number"==typeof t[2]&&e.push(t)})),e.length>0)return e}return"string"==typeof t?t:(console.error("color expression return invalid value "+t+" - used default color"),o(i))}(Object(r.a)(t,e,"toColor")):o(i)}function u(t){var e={allowOverlap:!1,allowElevation:!1,iconOpacity:1,iconImage:"",iconWidth:16,iconPriority:0,textFont:"Open_Sans",textColor:"#000000",textFontSize:16,textLineHeight:1.2,textLetterSpacing:0,textPlacement:"bottomCenter",textOffset:0,textHaloColor:"rgba(0, 0, 0, 0)",textHaloWidth:0,visibility:"visible"};if(t)for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}},function(t,e){},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(43),i=function(){function t(){this.size=4,this.items=[];for(var t=0;t<this.size;t++)this.items.push({index:t,rasterIndex:0,minStyleZoom:0,maxStyleZoom:0});this.length=0}return t.prototype.calculate=function(t,e,n){this.clear(e.length);for(var i=0;i<e.length;i++){var o=0===i,a=i===e.length-1,s=Object(r.c)(t,e[i][1]*n,!0),c=o?-1/0:e[i][0],l=a?1/0:e[i+1][0];void 0!==s&&this.push(s,c,l)}},t.prototype.getActivePlacement=function(t){for(var e=0;e<this.length;e++){var n=this.items[e];if(t>=n.minStyleZoom&&t<n.maxStyleZoom)return n}return this.items[0]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.clear=function(t){if(t>this.size){for(var e=this.size;e<t;e++)this.items.push({index:e,rasterIndex:0,minStyleZoom:0,maxStyleZoom:0});this.size=t}this.length=0},t.prototype.push=function(t,e,n){var r=this.items[this.length++];r.rasterIndex=t,r.minStyleZoom=e,r.maxStyleZoom=n},t}()},function(t,e,n){"use strict";n.r(e),n.d(e,"sinks",(function(){return a})),n.d(e,"generateRectWithTexture",(function(){return s}));var r=n(29),i=n(0),o=new Float64Array(6),a={fill:{stride:8,binder:function(t,e){t.position=new Uint16Array(e),t.txtrCoords=new Uint16Array(e,4)},packUniforms:function(t,e,n,r,i){return t[0]=e[n.phase],t[1]=e[n.minZoom],t[2]=e[n.maxZoom],t[3]=i,t[4]=r,t[5]=e[n.opacity],t},unpackUniforms:function(t){var e=new Float64Array(t);return{phase:e[0],minStyleZoom:e[1],maxStyleZoom:e[2],textureIndex:e[3],styleId:e[4],opacity:e[5]}}}},s=function(t,e,n,r,s){var l=e[0],u=e[1],d=n[i.i.phase];if(!Number.isNaN(d)){var f=t.getBucket("rectWithTexture","fill",a.fill.packUniforms(o,n,i.i,r.id,s),a.fill.binder),h=f.elements.offset;!function(t,e,n,r,i,o,a,s){var c=t.buffer,l=t.offset;c[l]=e+0,c[l+1]=e+1,c[l+2]=e+2,c[l+3]=e+2,c[l+4]=e+1,c[l+5]=e+3,t.offset=l+6}(f.indices,h),c(f,h++,l[0],u[0],0,1),c(f,h++,l[1],u[1],1,1),c(f,h++,l[2],u[2],0,0),c(f,h++,l[3],u[3],1,0),f.elements.offset=h}};function c(t,e,n,i,o,a){e*=4,t.position[e]=n,t.position[e+1]=i,t.txtrCoords[e]=Object(r.c)(o),t.txtrCoords[e+1]=Object(r.c)(a)}},function(t,e,n){"use strict";function r(t,e,n,r,i,o){return{type:t,maxDetailLevel:o,minDetailLevel:i,maxZoomLevel:r,minZoomLevel:n,zoomLevel:Math.floor(e),tiles:{},viewportTiles:[]}}function i(t){t.tiles={},t.viewportTiles=[]}n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}))},function(t,e,n){"use strict";var r=n(19);function i(t,e){for(var n=0;n<t.length;n++)if(!(t[n]===e[n]||Number.isNaN(t[n])&&Number.isNaN(e[n])))return!1;return!0}var o=.8,a=function(){function t(t,e){this.offset=0,this.stride=e,this.buffer=new ArrayBuffer(t),this.view=new Int32Array(this.buffer),this.comittedOffsets=0,this.watermark=t/e*o}return t.prototype.extend=function(){var t=2*this.buffer.byteLength;this.watermark=t/this.stride*o;var e=new ArrayBuffer(t),n=new Int32Array(e);return n.set(this.view),this.buffer=e,this.view=n,e},t}(),s=function(){function t(t){this.offset=0,this.buffer=new Int32Array(t),this.comittedOffsets=0,this.watermark=t*o}return t.prototype.extend=function(){var t=2*this.buffer.length;this.watermark=t*o;var e=new Int32Array(t);e.set(this.buffer),this.buffer=e},t}(),c=function(){function t(t,e,n,i){var o="model"!==t?67200:336e3,c=Object(r.e)(t,e);this.elements=new a(o,c),this.indices=new s(2*o/c),this.binder=i,i(this,this.elements.buffer),this.uniforms=new Float64Array(n),this.hash=function(t){for(var e="",n=0;n<t.length;n++)e+=t[n]+"$";return e}(n)}return t.prototype.resetOffsets=function(){this.elements.offset=0,this.elements.comittedOffsets=0,this.indices.offset=0,this.indices.comittedOffsets=0},t.prototype.commit=function(){this.elements.comittedOffsets=this.elements.offset,this.indices.comittedOffsets=this.indices.offset},t.prototype.rollback=function(){this.elements.offset=this.elements.comittedOffsets,this.indices.offset=this.indices.comittedOffsets},t.prototype.checkWatermarks=function(){var t=0,e=this.elements;e.offset>e.watermark&&(e.offset>=e.buffer.byteLength/e.stride&&(t=1),this.binder(this,e.extend()));var n=this.indices;return n.offset>n.watermark&&(n.offset>=n.buffer.length&&(t=1),n.extend()),t},t}(),l=n(4),u=n(6),d=n(3),f=u.b*Uint32Array.BYTES_PER_ELEMENT,h=new Uint8Array(0),p=function(){var t=new ArrayBuffer(f);this.f32=new Float32Array(t),this.u32=new Uint32Array(t),this.label=h,this.label2=h,this.vertexCount=0,this.px=void 0,this.py=void 0,this.pz=void 0},m=function(){function t(){this.items=[],this.usedItemsCount=0}return t.prototype.getItem=function(){return this.usedItemsCount===this.items.length&&this.items.push(new p),this.items[this.usedItemsCount++]},t.prototype.clear=function(){for(var t=this.items,e=0;e<t.length;e++){var n=t[e];n.label=h,n.label2=h,n.vertexCount=0,n.px=void 0,n.py=void 0,n.pz=void 0}this.usedItemsCount=0},t.prototype.isEmpty=function(){return 0===this.usedItemsCount},t.prototype.getAccumulatedData=function(t){if(!this.isEmpty()){var e=function(t,e){for(var n=0,r=0,i=0;i<e;i++){var o=t[i],a=o.u32;a[u.a.anchorStartIndex]=r,r+=3*o.vertexCount,a[u.a.anchorFinishIndex]=r,a[u.a.labelStartIndex]=n,n+=o.label.byteLength,a[u.a.labelFinishIndex]=n,a[u.a.label2StartIndex]=n,n+=o.label2.byteLength,a[u.a.label2FinishIndex]=n}return{attrs:new ArrayBuffer(e*f),labels:new ArrayBuffer(n),anchors:new ArrayBuffer(4*r)}}(this.items,this.usedItemsCount);return function(t,e,n,r){for(var i=new Uint32Array(r.attrs),o=new Uint8Array(r.labels),a=new Uint32Array(r.anchors),s=0;s<n;s++){for(var c=e[s],f=c.u32,p=0,m=s*u.b;p<u.b;p++,m++)i[m]=f[p];for(p=0;p<c.label.byteLength;p++)o[f[u.a.labelStartIndex]+p]=c.label[p];for(p=0;p<c.label2.byteLength;p++)o[f[u.a.label2StartIndex]+p]=c.label2[p];if(c.vertexCount>0){var g=c.px,y=c.py,b=c.pz;for(p=0,m=f[u.a.anchorStartIndex];p<c.vertexCount;p++,m+=3){var x=void 0!==b?b[p]:0;Object(d.q)(v,l.q(_,g[p],y[p],x),t),a[m]=v[0],a[m+1]=v[1],a[m+2]=v[2]}}c.label=h,c.label2=h,c.vertexCount=0,c.px=void 0,c.py=void 0,c.pz=void 0}}(t,this.items,this.usedItemsCount,e),this.usedItemsCount=0,e}},t}(),v=l.d(),_=l.d(),g=n(37),y=n(66),b=n(1),x=n(43),w=function(){function t(){this.packer=new y.a(b.atlasSize[0],b.atlasSize[1]),this.currentAtlasIndex=0,this.packedRasters=[],this.rastersToLoad=[],this.newRasterSets=new Map}return t.prototype.addNewRasterSet=function(t,e){var n=this.newRasterSets.get(t);n||(n=[],this.newRasterSets.set(t,n)),n.push(e)},t.prototype.pack=function(t,e,n){t.isSvg?this.packSvg(t,e,n):this.packPng(t,e,n)},t.prototype.addRastersToLoad=function(t,e,n){if(e.isSvg)this.rastersToLoad.push(t,e.index,0);else for(var r=0;r<n.length;r++)this.rastersToLoad.push(t,e.index,n.items[r].rasterIndex)},t.prototype.getNewRasterSets=function(){var t=this.newRasterSets;return this.newRasterSets=new Map,t},t.prototype.getPackedRasters=function(){if(0!==this.packedRasters.length){var t=new Uint16Array(this.packedRasters);return this.packedRasters=[],t}},t.prototype.getRastersToLoad=function(){var t=new Float64Array(this.rastersToLoad);return this.rastersToLoad=[],t},t.prototype.packPng=function(t,e,n){for(var r=t.rasters,i=0,o=e;i<o.length;i++){var a=o[i][1]*n,s=Object(x.c)(r,a,!1);if(void 0!==s){var c=t.rasters[s];if(!c.isPacked){var l=this.packer.packOne(c.w+2,c.h+2);null===l&&(this.packer=new y.a(b.atlasSize[0],b.atlasSize[1]),this.currentAtlasIndex++,l=this.packer.packOne(c.w+2,c.h+2)),c.x=l.x+1,c.y=l.y+1,c.atlasIndex=this.currentAtlasIndex,c.isPacked=!0,this.packedRasters.push(t.index,s,c.x,c.y,c.w,c.h,this.currentAtlasIndex)}}}},t.prototype.packSvg=function(t,e,n){for(var r=t.rasters,i=new Set,o=0,a=r;o<a.length;o++){var s=a[o];i.add(s.w)}for(var c=0,l=e;c<l.length;c++){var u=l[c][1]*n;if(!i.has(u)){var d=this.packer.packOne(u+2,u+2);null===d&&(this.packer=new y.a(b.atlasSize[0],b.atlasSize[1]),this.currentAtlasIndex++,d=this.packer.packOne(u+2,u+2)),s={w:u,h:u,x:d.x+1,y:d.y+1,anchorX:t.anchorX,anchorY:t.anchorY,atlasIndex:this.currentAtlasIndex,isPacked:!0};var f=r.push(s)-1;this.packedRasters.push(t.index,f,s.x,s.y,s.w,s.h,this.currentAtlasIndex)}}},t}(),S=n(76);n.d(e,"a",(function(){return O}));var O=function(){function t(t){this.idIndexer=new g.a(t),this.atlasPacker=new w,this.floorHidingMap=new S.a,this.reset()}return t.prototype.reset=function(){this.buckets={},this.labels=new m,this.addedBuckets=[],this.geoIds=new Uint32Array(0),this.floorHidingMap.clear()},t.prototype.getBucket=function(t,e,n,r){var o=this.buckets[t];void 0===o&&(o=this.buckets[t]={});var a=o[e];void 0===a&&(a=o[e]=[]);for(var s=a.length-1;s>=0;s--){var l=a[s];if(i(n,l.uniforms))return this.addedBuckets.push(l),l}var u=new c(t,e,n,r);return a.push(u),this.addedBuckets.push(u),u},t.prototype.isOverloaded=function(){for(var t=this.addedBuckets,e=0,n=0;n<t.length;)e+=t[n++].checkWatermarks();var r=e>0;if(r)for(;n--;)t[n].rollback();else for(;n--;)t[n].commit();return t.length=0,r},t.prototype.getFreeLabelItem=function(){return this.labels.getItem()},t.prototype.setGeoIds=function(t){this.geoIds=t},t.prototype.addFloorHidingMap=function(t,e){var n=this.floorHidingMap.get(e);void 0===n&&(n=[]),n.push(t[0],t[1]),this.floorHidingMap.set(e,n)},t.prototype.getAccumulatedData=function(t){var e,n=this.buckets,i=[],o=[];for(var a in n){var s=a,c=n[s];if(c)for(var l in c){var u=l,d=c[u];if(d){for(var f=Object(r.e)(s,u)/4,h=0,p=0;p<d.length;p++)h+=d[p].indices.offset;if(0!==h){var m=[],v=new Int32Array(h*f),_=0;for(p=0;p<d.length;p++){var g=d[p],y=g.elements,b=g.indices,x=g.uniforms,w=y.view,S=b.buffer;if(0!==y.offset){for(var O=_,M=0;M<b.offset;M++)for(var j=S[M]*f,I=0;I<f;I++)v[_++]=w[j+I];m.push({uniforms:x.buffer,hash:g.hash,rangeStart:4*O,rangeEnd:4*_}),g.resetOffsets()}}i.push({symbol:s,sink:u,buffer:v.buffer,generatedObjects:m}),o.push(v.buffer)}}}}t&&(e=this.labels.getAccumulatedData(t))&&o.push(e.anchors,e.attrs,e.labels);var T=this.idIndexer.getPacked();o.push(T.idBuffer,T.phaseBuffer);var E=this.atlasPacker.getPackedRasters();void 0!==E&&o.push(E.buffer);var A=this.atlasPacker.getRastersToLoad();o.push(A.buffer);var L=new Uint32Array(this.geoIds);o.push(L.buffer);var C=this.floorHidingMap.serialize();return this.floorHidingMap.clear(),{data:i,labels:e,geoIds:L,floorHidingMap:C,packedRasters:E,rastersToLoad:A,identifyIds:T,transferable:o}},t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return s}));var r=n(29),i=n(8);function o(t,e,n,r,o,a,s,l,u){!function(t,e,n,r,i,o,a){var s=t.elements,c=t.indices,l=c.buffer,u=c.offset,d=s.offset;l[u]=d+2,l[u+1]=d+0,l[u+2]=d+3,l[u+3]=d+3,l[u+4]=d+0,l[u+5]=d+1,c.offset=u+6}(a);for(var d=0;d<4;d++)c(a,t,e,n,r.items[4*o+d],s!==-1/0?s:i.h,l!==1/0?l:i.f,u)}var a=[0,0];function s(t,e,n,r){r.clear(4*n.length);for(var i=0;i<n.length;i++){var o=e[n.items[i].rasterIndex];a[0]=-o.w*o.anchorX,a[1]=-o.h+o.h*o.anchorY;var s=(o.x-.5)/t[0],c=(o.y-.5)/t[1],l=s+(o.w+1)/t[0],u=c+(o.h+1)/t[1];r.push(Math.floor(a[0]+.5)<<16>>16,Math.floor(a[1]+.5)<<16>>16,s,u),r.push(Math.floor(a[0]+o.w+.5)+1<<16>>16,Math.floor(a[1]+.5)<<16>>16,l,u),r.push(Math.floor(a[0]+.5)<<16>>16,Math.floor(a[1]+o.h+.5)+1<<16>>16,s,c),r.push(Math.floor(a[0]+o.w+.5)+1<<16>>16,Math.floor(a[1]+o.h+.5)+1<<16>>16,l,c)}}function c(t,e,n,i,o,a,s,c){var l=12*t.elements.offset;t.position[l]=e,t.position[l+1]=n,t.position[l+2]=i,t.cornerOffset[l]=o.cornerOffset[0],t.cornerOffset[l+1]=o.cornerOffset[1],t.texCoords[l]=Object(r.c)(o.texCoords[0]),t.texCoords[l+1]=Object(r.c)(o.texCoords[1]),t.scales[l]=Object(r.b)(a),t.scales[l+1]=Object(r.a)(s),l>>=1,t.localID[l]=c,t.elements.offset++}},function(t,e,n){"use strict";n.r(e),n.d(e,"sinks",(function(){return c})),n.d(e,"checkRequiredAttrs",(function(){return l})),n.d(e,"processSubmesh",(function(){return u})),n.d(e,"processOuterEdge",(function(){return d}));var r=n(39),i=n(20),o=n(0),a=new Float64Array(26),s=new Float64Array(24),c={fill:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.texCoords=new Uint16Array(e,8),t.localID=new Uint32Array(e,12)},packUniforms:function(t,e,n,r,i,o,a,s,c){return t[0]=e[n.color],t[1]=r,t[2]=e[n.minZoom],t[3]=e[n.maxZoom],t[4]=e[n.phase],t[5]=i,t[6]=c,t[7]=o,t[8]=s[0],t[9]=s[1],t.set(a,10),t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],texture:e[1],minStyleZoom:e[2],maxStyleZoom:e[3],phase:e[4],primitiveType:e[5],styleId:e[6],modelIndex:e[7],id:Object(i.a)(e[8],e[9]),matrix:e.subarray(10)}}},stroke:{stride:12,binder:function(t,e){t.position=new Uint16Array(e),t.directionDistance=new Int8Array(e,8)},packUniforms:function(t,e,n,r,i,o){return t[0]=e[n.contourColor],t[1]=e[n.outerEdgeWidth],t[2]=e[n.minZoom],t[3]=e[n.maxZoom],t[4]=e[n.phase],t[5]=o,t[6]=i[0],t[7]=i[1],t.set(r,8),t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],width:e[1],minStyleZoom:e[2],maxStyleZoom:e[3],phase:e[4],styleId:e[5],id:Object(i.a)(e[6],e[7]),matrix:e.subarray(8)}}}},l=function(t){return!Number.isNaN(t[o.i.color])&&!Number.isNaN(t[o.i.contourColor])},u=function(t,e,n,r,i,s,l,u,d,h,p){var m=e.tileProps;if(!Number.isNaN(r[o.i.phase])){var v=i[m.id],_=n.idIndexer.getIndex(v,r[o.i.phase],i[m.sublayer],"model"),g=n.getBucket("model","fill",c.fill.packUniforms(a,r,o.i,d,u,p,h,v,t.id),c.fill.binder);!function(t,e){for(var n=t.elements.offset,r=t.indices.offset,i=0;i<e.length;i++)t.indices.buffer[r++]=n+e[i];t.indices.offset=r}(g,l);for(var y=0;y<s.length;y++)f(g,s,y,_)}},d=function(t,e,n,i,a,l,u,d){var f=e.tileProps;if(!Number.isNaN(i[o.i.phase]))for(var h=a[f.id],p=n.getBucket("model","stroke",c.stroke.packUniforms(s,i,o.i,d,h,t.id),c.stroke.binder),m=0;m<u.length;m+=2){var v=5*u[m],_=5*u[m+1];Object(r.a)(p,l[v],l[v+1],l[v+2],l[_],l[_+1],l[_+2])}};function f(t,e,n,r){var i=t.elements.offset,o=5*n,a=i<<3,s=i<<2;t.position[a]=e[o],t.position[a+1]=e[o+1],t.position[a+2]=e[o+2],t.texCoords[a]=e[o+3],t.texCoords[a+1]=e[o+4],t.localID[s]=r,t.elements.offset++}},function(t,e,n){"use strict";function r(t,e,n){n=n||{},this.w=t||64,this.h=e||64,this.autoResize=!!n.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function i(t,e,n){this.x=0,this.y=t,this.w=this.free=e,this.h=n}function o(t,e,n,r,i,o,a){this.id=t,this.x=e,this.y=n,this.w=r,this.h=i,this.maxw=o||r,this.maxh=a||i,this.refcount=0}e.a=r,r.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var n,r,i,o,a=[],s=0;s<t.length;s++)if(n=t[s].w||t[s].width,r=t[s].h||t[s].height,i=t[s].id,n&&r){if(!(o=this.packOne(n,r,i)))continue;e.inPlace&&(t[s].x=o.x,t[s].y=o.y,t[s].id=o.id),a.push(o)}return this.shrink(),a},r.prototype.packOne=function(t,e,n){var r,o,a,s,c,l,u,d,f={freebin:-1,shelf:-1,waste:1/0},h=0;if("string"==typeof n||"number"==typeof n){if(r=this.getBin(n))return this.ref(r),r;"number"==typeof n&&(this.maxId=Math.max(n,this.maxId))}else n=++this.maxId;for(s=0;s<this.freebins.length;s++){if(e===(r=this.freebins[s]).maxh&&t===r.maxw)return this.allocFreebin(s,t,e,n);e>r.maxh||t>r.maxw||e<=r.maxh&&t<=r.maxw&&(a=r.maxw*r.maxh-t*e)<f.waste&&(f.waste=a,f.freebin=s)}for(s=0;s<this.shelves.length;s++)if(h+=(o=this.shelves[s]).h,!(t>o.free)){if(e===o.h)return this.allocShelf(s,t,e,n);e>o.h||e<o.h&&(a=(o.h-e)*t)<f.waste&&(f.freebin=-1,f.waste=a,f.shelf=s)}return-1!==f.freebin?this.allocFreebin(f.freebin,t,e,n):-1!==f.shelf?this.allocShelf(f.shelf,t,e,n):e<=this.h-h&&t<=this.w?(o=new i(h,this.w,e),this.allocShelf(this.shelves.push(o)-1,t,e,n)):this.autoResize?(c=l=this.h,((u=d=this.w)<=c||t>u)&&(d=2*Math.max(t,u)),(c<u||e>c)&&(l=2*Math.max(e,c)),this.resize(d,l),this.packOne(t,e,n)):null},r.prototype.allocFreebin=function(t,e,n,r){var i=this.freebins.splice(t,1)[0];return i.id=r,i.w=e,i.h=n,i.refcount=0,this.bins[r]=i,this.ref(i),i},r.prototype.allocShelf=function(t,e,n,r){var i=this.shelves[t].alloc(e,n,r);return this.bins[r]=i,this.ref(i),i},r.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,n=0;n<this.shelves.length;n++){var r=this.shelves[n];e+=r.h,t=Math.max(r.w-r.free,t)}this.resize(t,e)}},r.prototype.getBin=function(t){return this.bins[t]},r.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},r.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},r.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},r.prototype.resize=function(t,e){this.w=t,this.h=e;for(var n=0;n<this.shelves.length;n++)this.shelves[n].resize(t);return!0},i.prototype.alloc=function(t,e,n){if(t>this.free||e>this.h)return null;var r=this.x;return this.x+=t,this.free-=t,new o(n,r,this.y,t,e,t,this.h)},i.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0}},function(t,e,n){"use strict";var r=n(58),i=n(75);n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return a}));var o={toColor:function(t){return Object(r.b)(t.toString())}};function a(t,e,n){if(t&&"match"===t[0])return function(t,e,n){if(t.length>2&&t[1]&&"get"===t[1][0]){for(var r=2;r<t.length-1;r+=2){var i=t[r];if(Array.isArray(i))for(var o=0,s=i;o<s.length;o++){var c=s[o];if(e[t[1][1]]===c){var l=t[r+1],u=Array.isArray(l)?a(l,e):l;return u}}}var d=t[t.length-1],f=Array.isArray(d)?a(d,e):d;return f}}(r=t,e||[]);if(t&&"interpolate"===t[0]){var r=t;return Object(i.a)(r,n)}return t&&"toColor"===t[0]?(r=t,o.toColor(r[1])):t}},function(t,e,n){"use strict";n.r(e),n.d(e,"sinks",(function(){return b})),n.d(e,"checkRequiredAttrs",(function(){return x})),n.d(e,"processComponent",(function(){return w}));var r=n(51),i=n(7),o=n(34),a=n(50),s=n(10),c=n(1),l=n(38),u=n(39),d=n(0),f=n(31),h=new Float64Array(7),p=new Float64Array(5),m=new Float64Array(6),v=i.d(),_=i.d();function g(t,e,n,r,i){return t[0]=e[n.color],t[1]=e[n.minZoom],t[2]=e[n.maxZoom],t[3]=e[n.wallPhase],t[4]=r,t[5]=i,t}function y(t){var e=new Float64Array(t);return{color:e[0],minStyleZoom:e[1],maxStyleZoom:e[2],phase:e[3],styleId:e[4],type:e[5]}}var b={fill:{stride:8,binder:function(t,e){t.position=new Uint16Array(e),t.localID=new Uint32Array(e,4)},packUniforms:function(t,e,n,r){return t[0]=e[n.color],t[1]=e[n.minZoom],t[2]=e[n.maxZoom],t[3]=e[n.phase],t[4]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],minStyleZoom:e[1],maxStyleZoom:e[2],phase:e[3],styleId:e[4]}}},stroke:{stride:8,binder:function(t,e){t.position=new Uint16Array(e),t.directionDistance=new Int8Array(e,4)},packUniforms:function(t,e,n,r){return t[0]=e[n.borderColor],t[1]=e[n.borderWidth],t[2]=e[n.minZoom],t[3]=e[n.maxZoom],t[4]=e[n.phase],t[5]=e[n.color],t[6]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],width:e[1],minStyleZoom:e[2],maxStyleZoom:e[3],phase:e[4],fillColor:e[5],styleId:e[6]}}},wallSide:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.normal=new Uint16Array(e,8),t.localID=new Uint32Array(e,12)},packUniforms:g,unpackUniforms:y},wallStroke:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.distance=new Int16Array(e,6),t.normals=new Uint16Array(e,8),t.direction=new Uint16Array(e,12)},packUniforms:function(t,e,n,r){return t[0]=e[n.color],t[1]=e[n.minZoom],t[2]=e[n.maxZoom],t[3]=e[n.wallPhase],t[4]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],minStyleZoom:e[1],maxStyleZoom:e[2],phase:e[3],styleId:e[4]}}},roofStroke:{stride:12,binder:function(t,e){t.position=new Uint16Array(e),t.directionDistance=new Int8Array(e,8)},packUniforms:g,unpackUniforms:y}},x=function(t){return!Number.isNaN(t[d.i.color])&&!Number.isNaN(t[d.i.wallPhase])},w=function(t,e,n,r,u,g){if(!Number.isNaN(r[d.i.phase])){var y=Math.round(Object(s.p)(c.floors.wallHeight)),x=Math.round(Object(s.p)(c.floors.islandHeight)),w=e.idIndexer.getIndex(u[g.id],r[d.i.phase],u[g.sublayer],"floor"),I=e.getBucket("floor","fill",b.fill.packUniforms(p,r,d.i,t.id),b.fill.binder),T=e.getBucket("floor","stroke",b.stroke.packUniforms(h,r,d.i,t.id),b.stroke.binder),E=e.getBucket("floor","wallSide",b.wallSide.packUniforms(m,r,d.i,t.id,l.b.WallSide),b.wallSide.binder),A=e.getBucket("floor","wallSide",b.wallSide.packUniforms(m,r,d.i,t.id,l.b.WallTop),b.wallSide.binder),L=e.getBucket("floor","wallSide",b.wallSide.packUniforms(m,r,d.i,t.id,l.b.IslandTop),b.wallSide.binder),C=e.getBucket("floor","wallStroke",b.wallStroke.packUniforms(p,r,d.i,t.id),b.wallStroke.binder),P=e.getBucket("floor","roofStroke",b.roofStroke.packUniforms(m,r,d.i,t.id,l.b.WallTop),b.roofStroke.binder),k=e.getBucket("floor","roofStroke",b.roofStroke.packUniforms(m,r,d.i,t.id,l.b.IslandTop),b.roofStroke.binder);if(n.isIsland)for(var N=0;N<n.area.length;N++){var R=Object(f.a)(n.area[N]),z=Object(f.b)(R),B=z.x,F=z.y,D=z.count;O(L,R,x,w),j(k,B,F,D,x);for(var U=0;U<D;U++){var Z=(U+1)%D;i.o(v,B[U],B[Z]),i.o(_,F[U],F[Z]),Object(a.a)(E,2,v,_,void 0,x,w),Object(o.a)(C,2,v,_,void 0),Object(o.b)(C,2,v,_,void 0,x)}}else{for(N=0;N<n.area.length;N++)if(S(I,R=Object(f.a)(n.area[N]),w),!Number.isNaN(r[d.i.borderColor])){var H=Object(f.b)(R);j(T,B=H.x,F=H.y,D=H.count,0)}for(N=0;N<n.wallTop.length;N++)M(A,R=Object(f.a)(n.wallTop[N]),y,w);for(N=0;N<n.wallSide.length;N++){var G=Object(f.a)(n.wallSide[N]),W=Object(f.b)(G);B=W.x,F=W.y,D=W.count,Object(a.a)(E,D,B,F,void 0,y,w),Object(o.a)(C,D,B,F,void 0),Object(o.b)(C,D,B,F,void 0,y),j(P,B,F,D,y)}}}};function S(t,e,n){for(var i=t.elements.offset,o=0;o<e.length;o+=2){var a=t.elements.offset*b.fill.stride/t.position.BYTES_PER_ELEMENT;t.position[a]=e[o],t.position[a+1]=e[o+1],t.localID[a>>1]=n,t.elements.offset++}var s=r(e);for(o=0;o<s.length;o++)t.indices.buffer[t.indices.offset++]=i+s[o]}function O(t,e,n,i){for(var o=t.elements.offset,a=0;a<e.length;a+=2){var s=t.elements.offset*b.wallSide.stride/t.position.BYTES_PER_ELEMENT;t.position[s]=e[a],t.position[s+1]=e[a+1],t.position[s+2]=n,t.normal[s]=0,t.normal[s+1]=127,t.localID[s>>1]=i,t.elements.offset++}var c=r(e);for(a=0;a<c.length;a++)t.indices.buffer[t.indices.offset++]=o+c[a]}function M(t,e,n,r){for(var i=t.elements.offset,o=0;o<8;o+=2){var a=t.elements.offset*b.wallSide.stride/t.position.BYTES_PER_ELEMENT;t.position[a]=e[o],t.position[a+1]=e[o+1],t.position[a+2]=n,t.normal[a]=0,t.normal[a+1]=127,t.localID[a>>1]=r,t.elements.offset++}var s=t.indices.offset;t.indices.buffer[s++]=i,t.indices.buffer[s++]=i+1,t.indices.buffer[s++]=i+2,t.indices.buffer[s++]=i,t.indices.buffer[s++]=i+2,t.indices.buffer[s++]=i+3,t.indices.offset=s}function j(t,e,n,r,i){for(var o=0;o<r;o++){var a=(o+1)%r;Object(u.a)(t,e[o],n[o],i,e[a],n[a],i)}}},function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<t.length;r++)n[t.charCodeAt(r)]=r;e.encode=function(e){var n,r=new Uint8Array(e),i=r.length,o="";for(n=0;n<i;n+=3)o+=t[r[n]>>2],o+=t[(3&r[n])<<4|r[n+1]>>4],o+=t[(15&r[n+1])<<2|r[n+2]>>6],o+=t[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},e.decode=function(t){var e,r,i,o,a,s=.75*t.length,c=t.length,l=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var u=new ArrayBuffer(s),d=new Uint8Array(u);for(e=0;e<c;e+=4)r=n[t.charCodeAt(e)],i=n[t.charCodeAt(e+1)],o=n[t.charCodeAt(e+2)],a=n[t.charCodeAt(e+3)],d[l++]=r<<2|i>>4,d[l++]=(15&i)<<4|o>>2,d[l++]=(3&o)<<6|63&a;return u}}()},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o}));var r=n(2),i=["border_color","border_phase","border_width_zpt","color","color2","color3","contour_color","dash2_color","dash2_length_zpt","dash_color","dash_length_zpt","duplication_spacing_zpt","font","font2","font2_color","font2_size_zpt","font_color","font_direction","font_height_scale_percent","font_hinting_type","font_size_zpt","font_thickening_zpt","group_id","halo2_color","halo2_radius_zpt","halo_color","halo_opacity","halo_radius_zpt","height","icon_appear_margin_left_right_zpt","icon_appear_margin_top_bottom_zpt","icon_labeling_group","icon_priority","icon_visible_margin_left_right_zpt","icon_visible_margin_top_bottom_zpt","icon_width_zpt","label2_offset","label2_priority","label_halign","label_margins_zpt","label_priority","label_valign","labeling_group","length_zpt","letter_spacing","line_ending_offsets_zpt","line_height","max_display_zoom","max_line_count","max_symbols_per_line","max_width_z_level","max_width_zpt","max_zoom","min_display_zoom","min_width_z_level","min_width_zpt","min_zoom","icon_group_priority","label_group_priority","object_group_priority","offset_x_zpt","offset_y_zpt","opacity","outer_edge_width_zpt","phase","phase2","phase3","poi_label_offset","possible_label_placements","raster_set","scale_step","shift_zpt","space_color","space_length_zpt","symbol","text2_appear_margin_left_right_zpt","text2_appear_margin_top_bottom_zpt","text2_labeling_group","text2_visible_margin_left_right_zpt","text2_visible_margin_top_bottom_zpt","text_appear_margin_left_right_zpt","text_appear_margin_top_bottom_zpt","text_labeling_group","text_visible_margin_left_right_zpt","text_visible_margin_top_bottom_zpt","tip_height_multiplier","tip_movement_amplitude_zpt","wall_color","wall_phase","width2_zpt","width3_zpt","width_labeling_multiplier","width_zpt","wing_height_multiplier","wing_width_multiplier","with_height","font3","font3_size_zpt","font3_color","halo3_radius_zpt","halo3_color","label2_letter_spacing","label3_letter_spacing","label2_line_height","label3_line_height","label3_offset","text3_appear_margin_left_right_zpt","text3_appear_margin_top_bottom_zpt","text3_labeling_group","text3_visible_margin_left_right_zpt","text3_visible_margin_top_bottom_zpt"],o=Object(r.c)(i)},function(t,e,n){"use strict";n.r(e),n.d(e,"sinks",(function(){return v})),n.d(e,"checkRequiredAttrs",(function(){return _})),n.d(e,"processComponent",(function(){return g})),n.d(e,"generatePoint",(function(){return y}));var r=n(72),i=n(60),o=n(46),a=n(64),s=n(3),c=n(23),l=n(1),u=n(20),d=n(0),f=new Float64Array(7),h=new i.a,p=new r.a,m=[NaN,NaN],v={raster:{stride:24,binder:function(t,e){t.position=new Uint16Array(e),t.cornerOffset=new Int16Array(e,8),t.texCoords=new Uint16Array(e,12),t.scales=new Int16Array(e,16),t.localID=new Uint32Array(e,20)},packUniforms:function(t,e,n,r,i,o){return t[0]=i,t[1]=e[n.minZoom],t[2]=e[n.maxZoom],t[3]=e[n.phase],t[4]=r,t[5]=o[0],t[6]=o[1],t},unpackUniforms:function(t){var e=new Float64Array(t);return{atlasIndex:e[0],minStyleZoom:e[1],maxStyleZoom:e[2],phase:e[3],styleId:e[4],hiddenObjectId:Number.isNaN(e[5])?void 0:Object(u.a)(e[5],e[6])}}}},_=function(t,e){var n=e.rasterSets;if(Number.isNaN(t[d.i.rasterSet]))return!1;var r=!(Number.isNaN(t[d.i.minWidth])||Number.isNaN(t[d.i.maxWidth])||Number.isNaN(t[d.i.minWidthZLevel])||Number.isNaN(t[d.i.maxWidthZLevel])),i=void 0!==d.i.iconWidth&&!Number.isNaN(t[d.i.iconWidth]),o=r||i,a=n[t[d.i.rasterSet]].isSvg;return!a&&o||a&&i},g=function(t,e,n,r,i,o,a,s,c,l,u,f){var h=n.tileProps;if(!Number.isNaN(i[d.i.phase])){var p=o[h.id],v=!Number.isNaN(p)&&f&&f.has(p)?p:m;y(r,e,n,i,o,a[0][0],a[1][0],v)}};function y(t,e,n,r,i,u,_,g){void 0===g&&(g=m);var y=n.tileProps,b=e.rasterSets[r[d.i.rasterSet]],x=Object(c.b)(i[y.dpi]),w=Object(o.a)(e.curves,b.rasters,r[d.i.iconWidth],r[d.i.minWidth],r[d.i.maxWidth],Math.max(1,Object(s.v)(r[d.i.minWidthZLevel])),Math.max(1,Object(s.v)(r[d.i.maxWidthZLevel])),x);if(t.atlasPacker.pack(b,w,x),h.calculate(b.rasters,w,x),!h.isEmpty()){t.atlasPacker.addRastersToLoad(e.id,b,h);var S=t.idIndexer.getIndex(i[y.id],r[d.i.phase],i[y.sublayer],"point");Object(a.b)(l.atlasSize,b.rasters,h,p);for(var O=0;O<h.length;O++){var M=h.items[O],j=M.rasterIndex,I=M.minStyleZoom,T=M.maxStyleZoom,E=b.rasters[j].atlasIndex,A=t.getBucket("point","raster",v.raster.packUniforms(f,r,d.i,e.id,E,g),v.raster.binder);Object(a.a)(u,_,0,p,O,A,Math.max(1,Object(s.v)(T)),Math.max(1,Object(s.v)(I)),S)}}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=function(){this.cornerOffset=[0,0],this.texCoords=[0,0]},i=function(){function t(){this.size=4,this.items=[];for(var t=0;t<this.size;t++)this.items.push(new r);this.length=0}return t.prototype.clear=function(t){if(t>this.size){for(var e=this.size;e<t;e++)this.items.push(new r);this.size=t}this.length=0},t.prototype.push=function(t,e,n,r){var i=this.items[this.length++];i.cornerOffset[0]=t,i.cornerOffset[1]=e,i.texCoords[0]=n,i.texCoords[1]=r},t.prototype.isEmpty=function(){return 0===this.length},t}()},function(t,e,n){"use strict";n.r(e),n.d(e,"sinks",(function(){return o})),n.d(e,"generateRect",(function(){return a}));var r=n(0),i=new Float64Array(5),o={fill:{stride:8,binder:function(t,e){t.position=new Uint16Array(e),t.localID=new Uint32Array(e,4)},packUniforms:function(t,e,n,r){return t[0]=e[n.color],t[1]=e[n.minZoom],t[2]=e[n.maxZoom],t[3]=e[n.phase],t[4]=r,t},unpackUniforms:function(t){var e=new Float64Array(t);return{color:e[0],minStyleZoom:e[1],maxStyleZoom:e[2],phase:e[3],styleId:e[4]}}}},a=function(t,e,n,a,c,l){var u=e[0],d=e[1],f=l.tileProps,h=n[r.i.phase];if(!Number.isNaN(h)&&!Number.isNaN(n[r.i.color])){var p=t.idIndexer.getIndex(a[f.id],h,a[f.sublayer],"rect"),m=t.getBucket("rect","fill",o.fill.packUniforms(i,n,r.i,c.id),o.fill.binder),v=m.elements.offset;!function(t,e,n,r,i,o,a,s){var c=t.buffer,l=t.offset;c[l]=e+0,c[l+1]=e+1,c[l+2]=e+2,c[l+3]=e+2,c[l+4]=e+1,c[l+5]=e+3,t.offset=l+6}(m.indices,v),s(m,v++,u[0],d[0],p),s(m,v++,u[1],d[1],p),s(m,v++,u[2],d[2],p),s(m,v++,u[3],d[3],p),m.elements.offset=v}};function s(t,e,n,r,i){var o=4*e;t.position[o]=n,t.position[o+1]=r;var a=2*e;t.localID[a]=i}},function(t,e,n){"use strict";n.r(e),n.d(e,"sinks",(function(){return f})),n.d(e,"generateLabelPoint",(function(){return h})),n.d(e,"processElement",(function(){return p})),n.d(e,"getLabelingInfo",(function(){return m}));var r=n(40),i=n(1),o=n(47),a=n(3),s=n(17),c=n(10),l=n(15),u=new Float64Array(13),d=[0,0,0],f={raster:{stride:16,binder:function(t,e){t.position=new Uint16Array(e),t.cornerOffset=new Int16Array(e,8),t.texCoords=new Uint16Array(e,12)},packUniforms:function(t,e,n,r,i){return t[0]=e.font,t[1]=e.color,t[2]=e.haloColor,t[3]=e.fontSize,t[4]=e.haloRadius,t[5]=e.offsetX+(i?i[0]:0),t[6]=-e.offsetY-(i?i[1]:0),t[7]=e.phase,t[8]=e.styleId,t[9]=n,t[10]=r,t[11]=e.minDisplayStyleZoom,t[12]=e.maxDisplayStyleZoom,t},unpackUniforms:function(t){var e=new Float64Array(t);return{font:e[0],fontColor:e[1],haloColor:e[2],fontSize:e[3],haloRadius:e[4],offsetX:e[5],offsetY:e[6],phase:e[7],styleId:e[8],animDirection:e[9],range:e[10],minStyleZoom:e[11],maxStyleZoom:e[12]}}}},h=function(t,e,n,i,o){for(var a={},s=0,c=e.ranges;s<c.length;s++){var l=c[s];a[l]=t.getBucket("labelPoint","raster",f.raster.packUniforms(u,e,i,l,o),f.raster.binder)}Object(r.c)(a,e,n,e.textMetrics)},p=function(t,e,n,r,i,o,s,l){if(Object(a.k)(d,r.label.anchorWorld,l),Object(c.h)(d))return h(n,r.label,d,i)},m=function(t,e,n,a,c){for(var u=t.offsetX,d=t.offsetY,f=t.hAlign,h=t.vAlign,p=t.fontSize,m=t.textMetrics,v=e.curves,_=a.styleZoom,g=Object(s.c)(v[p],_),y=m.lines.length,b=g/i.fonts.baseSize,x=t.lineHeight*g,w=Object(r.d)(h,-x,y),S=new o.a(t,l.c.Text,t.anchorWorld,a,c,e),O=0;O<y;O++){var M=m.lines[O].width*b,j=void 0;switch(f){case 0:j=M/2;break;case 2:j=-M/2;break;default:j=0}S.boxes.push([j+u-M/2,w+d-g/2,j+u+M/2,w+d+g/2]),w+=x}t.textMetrics=m,t.labelingElements[0]=S}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(67);function i(t,e){for(var n,i=new Array,o=t.slice(3),a=0;a<o.length;a+=2){var s=o[a];if("number"==typeof s){var c=s,l=o[a+1],u=Array.isArray(l)?Object(r.a)(l):l;if("number"!=typeof u&&"string"!=typeof u){console.error("Interpolation expression not supported type "+typeof u);break}if(n&&typeof n!=typeof u){console.error("Interpolation expression not supported multiple types");break}var d=e&&r.b[e]?r.b[e](u):u;i.push([c,d,1]),n=u}}return i.length>0?i:void 0}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(t){void 0===t&&(t={}),this.map=t}return t.prototype.set=function(t,e){var n=this.map[t[0]];void 0===n&&(n=this.map[t[0]]={}),n[t[1]]=e},t.prototype.get=function(t){if(void 0!==this.map[t[0]])return this.map[t[0]][t[1]]},t.prototype.serialize=function(){return this.map},t.prototype.forEach=function(t){for(var e in this.map)for(var n in this.map[e])t(this.map[e][n],Number(e),Number(n))},t.prototype.clear=function(){this.map={}},t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(5),i=function(t){function e(e){var n=t.call(this)||this;return n.sync=function(t){var e=t.sublayers,r=t.sublayersByIndex,i=t.objectClasses,o=t.objectClassesByIndex;n.sublayers=e,n.sublayersByIndex=r,n.objectClasses=i,n.objectClassesByIndex=o},e.set("syncMetatile",n.sync),n}return Object(r.c)(e,t),e}(n(78).a)},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(0),i=n(8),o=function(){this.classes={building:0,area:1,line:2,dashed_line:3,point:4,label_line:5,one_way_line:6,arrow_line:7,class_model:8,unknown_class:9},this.sublayers={},this.objectClasses={},this.sublayersByIndex={},this.objectClassesByIndex={},this.version="",this.exportConfig={},this.defaultProps={},this.tileProps=r.b,this.hash=i.i}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(){this.metaStyles=new Map,this.metatileHashToStyleId=new Map,this.singleUsedStyleId=void 0}return t.prototype.proxyAddStyle=function(t){this.metaStyles.set(t.id,t)},t.prototype.proxyBindStyleToMetatileHash=function(t,e){this.metatileHashToStyleId.set(t,e)},t.prototype.proxyUseSingleStyle=function(t){this.singleUsedStyleId=t},t.prototype.getStyle=function(t){return this.metaStyles.get(t)},t.prototype.getStyleForTerrainTiles=function(t){var e,n=null!==(e=this.singleUsedStyleId)&&void 0!==e?e:this.metatileHashToStyleId.get(t);if(void 0!==n)return this.metaStyles.get(n)},t.prototype.isCustomStyle=function(){return void 0!==this.singleUsedStyleId},t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(28),i=n(6),o=n(25),a=n(20);function s(t,e){for(var n=[],r=0;r<t.length;r++)for(var o=t[r],a=o.labels,s=o.metatileHash,l=o.styleId,u=new Float32Array(a.attrs),d=new Uint32Array(a.attrs),f=new Int32Array(a.anchors),h=d.length/i.b,p=0;p<h;p++)n.push(new c(u,d,a.labels,f,s,l,e,p));return n}var c=function(t,e,n,s,c,l,u,d){var f=d*i.b;this.metatileHash=c,this.styleId=l,this.sublayer=e[f+i.a.sublayer],this.labelPriority=e[f+i.a.labelPriority],this.label2Priority=e[f+i.a.label2Priority],this.iconPriority=e[f+i.a.iconPriority],this.iconGroupPriority=e[f+i.a.iconGroupPriority],this.labelGroupPriority=e[f+i.a.labelGroupPriority],this.hAlign=e[f+i.a.hAlign],this.vAlign=e[f+i.a.vAlign],this.font=t[f+i.a.font],this.fontSize=t[f+i.a.fontSize],this.font2=t[f+i.a.font2],this.font2Size=t[f+i.a.font2Size],this.lineHeight=t[f+i.a.lineHeight],this.letterSpacing=t[f+i.a.letterSpacing],this.symbol=o.a[e[f+i.a.symbol]],this.phase=t[f+i.a.phase],this.identifyIndex=e[f+i.a.identifyIndex],this.identifyPoiLabelIndex=e[f+i.a.identifyPoiLabelIndex],this.color=e[f+i.a.color],this.fontColor=e[f+i.a.fontColor],this.haloColor=t[f+i.a.haloColor],this.font2Color=e[f+i.a.font2Color],this.halo2Color=t[f+i.a.halo2Color],this.haloRadius=t[f+i.a.haloRadius],this.halo2Radius=t[f+i.a.halo2Radius],this.rasterSet=e[f+i.a.rasterSet],this.offsetX=t[f+i.a.offsetX],this.offsetY=t[f+i.a.offsetY],this.minWidth=t[f+i.a.minWidth],this.maxWidth=t[f+i.a.maxWidth],this.minWidthScale=t[f+i.a.minWidthScale],this.maxWidthScale=t[f+i.a.maxWidthScale],this.iconWidth=t[f+i.a.iconWidth],this.possibleLabelPlacements=e[f+i.a.possibleLabelPlacements],this.labelingGroup=e[f+i.a.labelingGroup],this.iconLabelingGroup=e[f+i.a.iconLabelingGroup],this.textLabelingGroup=e[f+i.a.textLabelingGroup],this.text2LabelingGroup=e[f+i.a.text2LabelingGroup],this.duplicationSpacing=t[f+i.a.duplicationSpacing],this.lineEndingOffsets=t[f+i.a.lineEndingOffsets],this.labelMargins=t[f+i.a.labelMargins],this.iconVisibleMarginLeftRight=t[f+i.a.iconVisibleMarginLeftRight],this.iconVisibleMarginTopBottom=t[f+i.a.iconVisibleMarginTopBottom],this.iconAppearMarginLeftRight=t[f+i.a.iconAppearMarginLeftRight],this.iconAppearMarginTopBottom=t[f+i.a.iconAppearMarginTopBottom],this.textVisibleMarginLeftRight=t[f+i.a.textVisibleMarginLeftRight],this.textVisibleMarginTopBottom=t[f+i.a.textVisibleMarginTopBottom],this.textAppearMarginLeftRight=t[f+i.a.textAppearMarginLeftRight],this.textAppearMarginTopBottom=t[f+i.a.textAppearMarginTopBottom],this.text2VisibleMarginLeftRight=t[f+i.a.text2VisibleMarginLeftRight],this.text2VisibleMarginTopBottom=t[f+i.a.text2VisibleMarginTopBottom],this.text2AppearMarginLeftRight=t[f+i.a.text2AppearMarginLeftRight],this.text2AppearMarginTopBottom=t[f+i.a.text2AppearMarginTopBottom],this.componentDistanceStart=e[f+i.a.componentDistanceStart],this.componentDistanceEnd=e[f+i.a.componentDistanceEnd],this.componentDistanceStartWorld=t[f+i.a.componentDistanceStartWorld],this.objectLengthWorld=t[f+i.a.objectLengthWorld],this.minStyleZoom=t[f+i.a.minStyleZoom],this.maxStyleZoom=t[f+i.a.maxStyleZoom],this.detailLevel=e[f+i.a.detailLevel],this.minDisplayStyleZoom=t[f+i.a.minDisplayStyleZoom],this.maxDisplayStyleZoom=t[f+i.a.maxDisplayStyleZoom];var h=e[f+i.a.labelStartIndex],p=e[f+i.a.labelFinishIndex],m=Object(r.a)(new Uint8Array(n,h,p-h)),v=e[f+i.a.maxSymbolsPerLine];this.label="poi"===this.symbol||"labelPoint"===this.symbol?Object(r.e)(m,v):m;var _=e[f+i.a.label2StartIndex],g=e[f+i.a.label2FinishIndex];if(_!==g){var y=Object(r.a)(new Uint8Array(n,_,g-_));this.label2="poi"===this.symbol?Object(r.e)(y,v):y}this.ranges=Object(r.c)(this.label,this.label2);var b=e[f+i.a.anchorStartIndex],x=e[f+i.a.anchorFinishIndex];this.anchorWorld=s.subarray(b,x),this.idLo=e[f+i.a.idLo],this.idHi=e[f+i.a.idHi],this.id=Object(a.a)(this.idLo,this.idHi),this.labelingElements=[],this.source=u,this.ready=!1,this.poiLabelOffset=t[f+i.a.poiLabelOffset],this.label2Offset=t[f+i.a.label2Offset],this.borderColor=t[f+i.a.borderColor],this.borderWidth=t[f+i.a.borderWidth],this.width=t[f+i.a.width],this.wingWidthMultiplier=t[f+i.a.wingWidthMultiplier],this.tipHeightMultiplier=t[f+i.a.tipHeightMultiplier],this.wingHeightMultiplier=t[f+i.a.wingHeightMultiplier],this.length=t[f+i.a.length]}},function(t,e,n){function r(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw console.error(t),t};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+i+").*?\\)";function a(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(t,e,r){var s={};s[r]=[];var c=e.toString(),l=c.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return s;for(var u,d=l[1],f=new RegExp("(\\\\n|\\W)"+a(d)+o,"g");u=f.exec(c);)"dll-reference"!==u[3]&&s[r].push(u[3]);for(f=new RegExp("\\("+a(d)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+o,"g");u=f.exec(c);)t[u[2]]||(s[r].push(u[1]),t[u[2]]=n(u[1]).m),s[u[2]]=s[u[2]]||[],s[u[2]].push(u[4]);for(var h,p=Object.keys(s),m=0;m<p.length;m++)for(var v=0;v<s[p[m]].length;v++)h=s[p[m]][v],isNaN(1*h)||(s[p[m]][v]=1*s[p[m]][v]);return s}function c(t){return Object.keys(t).reduce((function(e,n){return e||t[n].length>0}),!1)}t.exports=function(t,e){e=e||{};var i={main:n.m},o=e.all?{main:Object.keys(i.main)}:function(t,e){for(var n={main:[e]},r={main:[]},i={main:{}};c(n);)for(var o=Object.keys(n),a=0;a<o.length;a++){var l=o[a],u=n[l].pop();if(i[l]=i[l]||{},!i[l][u]&&t[l][u]){i[l][u]=!0,r[l]=r[l]||[],r[l].push(u);for(var d=s(t,t[l][u],l),f=Object.keys(d),h=0;h<f.length;h++)n[f[h]]=n[f[h]]||[],n[f[h]]=n[f[h]].concat(d[f[h]])}}return r}(i,t),a="";Object.keys(o).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;o[t][e];)e++;o[t].push(e),i[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+"var "+t+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o[t].map((function(e){return JSON.stringify(e)+": "+i[t][e].toString()})).join(",")+"});\n"})),a=a+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o.main.map((function(t){return JSON.stringify(t)+": "+i.main[t].toString()})).join(",")+"}))(self);";var l=new window.Blob([a],{type:"text/javascript"});if(e.bare)return l;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),d=new window.Worker(u);return d.objectURL=u,d}},function(t,e,n){"use strict";var r=e.TileRequestUrl={};r.read=function(t,e){return t.readFields(r._readField,{tiles:[]},e)},r._readField=function(t,e,n){1===t&&e.tiles.push(r.Tile.read(n,n.readVarint()+n.pos))},r.write=function(t,e){if(t.tiles)for(var n=0;n<t.tiles.length;n++)e.writeMessage(1,r.Tile.write,t.tiles[n])},r.Tile={},r.Tile.read=function(t,e){return t.readFields(r.Tile._readField,{x:0,y:0,zoom:0},e)},r.Tile._readField=function(t,e,n){1===t?e.x=n.readVarint():2===t?e.y=n.readVarint():3===t&&(e.zoom=n.readVarint())},r.Tile.write=function(t,e){t.x&&e.writeVarintField(1,t.x),t.y&&e.writeVarintField(2,t.y),t.zoom&&e.writeVarintField(3,t.zoom)};var i=e.TileResponseData={};i.read=function(t,e){return t.readFields(i._readField,{tileGroups:[]},e)},i._readField=function(t,e,n){1===t&&e.tileGroups.push(i.TileGroup.read(n,n.readVarint()+n.pos))},i.write=function(t,e){if(t.tileGroups)for(var n=0;n<t.tileGroups.length;n++)e.writeMessage(1,i.TileGroup.write,t.tileGroups[n])},i.TileGroup={},i.TileGroup.read=function(t,e){return t.readFields(i.TileGroup._readField,{x:0,y:0,zoom:0,tiles:[]},e)},i.TileGroup._readField=function(t,e,n){1===t?e.x=n.readVarint():2===t?e.y=n.readVarint():3===t?e.zoom=n.readVarint():4===t&&e.tiles.push(i.TileGroup.Tile.read(n,n.readVarint()+n.pos))},i.TileGroup.write=function(t,e){if(t.x&&e.writeVarintField(1,t.x),t.y&&e.writeVarintField(2,t.y),t.zoom&&e.writeVarintField(3,t.zoom),t.tiles)for(var n=0;n<t.tiles.length;n++)e.writeMessage(4,i.TileGroup.Tile.write,t.tiles[n])},i.TileGroup.Tile={},i.TileGroup.Tile.read=function(t,e){return t.readFields(i.TileGroup.Tile._readField,{regionId:0,hash:null,data:null},e)},i.TileGroup.Tile._readField=function(t,e,n){1===t?e.regionId=n.readVarint():2===t?e.hash=n.readBytes():3===t&&(e.data=n.readBytes())},i.TileGroup.Tile.write=function(t,e){t.regionId&&e.writeVarintField(1,t.regionId),t.hash&&e.writeBytesField(2,t.hash),t.data&&e.writeBytesField(3,t.data)}},function(t,e){},function(t,e){var n=.1,r="function"==typeof Float32Array;function i(t,e){return 1-3*e+3*t}function o(t,e){return 3*e-6*t}function a(t){return 3*t}function s(t,e,n){return((i(e,n)*t+o(e,n))*t+a(e))*t}function c(t,e,n){return 3*i(e,n)*t*t+2*o(e,n)*t+a(e)}function l(t){return t}t.exports=function(t,e,i,o){if(!(0<=t&&t<=1&&0<=i&&i<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&i===o)return l;for(var a=r?new Float32Array(11):new Array(11),u=0;u<11;++u)a[u]=s(u*n,t,i);function d(e){for(var r=0,o=1;10!==o&&a[o]<=e;++o)r+=n;--o;var l=r+(e-a[o])/(a[o+1]-a[o])*n,u=c(l,t,i);return u>=.001?function(t,e,n,r){for(var i=0;i<4;++i){var o=c(e,n,r);if(0===o)return e;e-=(s(e,n,r)-t)/o}return e}(e,l,t,i):0===u?l:function(t,e,n,r,i){var o,a,c=0;do{(o=s(a=e+(n-e)/2,r,i)-t)>0?n=a:e=a}while(Math.abs(o)>1e-7&&++c<10);return a}(e,r,r+n,t,i)}return function(t){return 0===t?0:1===t?1:s(d(t),e,o)}}},function(t,e,n){"use strict";var r=e.Complex={};r.read=function(t,e){return t.readFields(r._readField,{id:"",name:"",address:"",type:0,regionId:0,branchId:"",branchCount:0,buildings:[],hull:[],tileCoords:[],center:[],centroid:[],scaleFactor:0,viewAngle:0,bound:null,floorCount:0,defaultFloor:0,floorNames:[],entities:[],floorGeometries:[],outdoors:[],metaRubrics:[],version:0,hybrids:[]},e)},r._readField=function(t,e,n){1===t?e.id=n.readString():2===t?e.name=n.readString():3===t?e.address=n.readString():4===t?e.type=n.readVarint():5===t?e.regionId=n.readVarint():6===t?e.branchId=n.readString():7===t?e.branchCount=n.readVarint():8===t?e.buildings.push(n.readString()):9===t?n.readPackedSVarint(e.hull):10===t?n.readPackedDouble(e.tileCoords):11===t?n.readPackedSVarint(e.center):12===t?n.readPackedDouble(e.centroid):13===t?e.scaleFactor=n.readDouble():14===t?e.viewAngle=n.readDouble():15===t?e.bound=r.Bound.read(n,n.readVarint()+n.pos):16===t?e.floorCount=n.readVarint():17===t?e.defaultFloor=n.readVarint():18===t?e.floorNames.push(n.readString()):19===t?e.entities.push(r.Entity.read(n,n.readVarint()+n.pos)):20===t?e.floorGeometries.push(r.Floor.read(n,n.readVarint()+n.pos)):21===t?e.outdoors.push(r.OutdoorObject.read(n,n.readVarint()+n.pos)):22===t?e.metaRubrics.push(r.Metarubric.read(n,n.readVarint()+n.pos)):23===t?e.version=n.readVarint():24===t&&e.hybrids.push(n.readString())},r.write=function(t,e){if(t.id&&e.writeStringField(1,t.id),t.name&&e.writeStringField(2,t.name),t.address&&e.writeStringField(3,t.address),t.type&&e.writeVarintField(4,t.type),t.regionId&&e.writeVarintField(5,t.regionId),t.branchId&&e.writeStringField(6,t.branchId),t.branchCount&&e.writeVarintField(7,t.branchCount),t.buildings)for(var n=0;n<t.buildings.length;n++)e.writeStringField(8,t.buildings[n]);if(t.hull&&e.writePackedSVarint(9,t.hull),t.tileCoords&&e.writePackedDouble(10,t.tileCoords),t.center&&e.writePackedSVarint(11,t.center),t.centroid&&e.writePackedDouble(12,t.centroid),t.scaleFactor&&e.writeDoubleField(13,t.scaleFactor),t.viewAngle&&e.writeDoubleField(14,t.viewAngle),t.bound&&e.writeMessage(15,r.Bound.write,t.bound),t.floorCount&&e.writeVarintField(16,t.floorCount),t.defaultFloor&&e.writeVarintField(17,t.defaultFloor),t.floorNames)for(n=0;n<t.floorNames.length;n++)e.writeStringField(18,t.floorNames[n]);if(t.entities)for(n=0;n<t.entities.length;n++)e.writeMessage(19,r.Entity.write,t.entities[n]);if(t.floorGeometries)for(n=0;n<t.floorGeometries.length;n++)e.writeMessage(20,r.Floor.write,t.floorGeometries[n]);if(t.outdoors)for(n=0;n<t.outdoors.length;n++)e.writeMessage(21,r.OutdoorObject.write,t.outdoors[n]);if(t.metaRubrics)for(n=0;n<t.metaRubrics.length;n++)e.writeMessage(22,r.Metarubric.write,t.metaRubrics[n]);if(t.version&&e.writeVarintField(23,t.version),t.hybrids)for(n=0;n<t.hybrids.length;n++)e.writeStringField(24,t.hybrids[n])},r.ComplexType={mall:{value:0,options:{}},other:{value:1,options:{}},office:{value:2,options:{}}},r.Metarubric={},r.Metarubric.read=function(t,e){return t.readFields(r.Metarubric._readField,{id:"",orgCount:0},e)},r.Metarubric._readField=function(t,e,n){1===t?e.id=n.readString():2===t&&(e.orgCount=n.readVarint())},r.Metarubric.write=function(t,e){t.id&&e.writeStringField(1,t.id),t.orgCount&&e.writeVarintField(2,t.orgCount)},r.Bound={},r.Bound.read=function(t,e){return t.readFields(r.Bound._readField,{min:[],max:[]},e)},r.Bound._readField=function(t,e,n){1===t?n.readPackedSVarint(e.min):2===t&&n.readPackedSVarint(e.max)},r.Bound.write=function(t,e){t.min&&e.writePackedSVarint(1,t.min),t.max&&e.writePackedSVarint(2,t.max)},r.Entity={},r.Entity.read=function(t,e){return t.readFields(r.Entity._readField,{id:"",sublayer:"",coordinates:[],iconId:0,areaId:0,firmId:"",floorIndex:0,floorName:"",text:"",layer:"",priority:0,textPriority:0,type:0,text2:"",humanReadableIconId:""},e)},r.Entity._readField=function(t,e,n){1===t?e.id=n.readString():2===t?e.sublayer=n.readString():3===t?n.readPackedVarint(e.coordinates):4===t?e.iconId=n.readVarint():5===t?e.areaId=n.readVarint():6===t?e.firmId=n.readString():7===t?e.floorIndex=n.readVarint():8===t?e.floorName=n.readString():9===t?e.text=n.readString():10===t?e.layer=n.readString():11===t?e.priority=n.readVarint(!0):12===t?e.textPriority=n.readVarint(!0):13===t?e.type=n.readVarint():14===t?e.text2=n.readString():15===t&&(e.humanReadableIconId=n.readString())},r.Entity.write=function(t,e){t.id&&e.writeStringField(1,t.id),t.sublayer&&e.writeStringField(2,t.sublayer),t.coordinates&&e.writePackedVarint(3,t.coordinates),t.iconId&&e.writeVarintField(4,t.iconId),t.areaId&&e.writeVarintField(5,t.areaId),t.firmId&&e.writeStringField(6,t.firmId),t.floorIndex&&e.writeVarintField(7,t.floorIndex),t.floorName&&e.writeStringField(8,t.floorName),t.text&&e.writeStringField(9,t.text),t.layer&&e.writeStringField(10,t.layer),t.priority&&e.writeVarintField(11,t.priority),t.textPriority&&e.writeVarintField(12,t.textPriority),t.type&&e.writeVarintField(13,t.type),t.text2&&e.writeStringField(14,t.text2),t.humanReadableIconId&&e.writeStringField(15,t.humanReadableIconId)},r.Floor={},r.Floor.read=function(t,e){return t.readFields(r.Floor._readField,{name:"",rooms:[]},e)},r.Floor._readField=function(t,e,n){1===t?e.name=n.readString():2===t&&e.rooms.push(r.Room.read(n,n.readVarint()+n.pos))},r.Floor.write=function(t,e){if(t.name&&e.writeStringField(1,t.name),t.rooms)for(var n=0;n<t.rooms.length;n++)e.writeMessage(2,r.Room.write,t.rooms[n])},r.Room={},r.Room.read=function(t,e){return t.readFields(r.Room._readField,{id:0,type:0,sublayer:"",isIsland:!1,firmIds:[],area:[],wallSide:[],wallTop:[],areaSublayer:"",wallSublayer:""},e)},r.Room._readField=function(t,e,n){1===t?e.id=n.readVarint():2===t?e.type=n.readVarint():3===t?e.sublayer=n.readString():4===t?e.isIsland=n.readBoolean():5===t?e.firmIds.push(n.readString()):6===t?e.area.push(n.readBytes()):7===t?e.wallSide.push(n.readBytes()):8===t?e.wallTop.push(n.readBytes()):9===t?e.areaSublayer=n.readString():10===t&&(e.wallSublayer=n.readString())},r.Room.write=function(t,e){if(t.id&&e.writeVarintField(1,t.id),t.type&&e.writeVarintField(2,t.type),t.sublayer&&e.writeStringField(3,t.sublayer),t.isIsland&&e.writeBooleanField(4,t.isIsland),t.firmIds)for(var n=0;n<t.firmIds.length;n++)e.writeStringField(5,t.firmIds[n]);if(t.area)for(n=0;n<t.area.length;n++)e.writeBytesField(6,t.area[n]);if(t.wallSide)for(n=0;n<t.wallSide.length;n++)e.writeBytesField(7,t.wallSide[n]);if(t.wallTop)for(n=0;n<t.wallTop.length;n++)e.writeBytesField(8,t.wallTop[n]);t.areaSublayer&&e.writeStringField(9,t.areaSublayer),t.wallSublayer&&e.writeStringField(10,t.wallSublayer)},r.OutdoorObject={},r.OutdoorObject.read=function(t,e){return t.readFields(r.OutdoorObject._readField,{type:"",vertices:[],width:0},e)},r.OutdoorObject._readField=function(t,e,n){1===t?e.type=n.readString():2===t?e.vertices.push(n.readBytes()):3===t&&(e.width=n.readDouble())},r.OutdoorObject.write=function(t,e){if(t.type&&e.writeStringField(1,t.type),t.vertices)for(var n=0;n<t.vertices.length;n++)e.writeBytesField(2,t.vertices[n]);t.width&&e.writeDoubleField(3,t.width)}},function(t,e,n){"use strict";t.exports=i,t.exports.default=i;var r=n(92);function i(t,e){if(!(this instanceof i))return new i(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function o(t,e,n){if(!n)return e.indexOf(t);for(var r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function a(t,e){s(t,0,t.children.length,e,t)}function s(t,e,n,r,i){i||(i=m(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,a=e;a<n;a++)o=t.children[a],c(i,t.leaf?r(o):o);return i}function c(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function l(t,e){return t.minX-e.minX}function u(t,e){return t.minY-e.minY}function d(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function p(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function m(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(t,e,n,i,o){for(var a,s=[e,n];s.length;)(n=s.pop())-(e=s.pop())<=i||(a=e+Math.ceil((n-e)/i/2)*i,r(t,a,e,n,o),s.push(e,a,a,n))}i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],r=this.toBBox;if(!p(t,e))return n;for(var i,o,a,s,c=[];e;){for(i=0,o=e.children.length;i<o;i++)a=e.children[i],p(t,s=e.leaf?r(a):a)&&(e.leaf?n.push(a):h(t,s)?this._all(a,n):c.push(a));e=c.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!p(t,e))return!1;for(var r,i,o,a,s=[];e;){for(r=0,i=e.children.length;r<i;r++)if(o=e.children[r],p(t,a=e.leaf?n(o):o)){if(e.leaf||h(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(t,e){if(!t)return this;for(var n,r,i,a,s=this.data,c=this.toBBox(t),l=[],u=[];s||l.length;){if(s||(s=l.pop(),r=l[l.length-1],n=u.pop(),a=!0),s.leaf&&-1!==(i=o(t,s.children,e)))return s.children.splice(i,1),l.push(s),this._condense(l),this;a||s.leaf||!h(s,c)?r?(n++,s=r.children[n],a=!1):s=null:(l.push(s),u.push(n),n=0,r=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:l,compareMinY:u,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,r){var i,o=n-e+1,s=this._maxEntries;if(o<=s)return a(i=m(t.slice(e,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=m([])).leaf=!1,i.height=r;var c,l,u,d,f=Math.ceil(o/s),h=f*Math.ceil(Math.sqrt(s));for(v(t,e,n,h,this.compareMinX),c=e;c<=n;c+=h)for(v(t,c,u=Math.min(c+h-1,n),f,this.compareMinY),l=c;l<=u;l+=f)d=Math.min(l+f-1,u),i.children.push(this._build(t,l,d,r-1));return a(i,this.toBBox),i},_chooseSubtree:function(t,e,n,r){for(var i,o,a,s,c,l,u,f,h,p;r.push(e),!e.leaf&&r.length-1!==n;){for(u=f=1/0,i=0,o=e.children.length;i<o;i++)c=d(a=e.children[i]),h=t,p=a,(l=(Math.max(p.maxX,h.maxX)-Math.min(p.minX,h.minX))*(Math.max(p.maxY,h.maxY)-Math.min(p.minY,h.minY))-c)<f?(f=l,u=c<u?c:u,s=a):l===f&&c<u&&(u=c,s=a);e=s||e.children[0]}return e},_insert:function(t,e,n){var r=this.toBBox,i=n?t:r(t),o=[],a=this._chooseSubtree(i,this.data,e,o);for(a.children.push(t),c(a,i);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(i,o,e)},_split:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=m(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,a(n,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=m([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var r,i,o,a,c,l,u,f,h,p,m,v,_,g;for(l=u=1/0,r=e;r<=n-e;r++)h=i=s(t,0,r,this.toBBox),p=o=s(t,r,n,this.toBBox),m=Math.max(h.minX,p.minX),v=Math.max(h.minY,p.minY),_=Math.min(h.maxX,p.maxX),g=Math.min(h.maxY,p.maxY),a=Math.max(0,_-m)*Math.max(0,g-v),c=d(i)+d(o),a<l?(l=a,f=r,u=c<u?c:u):a===l&&c<u&&(u=c,f=r);return f},_chooseSplitAxis:function(t,e,n){var r=t.leaf?this.compareMinX:l,i=t.leaf?this.compareMinY:u;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)},_allDistMargin:function(t,e,n,r){t.children.sort(r);var i,o,a=this.toBBox,l=s(t,0,e,a),u=s(t,n-e,n,a),d=f(l)+f(u);for(i=e;i<n-e;i++)o=t.children[i],c(l,t.leaf?a(o):o),d+=f(l);for(i=n-e-1;i>=e;i--)o=t.children[i],c(u,t.leaf?a(o):o),d+=f(u);return d},_adjustParentBBoxes:function(t,e,n){for(var r=n;r>=0;r--)c(e[r],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():a(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},function(t,e,n){t.exports=function(){"use strict";function t(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var c=((t-n)*a+(e-r)*s)/(a*a+s*s);c>1?(n=i,r=o):c>0&&(n+=a*c,r+=s*c)}return(a=t-n)*a+(s=e-r)*s}function e(t,e,r,i){var o={id:null==t?null:t,type:e,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)n(o,r);else if("Polygon"===e)n(o,r[0]);else if("MultiLineString"===e)for(var a=0,s=r;a<s.length;a+=1)n(o,s[a]);else if("MultiPolygon"===e)for(var c=0,l=r;c<l.length;c+=1)n(o,l[c][0]);return o}function n(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function r(t,n,s,c){if(n.geometry){var l=n.geometry.coordinates,u=n.geometry.type,d=Math.pow(s.tolerance/((1<<s.maxZoom)*s.extent),2),f=[],h=n.id;if(s.promoteId?h=n.properties[s.promoteId]:s.generateId&&(h=c||0),"Point"===u)i(l,f);else if("MultiPoint"===u)for(var p=0,m=l;p<m.length;p+=1)i(m[p],f);else if("LineString"===u)o(l,f,d,!1);else if("MultiLineString"===u){if(s.lineMetrics){for(var v=0,_=l;v<_.length;v+=1)o(_[v],f=[],d,!1),t.push(e(h,"LineString",f,n.properties));return}a(l,f,d,!1)}else if("Polygon"===u)a(l,f,d,!0);else{if("MultiPolygon"!==u){if("GeometryCollection"===u){for(var g=0,y=n.geometry.geometries;g<y.length;g+=1)r(t,{id:h,geometry:y[g],properties:n.properties},s,c);return}throw new Error("Input data is not a valid GeoJSON object.")}for(var b=0,x=l;b<x.length;b+=1){var w=[];a(x[b],w,d,!0),t.push(e(h,"Polygon",w,n.properties))}}f.length>0&&t.push(e(h,u,f,n.properties))}}function i(t,e){e.push(s(t[0]),c(t[1]),0)}function o(e,n,r,i){for(var o,a,l=0,u=0;u<e.length;u++){var d=s(e[u][0]),f=c(e[u][1]);n.push(d,f,0),u>0&&(l+=i?(o*f-d*a)/2:Math.sqrt(Math.pow(d-o,2)+Math.pow(f-a,2))),o=d,a=f}var h=n.length-3;n[2]=1,function e(n,r,i,o){for(var a,s=o,c=i-r>>1,l=i-r,u=n[r],d=n[r+1],f=n[i],h=n[i+1],p=r+3;p<i;p+=3){var m=t(n[p],n[p+1],u,d,f,h);if(m>s)a=p,s=m;else if(m===s){var v=Math.abs(p-c);v<l&&(a=p,l=v)}}s>o&&(a-r>3&&e(n,r,a,o),n[a+2]=s,i-a>3&&e(n,a,i,o))}(n,0,h,r),n[h+2]=1,n.size=Math.abs(l),n.start=0,n.end=n.size}function a(t,e,n,r){for(var i=0;i<t.length;i++){var a=[];o(t[i],a,n,r),e.push(a)}}function s(t){return 1*t/360+.5}function c(t){var e=Math.sin(t*Math.PI/180);return 1*Math.log((1+e)/(1-e))/(4*Math.PI)+.5}function l(t,n,r,i,o,a,s,c){if(i/=n,a>=(r/=n)&&s<i)return t;if(s<r||a>=i)return null;for(var l=[],f=0,p=t;f<p.length;f+=1){var m=p[f],v=m.geometry,_=m.type,g=0===o?m.minX:m.minY,y=0===o?m.maxX:m.maxY;if(g>=r&&y<i)l.push(m);else if(!(y<r||g>=i)){var b=[];if("Point"===_||"MultiPoint"===_)u(v,b,r,i,o);else if("LineString"===_)d(v,b,r,i,o,!1,c.lineMetrics);else if("MultiLineString"===_)h(v,b,r,i,o,!1);else if("Polygon"===_)h(v,b,r,i,o,!0);else if("MultiPolygon"===_)for(var x=0,w=v;x<w.length;x+=1){var S=[];h(w[x],S,r,i,o,!0),S.length&&b.push(S)}if(b.length){if(c.lineMetrics&&"LineString"===_){for(var O=0,M=b;O<M.length;O+=1){var j=M[O];l.push(e(m.id,_,j,m.tags))}continue}"LineString"!==_&&"MultiLineString"!==_||(1===b.length?(_="LineString",b=b[0]):_="MultiLineString"),"Point"!==_&&"MultiPoint"!==_||(_=3===b.length?"Point":"MultiPoint"),l.push(e(m.id,_,b,m.tags))}}}return l.length?l:null}function u(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&p(e,t[o],t[o+1],t[o+2])}}function d(t,e,n,r,i,o,a){for(var s,c,l=f(t),u=0===i?m:v,d=t.start,h=0;h<t.length-3;h+=3){var _=t[h],g=t[h+1],y=t[h+2],b=t[h+3],x=t[h+4],w=0===i?_:g,S=0===i?b:x,O=!1;a&&(s=Math.sqrt(Math.pow(_-b,2)+Math.pow(g-x,2))),w<n?S>n&&(c=u(l,_,g,b,x,n),a&&(l.start=d+s*c)):w>r?S<r&&(c=u(l,_,g,b,x,r),a&&(l.start=d+s*c)):p(l,_,g,y),S<n&&w>=n&&(c=u(l,_,g,b,x,n),O=!0),S>r&&w<=r&&(c=u(l,_,g,b,x,r),O=!0),!o&&O&&(a&&(l.end=d+s*c),e.push(l),l=f(t)),a&&(d+=s)}var M=t.length-3,j=t[M],I=t[M+1],T=t[M+2],E=0===i?j:I;E>=n&&E<=r&&p(l,j,I,T),M=l.length-3,o&&M>=3&&(l[M]!==l[0]||l[M+1]!==l[1])&&p(l,l[0],l[1],l[2]),l.length&&e.push(l)}function f(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function h(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1)d(s[a],e,n,r,i,o,!1)}function p(t,e,n,r){t.push(e,n,r)}function m(t,e,n,r,i,o){var a=(o-e)/(r-e);return p(t,o,n+(i-n)*a,1),a}function v(t,e,n,r,i,o){var a=(o-n)/(i-n);return p(t,e+(r-e)*a,o,1),a}function _(t,n){for(var r=[],i=0;i<t.length;i++){var o=t[i],a=o.type,s=void 0;if("Point"===a||"MultiPoint"===a||"LineString"===a)s=g(o.geometry,n);else if("MultiLineString"===a||"Polygon"===a){s=[];for(var c=0,l=o.geometry;c<l.length;c+=1){var u=l[c];s.push(g(u,n))}}else if("MultiPolygon"===a){s=[];for(var d=0,f=o.geometry;d<f.length;d+=1){for(var h=[],p=0,m=f[d];p<m.length;p+=1){var v=m[p];h.push(g(v,n))}s.push(h)}}r.push(e(o.id,a,s,o.tags))}return r}function g(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function y(t,e){if(t.transformed)return t;for(var n=1<<t.z,r=t.x,i=t.y,o=0,a=t.features;o<a.length;o+=1){var s=a[o],c=s.geometry,l=s.type;if(s.geometry=[],1===l)for(var u=0;u<c.length;u+=2)s.geometry.push(b(c[u],c[u+1],e,n,r,i));else for(var d=0;d<c.length;d++){for(var f=[],h=0;h<c[d].length;h+=2)f.push(b(c[d][h],c[d][h+1],e,n,r,i));s.geometry.push(f)}}return t.transformed=!0,t}function b(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function x(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0,c=t;s<c.length;s+=1)w(a,c[s],o,i);return a}function w(t,e,n,r){var i=e.geometry,o=e.type,a=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s],i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)S(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(var c=0;c<i.length;c++)S(a,i[c],t,n,"Polygon"===o,0===c);else if("MultiPolygon"===o)for(var l=0;l<i.length;l++)for(var u=i[l],d=0;d<u.length;d++)S(a,u[d],t,n,!0,0===d);if(a.length){var f=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in f={},e.tags)f[h]=e.tags[h];f.mapbox_clip_start=i.start/i.size,f.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:f};null!==e.id&&(p.id=e.id),t.features.push(p)}}function S(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],c=0;c<e.length;c+=3)(0===r||e[c+2]>a)&&(n.numSimplified++,s.push(e[c],e[c+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(var a=0,s=t.length;a<s/2;a+=2){var c=t[a],l=t[a+1];t[a]=t[s-2-a],t[a+1]=t[s-1-a],t[s-2-a]=c,t[s-1-a]=l}}(s,o),t.push(s)}}var O={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},M=function(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(O),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)r(n,t.features[i],e,i);else"Feature"===t.type?r(n,t,e):r(n,{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=function(t,e){var n=e.buffer/e.extent,r=t,i=l(t,1,-1-n,n,0,-1,2,e),o=l(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=l(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=_(i,1).concat(r)),o&&(r=r.concat(_(o,-1)))),r}(i,e)).length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))};function j(t,e,n){return 32*((1<<t)*n+e)+t}return M.prototype.splitTile=function(t,e,n,r,i,o,a){for(var s=[t,e,n,r],c=this.options,u=c.debug;s.length;){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var d=1<<e,f=j(e,n,r),h=this.tiles[f];if(!h&&(u>1&&console.time("creation"),h=this.tiles[f]=x(t,e,n,r,c),this.tileCoords.push({z:e,x:n,y:r}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(h.source=t,null==i){if(e===c.indexMaxZoom||h.numPoints<=c.indexMaxPoints)continue}else{if(e===c.maxZoom||e===i)continue;if(null!=i){var m=i-e;if(n!==o>>m||r!==a>>m)continue}}if(h.source=null,0!==t.length){u>1&&console.time("clipping");var v=.5*c.buffer/c.extent,_=.5-v,g=.5+v,y=1+v,b=null,w=null,S=null,O=null,M=l(t,d,n-v,n+g,0,h.minX,h.maxX,c),I=l(t,d,n+_,n+y,0,h.minX,h.maxX,c);t=null,M&&(b=l(M,d,r-v,r+g,1,h.minY,h.maxY,c),w=l(M,d,r+_,r+y,1,h.minY,h.maxY,c),M=null),I&&(S=l(I,d,r-v,r+g,1,h.minY,h.maxY,c),O=l(I,d,r+_,r+y,1,h.minY,h.maxY,c),I=null),u>1&&console.timeEnd("clipping"),s.push(b||[],e+1,2*n,2*r),s.push(w||[],e+1,2*n,2*r+1),s.push(S||[],e+1,2*n+1,2*r),s.push(O||[],e+1,2*n+1,2*r+1)}}},M.prototype.getTile=function(t,e,n){t=+t,e=+e,n=+n;var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var a=1<<t,s=j(t,e=e+a&a-1,n);if(this.tiles[s])return y(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var c,l=t,u=e,d=n;!c&&l>0;)l--,u>>=1,d>>=1,c=this.tiles[j(l,u,d)];return c&&c.source?(o>1&&(console.log("found parent tile z%d-%d-%d",l,u,d),console.time("drilling down")),this.splitTile(c.source,l,u,d,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?y(this.tiles[s],i):null):null},function(t,e){return new M(t,e)}}()},function(t,e,n){window,t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=10)}([function(t,e,n){"use strict";n.d(e,"b",(function(){return c})),n.d(e,"a",(function(){return l}));var r=n(6),i=n(1),o=n(5),a=n(3);function s(t,e,n,r,c){if(void 0===r&&(r=0),"string"!=typeof e&&"number"!=typeof e){if(Object(i.h)(e))return function(t,e,n,r){if("interpolate"!==e[0]||e[1]&&"linear"!==e[1][0]&&"exponential"!==e[1][0]||e[2]&&"zoom"!==e[2][0])throw new Error("Цвет должен задаваться либо строкой, либо с помощью InterpolateExpression вида ['interpolate', ['linear'], ['zoom'], 12, '#ffffff', 15, '#000000'], а пришло "+JSON.stringify(e));var i=1;"exponential"===e[1][0]&&"number"==typeof e[1][1]&&(i=e[1][1]);var o="{\n";o+="parameter: z_level;\n",o+="keys: [\n";for(var a=e.slice(3),s=[],c=0;c<a.length;c+=2){var l=a[c],u=a[c+1];if("string"!=typeof u&&"number"!=typeof u)throw new Error("Внутри InterpolateExpression выражения не поддерживаются");s.push("{ key: "+l+"; value: "+n(u)+"; base: "+i+"; }")}o+=s.join(",\n")+"\n];\n}",r.storeAttribute({param:t,value:o})}(t,e,n,c);if(Object(i.i)(e))return function(t,e,n,r,i){var c=e[0],l=e[1],u=l[0],d=l[1],f=e.slice(2),h=f.slice(0,-1),p=f.slice(-1)[0];if(r>1)throw new Error("Вложенные match-выражения не поддерживаются");if(p&&s(t,p,n,r,i),"match"!==c||-1===["get","global"].indexOf(u))throw new Error('Ожидалось MatchExpression виде  [ "match", [ "get" | "global", param ], ... ], а пришло '+JSON.stringify(e));"global"===u&&Object(o.b)(d);for(var m=0;m<h.length;m+=2){var v=h[m],_=h[m+1];if(""!==_){var g=new a.a;s(t,_,n,r,g),i.storeOverride({selectors:v.map((function(t){return{prop:d,op:"=",value:t}})),attributes:g.getAttributes()})}}}(t,e,n,r+1,c);throw new Error("Неизвестный тип "+e+" выражения "+JSON.stringify(e))}c.storeAttribute({param:t,value:n(e)})}function c(t,e,n,r){return void 0===n&&(n=1),s(t,e,(function(t){return String(Object(i.n)(t)*n)}),0,r)}function l(t,e,n){return s(t,e,r.a,0,n)}},function(t,e,n){"use strict";n.d(e,"k",(function(){return o})),n.d(e,"n",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"h",(function(){return c})),n.d(e,"j",(function(){return l})),n.d(e,"i",(function(){return u})),n.d(e,"l",(function(){return d})),n.d(e,"c",(function(){return f})),n.d(e,"d",(function(){return h})),n.d(e,"f",(function(){return p})),n.d(e,"e",(function(){return m})),n.d(e,"a",(function(){return v})),n.d(e,"g",(function(){return _})),n.d(e,"m",(function(){return g}));var r=n(0),i=n(7);function o(t){return t.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1_$2").toLowerCase()}function a(t){return Math.round(1e3*t)/1e3}function s(t){var e="{\n";return e+="visible: { top_bottom: "+t.topBottom+"; left_right: "+t.leftRight+"; };\n",(e+="appear: { top_bottom: "+t.topBottom+"; left_right: "+t.leftRight+"; };\n")+"}"}function c(t){return t&&"interpolate"===t[0]&&t[1]&&("linear"===t[1][0]||"exponential"===t[1][0])&&t[2]&&"zoom"===t[2][0]}function l(t){return"step"===t[0]&&t[1]&&"zoom"===t[1][0]}function u(t){return t&&"match"===t[0]}var d={font:["font","font2","font3"],font_size_zpt:["font_size_zpt","font2_size_zpt","font3_size_zpt"],font_color:["font_color","font2_color","font3_color"],color:["color"],halo_radius_zpt:["halo_radius_zpt","halo2_radius_zpt","halo3_radius_zpt"],halo_color:["halo_color","halo2_color","halo3_color"],letter_spacing:["letter_spacing","label2_letter_spacing","label3_letter_spacing"],line_height:["line_height","label2_line_height","label3_line_height"],poi_label_offset:["poi_label_offset","label2_offset","label3_offset"],text_margin_zpt:["text_margin_zpt","text2_margin_zpt","text3_margin_zpt"]};function f(t,e,n){if(u(e)||c(e)||"string"==typeof e)return Object(r.a)(t,e,n);e.forEach((function(e,i){d[t][i]&&Object(r.a)(d[t][i],e,n)}))}function h(t,e,n){if(c(e)||u(e)||"number"==typeof e)return Object(r.b)(t,e,1,n);e.forEach((function(e,i){Object(r.b)(d[t][i],e,1,n)}))}function p(t,e){return Array.isArray(e)?e.reduce((function(e,n,r){return e+(d[t][r]+": ")+a(n)+";\n"}),""):t+": "+a(e)+";\n"}function m(t){return Array.isArray(t)?t.reduce((function(t,e,n){return t+(d.text_margin_zpt[n]+": ")+s(e)+";\n"}),""):"text_margin_zpt: "+s(t)+";\n"}function v(t,e){return e?((Array.isArray(e)&&!l(e)?e:[e]).forEach((function(e){Object(i.b)(e).forEach((function(e){""===e||t.includes(e)||t.push(e)}))})),t):t}function _(t){return Math.abs(t.split("").reduce((function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t}),0))}function g(t){if(!t)return"";var e=t.replace(/[^a-z0-9_]+/gi,"_");return(e=e.replace(/^\d/gi,"_"))!==t&&(e=e+"_"+_(t)),e}},function(t,e,n){"use strict";function r(t){var e={color:"#000000",strokeColor:"#000000",strokeWidth:1,visibility:"visible"};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return void 0===t.strokeColor&&(e.strokeColor=e.color),e}function i(t){var e={topColor:"#000000",strokeColor:"#000000",strokeWidth:1,sideColor:"#000000",visibility:"visible"};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return void 0===t.strokeColor&&(e.strokeColor=e.topColor),void 0===t.sideColor&&(e.sideColor=e.topColor),e}function o(t){var e={diameter:10};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}function a(t){var e={color:"#000000",strokeColor:"#000000",strokeWidth:1};for(var n in void 0===t.strokeColor&&(e.strokeColor=e.color),t)void 0!==t[n]&&(e[n]=t[n]);return e}function s(t){var e={width:40};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}function c(t){var e={color:"#000000",width:1,visibility:"visible"};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}function l(t){var e={color:"#000000",strokeColor:"#000000",strokeWidth:1,visibility:"visible"};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return void 0===t.strokeColor&&(e.strokeColor=e.color),e}function u(t){var e={sideColor:"#000000",strokeColor:"#000000",strokeWidth:1,height:0,visibility:"visible"};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return void 0===t.strokeColor&&(e.strokeColor=e.sideColor),e}function d(t){var e={labelingGroup:y,textFont:"Noto_Sans",textColor:"#000000",textFontSize:16,textLetterSpacing:0,textHaloColor:"rgba(0, 0, 0, 0)",textHaloWidth:0,textPriority:0,textLabelingSideMargin:0,textDuplicationSpacing:0,lineEndingOffsets:0,visibility:"visible"};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}function f(t){var e={labelingGroup:y,color:"#000000",lineWidth:2,lineLength:10,tipWidth:1.5,tipHeight:2,priority:0,duplicationSpacing:0,endingOffsets:0,visibility:"visible"};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}function h(t){var e={color:"#000000",gapColor:"#00000000",width:1,gapLength:1,dashLength:1,visibility:"visible"};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}function p(t){var e={color:"#000000",width:1,shift:0,visibility:"visible"};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}function m(t){var e={lineWidth:1,strokeWidth:0,colors:["#ff0000","#ffff00","#00ff00","#808080","#000000"],strokeColor:"#000000",gradientLength:1,gradientMaxLength:.6};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}function v(t){var e={color:"#000000",strokeColor:"#000000",lineWidth:1,strokeWidth:0,tipWidth:1,tipHeight:1,animation:{type:"appearence",tipMovementAmplitude:0}};for(var n in void 0===t.strokeColor&&(e.strokeColor=e.color),t)void 0!==t[n]&&(e[n]=t[n]);return e}function _(t){var e={allowOverlap:!1,iconLabelingGroup:y,textLabelingGroup:y,allowElevation:!1,iconOpacity:1,iconImage:"",iconAnchor:[.5,.5],iconWidth:16,iconPriority:0,iconLabelingMargin:{topBottom:0,leftRight:0},textFont:"",textColor:"#000000",textFontSize:16,textLineHeight:1.2,textLetterSpacing:0,textPlacement:"bottomCenter",textOffset:0,textHaloColor:"rgba(0, 0, 0, 0)",textHaloWidth:0,textLabelingMargin:{topBottom:0,leftRight:0},textPriority:0,textMaxLengthPerLine:30,visibility:"visible"};for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}n.d(e,"n",(function(){return r})),n.d(e,"m",(function(){return i})),n.d(e,"f",(function(){return o})),n.d(e,"d",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"j",(function(){return c})),n.d(e,"b",(function(){return l})),n.d(e,"i",(function(){return u})),n.d(e,"h",(function(){return d})),n.d(e,"k",(function(){return f})),n.d(e,"e",(function(){return h})),n.d(e,"o",(function(){return p})),n.d(e,"g",(function(){return m})),n.d(e,"a",(function(){return v})),n.d(e,"l",(function(){return _})),n.d(e,"r",(function(){return g})),n.d(e,"p",(function(){return y})),n.d(e,"q",(function(){return b}));var g="__overlapped",y="default",b={groups:[y,g],overlay:[["default",g]],intersect:[[]]}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r=function(){function t(){this.attributes=[],this.overrides=[]}return t.prototype.storeAttribute=function(t){return this.attributes.push(t),this},t.prototype.storeOverride=function(t){return this.overrides.push(t),this},t.prototype.getAttributes=function(){return this.attributes},t.prototype.getZss=function(){var t=this.getAttributesZss(this.attributes);this.overrides.length>0&&(t+="\n");for(var e=0,n=this.overrides;e<n.length;e++){var r=n[e];t+="\n"+r.selectors.map((function(t){return"["+t.prop+" "+t.op+" "+t.value+"]"})).join("|")+" <\n"+this.getAttributesZss(r.attributes)+"\n>\n"}return this.overrides.length>0&&(t+="{}"),t+"\n"},t.prototype.getAttributesZss=function(t){return t.map((function(t){return t.param+": "+t.value+";"})).join("\n")},t}()},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(5);function i(t,e){return function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}([o(t)],function(t,e){if(t&&"all"===t[0])return t.slice(1).map((function(n){if("match"===n[0])return s(n,e);throw new Error("Если в поле filter используется AllExpression, то все вложенные выражения должны быть MatchExpression, а пришло: "+JSON.stringify(t))}));if(t&&"match"===t[0])return[s(t,e)];throw new Error("Поле filter должно содержать MatchExpression, а пришло: "+JSON.stringify(t))}(t.filter,e))}function o(t){return"[g_z_level >= "+(void 0!==t.minzoom?t.minzoom:0)+"][g_z_level < "+(void 0!==t.maxzoom?t.maxzoom:22)+"]"}var a={sublayer:"db_sublayer",class:"db_class",objectClass:"db_object_class"};function s(t,e){if("match"!==t[0]||"get"!==t[1][0]&&"global"!==t[1][0])throw new Error("MatchExpression поддерживает только следующий вид: ['match', ['get' | 'global', parameter], [string, string...], true | false, false | true], а пришел "+JSON.stringify(t));var n=t[2],i=t[1][1];e&&a[i]&&(i=a[i]);var o=t[3]?"=":"!=";return"global"===t[1][0]&&Object(r.b)(i),n.filter((function(t){return"string"!=typeof t||t.length})).map((function(t){return"["+i+" "+o+" "+t+"]"})).join(" | ")}},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o}));var r=new Set,i=function(t){r.add(t)},o=function(){var t=Array.from(r.keys());return r.clear(),t}},function(t,e,n){"use strict";function r(t){switch(t[0]){case"#":return function(t){if(4===t.length){var e=t.slice(1,2),n=t.slice(2,3),r=t.slice(3,4);return"#ff"+e+e+n+n+r+r}return 9===t.length?"#"+t.slice(7,9)+t.slice(1,7):"#ff"+t.slice(1)}(t);case"h":return function(t){var e=a(t);e[0]/=360,e[1]/=100,e[2]/=100;var n=function(t,e,n){if(0===e)return[255*n,255*n,255*n];var r=n<.5?n*(1+e):n+e-n*e,i=2*n-r;return[255*s(i,r,t+1/3),255*s(i,r,t),255*s(i,r,t-1/3)]}(e[0],e[1],e[2]);return o(n[0],n[1],n[2],void 0!==e[3]?255*e[3]:255)}(t);case"r":return function(t){var e=a(t),n=e[0],r=e[1],i=e[2],s=e[3];return o(n,r,i,void 0!==s?255*s:255)}(t)}return"#ff0000"}function i(t){return"#"+t.slice(3,9)+t.slice(1,3)}function o(t,e,n,r){var i=Math.round(t).toString(16),o=Math.round(e).toString(16),a=Math.round(n).toString(16),s=Math.round(r).toString(16);return 1===s.length&&(s="0"+s),1===i.length&&(i="0"+i),1===o.length&&(o="0"+o),1===a.length&&(a="0"+a),"#"+s+i+o+a}function a(t){return t.split("(")[1].split(")")[0].split(",").map((function(t){return parseFloat(t)}))}function s(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));var r=function(){function t(t,e){this.expressions=[],this.maxZoom=e,this.minZoom=t}return t.prototype.addStep=function(t,e,n){var r;(r=this.expressions).push.apply(r,this.evalStepExpression(t,e,n))},t.prototype.addZssToStep=function(t,e){var n;(n=this.expressions).push.apply(n,this.evalStepExpression(void 0,t,e))},t.prototype.getStepsZss=function(){return this.stepsZss()},t.prototype.evalStepExpression=function(t,e,n){var r=[],i=[];if(!e||!Array.isArray(e)){var o=n?n(e):e;return r=t?o?[t+": "+o+";\n"]:[]:o?[o.toString()]:[],[{minZoom:this.minZoom,maxZoom:this.maxZoom,zss:r}]}if("step"===e[0]&&"zoom"===e[1][0]){var a=e.slice(2);a.unshift(0);for(var s=0;s<a.length;s+=2){var c=[],l=a[s],u=a[s+1],d=n?n(u):u;d&&(t?c.push(t+": "+d+";\n"):c.push(d.toString())),i.push({minZoom:Math.max(l||0,this.minZoom),maxZoom:Math.min(a[s+2]||22,this.maxZoom),zss:c})}}return i},t.prototype.createZssOfSteps=function(t){var e="";return t.forEach((function(t){var n="[g_z_level >= "+t.minZoom+"]",r="[g_z_level < "+t.maxZoom+"]";e+=""+n+r+" {\n"+t.zss.join("")+"}\n"})),e},t.prototype.getNextStepZoom=function(t){void 0===t&&(t=-1);var e=22;return this.expressions.forEach((function(n){n.minZoom>t&&n.minZoom<e&&(e=n.minZoom),n.maxZoom>t&&n.maxZoom<e&&(e=n.maxZoom)})),e},t.prototype.isСurrentMinZoomInStepRange=function(t,e){return t.minZoom<=e&&t.maxZoom>e},t.prototype.stepsZss=function(){for(var t=this,e=this.getNextStepZoom(),n=this.getNextStepZoom(e),r=[],i=function(){var i={zss:new Array,minZoom:e,maxZoom:n};o.expressions.forEach((function(n){var r;t.isСurrentMinZoomInStepRange(n,e)&&(r=i.zss).push.apply(r,n.zss)})),r.push(i),e=n,n=o.getNextStepZoom(e)},o=this;e<this.maxZoom;)i();return this.createZssOfSteps(this.mergeSimilarSteps(r))},t.prototype.mergeSimilarSteps=function(t){var e=[];return t.forEach((function(t){var n=e[e.length-1];(null==n?void 0:n.zss.join(""))===t.zss.join("")?n.maxZoom=t.maxZoom:e.push(t)})),e},t}();function i(t){if(t){if("string"==typeof t)return[t];if("step"===t[0]&&"zoom"===t[1][0]){for(var e=[],n=2;n<t.length;n+=2){if("string"!=typeof t[n])throw console.log(typeof t[n]),new Error("Для данного стилевого свойства внутри выражения StepExpression поддерживаются только строковые значения");""!==t[n]&&e.push(t[n])}return e}}return[]}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s}));var r=n(3),i=n(1);function o(t){if("string"==typeof t)return[t];if("match"!==t[0])throw new Error("В iconName должен прийти либо string, либо MatchExpression, а пришло "+JSON.stringify(t));for(var e=[],n=t.slice(2,-1),r=0;r<n.length;r+=2){var i=n[r+1];e.push(i)}return e.push(t[t.length-1]),e}function a(t,e,n){if("string"!=typeof t){if("match"!==t[0]&&5!==t.length)throw new Error('В iconName должен прийти либо string, либо MatchExpression вида ["match", ["get", "selected"], [true], "iconA", "defaultIcon"], а пришло '+JSON.stringify(t));var i=t[1],o=t[2],a=t[3],c=t[4],l=i[1],u=o[0];n.storeAttribute({param:"raster_set",value:s(c,e)});var d=new r.a;d.storeAttribute({param:"raster_set",value:s(a,e)}),n.storeOverride({selectors:[{prop:l,op:"=",value:u}],attributes:d.getAttributes()})}else n.storeAttribute({param:"raster_set",value:s(t,e)})}function s(t,e){var n=t+(void 0!==e?"_anchor_x"+e[0]+"y"+e[1]:"");return/\d/.test(t[0])&&(n="i"+n),(n=n.replace(/[^a-z0-9_]+/gi,"_"))!==t&&(n=n+"_"+Object(i.g)(t)),n}},function(t,e){},function(t,e,n){"use strict";n.r(e),n.d(e,"convertMapGLStyleToZss",(function(){return p}));var r=n(0),i=n(4),o=n(2),a=n(1),s=n(6),c=n(7),l=n(8),u=n(5),d=n(3),f=n(9);for(var h in f)["default","convertMapGLStyleToZss"].indexOf(h)<0&&function(t){n.d(e,t,(function(){return f[t]}))}(h);function p(t,e){var n,f;void 0===e&&(e=!0);var h=[],p=[],v=[],_=[],g=((null===(n=t.labelingGroups)||void 0===n?void 0:n.groups)||[]).concat(o.q.groups).reduce((function(t,e){return t.includes(e)||t.push(e),t}),[]).map((function(t){return Object(a.m)(t)})),y=((null===(f=t.labelingGroups)||void 0===f?void 0:f.overlay)||[]).concat(o.q.overlay).concat(g.reduce((function(t,e){return e===o.p||e===o.r||t.push([e,o.r]),t}),[])).reduce((function(t,e){for(var n=e.map((function(t){return Object(a.m)(t)})),r=[],i=0,o=n;i<o.length;i++){var s=o[i];g.includes(s)?r.push(s):h.push("Group name '"+s+"' is not existed in 'groups' array. '"+s+"' will be removed from overlay config: '["+n.join(", ")+"]'.")}return r.length>1&&t.push(r),1===n.length&&1===r.length&&t.push(r),t}),[]),b={groups:g,overlay:y,intersect:o.q.intersect},x=t.layers.map((function(t,n){var u=void 0===t.interactive||t.interactive;v.push({index:n,interactive:u});try{switch(t.type){case"polygon":return function(t,e,n){var a=Object(o.n)(t.style);if("none"===a.visibility)return"";var s="",c=new d.a,l=Object(i.a)(t,n);return l.forEach((function(t){return s+=t+" {\n"})),s+="symbol: area_symbol;\n",Object(r.a)("color",a.color,c),Object(r.a)("border_color",a.strokeColor,c),Object(r.b)("border_width_zpt",a.strokeWidth,1,c),s+="phase: "+e+";\n",s+=c.getZss(),l.forEach((function(){return s+="}\n"})),s+="\n"}(t,n,e);case"transparentPolygon":return function(t,e,n){if(!n)return"";var r="",o=Object(i.a)(t,n);return o.forEach((function(t){return r+=t+" {\n"})),r+="symbol: identify_only_area_symbol;\n",r+="phase: "+e+";\n",o.forEach((function(){return r+="}\n"})),r+="\n"}(t,n,e);case"polygonExtrusion":return function(t,e,n){var a=Object(o.m)(t.style);if("none"===a.visibility)return"";var s="",c=new d.a,l=Object(i.a)(t,n);return l.forEach((function(t){return s+=t+" {\n"})),s+="symbol: building_symbol;\n",Object(r.a)("color",a.topColor,c),Object(r.a)("wall_color",a.sideColor,c),Object(r.a)("border_color",a.strokeColor,c),Object(r.b)("border_width_zpt",a.strokeWidth,1,c),s+="phase: "+e+";\n",s+=c.getZss(),l.forEach((function(){return s+="}\n"})),s+="\n"}(t,n,e);case"callout":return function(t,e,n){if(!n)return"";var a=Object(o.c)(t.style),s="",c=new d.a,l=Object(i.a)(t,n);return l.forEach((function(t){return s+=t+" {\n"})),s+="symbol: icon_symbol;\n",s+="labeling_opacity: 1;\n",s+="raster_set: dynamic_bubble_two_lines;\n",Object(r.b)("icon_width_zpt",a.width,1,c),s+="substitutions: [\n",s+='    { id: "time"; properties: ["db_label"]; },\n',s+='    { id: "distance"; properties: ["db_label2"]; },\n',s+='    { id: "bubble"; action: { name: "stretch"; margins: { top_bottom_svg_units: 3; left_right_svg_units: 8; }; }; },\n',s+="];\n",s+="phase: "+e+";\n",s+=c.getZss(),l.forEach((function(){return s+="}\n"})),s+="\n"}(t,n,e);case"line":return function(t,e,n){var a=Object(o.j)(t.style);if("none"===a.visibility)return"";var s="",c=new d.a,l=Object(i.a)(t,n);return l.forEach((function(t){return s+=t+" {\n"})),s+="symbol: line_symbol;\n",Object(r.a)("color",a.color,c),Object(r.b)("width_zpt",a.width,1,c),s+="phase: "+e+";\n",s+=c.getZss(),l.forEach((function(){return s+="}\n"})),s+="\n"}(t,n,e);case"dashedLine":return function(t,e,n){var a=Object(o.e)(t.style);if("none"===a.visibility)return"";var s="",c=new d.a,l=Object(i.a)(t,n);return l.forEach((function(t){return s+=t+" {\n"})),s+="symbol: dashed_line_symbol;\n",Object(r.b)("dash_length_zpt",a.dashLength,1,c),Object(r.b)("space_length_zpt",a.gapLength,1,c),Object(r.a)("dash_color",a.color,c),Object(r.a)("space_color",a.gapColor,c),Object(r.b)("width_zpt",a.width,1,c),s+="phase: "+e+";\n",s+=c.getZss(),l.forEach((function(){return s+="}\n"})),s+="\n"}(t,n,e);case"shiftedLine":return function(t,e,n){var a=Object(o.o)(t.style);if("none"===a.visibility)return"";var s="",c=new d.a,l=Object(i.a)(t,n);return l.forEach((function(t){return s+=t+" {\n"})),s+="symbol: line_symbol;\n",Object(r.a)("color",a.color,c),Object(r.b)("width_zpt",a.width,1,c),Object(r.b)("shift_zpt",a.shift,1,c),s+="phase: "+e+";\n",s+=c.getZss(),l.forEach((function(){return s+="}\n"})),s+="\n"}(t,n,e);case"arrow":return function(t,e,n){if(!n)return"";var a=Object(o.a)(t.style),s=Object(i.a)(t,n),c="",l=new d.a;return s.forEach((function(t){return c+=t+" {\n"})),"erase"===a.animation.type?c+="symbol: maneuver_arrow_symbol;\n":(c+="symbol: entrance_arrow_symbol;\n",Object(r.b)("tip_movement_amplitude_zpt",a.animation.tipMovementAmplitude,1,l)),Object(r.b)("width_zpt",a.lineWidth,1,l),Object(r.a)("color",a.color,l),Object(r.a)("border_color",a.strokeColor,l),Object(r.b)("border_width_zpt",a.strokeWidth,1,l),c+="wing_height_multiplier: 0;\n",c+="wing_width_multiplier: "+a.tipWidth+";\n",c+="tip_height_multiplier: "+a.tipHeight+";\n",c+="phase: "+e+";\n",c+=l.getZss(),s.forEach((function(){return c+="}\n"})),c+="\n"}(t,n,e);case"point":if(t.style.iconImage){var f=Object(o.l)(t.style).iconAnchor;Object(l.a)(t.style.iconImage).forEach((function(t){var e=Object(l.c)(t,f);_.some((function(t){return t.name===e}))||_.push({format:"svg",name:e,fileName:t,anchorX:f[0],anchorY:f[1]})}))}return p=Object(a.a)(p,t.style.textFont),function(t,e,n,s){var u,f,h=Object(o.l)(t.style);if("none"===h.visibility)return"";var p=Object(i.a)(t,s),m="",v=new d.a;p.forEach((function(t){return m+=t+" {\n"})),m+="phase: "+e+";\n",m+="with_height: "+h.allowElevation+";\n",m+="label_halign: center;\n",m+="label_valign: center;\n",m+="max_symbols_per_line: "+Object(a.n)(h.textMaxLengthPerLine)+";\n",m+="label_group_priority: "+Object(a.n)(h.textPriority)+";\n";var _=null!==(u=t.minzoom)&&void 0!==u?u:0,g=null!==(f=t.maxzoom)&&void 0!==f?f:22,y=new c.a(_,g);if(m+="min_display_zoom: "+Object(a.n)(_)+";\n",m+="max_display_zoom: "+Object(a.n)(g)+";\n",m+=Object(a.f)("halo_radius_zpt",h.textHaloWidth),Object(a.c)("halo_color",h.textHaloColor,v),m+=Object(a.f)("letter_spacing",h.textLetterSpacing),Object(a.d)("font_size_zpt",h.textFontSize,v),m+=Object(a.f)("line_height",h.textLineHeight),h.iconImage){if(m+="symbol: poi_symbol;\n",Object(l.b)(h.iconImage,h.iconAnchor,v),"number"==typeof h.iconWidth||Object(a.h)(h.iconWidth)||Object(a.i)(h.iconWidth)?Object(r.b)("icon_width_zpt",h.iconWidth,1,v):(y.addStep("icon_width_zpt",h.iconWidth),y.addZssToStep(h.iconWidth,(function(){return v.getZss()}))),h.allowOverlap)m+="icon_labeling_group: "+o.r+";\n",m+="text_labeling_group: "+o.r+";\n",m+="text2_labeling_group: "+o.r+";\n",m+="text3_labeling_group: "+o.r+";\n";else{var b=Object(a.m)(h.iconLabelingGroup);if(b&&n.includes(b)){m+="icon_labeling_group: "+b+";\n";var x=Array.isArray(h.textLabelingGroup)?h.textLabelingGroup:[h.textLabelingGroup];["text_labeling_group","text2_labeling_group","text3_labeling_group"].forEach((function(t,e){var r=Object(a.m)(x[e]);r&&n.includes(r)&&(m+=t+": "+r+";\n")}))}}m+="possible_label_placements: ["+Object(a.k)(h.textPlacement)+"];\n",Object(a.c)("font_color",h.textColor,v),m+="icon_group_priority: "+Object(a.n)(h.iconPriority)+";\n",Object(a.d)("poi_label_offset",h.textOffset,v),m+="icon_margin_zpt: "+Object(a.b)(h.iconLabelingMargin)+";\n",m+=Object(a.e)(h.textLabelingMargin)}else{if(m+="symbol: label_point_symbol;\n",Object(a.c)("color",h.textColor,v),h.allowOverlap)m+="labeling_group: "+o.r+";\n";else{var w=Array.isArray(h.textLabelingGroup)?h.textLabelingGroup[0]:h.textLabelingGroup;w&&n.includes(Object(a.m)(w))&&(m+="labeling_group: "+Object(a.m)(w)+";\n")}m+="margin_zpt: "+Object(a.b)(Array.isArray(h.textLabelingMargin)?h.textLabelingMargin[0]:h.textLabelingMargin)+";\n"}if(!t.style.iconImage&&""===h.textFont)return"";if(Array.isArray(h.textFont)&&!Object(a.j)(h.textFont)){if(!t.style.iconImage&&""===h.textFont[0])return"";for(var S=0;S<h.textFont.length;S++)void 0!==a.l.font[S]&&(y.addStep(""+a.l.font[S],h.textFont[S]),y.addZssToStep(h.textFont[S],(function(){return v.getZss()})))}else y.addStep("font",h.textFont),y.addZssToStep(h.textFont,(function(){return v.getZss()}));return m+=y.getStepsZss(),p.forEach((function(){return m+="}\n"})),m+="\n"}(t,n,b.groups,e);case"labelLine":return t.style.textFont&&!p.includes(t.style.textFont)&&p.push(t.style.textFont),function(t,e,n,s){var c=Object(o.h)(t.style);if("none"===c.visibility||""===c.textFont)return"";var l="",u=new d.a,f=Object(i.a)(t,s);return f.forEach((function(t){return l+=t+" {\n"})),l+="symbol: label_line_symbol;\n",l+="font: "+c.textFont+";\n",Object(r.a)("color",c.textColor,u),Object(r.b)("font_size_zpt",c.textFontSize,1,u),l+="letter_spacing: "+Object(a.n)(c.textLetterSpacing)+";\n",Object(r.a)("halo_color",c.textHaloColor,u),l+="halo_radius_zpt: "+Object(a.n)(c.textHaloWidth)+";\n",l+="label_group_priority: "+Object(a.n)(c.textPriority)+";\n",Object(r.b)("duplication_spacing_zpt",c.textDuplicationSpacing,1,u),l+="line_ending_offsets_zpt: "+Object(a.n)(c.lineEndingOffsets)+";\n",l+="label_margins_zpt: "+Object(a.n)(c.textLabelingSideMargin)+";\n",l+="phase: "+e+";\n",t.style.labelingGroup&&n.includes(Object(a.m)(t.style.labelingGroup))&&(l+="labeling_group: "+Object(a.m)(t.style.labelingGroup)+";\n"),l+=u.getZss(),f.forEach((function(){return l+="}\n"})),l+="\n"}(t,n,b.groups,e);case"buildingModel":return function(t,e,n){var a=Object(o.b)(t.style);if("none"===a.visibility)return"";var s="",c=new d.a,l=Object(i.a)(t,n);return l.forEach((function(t){return s+=t+" {\n"})),s+="symbol: model_symbol;\n",Object(r.a)("color",a.color,c),Object(r.a)("contour_color",a.strokeColor,c),s+="phase: "+e+";\n",Object(r.b)("outer_edge_width_zpt",a.strokeWidth,1,c),s+=c.getZss(),l.forEach((function(){return s+="}\n"})),s+="\n"}(t,n,e);case"directionalModel":return function(t,e,n){if(!n)return"";var a=Object(o.f)(t.style),s="",c=new d.a,l=Object(i.a)(t,n);return l.forEach((function(t){return s+=t+" {\n"})),s+="symbol: directional_model_symbol;\n",s+="color: #ffffff;\n",s+="contour_color: #ffffff;\n",s+="outer_edge_width_zpt: 0;\n",Object(r.b)("circle_diameter_zpt",a.diameter,1,c),s+="phase: "+e+";\n",s+=c.getZss(),l.forEach((function(){return s+="}\n"})),s+="\n"}(t,n,e);case"lineExtrusion":return function(t,e,n){var a=Object(o.i)(t.style);if("none"===a.visibility)return"";var s="",c=new d.a,l=Object(i.a)(t,n);return l.forEach((function(t){return s+=t+" {\n"})),s+="symbol: fence_symbol;\n",Object(r.a)("wall_color",a.sideColor,c),Object(r.a)("border_color",a.strokeColor,c),Object(r.b)("border_width_zpt",a.strokeWidth,1,c),s+="phase: "+e+";\n",Object(r.b)("height",a.height,1,c),s+=c.getZss(),l.forEach((function(){return s+="}\n"})),s+="\n"}(t,n,e);case"oneWayLine":return function(t,e,n,s){var c=Object(o.k)(t.style);if("none"===c.visibility)return"";var l="",u=new d.a,f=Object(i.a)(t,s);return f.forEach((function(t){return l+=t+" {\n"})),l+="symbol: one_way_line_symbol;\n",Object(r.a)("color",c.color,u),l+="border_color: #00000000;\n",Object(r.b)("width_zpt",c.lineWidth,1,u),Object(r.b)("length_zpt",c.lineLength,1,u),l+="wing_width_multiplier: "+Object(a.n)(c.tipWidth)+";\n",l+="tip_height_multiplier: "+Object(a.n)(c.tipHeight)+";\n",l+="label_group_priority: "+Object(a.n)(c.priority)+";\n",Object(r.b)("duplication_spacing_zpt",c.duplicationSpacing,1,u),l+="line_ending_offsets_zpt: "+Object(a.n)(c.endingOffsets)+";\n",l+="border_width_zpt: 0;\n",l+="wing_height_multiplier: 0;\n",l+="phase: "+e+";\n",t.style.labelingGroup&&n.includes(Object(a.m)(t.style.labelingGroup))&&(l+="labeling_group: "+Object(a.m)(t.style.labelingGroup)+";\n"),l+=u.getZss(),f.forEach((function(){return l+="}\n"})),l+="\n"}(t,n,b.groups,e);case"gradientLine":return function(t,e,n){if(!n)return"";var a=Object(o.g)(t.style),c="",l=new d.a,u=Object(i.a)(t,n);return u.forEach((function(t){return c+=t+" {\n"})),c+="symbol: gradient_line_symbol;\n",Object(r.b)("width_zpt",a.lineWidth,1,l),Object(r.b)("border_width_zpt",a.strokeWidth,1,l),c+="border2_width_zpt: 0;\n",c+="palette: ["+a.colors.map(s.a).join(", ")+"];\n",Object(r.a)("border_color",a.strokeColor,l),c+="border2_color: #000000;\n",Object(r.b)("gradient_length_zpt",a.gradientLength,1,l),Object(r.b)("max_edge_percent_for_gradient",a.gradientMaxLength,100,l),c+="phase: "+e+";\n",c+=l.getZss(),u.forEach((function(){return c+="}\n"})),c+="\n"}(t,n,e);case"circle":return function(t,e,n){if(!n)return"";var a=Object(o.d)(t.style),s="",c=new d.a,l=Object(i.a)(t,n);return l.forEach((function(t){return s+=t+" {\n"})),s+="symbol: area_symbol;\n",Object(r.a)("color",a.color,c),Object(r.a)("border_color",a.strokeColor,c),Object(r.b)("border_width_zpt",a.strokeWidth,1,c),s+="phase: "+e+";\n",s+=c.getZss(),l.forEach((function(){return s+="}\n"})),s+="\n"}(t,n,e);default:throw new Error("Unsupported layer type")}}catch(e){h.push('Layer "'+t.id+'" won\'t be drawn, the reason: "'+e.message+'"')}})).filter((function(t){return void 0!==t})).join("\n\n"),w=Object(s.b)(Object(s.a)(t.background.color));return{zss:x,globalVars:Object(u.a)(),errors:h,backgroundColor:w,labelingGroupConfig:b,backgroundColorZss:m(w),rasterSets:_,fonts:p,phases:v}}function m(t){var e=new d.a;Object(r.a)("color",t,e);var n="";return n+="[db_sublayer = tech_zenith_background] {\n",n+="symbol: background_symbol;\n",(n+=e.getZss())+"}"}}])},function(t,e,n){"undefined"!=typeof self&&self,t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=113)}([function(t,e,n){"use strict";function r(t){return t&&0===t.length}function i(t){return null==t?[]:Object.keys(t)}function o(t){for(var e=[],n=Object.keys(t),r=0;r<n.length;r++)e.push(t[n[r]]);return e}function a(t,e){for(var n=[],r=i(t),o=0;o<r.length;o++){var a=r[o];n.push(e.call(null,t[a],a))}return n}function s(t,e){for(var n=[],r=0;r<t.length;r++)n.push(e.call(null,t[r],r));return n}function c(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];Array.isArray(r)?e=e.concat(c(r)):e.push(r)}return e}function l(t){return r(t)?void 0:t[0]}function u(t){var e=t&&t.length;return e?t[e-1]:void 0}function d(t,e){if(Array.isArray(t))for(var n=0;n<t.length;n++)e.call(null,t[n],n);else{if(!L(t))throw Error("non exhaustive match");var r=i(t);for(n=0;n<r.length;n++){var o=r[n],a=t[o];e.call(null,a,o)}}}function f(t){return"string"==typeof t}function h(t){return void 0===t}function p(t){return t instanceof Function}function m(t,e){return void 0===e&&(e=1),t.slice(e,t.length)}function v(t,e){return void 0===e&&(e=1),t.slice(0,t.length-e)}function _(t,e){var n=[];if(Array.isArray(t))for(var r=0;r<t.length;r++){var i=t[r];e.call(null,i)&&n.push(i)}return n}function g(t,e){return _(t,(function(t){return!e(t)}))}function y(t,e){for(var n=Object.keys(t),r={},i=0;i<n.length;i++){var o=n[i],a=t[o];e(a)&&(r[o]=a)}return r}function b(t,e){return!!L(t)&&t.hasOwnProperty(e)}function x(t,e){return void 0!==O(t,(function(t){return t===e}))}function w(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e}function S(t){var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}function O(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(e.call(null,r))return r}}function M(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r];e.call(null,i)&&n.push(i)}return n}function j(t,e,n){for(var r=Array.isArray(t),a=r?t:o(t),s=r?[]:i(t),c=n,l=0;l<a.length;l++)c=e.call(null,c,a[l],r?l:s[l]);return c}function I(t){return g(t,(function(t){return null==t}))}function T(t,e){void 0===e&&(e=function(t){return t});var n=[];return j(t,(function(t,r){var i=e(r);return x(n,i)?t:(n.push(i),t.concat(r))}),[])}function E(t){return Array.isArray(t)}function A(t){return t instanceof RegExp}function L(t){return t instanceof Object}function C(t,e){for(var n=0;n<t.length;n++)if(!e(t[n],n))return!1;return!0}function P(t,e){return g(t,(function(t){return x(e,t)}))}function k(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function N(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}function R(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++)for(var o=e[r],a=i(o),s=0;s<a.length;s++){var c=a[s];t[c]=o[c]}return t}function z(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++)for(var o=e[r],a=i(o),s=0;s<a.length;s++){var c=a[s];b(t,c)||(t[c]=o[c])}return t}function B(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return z.apply(null,[{}].concat(t))}function F(t,e){var n={};return d(t,(function(t){var r=e(t),i=n[r];i?i.push(t):n[r]=[t]})),n}function D(t,e){for(var n=S(t),r=i(e),o=0;o<r.length;o++){var a=r[o],s=e[a];n[a]=s}return n}function U(){}function Z(t){return t}function H(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];e.push(void 0!==r?r:void 0)}return e}function G(t){console&&console.error&&console.error("Error: "+t)}function W(t){console&&console.warn&&console.warn("Warning: "+t)}function V(){return"function"==typeof Map}function q(t,e){e.forEach((function(e){var n=e.prototype;Object.getOwnPropertyNames(n).forEach((function(r){if("constructor"!==r){var i=Object.getOwnPropertyDescriptor(n,r);i&&(i.get||i.set)?Object.defineProperty(t.prototype,r,i):t.prototype[r]=e.prototype[r]}}))}))}function Y(t){function e(){}e.prototype=t;var n=new e;function r(){return typeof n.bar}return r(),r(),t}function X(t){return t[t.length-1]}function K(t){var e=(new Date).getTime(),n=t();return{time:(new Date).getTime()-e,value:n}}n.d(e,"A",(function(){return r})),n.d(e,"G",(function(){return i})),n.d(e,"U",(function(){return o})),n.d(e,"J",(function(){return a})),n.d(e,"I",(function(){return s})),n.d(e,"t",(function(){return c})),n.d(e,"s",(function(){return l})),n.d(e,"H",(function(){return u})),n.d(e,"u",(function(){return d})),n.d(e,"E",(function(){return f})),n.d(e,"F",(function(){return h})),n.d(e,"B",(function(){return p})),n.d(e,"m",(function(){return m})),n.d(e,"n",(function(){return v})),n.d(e,"p",(function(){return _})),n.d(e,"P",(function(){return g})),n.d(e,"N",(function(){return y})),n.d(e,"w",(function(){return b})),n.d(e,"j",(function(){return x})),n.d(e,"g",(function(){return w})),n.d(e,"h",(function(){return S})),n.d(e,"q",(function(){return O})),n.d(e,"r",(function(){return M})),n.d(e,"O",(function(){return j})),n.d(e,"i",(function(){return I})),n.d(e,"T",(function(){return T})),n.d(e,"y",(function(){return E})),n.d(e,"D",(function(){return A})),n.d(e,"C",(function(){return L})),n.d(e,"o",(function(){return C})),n.d(e,"l",(function(){return P})),n.d(e,"Q",(function(){return k})),n.d(e,"x",(function(){return N})),n.d(e,"f",(function(){return R})),n.d(e,"k",(function(){return B})),n.d(e,"v",(function(){return F})),n.d(e,"K",(function(){return D})),n.d(e,"b",(function(){return U})),n.d(e,"a",(function(){return Z})),n.d(e,"L",(function(){return H})),n.d(e,"c",(function(){return G})),n.d(e,"d",(function(){return W})),n.d(e,"z",(function(){return V})),n.d(e,"e",(function(){return q})),n.d(e,"S",(function(){return Y})),n.d(e,"M",(function(){return X})),n.d(e,"R",(function(){return K}))},function(t,e,n){"use strict";n.r(e),n.d(e,"VERSION",(function(){return r})),n.d(e,"CstParser",(function(){return Qe})),n.d(e,"EmbeddedActionsParser",(function(){return $e})),n.d(e,"ParserDefinitionErrorType",(function(){return qe})),n.d(e,"EMPTY_ALT",(function(){return Ke})),n.d(e,"Lexer",(function(){return V})),n.d(e,"LexerDefinitionErrorType",(function(){return H})),n.d(e,"createToken",(function(){return K})),n.d(e,"createTokenInstance",(function(){return Q})),n.d(e,"EOF",(function(){return J})),n.d(e,"tokenLabel",(function(){return q})),n.d(e,"tokenMatcher",(function(){return $})),n.d(e,"tokenName",(function(){return Y})),n.d(e,"defaultGrammarResolverErrorProvider",(function(){return jt})),n.d(e,"defaultGrammarValidatorErrorProvider",(function(){return It})),n.d(e,"defaultParserErrorProvider",(function(){return Mt})),n.d(e,"EarlyExitException",(function(){return he})),n.d(e,"isRecognitionException",(function(){return le})),n.d(e,"MismatchedTokenException",(function(){return ue})),n.d(e,"NotAllInputParsedException",(function(){return fe})),n.d(e,"NoViableAltException",(function(){return de})),n.d(e,"defaultLexerErrorProvider",(function(){return G})),n.d(e,"Alternation",(function(){return ut})),n.d(e,"Alternative",(function(){return it})),n.d(e,"NonTerminal",(function(){return nt})),n.d(e,"Option",(function(){return ot})),n.d(e,"Repetition",(function(){return ct})),n.d(e,"RepetitionMandatory",(function(){return at})),n.d(e,"RepetitionMandatoryWithSeparator",(function(){return st})),n.d(e,"RepetitionWithSeparator",(function(){return lt})),n.d(e,"Rule",(function(){return rt})),n.d(e,"Terminal",(function(){return dt})),n.d(e,"serializeGrammar",(function(){return ft})),n.d(e,"serializeProduction",(function(){return ht})),n.d(e,"GAstVisitor",(function(){return vt})),n.d(e,"assignOccurrenceIndices",(function(){return se})),n.d(e,"resolveGrammar",(function(){return oe})),n.d(e,"validateGrammar",(function(){return ae})),n.d(e,"clearCache",(function(){return un})),n.d(e,"createSyntaxDiagramsCode",(function(){return tn})),n.d(e,"generateParserFactory",(function(){return cn})),n.d(e,"generateParserModule",(function(){return ln})),n.d(e,"Parser",(function(){return dn}));var r="7.0.1",i=n(0),o=n(3),a={},s=new o.RegExpParser;function c(t){var e=t.toString();if(a.hasOwnProperty(e))return a[e];var n=s.pattern(e);return a[e]=n,n}var l,u=(l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),d='Unable to use "first char" lexer optimizations:\n';function f(t,e){void 0===e&&(e=!1);try{var n=c(t);return function t(e,n,r){switch(e.type){case"Disjunction":for(var o=0;o<e.value.length;o++)t(e.value[o],n,r);break;case"Alternative":var a=e.value;for(o=0;o<a.length;o++){var s=a[o];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var c=s;switch(c.type){case"Character":h(c.value,n,r);break;case"Set":if(!0===c.complement)throw Error("Complement Sets are not supported for first char optimization");Object(i.u)(c.value,(function(t){if("number"==typeof t)h(t,n,r);else{var e=t;if(!0===r)for(var i=e.from;i<=e.to;i++)h(i,n,r);else{for(i=e.from;i<=e.to&&i<C;i++)h(i,n,r);if(e.to>=C)for(var o=e.from>=C?e.from:C,a=e.to,s=P(o),c=P(a),l=s;l<=c;l++)n[l]=l}}}));break;case"Group":t(c.value,n,r);break;default:throw Error("Non Exhaustive Match")}var l=void 0!==c.quantifier&&0===c.quantifier.atLeast;if("Group"===c.type&&!1===m(c)||"Group"!==c.type&&!1===l)break}break;default:throw Error("non exhaustive match!")}return Object(i.U)(n)}(n.value,{},n.flags.ignoreCase)}catch(n){if("Complement Sets are not supported for first char optimization"===n.message)e&&Object(i.d)(d+"\tUnable to optimize: < "+t.toString()+" >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.");else{var r="";e&&(r="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),Object(i.c)(d+"\n\tFailed parsing: < "+t.toString()+" >\n\tUsing the regexp-to-ast library version: "+o.VERSION+"\n\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+r)}}return[]}function h(t,e,n){var r=P(t);e[r]=r,!0===n&&function(t,e){var n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){var i=P(r.charCodeAt(0));e[i]=i}else{var o=n.toLowerCase();o!==n&&(e[i=P(o.charCodeAt(0))]=i)}}(t,e)}function p(t,e){return Object(i.q)(t.value,(function(t){if("number"==typeof t)return Object(i.j)(e,t);var n=t;return void 0!==Object(i.q)(e,(function(t){return n.from<=t&&t<=n.to}))}))}function m(t){return!(!t.quantifier||0!==t.quantifier.atLeast)||!!t.value&&(Object(i.y)(t.value)?Object(i.o)(t.value,m):m(t.value))}var v=function(t){function e(e){var n=t.call(this)||this;return n.targetCharCodes=e,n.found=!1,n}return u(e,t),e.prototype.visitChildren=function(e){if(!0!==this.found){switch(e.type){case"Lookahead":return void this.visitLookahead(e);case"NegativeLookahead":return void this.visitNegativeLookahead(e)}t.prototype.visitChildren.call(this,e)}},e.prototype.visitCharacter=function(t){Object(i.j)(this.targetCharCodes,t.value)&&(this.found=!0)},e.prototype.visitSet=function(t){t.complement?void 0===p(t,this.targetCharCodes)&&(this.found=!0):void 0!==p(t,this.targetCharCodes)&&(this.found=!0)},e}(o.BaseRegExpVisitor);function _(t,e){if(e instanceof RegExp){var n=c(e),r=new v(t);return r.visit(n),r.found}return void 0!==Object(i.q)(e,(function(e){return Object(i.j)(t,e.charCodeAt(0))}))}var g=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),y="PATTERN",b="boolean"==typeof new RegExp("(?:)").sticky;function x(t,e){var n=[],r=function(t){var e=Object(i.p)(t,(function(t){return!Object(i.w)(t,y)}));return{errors:Object(i.I)(e,(function(t){return{message:"Token Type: ->"+t.name+"<- missing static 'PATTERN' property",type:H.MISSING_PATTERN,tokenTypes:[t]}})),valid:Object(i.l)(t,e)}}(t);n=n.concat(r.errors);var a=function(t){var e=Object(i.p)(t,(function(t){var e=t[y];return!(Object(i.D)(e)||Object(i.B)(e)||Object(i.w)(e,"exec")||Object(i.E)(e))}));return{errors:Object(i.I)(e,(function(t){return{message:"Token Type: ->"+t.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:H.INVALID_PATTERN,tokenTypes:[t]}})),valid:Object(i.l)(t,e)}}(r.valid),s=a.valid;return(n=(n=(n=(n=n.concat(a.errors)).concat(function(t){var e=[],n=Object(i.p)(t,(function(t){return Object(i.D)(t[y])}));return(e=(e=(e=(e=e.concat(function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.found=!1,e}return g(e,t),e.prototype.visitEndAnchor=function(t){this.found=!0},e}(o.BaseRegExpVisitor),n=Object(i.p)(t,(function(t){var n=t[y];try{var r=c(n),i=new e;return i.visit(r),i.found}catch(t){return w.test(n.source)}}));return Object(i.I)(n,(function(t){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+t.name+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:H.EOI_ANCHOR_FOUND,tokenTypes:[t]}}))}(n))).concat(function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.found=!1,e}return g(e,t),e.prototype.visitStartAnchor=function(t){this.found=!0},e}(o.BaseRegExpVisitor),n=Object(i.p)(t,(function(t){var n=t[y];try{var r=c(n),i=new e;return i.visit(r),i.found}catch(t){return S.test(n.source)}}));return Object(i.I)(n,(function(t){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+t.name+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:H.SOI_ANCHOR_FOUND,tokenTypes:[t]}}))}(n))).concat(function(t){var e=Object(i.p)(t,(function(t){var e=t[y];return e instanceof RegExp&&(e.multiline||e.global)}));return Object(i.I)(e,(function(t){return{message:"Token Type: ->"+t.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:H.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[t]}}))}(n))).concat(function(t){var e=[],n=Object(i.I)(t,(function(n){return Object(i.O)(t,(function(t,r){return n.PATTERN.source!==r.PATTERN.source||Object(i.j)(e,r)||r.PATTERN===V.NA||(e.push(r),t.push(r)),t}),[])}));n=Object(i.i)(n);var r=Object(i.p)(n,(function(t){return t.length>1}));return Object(i.I)(r,(function(t){var e=Object(i.I)(t,(function(t){return t.name}));return{message:"The same RegExp pattern ->"+Object(i.s)(t).PATTERN+"<-has been used in all of the following Token Types: "+e.join(", ")+" <-",type:H.DUPLICATE_PATTERNS_FOUND,tokenTypes:t}}))}(n))).concat(function(t){var e=Object(i.p)(t,(function(t){return t[y].test("")}));return Object(i.I)(e,(function(t){return{message:"Token Type: ->"+t.name+"<- static 'PATTERN' must not match an empty string",type:H.EMPTY_MATCH_PATTERN,tokenTypes:[t]}}))}(n))}(s))).concat(function(t){var e=Object(i.p)(t,(function(t){if(!Object(i.w)(t,"GROUP"))return!1;var e=t.GROUP;return e!==V.SKIPPED&&e!==V.NA&&!Object(i.E)(e)}));return Object(i.I)(e,(function(t){return{message:"Token Type: ->"+t.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:H.INVALID_GROUP_TYPE_FOUND,tokenTypes:[t]}}))}(s))).concat(function(t,e){var n=Object(i.p)(t,(function(t){return void 0!==t.PUSH_MODE&&!Object(i.j)(e,t.PUSH_MODE)}));return Object(i.I)(n,(function(t){return{message:"Token Type: ->"+t.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+t.PUSH_MODE+"<-which does not exist",type:H.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[t]}}))}(s,e))).concat(function(t){var e=[],n=Object(i.O)(t,(function(t,e,n){var r,o=e.PATTERN;return o===V.NA||(Object(i.E)(o)?t.push({str:o,idx:n,tokenType:e}):Object(i.D)(o)&&(r=o,void 0===Object(i.q)([".","\\","[","]","|","^","$","(",")","?","*","+","{"],(function(t){return-1!==r.source.indexOf(t)})))&&t.push({str:o.source,idx:n,tokenType:e})),t}),[]);return Object(i.u)(t,(function(t,r){Object(i.u)(n,(function(n){var o=n.str,a=n.idx,s=n.tokenType;if(r<a&&function(t,e){if(Object(i.D)(e)){var n=e.exec(t);return null!==n&&0===n.index}if(Object(i.B)(e))return e(t,0,[],{});if(Object(i.w)(e,"exec"))return e.exec(t,0,[],{});if("string"==typeof e)return e===t;throw Error("non exhaustive match")}(o,t.PATTERN)){var c="Token: ->"+s.name+"<- can never be matched.\nBecause it appears AFTER the Token Type ->"+t.name+"<-in the lexer's definition.\nSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE";e.push({message:c,type:H.UNREACHABLE_PATTERN,tokenTypes:[t,s]})}}))})),e}(s))}var w=/[^\\][\$]/,S=/[^\\[][\^]|^\^/;function O(t){var e=t.ignoreCase?"i":"";return new RegExp("^(?:"+t.source+")",e)}function M(t){var e=t.ignoreCase?"iy":"y";return new RegExp(""+t.source,e)}function j(t){var e=t.PATTERN;if(Object(i.D)(e))return!1;if(Object(i.B)(e))return!0;if(Object(i.w)(e,"exec"))return!0;if(Object(i.E)(e))return!1;throw Error("non exhaustive match")}function I(t){return!(!Object(i.E)(t)||1!==t.length)&&t.charCodeAt(0)}var T={test:function(t){for(var e=t.length,n=this.lastIndex;n<e;n++){var r=t.charCodeAt(n);if(10===r)return this.lastIndex=n+1,!0;if(13===r)return 10===t.charCodeAt(n+1)?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function E(t,e){if(Object(i.w)(t,"LINE_BREAKS"))return!1;if(Object(i.D)(t.PATTERN)){try{_(e,t.PATTERN)}catch(t){return{issue:H.IDENTIFY_TERMINATOR,errMsg:t.message}}return!1}if(Object(i.E)(t.PATTERN))return!1;if(j(t))return{issue:H.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function A(t){return Object(i.I)(t,(function(t){return Object(i.E)(t)&&t.length>0?t.charCodeAt(0):t}))}function L(t,e,n){void 0===t[e]?t[e]=[n]:t[e].push(n)}var C=256;function P(t){return t<C?t:k[t]}var k=[];function N(t,e){var n=t.tokenTypeIdx;return n===e.tokenTypeIdx||!0===e.isParent&&!0===e.categoryMatchesMap[n]}function R(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}var z=1,B={};function F(t){var e=function(t){for(var e=Object(i.g)(t),n=t,r=!0;r;){n=Object(i.i)(Object(i.t)(Object(i.I)(n,(function(t){return t.CATEGORIES}))));var o=Object(i.l)(n,e);e=e.concat(o),Object(i.A)(o)?r=!1:n=o}return e}(t);!function(t){Object(i.u)(t,(function(t){var e;D(t)||(B[z]=t,t.tokenTypeIdx=z++),U(t)&&!Object(i.y)(t.CATEGORIES)&&(t.CATEGORIES=[t.CATEGORIES]),U(t)||(t.CATEGORIES=[]),e=t,Object(i.w)(e,"categoryMatches")||(t.categoryMatches=[]),function(t){return Object(i.w)(t,"categoryMatchesMap")}(t)||(t.categoryMatchesMap={})}))}(e),function(t){Object(i.u)(t,(function(t){!function t(e,n){Object(i.u)(e,(function(t){n.categoryMatchesMap[t.tokenTypeIdx]=!0})),Object(i.u)(n.CATEGORIES,(function(r){var o=e.concat(n);Object(i.j)(o,r)||t(o,r)}))}([],t)}))}(e),function(t){Object(i.u)(t,(function(t){t.categoryMatches=[],Object(i.u)(t.categoryMatchesMap,(function(e,n){t.categoryMatches.push(B[n].tokenTypeIdx)}))}))}(e),Object(i.u)(e,(function(t){t.isParent=t.categoryMatches.length>0}))}function D(t){return Object(i.w)(t,"tokenTypeIdx")}function U(t){return Object(i.w)(t,"CATEGORIES")}function Z(t){return Object(i.w)(t,"tokenTypeIdx")}var H,G={buildUnableToPopLexerModeMessage:function(t){return"Unable to pop Lexer Mode after encountering Token ->"+t.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(t,e,n,r,i){return"unexpected character: ->"+t.charAt(e)+"<- at offset: "+e+", skipped "+n+" characters."}};!function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"}(H||(H={}));var W={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:G,traceInitPerf:!1,skipValidations:!1};Object.freeze(W);var V=function(){function t(t,e){var n=this;if(void 0===e&&(e=W),this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},"boolean"==typeof e)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");this.config=Object(i.K)(W,e);var r=this.config.traceInitPerf;!0===r?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):"number"==typeof r&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",(function(){var r,o=!0;n.TRACE_INIT("Lexer Config handling",(function(){if(n.config.lineTerminatorsPattern===W.lineTerminatorsPattern)n.config.lineTerminatorsPattern=T;else if(n.config.lineTerminatorCharacters===W.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(e.safeMode&&e.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');n.trackStartLines=/full|onlyStart/i.test(n.config.positionTracking),n.trackEndLines=/full/i.test(n.config.positionTracking),Object(i.y)(t)?((r={modes:{}}).modes.defaultMode=Object(i.g)(t),r.defaultMode="defaultMode"):(o=!1,r=Object(i.h)(t))})),!1===n.config.skipValidations&&(n.TRACE_INIT("performRuntimeChecks",(function(){n.lexerDefinitionErrors=n.lexerDefinitionErrors.concat(function(t,e,n){var r=[];return Object(i.w)(t,"defaultMode")||r.push({message:"A MultiMode Lexer cannot be initialized without a <defaultMode> property in its definition\n",type:H.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),Object(i.w)(t,"modes")||r.push({message:"A MultiMode Lexer cannot be initialized without a <modes> property in its definition\n",type:H.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),Object(i.w)(t,"modes")&&Object(i.w)(t,"defaultMode")&&!Object(i.w)(t.modes,t.defaultMode)&&r.push({message:"A MultiMode Lexer cannot be initialized with a defaultMode: <"+t.defaultMode+">which does not exist\n",type:H.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),Object(i.w)(t,"modes")&&Object(i.u)(t.modes,(function(t,e){Object(i.u)(t,(function(t,n){Object(i.F)(t)&&r.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<"+e+"> at index: <"+n+">\n",type:H.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})}))})),r}(r,n.trackStartLines,n.config.lineTerminatorCharacters))})),n.TRACE_INIT("performWarningRuntimeChecks",(function(){n.lexerDefinitionWarning=n.lexerDefinitionWarning.concat(function(t,e,n){var r=[],o=!1,a=Object(i.i)(Object(i.t)(Object(i.J)(t.modes,(function(t){return t})))),s=Object(i.P)(a,(function(t){return t[y]===V.NA})),c=A(n);return e&&Object(i.u)(s,(function(t){var e=E(t,c);if(!1!==e){var n={message:function(t,e){if(e.issue===H.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <"+t.name+"> Token Type\n\t Root cause: "+e.errMsg+".\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(e.issue===H.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <"+t.name+"> Token Type\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}(t,e),type:e.issue,tokenType:t};r.push(n)}else Object(i.w)(t,"LINE_BREAKS")?!0===t.LINE_BREAKS&&(o=!0):_(c,t.PATTERN)&&(o=!0)})),e&&!o&&r.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS \n\tfor details.",type:H.NO_LINE_BREAKS_FLAGS}),r}(r,n.trackStartLines,n.config.lineTerminatorCharacters))}))),r.modes=r.modes?r.modes:{},Object(i.u)(r.modes,(function(t,e){r.modes[e]=Object(i.P)(t,(function(t){return Object(i.F)(t)}))}));var s=Object(i.G)(r.modes);if(Object(i.u)(r.modes,(function(t,r){n.TRACE_INIT("Mode: <"+r+"> processing",(function(){var o;n.modes.push(r),!1===n.config.skipValidations&&n.TRACE_INIT("validatePatterns",(function(){n.lexerDefinitionErrors=n.lexerDefinitionErrors.concat(x(t,s))})),Object(i.A)(n.lexerDefinitionErrors)&&(F(t),n.TRACE_INIT("analyzeTokenTypes",(function(){o=function(t,e){var n,r=(e=Object(i.k)(e,{useSticky:b,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"],tracer:function(t,e){return e()}})).tracer;r("initCharCodeToOptimizedIndexMap",(function(){!function(){if(Object(i.A)(k)){k=new Array(65536);for(var t=0;t<65536;t++)k[t]=t>255?255+~~(t/255):t}}()})),r("Reject Lexer.NA",(function(){n=Object(i.P)(t,(function(t){return t[y]===V.NA}))}));var o,a,s,c,l,u,h,p,m,v,g,x=!1;r("Transform Patterns",(function(){x=!1,o=Object(i.I)(n,(function(t){var n=t[y];if(Object(i.D)(n)){var r=n.source;return 1!==r.length||"^"===r||"$"===r||"."===r||n.ignoreCase?2!==r.length||"\\"!==r[0]||Object(i.j)(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],r[1])?e.useSticky?M(n):O(n):r[1]:r}if(Object(i.B)(n))return x=!0,{exec:n};if(Object(i.w)(n,"exec"))return x=!0,n;if("string"==typeof n){if(1===n.length)return n;var o=n.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),a=new RegExp(o);return e.useSticky?M(a):O(a)}throw Error("non exhaustive match")}))})),r("misc mapping",(function(){a=Object(i.I)(n,(function(t){return t.tokenTypeIdx})),s=Object(i.I)(n,(function(t){var e=t.GROUP;if(e!==V.SKIPPED){if(Object(i.E)(e))return e;if(Object(i.F)(e))return!1;throw Error("non exhaustive match")}})),c=Object(i.I)(n,(function(t){var e=t.LONGER_ALT;if(e)return Object(i.x)(n,e)})),l=Object(i.I)(n,(function(t){return t.PUSH_MODE})),u=Object(i.I)(n,(function(t){return Object(i.w)(t,"POP_MODE")}))})),r("Line Terminator Handling",(function(){var t=A(e.lineTerminatorCharacters);h=Object(i.I)(n,(function(t){return!1})),"onlyOffset"!==e.positionTracking&&(h=Object(i.I)(n,(function(e){return Object(i.w)(e,"LINE_BREAKS")?e.LINE_BREAKS:!1===E(e,t)?_(t,e.PATTERN):void 0})))})),r("Misc Mapping #2",(function(){p=Object(i.I)(n,j),m=Object(i.I)(o,I),v=Object(i.O)(n,(function(t,e){var n=e.GROUP;return Object(i.E)(n)&&n!==V.SKIPPED&&(t[n]=[]),t}),{}),g=Object(i.I)(o,(function(t,e){return{pattern:o[e],longerAlt:c[e],canLineTerminator:h[e],isCustom:p[e],short:m[e],group:s[e],push:l[e],pop:u[e],tokenTypeIdx:a[e],tokenType:n[e]}}))}));var w=!0,S=[];return e.safeMode||r("First Char Optimization",(function(){S=Object(i.O)(n,(function(t,n,r){if("string"==typeof n.PATTERN){var o=P(n.PATTERN.charCodeAt(0));L(t,o,g[r])}else if(Object(i.y)(n.START_CHARS_HINT)){var a;Object(i.u)(n.START_CHARS_HINT,(function(e){var n=P("string"==typeof e?e.charCodeAt(0):e);a!==n&&(a=n,L(t,n,g[r]))}))}else if(Object(i.D)(n.PATTERN))if(n.PATTERN.unicode)w=!1,e.ensureOptimizations&&Object(i.c)(d+"\tUnable to analyze < "+n.PATTERN.toString()+" > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE");else{var s=f(n.PATTERN,e.ensureOptimizations);Object(i.A)(s)&&(w=!1),Object(i.u)(s,(function(e){L(t,e,g[r])}))}else e.ensureOptimizations&&Object(i.c)(d+"\tTokenType: <"+n.name+"> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),w=!1;return t}),[])})),r("ArrayPacking",(function(){S=Object(i.L)(S)})),{emptyGroups:v,patternIdxToConfig:g,charCodeToPatternIdxToConfig:S,hasCustom:x,canBeOptimized:w}}(t,{lineTerminatorCharacters:n.config.lineTerminatorCharacters,positionTracking:e.positionTracking,ensureOptimizations:e.ensureOptimizations,safeMode:e.safeMode,tracer:n.TRACE_INIT.bind(n)})})),n.patternIdxToConfig[r]=o.patternIdxToConfig,n.charCodeToPatternIdxToConfig[r]=o.charCodeToPatternIdxToConfig,n.emptyGroups=Object(i.K)(n.emptyGroups,o.emptyGroups),n.hasCustom=o.hasCustom||n.hasCustom,n.canModeBeOptimized[r]=o.canBeOptimized)}))})),n.defaultMode=r.defaultMode,!Object(i.A)(n.lexerDefinitionErrors)&&!n.config.deferDefinitionErrorsHandling){var c=Object(i.I)(n.lexerDefinitionErrors,(function(t){return t.message})).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+c)}Object(i.u)(n.lexerDefinitionWarning,(function(t){Object(i.d)(t.message)})),n.TRACE_INIT("Choosing sub-methods implementations",(function(){if(b?(n.chopInput=i.a,n.match=n.matchWithTest):(n.updateLastIndex=i.b,n.match=n.matchWithExec),o&&(n.handleModes=i.b),!1===n.trackStartLines&&(n.computeNewColumn=i.a),!1===n.trackEndLines&&(n.updateTokenEndLineColumnLocation=i.b),/full/i.test(n.config.positionTracking))n.createTokenInstance=n.createFullToken;else if(/onlyStart/i.test(n.config.positionTracking))n.createTokenInstance=n.createStartOnlyToken;else{if(!/onlyOffset/i.test(n.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'+n.config.positionTracking+'"');n.createTokenInstance=n.createOffsetOnlyToken}n.hasCustom?(n.addToken=n.addTokenUsingPush,n.handlePayload=n.handlePayloadWithCustom):(n.addToken=n.addTokenUsingMemberAccess,n.handlePayload=n.handlePayloadNoCustom)})),n.TRACE_INIT("Failed Optimization Warnings",(function(){var t=Object(i.O)(n.canModeBeOptimized,(function(t,e,n){return!1===e&&t.push(n),t}),[]);if(e.ensureOptimizations&&!Object(i.A)(t))throw Error("Lexer Modes: < "+t.join(", ")+' > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')})),n.TRACE_INIT("clearRegExpParserCache",(function(){a={}})),n.TRACE_INIT("toFastProperties",(function(){Object(i.S)(n)}))}))}return t.prototype.tokenize=function(t,e){if(void 0===e&&(e=this.defaultMode),!Object(i.A)(this.lexerDefinitionErrors)){var n=Object(i.I)(this.lexerDefinitionErrors,(function(t){return t.message})).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+n)}return this.tokenizeInternal(t,e)},t.prototype.tokenizeInternal=function(t,e){var n,r,o,a,s,c,l,u,d,f,h,p,m,v,_,g,y,b=this,x=t,w=x.length,S=0,O=0,M=this.hasCustom?0:Math.floor(t.length/10),j=new Array(M),I=[],T=this.trackStartLines?1:void 0,E=this.trackStartLines?1:void 0,A=(_=this.emptyGroups,g={},y=Object(i.G)(_),Object(i.u)(y,(function(t){var e=_[t];if(!Object(i.y)(e))throw Error("non exhaustive match");g[t]=[]})),g),L=this.trackStartLines,C=this.config.lineTerminatorsPattern,k=0,N=[],R=[],z=[],B=[];Object.freeze(B);var F=void 0;function D(){return N}function U(t){var e=P(t),n=R[e];return void 0===n?B:n}var Z,H=function(t){if(1===z.length&&void 0===t.tokenType.PUSH_MODE){var e=b.config.errorMessageProvider.buildUnableToPopLexerModeMessage(t);I.push({offset:t.startOffset,line:void 0!==t.startLine?t.startLine:void 0,column:void 0!==t.startColumn?t.startColumn:void 0,length:t.image.length,message:e})}else{z.pop();var n=Object(i.H)(z);N=b.patternIdxToConfig[n],R=b.charCodeToPatternIdxToConfig[n],k=N.length;var r=b.canModeBeOptimized[n]&&!1===b.config.safeMode;F=R&&r?U:D}};function G(t){z.push(t),R=this.charCodeToPatternIdxToConfig[t],N=this.patternIdxToConfig[t],k=N.length,k=N.length;var e=this.canModeBeOptimized[t]&&!1===this.config.safeMode;F=R&&e?U:D}for(G.call(this,e);S<w;){s=null;var W=x.charCodeAt(S),V=F(W),q=V.length;for(n=0;n<q;n++){var Y=(Z=V[n]).pattern;if(c=null,!1!==(it=Z.short)?W===it&&(s=Y):!0===Z.isCustom?null!==(v=Y.exec(x,S,j,A))?(s=v[0],void 0!==v.payload&&(c=v.payload)):s=null:(this.updateLastIndex(Y,S),s=this.match(Y,t,S)),null!==s){if(void 0!==(a=Z.longerAlt)){var X=N[a],K=X.pattern;l=null,!0===X.isCustom?null!==(v=K.exec(x,S,j,A))?(o=v[0],void 0!==v.payload&&(l=v.payload)):o=null:(this.updateLastIndex(K,S),o=this.match(K,t,S)),o&&o.length>s.length&&(s=o,c=l,Z=X)}break}}if(null!==s){if(u=s.length,void 0!==(d=Z.group)&&(f=Z.tokenTypeIdx,h=this.createTokenInstance(s,S,f,Z.tokenType,T,E,u),this.handlePayload(h,c),!1===d?O=this.addToken(j,O,h):A[d].push(h)),t=this.chopInput(t,u),S+=u,E=this.computeNewColumn(E,u),!0===L&&!0===Z.canLineTerminator){var J=0,Q=void 0,$=void 0;C.lastIndex=0;do{!0===(Q=C.test(s))&&($=C.lastIndex-1,J++)}while(!0===Q);0!==J&&(T+=J,E=u-$,this.updateTokenEndLineColumnLocation(h,d,$,J,T,E,u))}this.handleModes(Z,H,G,h)}else{for(var tt=S,et=T,nt=E,rt=!1;!rt&&S<w;)for(x.charCodeAt(S),t=this.chopInput(t,1),S++,r=0;r<k;r++){var it,ot=N[r];if(Y=ot.pattern,!1!==(it=ot.short)?x.charCodeAt(S)===it&&(rt=!0):!0===ot.isCustom?rt=null!==Y.exec(x,S,j,A):(this.updateLastIndex(Y,S),rt=null!==Y.exec(t)),!0===rt)break}p=S-tt,m=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(x,tt,p,et,nt),I.push({offset:tt,line:et,column:nt,length:p,message:m})}}return this.hasCustom||(j.length=O),{tokens:j,groups:A,errors:I}},t.prototype.handleModes=function(t,e,n,r){if(!0===t.pop){var i=t.push;e(r),void 0!==i&&n.call(this,i)}else void 0!==t.push&&n.call(this,t.push)},t.prototype.chopInput=function(t,e){return t.substring(e)},t.prototype.updateLastIndex=function(t,e){t.lastIndex=e},t.prototype.updateTokenEndLineColumnLocation=function(t,e,n,r,i,o,a){var s,c;void 0!==e&&(c=(s=n===a-1)?-1:0,1===r&&!0===s||(t.endLine=i+c,t.endColumn=o-1-c))},t.prototype.computeNewColumn=function(t,e){return t+e},t.prototype.createTokenInstance=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return null},t.prototype.createOffsetOnlyToken=function(t,e,n,r){return{image:t,startOffset:e,tokenTypeIdx:n,tokenType:r}},t.prototype.createStartOnlyToken=function(t,e,n,r,i,o){return{image:t,startOffset:e,startLine:i,startColumn:o,tokenTypeIdx:n,tokenType:r}},t.prototype.createFullToken=function(t,e,n,r,i,o,a){return{image:t,startOffset:e,endOffset:e+a-1,startLine:i,endLine:i,startColumn:o,endColumn:o+a-1,tokenTypeIdx:n,tokenType:r}},t.prototype.addToken=function(t,e,n){return 666},t.prototype.addTokenUsingPush=function(t,e,n){return t.push(n),e},t.prototype.addTokenUsingMemberAccess=function(t,e,n){return t[e]=n,++e},t.prototype.handlePayload=function(t,e){},t.prototype.handlePayloadNoCustom=function(t,e){},t.prototype.handlePayloadWithCustom=function(t,e){null!==e&&(t.payload=e)},t.prototype.match=function(t,e,n){return null},t.prototype.matchWithTest=function(t,e,n){return!0===t.test(e)?e.substring(n,t.lastIndex):null},t.prototype.matchWithExec=function(t,e){var n=t.exec(e);return null!==n?n[0]:n},t.prototype.TRACE_INIT=function(t,e){if(!0===this.traceInitPerf){this.traceInitIndent++;var n=new Array(this.traceInitIndent+1).join("\t");this.traceInitIndent<this.traceInitMaxIdent&&console.log(n+"--\x3e <"+t+">");var r=Object(i.R)(e),o=r.time,a=r.value,s=o>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(n+"<-- <"+t+"> time: "+o+"ms"),this.traceInitIndent--,a}return e()},t.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",t.NA=/NOT_APPLICABLE/,t}();function q(t){return X(t)?t.LABEL:t.name}function Y(t){return t.name}function X(t){return Object(i.E)(t.LABEL)&&""!==t.LABEL}function K(t){return function(t){var e=t.pattern,n={};if(n.name=t.name,Object(i.F)(e)||(n.PATTERN=e),Object(i.w)(t,"parent"))throw"The parent property is no longer supported.\nSee: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.";return Object(i.w)(t,"categories")&&(n.CATEGORIES=t.categories),F([n]),Object(i.w)(t,"label")&&(n.LABEL=t.label),Object(i.w)(t,"group")&&(n.GROUP=t.group),Object(i.w)(t,"pop_mode")&&(n.POP_MODE=t.pop_mode),Object(i.w)(t,"push_mode")&&(n.PUSH_MODE=t.push_mode),Object(i.w)(t,"longer_alt")&&(n.LONGER_ALT=t.longer_alt),Object(i.w)(t,"line_breaks")&&(n.LINE_BREAKS=t.line_breaks),Object(i.w)(t,"start_chars_hint")&&(n.START_CHARS_HINT=t.start_chars_hint),n}(t)}var J=K({name:"EOF",pattern:V.NA});function Q(t,e,n,r,i,o,a,s){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:o,startColumn:a,endColumn:s,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function $(t,e){return N(t,e)}F([J]);var tt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),et=function(){function t(t){this.definition=t}return t.prototype.accept=function(t){t.visit(this),Object(i.u)(this.definition,(function(e){e.accept(t)}))},t}(),nt=function(t){function e(e){var n=t.call(this,[])||this;return n.idx=1,Object(i.f)(n,Object(i.N)(e,(function(t){return void 0!==t}))),n}return tt(e,t),Object.defineProperty(e.prototype,"definition",{get:function(){return void 0!==this.referencedRule?this.referencedRule.definition:[]},set:function(t){},enumerable:!0,configurable:!0}),e.prototype.accept=function(t){t.visit(this)},e}(et),rt=function(t){function e(e){var n=t.call(this,e.definition)||this;return n.orgText="",Object(i.f)(n,Object(i.N)(e,(function(t){return void 0!==t}))),n}return tt(e,t),e}(et),it=function(t){function e(e){var n=t.call(this,e.definition)||this;return n.ignoreAmbiguities=!1,Object(i.f)(n,Object(i.N)(e,(function(t){return void 0!==t}))),n}return tt(e,t),e}(et),ot=function(t){function e(e){var n=t.call(this,e.definition)||this;return n.idx=1,Object(i.f)(n,Object(i.N)(e,(function(t){return void 0!==t}))),n}return tt(e,t),e}(et),at=function(t){function e(e){var n=t.call(this,e.definition)||this;return n.idx=1,Object(i.f)(n,Object(i.N)(e,(function(t){return void 0!==t}))),n}return tt(e,t),e}(et),st=function(t){function e(e){var n=t.call(this,e.definition)||this;return n.idx=1,Object(i.f)(n,Object(i.N)(e,(function(t){return void 0!==t}))),n}return tt(e,t),e}(et),ct=function(t){function e(e){var n=t.call(this,e.definition)||this;return n.idx=1,Object(i.f)(n,Object(i.N)(e,(function(t){return void 0!==t}))),n}return tt(e,t),e}(et),lt=function(t){function e(e){var n=t.call(this,e.definition)||this;return n.idx=1,Object(i.f)(n,Object(i.N)(e,(function(t){return void 0!==t}))),n}return tt(e,t),e}(et),ut=function(t){function e(e){var n=t.call(this,e.definition)||this;return n.idx=1,n.ignoreAmbiguities=!1,n.hasPredicates=!1,Object(i.f)(n,Object(i.N)(e,(function(t){return void 0!==t}))),n}return tt(e,t),e}(et),dt=function(){function t(t){this.idx=1,Object(i.f)(this,Object(i.N)(t,(function(t){return void 0!==t})))}return t.prototype.accept=function(t){t.visit(this)},t}();function ft(t){return Object(i.I)(t,ht)}function ht(t){function e(t){return Object(i.I)(t,ht)}if(t instanceof nt)return{type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};if(t instanceof it)return{type:"Alternative",definition:e(t.definition)};if(t instanceof ot)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof at)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof st)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:ht(new dt({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof lt)return{type:"RepetitionWithSeparator",idx:t.idx,separator:ht(new dt({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof ct)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof ut)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof dt){var n={type:"Terminal",name:t.terminalType.name,label:q(t.terminalType),idx:t.idx},r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=Object(i.D)(r)?r.source:r),n}if(t instanceof rt)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}var pt=function(){function t(){}return t.prototype.walk=function(t,e){var n=this;void 0===e&&(e=[]),Object(i.u)(t.definition,(function(r,o){var a=Object(i.m)(t.definition,o+1);if(r instanceof nt)n.walkProdRef(r,a,e);else if(r instanceof dt)n.walkTerminal(r,a,e);else if(r instanceof it)n.walkFlat(r,a,e);else if(r instanceof ot)n.walkOption(r,a,e);else if(r instanceof at)n.walkAtLeastOne(r,a,e);else if(r instanceof st)n.walkAtLeastOneSep(r,a,e);else if(r instanceof lt)n.walkManySep(r,a,e);else if(r instanceof ct)n.walkMany(r,a,e);else{if(!(r instanceof ut))throw Error("non exhaustive match");n.walkOr(r,a,e)}}))},t.prototype.walkTerminal=function(t,e,n){},t.prototype.walkProdRef=function(t,e,n){},t.prototype.walkFlat=function(t,e,n){var r=e.concat(n);this.walk(t,r)},t.prototype.walkOption=function(t,e,n){var r=e.concat(n);this.walk(t,r)},t.prototype.walkAtLeastOne=function(t,e,n){var r=[new ot({definition:t.definition})].concat(e,n);this.walk(t,r)},t.prototype.walkAtLeastOneSep=function(t,e,n){var r=mt(t,e,n);this.walk(t,r)},t.prototype.walkMany=function(t,e,n){var r=[new ot({definition:t.definition})].concat(e,n);this.walk(t,r)},t.prototype.walkManySep=function(t,e,n){var r=mt(t,e,n);this.walk(t,r)},t.prototype.walkOr=function(t,e,n){var r=this,o=e.concat(n);Object(i.u)(t.definition,(function(t){var e=new it({definition:[t]});r.walk(e,o)}))},t}();function mt(t,e,n){return[new ot({definition:[new dt({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}var vt=function(){function t(){}return t.prototype.visit=function(t){var e=t;switch(e.constructor){case nt:return this.visitNonTerminal(e);case it:return this.visitAlternative(e);case ot:return this.visitOption(e);case at:return this.visitRepetitionMandatory(e);case st:return this.visitRepetitionMandatoryWithSeparator(e);case lt:return this.visitRepetitionWithSeparator(e);case ct:return this.visitRepetition(e);case ut:return this.visitAlternation(e);case dt:return this.visitTerminal(e);case rt:return this.visitRule(e);default:throw Error("non exhaustive match")}},t.prototype.visitNonTerminal=function(t){},t.prototype.visitAlternative=function(t){},t.prototype.visitOption=function(t){},t.prototype.visitRepetition=function(t){},t.prototype.visitRepetitionMandatory=function(t){},t.prototype.visitRepetitionMandatoryWithSeparator=function(t){},t.prototype.visitRepetitionWithSeparator=function(t){},t.prototype.visitAlternation=function(t){},t.prototype.visitTerminal=function(t){},t.prototype.visitRule=function(t){},t}(),_t=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function gt(t,e){return void 0===e&&(e=[]),!!(t instanceof ot||t instanceof ct||t instanceof lt)||(t instanceof ut?Object(i.Q)(t.definition,(function(t){return gt(t,e)})):!(t instanceof nt&&Object(i.j)(e,t))&&t instanceof et&&(t instanceof nt&&e.push(t),Object(i.o)(t.definition,(function(t){return gt(t,e)}))))}function yt(t){if(t instanceof nt)return"SUBRULE";if(t instanceof ot)return"OPTION";if(t instanceof ut)return"OR";if(t instanceof at)return"AT_LEAST_ONE";if(t instanceof st)return"AT_LEAST_ONE_SEP";if(t instanceof lt)return"MANY_SEP";if(t instanceof ct)return"MANY";if(t instanceof dt)return"CONSUME";throw Error("non exhaustive match")}var bt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.separator="-",e.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},e}return _t(e,t),e.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},e.prototype.visitTerminal=function(t){var e=t.terminalType.name+this.separator+"Terminal";Object(i.w)(this.dslMethods,e)||(this.dslMethods[e]=[]),this.dslMethods[e].push(t)},e.prototype.visitNonTerminal=function(t){var e=t.nonTerminalName+this.separator+"Terminal";Object(i.w)(this.dslMethods,e)||(this.dslMethods[e]=[]),this.dslMethods[e].push(t)},e.prototype.visitOption=function(t){this.dslMethods.option.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.dslMethods.repetitionWithSeparator.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.dslMethods.repetitionMandatory.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.dslMethods.repetitionMandatoryWithSeparator.push(t)},e.prototype.visitRepetition=function(t){this.dslMethods.repetition.push(t)},e.prototype.visitAlternation=function(t){this.dslMethods.alternation.push(t)},e}(vt),xt=new bt;function wt(t){if(t instanceof nt)return wt(t.referencedRule);if(t instanceof dt)return[t.terminalType];if(function(t){return t instanceof it||t instanceof ot||t instanceof ct||t instanceof at||t instanceof st||t instanceof lt||t instanceof dt||t instanceof rt}(t))return function(t){for(var e,n=[],r=t.definition,o=0,a=r.length>o,s=!0;a&&s;)s=gt(e=r[o]),n=n.concat(wt(e)),o+=1,a=r.length>o;return Object(i.T)(n)}(t);if(function(t){return t instanceof ut}(t))return function(t){var e=Object(i.I)(t.definition,(function(t){return wt(t)}));return Object(i.T)(Object(i.t)(e))}(t);throw Error("non exhaustive match")}var St=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ot=function(t){function e(e){var n=t.call(this)||this;return n.topProd=e,n.follows={},n}return St(e,t),e.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},e.prototype.walkTerminal=function(t,e,n){},e.prototype.walkProdRef=function(t,e,n){var r,i,o=(r=t.referencedRule,i=t.idx,r.name+i+"_~IN~_"+this.topProd.name),a=e.concat(n),s=wt(new it({definition:a}));this.follows[o]=s},e}(pt),Mt={buildMismatchTokenMessage:function(t){var e=t.expected,n=t.actual;return t.previous,t.ruleName,"Expecting "+(X(e)?"--\x3e "+q(e)+" <--":"token of type --\x3e "+e.name+" <--")+" but found --\x3e '"+n.image+"' <--"},buildNotAllInputParsedMessage:function(t){var e=t.firstRedundant;return t.ruleName,"Redundant input, expecting EOF but found: "+e.image},buildNoViableAltMessage:function(t){var e=t.expectedPathsPerAlt,n=t.actual,r=(t.previous,t.customUserDescription),o=(t.ruleName,"\nbut found: '"+Object(i.s)(n).image+"'");if(r)return"Expecting: "+r+o;var a=Object(i.O)(e,(function(t,e){return t.concat(e)}),[]),s=Object(i.I)(a,(function(t){return"["+Object(i.I)(t,(function(t){return q(t)})).join(", ")+"]"}));return"Expecting: one of these possible Token sequences:\n"+Object(i.I)(s,(function(t,e){return"  "+(e+1)+". "+t})).join("\n")+o},buildEarlyExitMessage:function(t){var e=t.expectedIterationPaths,n=t.actual,r=t.customUserDescription,o=(t.ruleName,"\nbut found: '"+Object(i.s)(n).image+"'");return r?"Expecting: "+r+o:"Expecting: expecting at least one iteration which starts with one of these possible Token sequences::\n  <"+Object(i.I)(e,(function(t){return"["+Object(i.I)(t,(function(t){return q(t)})).join(",")+"]"})).join(" ,")+">"+o}};Object.freeze(Mt);var jt={buildRuleNotFoundError:function(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+"<-\ninside top level rule: ->"+t.name+"<-"}},It={buildDuplicateFoundError:function(t,e){var n,r=t.name,o=Object(i.s)(e),a=o.idx,s=yt(o),c=(n=o)instanceof dt?n.terminalType.name:n instanceof nt?n.nonTerminalName:"",l="->"+s+(a>0?a:"")+"<- "+(c?"with argument: ->"+c+"<-":"")+"\n                  appears more than once ("+e.length+" times) in the top level rule: ->"+r+"<-.                  \n                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES \n                  ";return(l=l.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildNamespaceConflictError:function(t){return"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+t.name+">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(t){var e=Object(i.I)(t.prefixPath,(function(t){return q(t)})).join(", "),n=0===t.alternation.idx?"":t.alternation.idx;return"Ambiguous alternatives: <"+t.ambiguityIndices.join(" ,")+"> due to common lookahead prefix\nin <OR"+n+"> inside <"+t.topLevelRule.name+"> Rule,\n<"+e+"> may appears as a prefix path in all these alternatives.\nSee: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(t){var e=Object(i.I)(t.prefixPath,(function(t){return q(t)})).join(", "),n=0===t.alternation.idx?"":t.alternation.idx;return"Ambiguous Alternatives Detected: <"+t.ambiguityIndices.join(" ,")+"> in <OR"+n+"> inside <"+t.topLevelRule.name+"> Rule,\n<"+e+"> may appears as a prefix path in all these alternatives.\nSee: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES\nFor Further details."},buildEmptyRepetitionError:function(t){var e=yt(t.repetition);return 0!==t.repetition.idx&&(e+=t.repetition.idx),"The repetition <"+e+"> within Rule <"+t.topLevelRule.name+"> can never consume any tokens.\nThis could lead to an infinite loop."},buildTokenNameError:function(t){return"Invalid Grammar Token name: ->"+t.tokenType.name+"<- it must match the pattern: ->"+t.expectedPattern.toString()+"<-"},buildEmptyAlternationError:function(t){return"Ambiguous empty alternative: <"+(t.emptyChoiceIdx+1)+"> in <OR"+t.alternation.idx+"> inside <"+t.topLevelRule.name+"> Rule.\nOnly the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(t){return"An Alternation cannot have more than 256 alternatives:\n<OR"+t.alternation.idx+"> inside <"+t.topLevelRule.name+"> Rule.\n has "+(t.alternation.definition.length+1)+" alternatives."},buildLeftRecursionError:function(t){var e=t.topLevelRule.name;return"Left Recursion found in grammar.\nrule: <"+e+"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is: \n "+e+" --\x3e "+i.I(t.leftRecursionPath,(function(t){return t.name})).concat([e]).join(" --\x3e ")+"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring."},buildInvalidRuleNameError:function(t){return"Invalid grammar rule name: ->"+t.topLevelRule.name+"<- it must match the pattern: ->"+t.expectedPattern.toString()+"<-"},buildDuplicateRuleNameError:function(t){return"Duplicate definition, rule: ->"+(t.topLevelRule instanceof rt?t.topLevelRule.name:t.topLevelRule)+"<- is already defined in the grammar: ->"+t.grammarName+"<-"}},Tt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Et=function(t){function e(e,n){var r=t.call(this)||this;return r.nameToTopRule=e,r.errMsgProvider=n,r.errors=[],r}return Tt(e,t),e.prototype.resolveRefs=function(){var t=this;Object(i.u)(Object(i.U)(this.nameToTopRule),(function(e){t.currTopLevel=e,e.accept(t)}))},e.prototype.visitNonTerminal=function(t){var e=this.nameToTopRule[t.nonTerminalName];if(e)t.referencedRule=e;else{var n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:n,type:qe.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}},e}(vt),At=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Lt=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.path=n,r.nextTerminalName="",r.nextTerminalOccurrence=0,r.nextTerminalName=r.path.lastTok.name,r.nextTerminalOccurrence=r.path.lastTokOccurrence,r}return At(e,t),e.prototype.walkTerminal=function(t,e,n){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){var r=e.concat(n),i=new it({definition:r});this.possibleTokTypes=wt(i),this.found=!0}},e}(function(t){function e(e,n){var r=t.call(this)||this;return r.topProd=e,r.path=n,r.possibleTokTypes=[],r.nextProductionName="",r.nextProductionOccurrence=0,r.found=!1,r.isAtEndOfPath=!1,r}return At(e,t),e.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Object(i.g)(this.path.ruleStack).reverse(),this.occurrenceStack=Object(i.g)(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},e.prototype.walk=function(e,n){void 0===n&&(n=[]),this.found||t.prototype.walk.call(this,e,n)},e.prototype.walkProdRef=function(t,e,n){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){var r=e.concat(n);this.updateExpectedNext(),this.walk(t.referencedRule,r)}},e.prototype.updateExpectedNext=function(){Object(i.A)(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},e}(pt)),Ct=function(t){function e(e,n){var r=t.call(this)||this;return r.topRule=e,r.occurrence=n,r.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},r}return At(e,t),e.prototype.startWalking=function(){return this.walk(this.topRule),this.result},e}(pt),Pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return At(e,t),e.prototype.walkMany=function(e,n,r){if(e.idx===this.occurrence){var o=Object(i.s)(n.concat(r));this.result.isEndOfRule=void 0===o,o instanceof dt&&(this.result.token=o.terminalType,this.result.occurrence=o.idx)}else t.prototype.walkMany.call(this,e,n,r)},e}(Ct),kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return At(e,t),e.prototype.walkManySep=function(e,n,r){if(e.idx===this.occurrence){var o=Object(i.s)(n.concat(r));this.result.isEndOfRule=void 0===o,o instanceof dt&&(this.result.token=o.terminalType,this.result.occurrence=o.idx)}else t.prototype.walkManySep.call(this,e,n,r)},e}(Ct),Nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return At(e,t),e.prototype.walkAtLeastOne=function(e,n,r){if(e.idx===this.occurrence){var o=Object(i.s)(n.concat(r));this.result.isEndOfRule=void 0===o,o instanceof dt&&(this.result.token=o.terminalType,this.result.occurrence=o.idx)}else t.prototype.walkAtLeastOne.call(this,e,n,r)},e}(Ct),Rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return At(e,t),e.prototype.walkAtLeastOneSep=function(e,n,r){if(e.idx===this.occurrence){var o=Object(i.s)(n.concat(r));this.result.isEndOfRule=void 0===o,o instanceof dt&&(this.result.token=o.terminalType,this.result.occurrence=o.idx)}else t.prototype.walkAtLeastOneSep.call(this,e,n,r)},e}(Ct);function zt(t,e,n){void 0===n&&(n=[]),n=Object(i.g)(n);var r=[],o=0;function a(a){var s=zt(a.concat(Object(i.m)(t,o+1)),e,n);return r.concat(s)}for(;n.length<e&&o<t.length;){var s=t[o];if(s instanceof it)return a(s.definition);if(s instanceof nt)return a(s.definition);if(s instanceof ot)r=a(s.definition);else{if(s instanceof at)return a(c=s.definition.concat([new ct({definition:s.definition})]));if(s instanceof st)return a(c=[new it({definition:s.definition}),new ct({definition:[new dt({terminalType:s.separator})].concat(s.definition)})]);if(s instanceof lt){var c=s.definition.concat([new ct({definition:[new dt({terminalType:s.separator})].concat(s.definition)})]);r=a(c)}else if(s instanceof ct)c=s.definition.concat([new ct({definition:s.definition})]),r=a(c);else{if(s instanceof ut)return Object(i.u)(s.definition,(function(t){r=a(t.definition)})),r;if(!(s instanceof dt))throw Error("non exhaustive match");n.push(s.terminalType)}}o++}return r.push({partialPath:n,suffixDef:Object(i.m)(t,o)}),r}function Bt(t,e,n,r){var o=["EXIT_NONE_TERMINAL"],a=!1,s=e.length,c=s-r-1,l=[],u=[];for(u.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Object(i.A)(u);){var d=u.pop();if("EXIT_ALTERNATIVE"!==d){var f=d.def,h=d.idx,p=d.ruleStack,m=d.occurrenceStack;if(!Object(i.A)(f)){var v=f[0];if("EXIT_NONE_TERMINAL"===v){var _={idx:h,def:Object(i.m)(f),ruleStack:Object(i.n)(p),occurrenceStack:Object(i.n)(m)};u.push(_)}else if(v instanceof dt)if(h<s-1){var g=h+1;n(e[g],v.terminalType)&&(_={idx:g,def:Object(i.m)(f),ruleStack:p,occurrenceStack:m},u.push(_))}else{if(h!==s-1)throw Error("non exhaustive match");l.push({nextTokenType:v.terminalType,nextTokenOccurrence:v.idx,ruleStack:p,occurrenceStack:m}),a=!0}else if(v instanceof nt){var y=Object(i.g)(p);y.push(v.nonTerminalName);var b=Object(i.g)(m);b.push(v.idx),_={idx:h,def:v.definition.concat(o,Object(i.m)(f)),ruleStack:y,occurrenceStack:b},u.push(_)}else if(v instanceof ot){var x={idx:h,def:Object(i.m)(f),ruleStack:p,occurrenceStack:m};u.push(x),u.push("EXIT_ALTERNATIVE");var w={idx:h,def:v.definition.concat(Object(i.m)(f)),ruleStack:p,occurrenceStack:m};u.push(w)}else if(v instanceof at){var S=new ct({definition:v.definition,idx:v.idx});_={idx:h,def:v.definition.concat([S],Object(i.m)(f)),ruleStack:p,occurrenceStack:m},u.push(_)}else if(v instanceof st){var O=new dt({terminalType:v.separator});S=new ct({definition:[O].concat(v.definition),idx:v.idx}),_={idx:h,def:v.definition.concat([S],Object(i.m)(f)),ruleStack:p,occurrenceStack:m},u.push(_)}else if(v instanceof lt){x={idx:h,def:Object(i.m)(f),ruleStack:p,occurrenceStack:m},u.push(x),u.push("EXIT_ALTERNATIVE"),O=new dt({terminalType:v.separator});var M=new ct({definition:[O].concat(v.definition),idx:v.idx});w={idx:h,def:v.definition.concat([M],Object(i.m)(f)),ruleStack:p,occurrenceStack:m},u.push(w)}else if(v instanceof ct)x={idx:h,def:Object(i.m)(f),ruleStack:p,occurrenceStack:m},u.push(x),u.push("EXIT_ALTERNATIVE"),M=new ct({definition:v.definition,idx:v.idx}),w={idx:h,def:v.definition.concat([M],Object(i.m)(f)),ruleStack:p,occurrenceStack:m},u.push(w);else if(v instanceof ut)for(var j=v.definition.length-1;j>=0;j--){var I={idx:h,def:v.definition[j].definition.concat(Object(i.m)(f)),ruleStack:p,occurrenceStack:m};u.push(I),u.push("EXIT_ALTERNATIVE")}else if(v instanceof it)u.push({idx:h,def:v.definition.concat(Object(i.m)(f)),ruleStack:p,occurrenceStack:m});else{if(!(v instanceof rt))throw Error("non exhaustive match");u.push(Ft(v,h,p,m))}}}else a&&Object(i.H)(u).idx<=c&&u.pop()}return l}function Ft(t,e,n,r){var o=Object(i.g)(n);o.push(t.name);var a=Object(i.g)(r);return a.push(1),{idx:e,def:t.definition,ruleStack:o,occurrenceStack:a}}var Dt,Ut=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"}(Dt||(Dt={}));var Zt=function(t){function e(e,n,r){var i=t.call(this)||this;return i.topProd=e,i.targetOccurrence=n,i.targetProdType=r,i}return Ut(e,t),e.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},e.prototype.checkIsTarget=function(t,e,n,r){return t.idx===this.targetOccurrence&&this.targetProdType===e&&(this.restDef=n.concat(r),!0)},e.prototype.walkOption=function(e,n,r){this.checkIsTarget(e,Dt.OPTION,n,r)||t.prototype.walkOption.call(this,e,n,r)},e.prototype.walkAtLeastOne=function(e,n,r){this.checkIsTarget(e,Dt.REPETITION_MANDATORY,n,r)||t.prototype.walkOption.call(this,e,n,r)},e.prototype.walkAtLeastOneSep=function(e,n,r){this.checkIsTarget(e,Dt.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||t.prototype.walkOption.call(this,e,n,r)},e.prototype.walkMany=function(e,n,r){this.checkIsTarget(e,Dt.REPETITION,n,r)||t.prototype.walkOption.call(this,e,n,r)},e.prototype.walkManySep=function(e,n,r){this.checkIsTarget(e,Dt.REPETITION_WITH_SEPARATOR,n,r)||t.prototype.walkOption.call(this,e,n,r)},e}(pt),Ht=function(t){function e(e,n,r){var i=t.call(this)||this;return i.targetOccurrence=e,i.targetProdType=n,i.targetRef=r,i.result=[],i}return Ut(e,t),e.prototype.checkIsTarget=function(t,e){t.idx!==this.targetOccurrence||this.targetProdType!==e||void 0!==this.targetRef&&t!==this.targetRef||(this.result=t.definition)},e.prototype.visitOption=function(t){this.checkIsTarget(t,Dt.OPTION)},e.prototype.visitRepetition=function(t){this.checkIsTarget(t,Dt.REPETITION)},e.prototype.visitRepetitionMandatory=function(t){this.checkIsTarget(t,Dt.REPETITION_MANDATORY)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.checkIsTarget(t,Dt.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.visitRepetitionWithSeparator=function(t){this.checkIsTarget(t,Dt.REPETITION_WITH_SEPARATOR)},e.prototype.visitAlternation=function(t){this.checkIsTarget(t,Dt.ALTERNATION)},e}(vt);function Gt(t){for(var e=new Array(t),n=0;n<t;n++)e[n]=[];return e}function Wt(t){for(var e=[""],n=0;n<t.length;n++){for(var r=t[n],i=[],o=0;o<e.length;o++){var a=e[o];i.push(a+"_"+r.tokenTypeIdx);for(var s=0;s<r.categoryMatches.length;s++){var c="_"+r.categoryMatches[s];i.push(a+c)}}e=i}return e}function Vt(t,e,n){for(var r=0;r<t.length;r++)if(r!==n)for(var i=t[r],o=0;o<e.length;o++)if(!0===i[e[o]])return!1;return!0}function qt(t,e){for(var n=Object(i.I)(t,(function(t){return zt([t],1)})),r=Gt(n.length),o=Object(i.I)(n,(function(t){var e={};return Object(i.u)(t,(function(t){var n=Wt(t.partialPath);Object(i.u)(n,(function(t){e[t]=!0}))})),e})),a=n,s=1;s<=e;s++){var c=a;a=Gt(c.length);for(var l=function(t){for(var n=c[t],l=0;l<n.length;l++){var u=n[l].partialPath,d=n[l].suffixDef,f=Wt(u);if(Vt(o,f,t)||Object(i.A)(d)||u.length===e){var h=r[t];if(!1===Kt(h,u)){h.push(u);for(var p=0;p<f.length;p++){var m=f[p];o[t][m]=!0}}}else{var v=zt(d,s+1,u);a[t]=a[t].concat(v),Object(i.u)(v,(function(e){var n=Wt(e.partialPath);Object(i.u)(n,(function(e){o[t][e]=!0}))}))}}},u=0;u<c.length;u++)l(u)}return r}function Yt(t,e,n,r){var i=new Ht(t,Dt.ALTERNATION,r);return e.accept(i),qt(i.result,n)}function Xt(t,e,n,r){var i=new Ht(t,n);e.accept(i);var o=i.result,a=new Zt(e,t,n).startWalking();return qt([new it({definition:o}),new it({definition:a})],r)}function Kt(t,e){t:for(var n=0;n<t.length;n++){var r=t[n];if(r.length===e.length){for(var i=0;i<r.length;i++){var o=e[i],a=r[i];if(0==(o===a||void 0!==a.categoryMatchesMap[o.tokenTypeIdx]))continue t}return!0}}return!1}function Jt(t){return Object(i.o)(t,(function(t){return Object(i.o)(t,(function(t){return Object(i.o)(t,(function(t){return Object(i.A)(t.categoryMatches)}))}))}))}var Qt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function $t(t){return yt(t)+"_#_"+t.idx+"_#_"+te(t)}function te(t){return t instanceof dt?t.terminalType.name:t instanceof nt?t.nonTerminalName:""}var ee=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.allProductions=[],e}return Qt(e,t),e.prototype.visitNonTerminal=function(t){this.allProductions.push(t)},e.prototype.visitOption=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e.prototype.visitAlternation=function(t){this.allProductions.push(t)},e.prototype.visitTerminal=function(t){this.allProductions.push(t)},e}(vt),ne=/^[a-zA-Z_]\w*$/,re=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.alternations=[],e}return Qt(e,t),e.prototype.visitAlternation=function(t){this.alternations.push(t)},e}(vt),ie=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.allProductions=[],e}return Qt(e,t),e.prototype.visitRepetitionWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatory=function(t){this.allProductions.push(t)},e.prototype.visitRepetitionMandatoryWithSeparator=function(t){this.allProductions.push(t)},e.prototype.visitRepetition=function(t){this.allProductions.push(t)},e}(vt);function oe(t){t=Object(i.k)(t,{errMsgProvider:jt});var e,n,r,o={};return Object(i.u)(t.rules,(function(t){o[t.name]=t})),e=o,n=t.errMsgProvider,(r=new Et(e,n)).resolveRefs(),r.errors}function ae(t){return function(t,e,n,r,o){var a=i.I(t,(function(t){return function(t,e){var n=new ee;t.accept(n);var r=n.allProductions,o=i.v(r,$t),a=i.N(o,(function(t){return t.length>1}));return i.I(i.U(a),(function(n){var r=i.s(n),o=e.buildDuplicateFoundError(t,n),a=yt(r),s={message:o,type:qe.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:a,occurrence:r.idx},c=te(r);return c&&(s.parameter=c),s}))}(t,r)})),s=i.I(t,(function(t){return function t(e,n,r,o){void 0===o&&(o=[]);var a=[],s=function t(e){var n=[];if(i.A(e))return n;var r=i.s(e);if(r instanceof nt)n.push(r.referencedRule);else if(r instanceof it||r instanceof ot||r instanceof at||r instanceof st||r instanceof lt||r instanceof ct)n=n.concat(t(r.definition));else if(r instanceof ut)n=i.t(i.I(r.definition,(function(e){return t(e.definition)})));else if(!(r instanceof dt))throw Error("non exhaustive match");var o=gt(r),a=e.length>1;if(o&&a){var s=i.m(e);return n.concat(t(s))}return n}(n.definition);if(i.A(s))return[];var c=e.name;i.j(s,e)&&a.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:o}),type:qe.LEFT_RECURSION,ruleName:c});var l=i.l(s,o.concat([e])),u=i.I(l,(function(n){var a=i.g(o);return a.push(n),t(e,n,r,a)}));return a.concat(i.t(u))}(t,t,r)})),c=[],l=[],u=[];Object(i.o)(s,i.A)&&(c=Object(i.I)(t,(function(t){return function(t,e){var n=new re;t.accept(n);var r=n.alternations;return i.O(r,(function(n,r){var o=i.n(r.definition),a=i.I(o,(function(n,o){var a=Bt([n],[],null,1);return i.A(a)?{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:r,emptyChoiceIdx:o}),type:qe.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:r.idx,alternative:o+1}:null}));return n.concat(i.i(a))}),[])}(t,r)})),l=Object(i.I)(t,(function(t){return function(t,e,n){var r=new re;t.accept(r);var o=r.alternations;return o=Object(i.P)(o,(function(t){return!0===t.ignoreAmbiguities})),i.O(o,(function(r,o){var a=o.idx,s=o.maxLookahead||e,c=Yt(a,t,s,o),l=function(t,e,n,r){var o=[],a=Object(i.O)(t,(function(n,r,a){return!0===e.definition[a].ignoreAmbiguities||Object(i.u)(r,(function(r){var s=[a];Object(i.u)(t,(function(t,n){a!==n&&Kt(t,r)&&!0!==e.definition[n].ignoreAmbiguities&&s.push(n)})),s.length>1&&!Kt(o,r)&&(o.push(r),n.push({alts:s,path:r}))})),n}),[]);return i.I(a,(function(t){var o=Object(i.I)(t.alts,(function(t){return t+1}));return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:o,prefixPath:t.path}),type:qe.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:[t.alts]}}))}(c,o,t,n),u=function(t,e,n,r){var o=[],a=Object(i.O)(t,(function(t,e,n){var r=Object(i.I)(e,(function(t){return{idx:n,path:t}}));return t.concat(r)}),[]);return Object(i.u)(a,(function(t){if(!0!==e.definition[t.idx].ignoreAmbiguities){var s=t.idx,c=t.path,l=Object(i.r)(a,(function(t){return!0!==e.definition[t.idx].ignoreAmbiguities&&t.idx<s&&(n=t.path,r=c,n.length<r.length&&Object(i.o)(n,(function(t,e){var n=r[e];return t===n||n.categoryMatchesMap[t.tokenTypeIdx]})));var n,r})),u=Object(i.I)(l,(function(t){var i=[t.idx+1,s+1],o=0===e.idx?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:i,prefixPath:t.path}),type:qe.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:o,alternatives:i}}));o=o.concat(u)}})),o}(c,o,t,n);return r.concat(l,u)}),[])}(t,e,r)})),u=function(t,e,n){var r=[];return Object(i.u)(t,(function(t){var o=new ie;t.accept(o);var a=o.allProductions;Object(i.u)(a,(function(o){var a=function(t){if(t instanceof ot)return Dt.OPTION;if(t instanceof ct)return Dt.REPETITION;if(t instanceof at)return Dt.REPETITION_MANDATORY;if(t instanceof st)return Dt.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof lt)return Dt.REPETITION_WITH_SEPARATOR;if(t instanceof ut)return Dt.ALTERNATION;throw Error("non exhaustive match")}(o),s=o.maxLookahead||e,c=Xt(o.idx,t,a,s)[0];if(Object(i.A)(Object(i.t)(c))){var l=n.buildEmptyRepetitionError({topLevelRule:t,repetition:o});r.push({message:l,type:qe.NO_NON_EMPTY_LOOKAHEAD,ruleName:t.name})}}))})),r}(t,e,r));var d=function(t,e,n){var r=[],o=Object(i.I)(e,(function(t){return t.name}));return Object(i.u)(t,(function(t){var e=t.name;if(Object(i.j)(o,e)){var a=n.buildNamespaceConflictError(t);r.push({message:a,type:qe.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:e})}})),r}(t,n,r),f=i.I(n,(function(t){return function(t,e){var n=[];return t.name.match(ne)||n.push({message:e.buildTokenNameError({tokenType:t,expectedPattern:ne}),type:qe.INVALID_TOKEN_NAME}),n}(t,r)})),h=Object(i.I)(t,(function(t){return function(t,e){var n=new re;t.accept(n);var r=n.alternations;return i.O(r,(function(n,r){return r.definition.length>255&&n.push({message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:r}),type:qe.TOO_MANY_ALTS,ruleName:t.name,occurrence:r.idx}),n}),[])}(t,r)})),p=Object(i.I)(t,(function(t){return function(t,e){var n=[],r=t.name;return r.match(ne)||n.push({message:e.buildInvalidRuleNameError({topLevelRule:t,expectedPattern:ne}),type:qe.INVALID_RULE_NAME,ruleName:r}),n}(t,r)})),m=Object(i.I)(t,(function(e){return function(t,e,n,r){var o=[];if(Object(i.O)(e,(function(e,n){return n.name===t.name?e+1:e}),0)>1){var a=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});o.push({message:a,type:qe.DUPLICATE_RULE_NAME,ruleName:t.name})}return o}(e,t,o,r)}));return i.t(a.concat(f,u,s,c,l,d,h,p,m))}((t=Object(i.k)(t,{errMsgProvider:It})).rules,t.maxLookahead,t.tokenTypes,t.errMsgProvider,t.grammarName)}function se(t){Object(i.u)(t.rules,(function(t){var e=new bt;t.accept(e),Object(i.u)(e.dslMethods,(function(t){Object(i.u)(t,(function(t,e){t.idx=e+1}))}))}))}var ce=["MismatchedTokenException","NoViableAltException","EarlyExitException","NotAllInputParsedException"];function le(t){return Object(i.j)(ce,t.name)}function ue(t,e,n){this.name="MismatchedTokenException",this.message=t,this.token=e,this.previousToken=n,this.resyncedTokens=[]}function de(t,e,n){this.name="NoViableAltException",this.message=t,this.token=e,this.previousToken=n,this.resyncedTokens=[]}function fe(t,e){this.name="NotAllInputParsedException",this.message=t,this.token=e,this.resyncedTokens=[]}function he(t,e,n){this.name="EarlyExitException",this.message=t,this.token=e,this.previousToken=n,this.resyncedTokens=[]}Object.freeze(ce),ue.prototype=Error.prototype,de.prototype=Error.prototype,fe.prototype=Error.prototype,he.prototype=Error.prototype;var pe={};function me(t){this.name="InRuleRecoveryException",this.message=t}me.prototype=Error.prototype;var ve=function(){function t(){}return t.prototype.initRecoverable=function(t){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=Object(i.w)(t,"recoveryEnabled")?t.recoveryEnabled:Ye.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=_e)},t.prototype.getTokenToInsert=function(t){var e=Q(t,"",NaN,NaN,NaN,NaN,NaN,NaN);return e.isInsertedInRecovery=!0,e},t.prototype.canTokenTypeBeInsertedInRecovery=function(t){return!0},t.prototype.tryInRepetitionRecovery=function(t,e,n,r){for(var o=this,a=this.findReSyncTokenType(),s=this.exportLexerState(),c=[],l=!1,u=this.LA(1),d=this.LA(1),f=function(){var t=o.LA(0),e=new ue(o.errorMessageProvider.buildMismatchTokenMessage({expected:r,actual:u,previous:t,ruleName:o.getCurrRuleFullName()}),u,o.LA(0));e.resyncedTokens=Object(i.n)(c),o.SAVE_ERROR(e)};!l;){if(this.tokenMatcher(d,r))return void f();if(n.call(this))return f(),void t.apply(this,e);this.tokenMatcher(d,a)?l=!0:(d=this.SKIP_TOKEN(),this.addToResyncTokens(d,c))}this.importLexerState(s)},t.prototype.shouldInRepetitionRecoveryBeTried=function(t,e,n){return!1!==n&&void 0!==t&&void 0!==e&&!this.tokenMatcher(this.LA(1),t)&&!this.isBackTracking()&&!this.canPerformInRuleRecovery(t,this.getFollowsForInRuleRecovery(t,e))},t.prototype.getFollowsForInRuleRecovery=function(t,e){var n=this.getCurrentGrammarPath(t,e);return this.getNextPossibleTokenTypes(n)},t.prototype.tryInRuleRecovery=function(t,e){if(this.canRecoverWithSingleTokenInsertion(t,e))return this.getTokenToInsert(t);if(this.canRecoverWithSingleTokenDeletion(t)){var n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new me("sad sad panda")},t.prototype.canPerformInRuleRecovery=function(t,e){return this.canRecoverWithSingleTokenInsertion(t,e)||this.canRecoverWithSingleTokenDeletion(t)},t.prototype.canRecoverWithSingleTokenInsertion=function(t,e){var n=this;if(!this.canTokenTypeBeInsertedInRecovery(t))return!1;if(Object(i.A)(e))return!1;var r=this.LA(1);return void 0!==Object(i.q)(e,(function(t){return n.tokenMatcher(r,t)}))},t.prototype.canRecoverWithSingleTokenDeletion=function(t){return this.tokenMatcher(this.LA(2),t)},t.prototype.isInCurrentRuleReSyncSet=function(t){var e=this.getCurrFollowKey(),n=this.getFollowSetFromFollowKey(e);return Object(i.j)(n,t)},t.prototype.findReSyncTokenType=function(){for(var t=this.flattenFollowSet(),e=this.LA(1),n=2;;){var r=e.tokenType;if(Object(i.j)(t,r))return r;e=this.LA(n),n++}},t.prototype.getCurrFollowKey=function(){if(1===this.RULE_STACK.length)return pe;var t=this.getLastExplicitRuleShortName(),e=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:e,inRule:this.shortRuleNameToFullName(n)}},t.prototype.buildFullFollowKeyStack=function(){var t=this,e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return Object(i.I)(e,(function(r,i){return 0===i?pe:{ruleName:t.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:t.shortRuleNameToFullName(e[i-1])}}))},t.prototype.flattenFollowSet=function(){var t=this,e=Object(i.I)(this.buildFullFollowKeyStack(),(function(e){return t.getFollowSetFromFollowKey(e)}));return Object(i.t)(e)},t.prototype.getFollowSetFromFollowKey=function(t){if(t===pe)return[J];var e=t.ruleName+t.idxInCallingRule+"_~IN~_"+t.inRule;return this.resyncFollows[e]},t.prototype.addToResyncTokens=function(t,e){return this.tokenMatcher(t,J)||e.push(t),e},t.prototype.reSyncTo=function(t){for(var e=[],n=this.LA(1);!1===this.tokenMatcher(n,t);)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,e);return Object(i.n)(e)},t.prototype.attemptInRepetitionRecovery=function(t,e,n,r,i,o,a){},t.prototype.getCurrentGrammarPath=function(t,e){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:Object(i.g)(this.RULE_OCCURRENCE_STACK),lastTok:t,lastTokOccurrence:e}},t.prototype.getHumanReadableRuleStack=function(){var t=this;return Object(i.I)(this.RULE_STACK,(function(e){return t.shortRuleNameToFullName(e)}))},t}();function _e(t,e,n,r,i,o,a){var s=this.getKeyForAutomaticLookahead(r,i),c=this.firstAfterRepMap[s];if(void 0===c){var l=this.getCurrRuleFullName();c=new o(this.getGAstProductions()[l],i).startWalking(),this.firstAfterRepMap[s]=c}var u=c.token,d=c.occurrence,f=c.isEndOfRule;1===this.RULE_STACK.length&&f&&void 0===u&&(u=J,d=1),this.shouldInRepetitionRecoveryBeTried(u,d,a)&&this.tryInRepetitionRecovery(t,e,n,u)}function ge(t,e,n){return n|e|t}var ye=function(){function t(){}return t.prototype.initLooksAhead=function(t){this.dynamicTokensEnabled=Object(i.w)(t,"dynamicTokensEnabled")?t.dynamicTokensEnabled:Ye.dynamicTokensEnabled,this.maxLookahead=Object(i.w)(t,"maxLookahead")?t.maxLookahead:Ye.maxLookahead,this.lookAheadFuncsCache=Object(i.z)()?new Map:[],Object(i.z)()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},t.prototype.preComputeLookaheadFunctions=function(t){var e=this;Object(i.u)(t,(function(t){e.TRACE_INIT(t.name+" Rule Lookahead",(function(){var n=function(t){xt.reset(),t.accept(xt);var e=xt.dslMethods;return xt.reset(),e}(t),r=n.alternation,o=n.repetition,a=n.option,s=n.repetitionMandatory,c=n.repetitionMandatoryWithSeparator,l=n.repetitionWithSeparator;Object(i.u)(r,(function(n){var r=0===n.idx?"":n.idx;e.TRACE_INIT(""+yt(n)+r,(function(){var r,i,o,a,s,c,l=(r=n.idx,i=t,o=n.maxLookahead||e.maxLookahead,a=n.hasPredicates,s=e.dynamicTokensEnabled,(0,e.lookAheadBuilderForAlternatives)(c=Yt(r,i,o),a,Jt(c)?R:N,s)),u=ge(e.fullRuleNameToShort[t.name],256,n.idx);e.setLaFuncCache(u,l)}))})),Object(i.u)(o,(function(n){e.computeLookaheadFunc(t,n.idx,768,Dt.REPETITION,n.maxLookahead,yt(n))})),Object(i.u)(a,(function(n){e.computeLookaheadFunc(t,n.idx,512,Dt.OPTION,n.maxLookahead,yt(n))})),Object(i.u)(s,(function(n){e.computeLookaheadFunc(t,n.idx,1024,Dt.REPETITION_MANDATORY,n.maxLookahead,yt(n))})),Object(i.u)(c,(function(n){e.computeLookaheadFunc(t,n.idx,1536,Dt.REPETITION_MANDATORY_WITH_SEPARATOR,n.maxLookahead,yt(n))})),Object(i.u)(l,(function(n){e.computeLookaheadFunc(t,n.idx,1280,Dt.REPETITION_WITH_SEPARATOR,n.maxLookahead,yt(n))}))}))}))},t.prototype.computeLookaheadFunc=function(t,e,n,r,i,o){var a=this;this.TRACE_INIT(""+o+(0===e?"":e),(function(){var o=function(t,e,n,r,i,o){var a=Xt(t,e,i,n),s=Jt(a)?R:N;return o(a[0],s,r)}(e,t,i||a.maxLookahead,a.dynamicTokensEnabled,r,a.lookAheadBuilderForOptional),s=ge(a.fullRuleNameToShort[t.name],n,e);a.setLaFuncCache(s,o)}))},t.prototype.lookAheadBuilderForOptional=function(t,e,n){return function(t,e,n){var r=Object(i.o)(t,(function(t){return 1===t.length})),o=t.length;if(r&&!n){var a=Object(i.t)(t);if(1===a.length&&Object(i.A)(a[0].categoryMatches)){var s=a[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===s}}var c=Object(i.O)(a,(function(t,e,n){return t[e.tokenTypeIdx]=!0,Object(i.u)(e.categoryMatches,(function(e){t[e]=!0})),t}),[]);return function(){var t=this.LA(1);return!0===c[t.tokenTypeIdx]}}return function(){t:for(var n=0;n<o;n++){for(var r=t[n],i=r.length,a=0;a<i;a++){var s=this.LA(a+1);if(!1===e(s,r[a]))continue t}return!0}return!1}}(t,e,n)},t.prototype.lookAheadBuilderForAlternatives=function(t,e,n,r){return function(t,e,n,r){var o=t.length,a=Object(i.o)(t,(function(t){return Object(i.o)(t,(function(t){return 1===t.length}))}));if(e)return function(e){for(var r=Object(i.I)(e,(function(t){return t.GATE})),a=0;a<o;a++){var s=t[a],c=s.length,l=r[a];if(void 0===l||!1!==l.call(this))t:for(var u=0;u<c;u++){for(var d=s[u],f=d.length,h=0;h<f;h++){var p=this.LA(h+1);if(!1===n(p,d[h]))continue t}return a}}};if(a&&!r){var s=Object(i.I)(t,(function(t){return Object(i.t)(t)})),c=Object(i.O)(s,(function(t,e,n){return Object(i.u)(e,(function(e){Object(i.w)(t,e.tokenTypeIdx)||(t[e.tokenTypeIdx]=n),Object(i.u)(e.categoryMatches,(function(e){Object(i.w)(t,e)||(t[e]=n)}))})),t}),[]);return function(){var t=this.LA(1);return c[t.tokenTypeIdx]}}return function(){for(var e=0;e<o;e++){var r=t[e],i=r.length;t:for(var a=0;a<i;a++){for(var s=r[a],c=s.length,l=0;l<c;l++){var u=this.LA(l+1);if(!1===n(u,s[l]))continue t}return e}}}}(t,e,n,r)},t.prototype.getKeyForAutomaticLookahead=function(t,e){return ge(this.getLastExplicitRuleShortName(),t,e)},t.prototype.getLaFuncFromCache=function(t){},t.prototype.getLaFuncFromMap=function(t){return this.lookAheadFuncsCache.get(t)},t.prototype.getLaFuncFromObj=function(t){return this.lookAheadFuncsCache[t]},t.prototype.setLaFuncCache=function(t,e){},t.prototype.setLaFuncCacheUsingMap=function(t,e){this.lookAheadFuncsCache.set(t,e)},t.prototype.setLaFuncUsingObj=function(t,e){this.lookAheadFuncsCache[t]=e},t}();function be(t,e){!0===isNaN(t.startOffset)?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset==1&&(t.endOffset=e.endOffset)}function xe(t,e){!0===isNaN(t.startOffset)?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset==1&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}var we,Se=/^\s*function\s*(\S*)\s*\(/;function Oe(t){return t.name||t.toString().match(Se)[1]}function Me(t,e){var n=Object.getOwnPropertyDescriptor(t,"name");return!(!Object(i.F)(n)&&!n.configurable||(Object.defineProperty(t,"name",{enumerable:!1,configurable:!0,writable:!1,value:e}),0))}function je(t,e){for(var n=Object(i.G)(t),r=n.length,o=0;o<r;o++)for(var a=t[n[o]],s=a.length,c=0;c<s;c++){var l=a[c];void 0===l.tokenTypeIdx&&this[l.name](l.children,e)}}!function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"}(we||(we={}));var Ie=["constructor","visit","validateVisitor"],Te=function(){function t(){}return t.prototype.initTreeBuilder=function(t){if(this.CST_STACK=[],this.outputCst=t.outputCst,this.nodeLocationTracking=Object(i.w)(t,"nodeLocationTracking")?t.nodeLocationTracking:Ye.nodeLocationTracking,this.outputCst)if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=xe,this.setNodeLocationFromNode=xe,this.cstPostRule=i.b,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=i.b,this.setNodeLocationFromNode=i.b,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=be,this.setNodeLocationFromNode=be,this.cstPostRule=i.b,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=i.b,this.setNodeLocationFromNode=i.b,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else{if(!/none/i.test(this.nodeLocationTracking))throw Error('Invalid <nodeLocationTracking> config option: "'+t.nodeLocationTracking+'"');this.setNodeLocationFromToken=i.b,this.setNodeLocationFromNode=i.b,this.cstPostRule=i.b,this.setInitialNodeLocation=i.b}else this.cstInvocationStateUpdate=i.b,this.cstFinallyStateUpdate=i.b,this.cstPostTerminal=i.b,this.cstPostNonTerminal=i.b,this.cstPostRule=i.b},t.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(t){t.location={startOffset:NaN,endOffset:NaN}},t.prototype.setInitialNodeLocationOnlyOffsetRegular=function(t){t.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},t.prototype.setInitialNodeLocationFullRecovery=function(t){t.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},t.prototype.setInitialNodeLocationFullRegular=function(t){var e=this.LA(1);t.location={startOffset:e.startOffset,startLine:e.startLine,startColumn:e.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},t.prototype.cstInvocationStateUpdate=function(t,e){var n={name:t,children:{}};this.setInitialNodeLocation(n),this.CST_STACK.push(n)},t.prototype.cstFinallyStateUpdate=function(){this.CST_STACK.pop()},t.prototype.cstPostRuleFull=function(t){var e=this.LA(0),n=t.location;n.startOffset<=e.startOffset==1?(n.endOffset=e.endOffset,n.endLine=e.endLine,n.endColumn=e.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)},t.prototype.cstPostRuleOnlyOffset=function(t){var e=this.LA(0),n=t.location;n.startOffset<=e.startOffset==1?n.endOffset=e.endOffset:n.startOffset=NaN},t.prototype.cstPostTerminal=function(t,e){var n,r,i,o=this.CST_STACK[this.CST_STACK.length-1];r=e,i=t,void 0===(n=o).children[i]?n.children[i]=[r]:n.children[i].push(r),this.setNodeLocationFromToken(o.location,e)},t.prototype.cstPostNonTerminal=function(t,e){var n=this.CST_STACK[this.CST_STACK.length-1];!function(t,e,n){void 0===t.children[e]?t.children[e]=[n]:t.children[e].push(n)}(n,e,t),this.setNodeLocationFromNode(n.location,t.location)},t.prototype.getBaseCstVisitorConstructor=function(){if(Object(i.F)(this.baseCstVisitorConstructor)){var t=function(t,e){var n=function(){};return Me(n,t+"BaseSemantics"),(n.prototype={visit:function(t,e){if(Object(i.y)(t)&&(t=t[0]),!Object(i.F)(t))return this[t.name](t.children,e)},validateVisitor:function(){var t=function(t,e){var n=function(t,e){var n=Object(i.I)(e,(function(e){if(!Object(i.B)(t[e]))return{msg:"Missing visitor method: <"+e+"> on "+Oe(t.constructor)+" CST Visitor.",type:we.MISSING_METHOD,methodName:e}}));return Object(i.i)(n)}(t,e),r=function(t,e){var n=[];for(var r in t)ne.test(r)&&Object(i.B)(t[r])&&!Object(i.j)(Ie,r)&&!Object(i.j)(e,r)&&n.push({msg:"Redundant visitor method: <"+r+"> on "+Oe(t.constructor)+" CST Visitor\nThere is no Grammar Rule corresponding to this method's name.\nFor utility methods on visitor classes use methods names that do not match /"+ne.source+"/.",type:we.REDUNDANT_METHOD,methodName:r});return n}(t,e);return n.concat(r)}(this,e);if(!Object(i.A)(t)){var n=Object(i.I)(t,(function(t){return t.msg}));throw Error("Errors Detected in CST Visitor <"+Oe(this.constructor)+">:\n\t"+n.join("\n\n").replace(/\n/g,"\n\t"))}}}).constructor=n,n._RULE_NAMES=e,n}(this.className,Object(i.G)(this.gastProductionsCache));return this.baseCstVisitorConstructor=t,t}return this.baseCstVisitorConstructor},t.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(Object(i.F)(this.baseCstVisitorWithDefaultsConstructor)){var t=function(t,e,n){var r=function(){};Me(r,t+"BaseSemanticsWithDefaults");var o=Object.create(n.prototype);return Object(i.u)(e,(function(t){o[t]=je})),(r.prototype=o).constructor=r,r}(this.className,Object(i.G)(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=t,t}return this.baseCstVisitorWithDefaultsConstructor},t.prototype.getLastExplicitRuleShortName=function(){var t=this.RULE_STACK;return t[t.length-1]},t.prototype.getPreviousExplicitRuleShortName=function(){var t=this.RULE_STACK;return t[t.length-2]},t.prototype.getLastExplicitRuleOccurrenceIndex=function(){var t=this.RULE_OCCURRENCE_STACK;return t[t.length-1]},t}(),Ee=function(){function t(){}return t.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(t.prototype,"input",{get:function(){return this.tokVector},set:function(t){if(!0!==this.selfAnalysisDone)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=t,this.tokVectorLength=t.length},enumerable:!0,configurable:!0}),t.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Ve},t.prototype.LA=function(t){var e=this.currIdx+t;return e<0||this.tokVectorLength<=e?Ve:this.tokVector[e]},t.prototype.consumeToken=function(){this.currIdx++},t.prototype.exportLexerState=function(){return this.currIdx},t.prototype.importLexerState=function(t){this.currIdx=t},t.prototype.resetLexerState=function(){this.currIdx=-1},t.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},t.prototype.getLexerPosition=function(){return this.exportLexerState()},t}(),Ae=function(){function t(){}return t.prototype.ACTION=function(t){return t.call(this)},t.prototype.consume=function(t,e,n){return this.consumeInternal(e,t,n)},t.prototype.subrule=function(t,e,n){return this.subruleInternal(e,t,n)},t.prototype.option=function(t,e){return this.optionInternal(e,t)},t.prototype.or=function(t,e){return this.orInternal(e,t)},t.prototype.many=function(t,e){return this.manyInternal(t,e)},t.prototype.atLeastOne=function(t,e){return this.atLeastOneInternal(t,e)},t.prototype.CONSUME=function(t,e){return this.consumeInternal(t,0,e)},t.prototype.CONSUME1=function(t,e){return this.consumeInternal(t,1,e)},t.prototype.CONSUME2=function(t,e){return this.consumeInternal(t,2,e)},t.prototype.CONSUME3=function(t,e){return this.consumeInternal(t,3,e)},t.prototype.CONSUME4=function(t,e){return this.consumeInternal(t,4,e)},t.prototype.CONSUME5=function(t,e){return this.consumeInternal(t,5,e)},t.prototype.CONSUME6=function(t,e){return this.consumeInternal(t,6,e)},t.prototype.CONSUME7=function(t,e){return this.consumeInternal(t,7,e)},t.prototype.CONSUME8=function(t,e){return this.consumeInternal(t,8,e)},t.prototype.CONSUME9=function(t,e){return this.consumeInternal(t,9,e)},t.prototype.SUBRULE=function(t,e){return this.subruleInternal(t,0,e)},t.prototype.SUBRULE1=function(t,e){return this.subruleInternal(t,1,e)},t.prototype.SUBRULE2=function(t,e){return this.subruleInternal(t,2,e)},t.prototype.SUBRULE3=function(t,e){return this.subruleInternal(t,3,e)},t.prototype.SUBRULE4=function(t,e){return this.subruleInternal(t,4,e)},t.prototype.SUBRULE5=function(t,e){return this.subruleInternal(t,5,e)},t.prototype.SUBRULE6=function(t,e){return this.subruleInternal(t,6,e)},t.prototype.SUBRULE7=function(t,e){return this.subruleInternal(t,7,e)},t.prototype.SUBRULE8=function(t,e){return this.subruleInternal(t,8,e)},t.prototype.SUBRULE9=function(t,e){return this.subruleInternal(t,9,e)},t.prototype.OPTION=function(t){return this.optionInternal(t,0)},t.prototype.OPTION1=function(t){return this.optionInternal(t,1)},t.prototype.OPTION2=function(t){return this.optionInternal(t,2)},t.prototype.OPTION3=function(t){return this.optionInternal(t,3)},t.prototype.OPTION4=function(t){return this.optionInternal(t,4)},t.prototype.OPTION5=function(t){return this.optionInternal(t,5)},t.prototype.OPTION6=function(t){return this.optionInternal(t,6)},t.prototype.OPTION7=function(t){return this.optionInternal(t,7)},t.prototype.OPTION8=function(t){return this.optionInternal(t,8)},t.prototype.OPTION9=function(t){return this.optionInternal(t,9)},t.prototype.OR=function(t){return this.orInternal(t,0)},t.prototype.OR1=function(t){return this.orInternal(t,1)},t.prototype.OR2=function(t){return this.orInternal(t,2)},t.prototype.OR3=function(t){return this.orInternal(t,3)},t.prototype.OR4=function(t){return this.orInternal(t,4)},t.prototype.OR5=function(t){return this.orInternal(t,5)},t.prototype.OR6=function(t){return this.orInternal(t,6)},t.prototype.OR7=function(t){return this.orInternal(t,7)},t.prototype.OR8=function(t){return this.orInternal(t,8)},t.prototype.OR9=function(t){return this.orInternal(t,9)},t.prototype.MANY=function(t){this.manyInternal(0,t)},t.prototype.MANY1=function(t){this.manyInternal(1,t)},t.prototype.MANY2=function(t){this.manyInternal(2,t)},t.prototype.MANY3=function(t){this.manyInternal(3,t)},t.prototype.MANY4=function(t){this.manyInternal(4,t)},t.prototype.MANY5=function(t){this.manyInternal(5,t)},t.prototype.MANY6=function(t){this.manyInternal(6,t)},t.prototype.MANY7=function(t){this.manyInternal(7,t)},t.prototype.MANY8=function(t){this.manyInternal(8,t)},t.prototype.MANY9=function(t){this.manyInternal(9,t)},t.prototype.MANY_SEP=function(t){this.manySepFirstInternal(0,t)},t.prototype.MANY_SEP1=function(t){this.manySepFirstInternal(1,t)},t.prototype.MANY_SEP2=function(t){this.manySepFirstInternal(2,t)},t.prototype.MANY_SEP3=function(t){this.manySepFirstInternal(3,t)},t.prototype.MANY_SEP4=function(t){this.manySepFirstInternal(4,t)},t.prototype.MANY_SEP5=function(t){this.manySepFirstInternal(5,t)},t.prototype.MANY_SEP6=function(t){this.manySepFirstInternal(6,t)},t.prototype.MANY_SEP7=function(t){this.manySepFirstInternal(7,t)},t.prototype.MANY_SEP8=function(t){this.manySepFirstInternal(8,t)},t.prototype.MANY_SEP9=function(t){this.manySepFirstInternal(9,t)},t.prototype.AT_LEAST_ONE=function(t){this.atLeastOneInternal(0,t)},t.prototype.AT_LEAST_ONE1=function(t){return this.atLeastOneInternal(1,t)},t.prototype.AT_LEAST_ONE2=function(t){this.atLeastOneInternal(2,t)},t.prototype.AT_LEAST_ONE3=function(t){this.atLeastOneInternal(3,t)},t.prototype.AT_LEAST_ONE4=function(t){this.atLeastOneInternal(4,t)},t.prototype.AT_LEAST_ONE5=function(t){this.atLeastOneInternal(5,t)},t.prototype.AT_LEAST_ONE6=function(t){this.atLeastOneInternal(6,t)},t.prototype.AT_LEAST_ONE7=function(t){this.atLeastOneInternal(7,t)},t.prototype.AT_LEAST_ONE8=function(t){this.atLeastOneInternal(8,t)},t.prototype.AT_LEAST_ONE9=function(t){this.atLeastOneInternal(9,t)},t.prototype.AT_LEAST_ONE_SEP=function(t){this.atLeastOneSepFirstInternal(0,t)},t.prototype.AT_LEAST_ONE_SEP1=function(t){this.atLeastOneSepFirstInternal(1,t)},t.prototype.AT_LEAST_ONE_SEP2=function(t){this.atLeastOneSepFirstInternal(2,t)},t.prototype.AT_LEAST_ONE_SEP3=function(t){this.atLeastOneSepFirstInternal(3,t)},t.prototype.AT_LEAST_ONE_SEP4=function(t){this.atLeastOneSepFirstInternal(4,t)},t.prototype.AT_LEAST_ONE_SEP5=function(t){this.atLeastOneSepFirstInternal(5,t)},t.prototype.AT_LEAST_ONE_SEP6=function(t){this.atLeastOneSepFirstInternal(6,t)},t.prototype.AT_LEAST_ONE_SEP7=function(t){this.atLeastOneSepFirstInternal(7,t)},t.prototype.AT_LEAST_ONE_SEP8=function(t){this.atLeastOneSepFirstInternal(8,t)},t.prototype.AT_LEAST_ONE_SEP9=function(t){this.atLeastOneSepFirstInternal(9,t)},t.prototype.RULE=function(t,e,n){if(void 0===n&&(n=Xe),Object(i.j)(this.definedRulesNames,t)){var r={message:It.buildDuplicateRuleNameError({topLevelRule:t,grammarName:this.className}),type:qe.DUPLICATE_RULE_NAME,ruleName:t};this.definitionErrors.push(r)}this.definedRulesNames.push(t);var o=this.defineRule(t,e,n);return this[t]=o,o},t.prototype.OVERRIDE_RULE=function(t,e,n){void 0===n&&(n=Xe);var r,o,a,s,c,l=[];l=l.concat((r=t,o=this.definedRulesNames,a=this.className,c=[],i.j(o,r)||(s="Invalid rule override, rule: ->"+r+"<- cannot be overridden in the grammar: ->"+a+"<-as it is not defined in any of the super grammars ",c.push({message:s,type:qe.INVALID_RULE_OVERRIDE,ruleName:r})),c)),this.definitionErrors.push.apply(this.definitionErrors,l);var u=this.defineRule(t,e,n);return this[t]=u,u},t.prototype.BACKTRACK=function(t,e){return function(){this.isBackTrackingStack.push(1);var n=this.saveRecogState();try{return t.apply(this,e),!0}catch(t){if(le(t))return!1;throw t}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}},t.prototype.getGAstProductions=function(){return this.gastProductionsCache},t.prototype.getSerializedGastProductions=function(){return ft(Object(i.U)(this.gastProductionsCache))},t}(),Le=function(){function t(){}return t.prototype.initRecognizerEngine=function(t,e){if(this.className=Oe(this.constructor),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=R,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},Object(i.w)(e,"serializedGrammar"))throw Error("The Parser's configuration can no longer contain a <serializedGrammar> property.\n\tSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_6-0-0\n\tFor Further details.");if(Object(i.y)(t)){if(Object(i.A)(t))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof t[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if(Object(i.y)(t))this.tokensMap=Object(i.O)(t,(function(t,e){return t[e.name]=e,t}),{});else if(Object(i.w)(t,"modes")&&Object(i.o)(Object(i.t)(Object(i.U)(t.modes)),Z)){var n=Object(i.t)(Object(i.U)(t.modes)),r=Object(i.T)(n);this.tokensMap=Object(i.O)(r,(function(t,e){return t[e.name]=e,t}),{})}else{if(!Object(i.C)(t))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=Object(i.h)(t)}this.tokensMap.EOF=J;var o=Object(i.o)(Object(i.U)(t),(function(t){return Object(i.A)(t.categoryMatches)}));this.tokenMatcher=o?R:N,F(Object(i.U)(this.tokensMap))},t.prototype.defineRule=function(t,e,n){if(this.selfAnalysisDone)throw Error("Grammar rule <"+t+"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var r,o=Object(i.w)(n,"resyncEnabled")?n.resyncEnabled:Xe.resyncEnabled,a=Object(i.w)(n,"recoveryValueFunc")?n.recoveryValueFunc:Xe.recoveryValueFunc,s=this.ruleShortNameIdx<<12;function c(t){try{if(!0===this.outputCst){e.apply(this,t);var n=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(n),n}return e.apply(this,t)}catch(t){return this.invokeRuleCatch(t,o,a)}finally{this.ruleFinallyStateUpdate()}}return this.ruleShortNameIdx++,this.shortRuleNameToFull[s]=t,this.fullRuleNameToShort[t]=s,(r=function(e,n){return void 0===e&&(e=0),this.ruleInvocationStateUpdate(s,t,e),c.call(this,n)}).ruleName=t,r.originalGrammarAction=e,r},t.prototype.invokeRuleCatch=function(t,e,n){var r=1===this.RULE_STACK.length,i=e&&!this.isBackTracking()&&this.recoveryEnabled;if(le(t)){var o=t;if(i){var a,s=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(s))return o.resyncedTokens=this.reSyncTo(s),this.outputCst?((a=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,a):n();throw this.outputCst&&((a=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,o.partialCstResult=a),o}if(r)return this.moveToTerminatedState(),n();throw o}throw t},t.prototype.optionInternal=function(t,e){var n=this.getKeyForAutomaticLookahead(512,e);return this.optionInternalLogic(t,e,n)},t.prototype.optionInternalLogic=function(t,e,n){var r,i,o=this,a=this.getLaFuncFromCache(n);if(void 0!==t.DEF){if(r=t.DEF,void 0!==(i=t.GATE)){var s=a;a=function(){return i.call(o)&&s.call(o)}}}else r=t;if(!0===a.call(this))return r.call(this)},t.prototype.atLeastOneInternal=function(t,e){var n=this.getKeyForAutomaticLookahead(1024,t);return this.atLeastOneInternalLogic(t,e,n)},t.prototype.atLeastOneInternalLogic=function(t,e,n){var r,i,o=this,a=this.getLaFuncFromCache(n);if(void 0!==e.DEF){if(r=e.DEF,void 0!==(i=e.GATE)){var s=a;a=function(){return i.call(o)&&s.call(o)}}}else r=e;if(!0!==a.call(this))throw this.raiseEarlyExitException(t,Dt.REPETITION_MANDATORY,e.ERR_MSG);for(var c=this.doSingleRepetition(r);!0===a.call(this)&&!0===c;)c=this.doSingleRepetition(r);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[t,e],a,1024,t,Nt)},t.prototype.atLeastOneSepFirstInternal=function(t,e){var n=this.getKeyForAutomaticLookahead(1536,t);this.atLeastOneSepFirstInternalLogic(t,e,n)},t.prototype.atLeastOneSepFirstInternalLogic=function(t,e,n){var r=this,i=e.DEF,o=e.SEP;if(!0!==this.getLaFuncFromCache(n).call(this))throw this.raiseEarlyExitException(t,Dt.REPETITION_MANDATORY_WITH_SEPARATOR,e.ERR_MSG);i.call(this);for(var a=function(){return r.tokenMatcher(r.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,o,a,i,Rt],a,1536,t,Rt)},t.prototype.manyInternal=function(t,e){var n=this.getKeyForAutomaticLookahead(768,t);return this.manyInternalLogic(t,e,n)},t.prototype.manyInternalLogic=function(t,e,n){var r,i,o=this,a=this.getLaFuncFromCache(n);if(void 0!==e.DEF){if(r=e.DEF,void 0!==(i=e.GATE)){var s=a;a=function(){return i.call(o)&&s.call(o)}}}else r=e;for(var c=!0;!0===a.call(this)&&!0===c;)c=this.doSingleRepetition(r);this.attemptInRepetitionRecovery(this.manyInternal,[t,e],a,768,t,Pt,c)},t.prototype.manySepFirstInternal=function(t,e){var n=this.getKeyForAutomaticLookahead(1280,t);this.manySepFirstInternalLogic(t,e,n)},t.prototype.manySepFirstInternalLogic=function(t,e,n){var r=this,i=e.DEF,o=e.SEP;if(!0===this.getLaFuncFromCache(n).call(this)){i.call(this);for(var a=function(){return r.tokenMatcher(r.LA(1),o)};!0===this.tokenMatcher(this.LA(1),o);)this.CONSUME(o),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,o,a,i,kt],a,1280,t,kt)}},t.prototype.repetitionSepSecondInternal=function(t,e,n,r,i){for(;n();)this.CONSUME(e),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[t,e,n,r,i],n,1536,t,i)},t.prototype.doSingleRepetition=function(t){var e=this.getLexerPosition();return t.call(this),this.getLexerPosition()>e},t.prototype.orInternal=function(t,e){var n=this.getKeyForAutomaticLookahead(256,e),r=Object(i.y)(t)?t:t.DEF,o=this.getLaFuncFromCache(n).call(this,r);if(void 0!==o)return r[o].ALT.call(this);this.raiseNoAltException(e,t.ERR_MSG)},t.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!1===this.isAtEndOfInput()){var t=this.LA(1),e=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:t,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new fe(e,t))}},t.prototype.subruleInternal=function(t,e,n){var r;try{var i=void 0!==n?n.ARGS:void 0;return r=t.call(this,e,i),this.cstPostNonTerminal(r,void 0!==n&&void 0!==n.LABEL?n.LABEL:t.ruleName),r}catch(e){this.subruleInternalError(e,n,t.ruleName)}},t.prototype.subruleInternalError=function(t,e,n){throw le(t)&&void 0!==t.partialCstResult&&(this.cstPostNonTerminal(t.partialCstResult,void 0!==e&&void 0!==e.LABEL?e.LABEL:n),delete t.partialCstResult),t},t.prototype.consumeInternal=function(t,e,n){var r;try{var i=this.LA(1);!0===this.tokenMatcher(i,t)?(this.consumeToken(),r=i):this.consumeInternalError(t,i,n)}catch(n){r=this.consumeInternalRecovery(t,e,n)}return this.cstPostTerminal(void 0!==n&&void 0!==n.LABEL?n.LABEL:t.name,r),r},t.prototype.consumeInternalError=function(t,e,n){var r,i=this.LA(0);throw r=void 0!==n&&n.ERR_MSG?n.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:t,actual:e,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new ue(r,e,i))},t.prototype.consumeInternalRecovery=function(t,e,n){if(!this.recoveryEnabled||"MismatchedTokenException"!==n.name||this.isBackTracking())throw n;var r=this.getFollowsForInRuleRecovery(t,e);try{return this.tryInRuleRecovery(t,r)}catch(t){throw"InRuleRecoveryException"===t.name?n:t}},t.prototype.saveRecogState=function(){var t=this.errors,e=Object(i.g)(this.RULE_STACK);return{errors:t,lexerState:this.exportLexerState(),RULE_STACK:e,CST_STACK:this.CST_STACK}},t.prototype.reloadRecogState=function(t){this.errors=t.errors,this.importLexerState(t.lexerState),this.RULE_STACK=t.RULE_STACK},t.prototype.ruleInvocationStateUpdate=function(t,e,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(t),this.cstInvocationStateUpdate(e,t)},t.prototype.isBackTracking=function(){return 0!==this.isBackTrackingStack.length},t.prototype.getCurrRuleFullName=function(){var t=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[t]},t.prototype.shortRuleNameToFullName=function(t){return this.shortRuleNameToFull[t]},t.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),J)},t.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},t}(),Ce=function(){function t(){}return t.prototype.initErrorHandler=function(t){this._errors=[],this.errorMessageProvider=Object(i.w)(t,"errorMessageProvider")?t.errorMessageProvider:Ye.errorMessageProvider},t.prototype.SAVE_ERROR=function(t){if(le(t))return t.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Object(i.g)(this.RULE_OCCURRENCE_STACK)},this._errors.push(t),t;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(t.prototype,"errors",{get:function(){return Object(i.g)(this._errors)},set:function(t){this._errors=t},enumerable:!0,configurable:!0}),t.prototype.raiseEarlyExitException=function(t,e,n){for(var r=this.getCurrRuleFullName(),i=Xt(t,this.getGAstProductions()[r],e,this.maxLookahead)[0],o=[],a=1;a<=this.maxLookahead;a++)o.push(this.LA(a));var s=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:i,actual:o,previous:this.LA(0),customUserDescription:n,ruleName:r});throw this.SAVE_ERROR(new he(s,this.LA(1),this.LA(0)))},t.prototype.raiseNoAltException=function(t,e){for(var n=this.getCurrRuleFullName(),r=Yt(t,this.getGAstProductions()[n],this.maxLookahead),i=[],o=1;o<=this.maxLookahead;o++)i.push(this.LA(o));var a=this.LA(0),s=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:r,actual:i,previous:a,customUserDescription:e,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new de(s,this.LA(1),a))},t}(),Pe=function(){function t(){}return t.prototype.initContentAssist=function(){},t.prototype.computeContentAssist=function(t,e){var n=this.gastProductionsCache[t];if(Object(i.F)(n))throw Error("Rule ->"+t+"<- does not exist in this grammar.");return Bt([n],e,this.tokenMatcher,this.maxLookahead)},t.prototype.getNextPossibleTokenTypes=function(t){var e=Object(i.s)(t.ruleStack),n=this.getGAstProductions()[e];return new Lt(n,t).startWalking()},t}(),ke={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(ke);var Ne=Math.pow(2,8)-1,Re=K({name:"RECORDING_PHASE_TOKEN",pattern:V.NA});F([Re]);var ze=Q(Re,"This IToken indicates the Parser is in Recording Phase\n\tSee: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details",-1,-1,-1,-1,-1,-1);Object.freeze(ze);var Be={name:"This CSTNode indicates the Parser is in Recording Phase\n\tSee: https://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording for details",children:{}},Fe=function(){function t(){}return t.prototype.initGastRecorder=function(t){this.recordingProdStack=[],this.RECORDING_PHASE=!1},t.prototype.enableRecording=function(){var t=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",(function(){for(var e=function(e){var n=e>0?e:"";t["CONSUME"+n]=function(t,n){return this.consumeInternalRecord(t,e,n)},t["SUBRULE"+n]=function(t,n){return this.subruleInternalRecord(t,e,n)},t["OPTION"+n]=function(t){return this.optionInternalRecord(t,e)},t["OR"+n]=function(t){return this.orInternalRecord(t,e)},t["MANY"+n]=function(t){this.manyInternalRecord(e,t)},t["MANY_SEP"+n]=function(t){this.manySepFirstInternalRecord(e,t)},t["AT_LEAST_ONE"+n]=function(t){this.atLeastOneInternalRecord(e,t)},t["AT_LEAST_ONE_SEP"+n]=function(t){this.atLeastOneSepFirstInternalRecord(e,t)}},n=0;n<10;n++)e(n);t.consume=function(t,e,n){return this.consumeInternalRecord(e,t,n)},t.subrule=function(t,e,n){return this.subruleInternalRecord(e,t,n)},t.option=function(t,e){return this.optionInternalRecord(e,t)},t.or=function(t,e){return this.orInternalRecord(e,t)},t.many=function(t,e){this.manyInternalRecord(t,e)},t.atLeastOne=function(t,e){this.atLeastOneInternalRecord(t,e)},t.ACTION=t.ACTION_RECORD,t.BACKTRACK=t.BACKTRACK_RECORD,t.LA=t.LA_RECORD}))},t.prototype.disableRecording=function(){var t=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",(function(){for(var e=0;e<10;e++){var n=e>0?e:"";delete t["CONSUME"+n],delete t["SUBRULE"+n],delete t["OPTION"+n],delete t["OR"+n],delete t["MANY"+n],delete t["MANY_SEP"+n],delete t["AT_LEAST_ONE"+n],delete t["AT_LEAST_ONE_SEP"+n]}delete t.consume,delete t.subrule,delete t.option,delete t.or,delete t.many,delete t.atLeastOne,delete t.ACTION,delete t.BACKTRACK,delete t.LA}))},t.prototype.ACTION_RECORD=function(t){},t.prototype.BACKTRACK_RECORD=function(t,e){return function(){return!0}},t.prototype.LA_RECORD=function(t){return Ve},t.prototype.topLevelRuleRecord=function(t,e){try{var n=new rt({definition:[],name:t});return n.name=t,this.recordingProdStack.push(n),e.call(this),this.recordingProdStack.pop(),n}catch(t){if(!0!==t.KNOWN_RECORDER_ERROR)try{t.message=t.message+'\n\t This error was thrown during the "grammar recording phase" For more info see:\n\thttps://sap.github.io/chevrotain/docs/guide/internals.html#grammar-recording'}catch(e){throw t}throw t}},t.prototype.optionInternalRecord=function(t,e){return De.call(this,ot,t,e)},t.prototype.atLeastOneInternalRecord=function(t,e){De.call(this,at,e,t)},t.prototype.atLeastOneSepFirstInternalRecord=function(t,e){De.call(this,st,e,t,!0)},t.prototype.manyInternalRecord=function(t,e){De.call(this,ct,e,t)},t.prototype.manySepFirstInternalRecord=function(t,e){De.call(this,lt,e,t,!0)},t.prototype.orInternalRecord=function(t,e){return Ue.call(this,t,e)},t.prototype.subruleInternalRecord=function(t,e,n){if(He(e),!t||!1===Object(i.w)(t,"ruleName")){var r=new Error("<SUBRULE"+Ze(e)+"> argument is invalid expecting a Parser method reference but got: <"+JSON.stringify(t)+">\n inside top level rule: <"+this.recordingProdStack[0].name+">");throw r.KNOWN_RECORDER_ERROR=!0,r}var o=Object(i.M)(this.recordingProdStack),a=t.ruleName,s=new nt({idx:e,nonTerminalName:a,referencedRule:void 0});return o.definition.push(s),this.outputCst?Be:ke},t.prototype.consumeInternalRecord=function(t,e,n){if(He(e),!D(t)){var r=new Error("<CONSUME"+Ze(e)+"> argument is invalid expecting a TokenType reference but got: <"+JSON.stringify(t)+">\n inside top level rule: <"+this.recordingProdStack[0].name+">");throw r.KNOWN_RECORDER_ERROR=!0,r}var o=Object(i.M)(this.recordingProdStack),a=new dt({idx:e,terminalType:t});return o.definition.push(a),ze},t}();function De(t,e,n,r){void 0===r&&(r=!1),He(n);var o=Object(i.M)(this.recordingProdStack),a=Object(i.B)(e)?e:e.DEF,s=new t({definition:[],idx:n});return r&&(s.separator=e.SEP),Object(i.w)(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(s),a.call(this),o.definition.push(s),this.recordingProdStack.pop(),ke}function Ue(t,e){var n=this;He(e);var r=Object(i.M)(this.recordingProdStack),o=!1===Object(i.y)(t),a=!1===o?t:t.DEF,s=new ut({definition:[],idx:e,ignoreAmbiguities:o&&!0===t.IGNORE_AMBIGUITIES});Object(i.w)(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);var c=Object(i.Q)(a,(function(t){return Object(i.B)(t.GATE)}));return s.hasPredicates=c,r.definition.push(s),Object(i.u)(a,(function(t){var e=new it({definition:[]});s.definition.push(e),Object(i.w)(t,"IGNORE_AMBIGUITIES")?e.ignoreAmbiguities=t.IGNORE_AMBIGUITIES:Object(i.w)(t,"GATE")&&(e.ignoreAmbiguities=!0),n.recordingProdStack.push(e),t.ALT.call(n),n.recordingProdStack.pop()})),ke}function Ze(t){return 0===t?"":""+t}function He(t){if(t<0||t>Ne){var e=new Error("Invalid DSL Method idx value: <"+t+">\n\tIdx value must be a none negative value smaller than "+(Ne+1));throw e.KNOWN_RECORDER_ERROR=!0,e}}var Ge=function(){function t(){}return t.prototype.initPerformanceTracer=function(t){if(Object(i.w)(t,"traceInitPerf")){var e=t.traceInitPerf,n="number"==typeof e;this.traceInitMaxIdent=n?e:1/0,this.traceInitPerf=n?e>0:e}else this.traceInitMaxIdent=0,this.traceInitPerf=Ye.traceInitPerf;this.traceInitIndent=-1},t.prototype.TRACE_INIT=function(t,e){if(!0===this.traceInitPerf){this.traceInitIndent++;var n=new Array(this.traceInitIndent+1).join("\t");this.traceInitIndent<this.traceInitMaxIdent&&console.log(n+"--\x3e <"+t+">");var r=Object(i.R)(e),o=r.time,a=r.value,s=o>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(n+"<-- <"+t+"> time: "+o+"ms"),this.traceInitIndent--,a}return e()},t}(),We=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ve=Q(J,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Ve);var qe,Ye=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:Mt,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Xe=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0});function Ke(t){return void 0===t&&(t=void 0),function(){return t}}!function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS"}(qe||(qe={}));var Je=function(){function t(t,e){if(this.definitionErrors=[],this.selfAnalysisDone=!1,this.initErrorHandler(e),this.initLexerAdapter(),this.initLooksAhead(e),this.initRecognizerEngine(t,e),this.initRecoverable(e),this.initTreeBuilder(e),this.initContentAssist(),this.initGastRecorder(e),this.initPerformanceTracer(e),Object(i.w)(e,"ignoredIssues"))throw new Error("The <ignoredIssues> IParserConfig property has been deprecated.\n\tPlease use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.\n\tSee: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES\n\tFor further details.");this.skipValidations=Object(i.w)(e,"skipValidations")?e.skipValidations:Ye.skipValidations}return t.performSelfAnalysis=function(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.\t\nUse the **instance** method with the same name instead.")},t.prototype.performSelfAnalysis=function(){var e=this;this.TRACE_INIT("performSelfAnalysis",(function(){var n;e.selfAnalysisDone=!0;var r=e.className;e.TRACE_INIT("toFastProps",(function(){Object(i.S)(e)})),e.TRACE_INIT("Grammar Recording",(function(){try{e.enableRecording(),Object(i.u)(e.definedRulesNames,(function(t){var n=e[t].originalGrammarAction,r=void 0;e.TRACE_INIT(t+" Rule",(function(){r=e.topLevelRuleRecord(t,n)})),e.gastProductionsCache[t]=r}))}finally{e.disableRecording()}}));var o=[];if(e.TRACE_INIT("Grammar Resolving",(function(){o=oe({rules:Object(i.U)(e.gastProductionsCache)}),e.definitionErrors.push.apply(e.definitionErrors,o)})),e.TRACE_INIT("Grammar Validations",(function(){if(Object(i.A)(o)&&!1===e.skipValidations){var t=ae({rules:Object(i.U)(e.gastProductionsCache),maxLookahead:e.maxLookahead,tokenTypes:Object(i.U)(e.tokensMap),errMsgProvider:It,grammarName:r});e.definitionErrors.push.apply(e.definitionErrors,t)}})),Object(i.A)(e.definitionErrors)&&(e.recoveryEnabled&&e.TRACE_INIT("computeAllProdsFollows",(function(){var t,n,r=(t=Object(i.U)(e.gastProductionsCache),n={},Object(i.u)(t,(function(t){var e=new Ot(t).startWalking();Object(i.f)(n,e)})),n);e.resyncFollows=r})),e.TRACE_INIT("ComputeLookaheadFunctions",(function(){e.preComputeLookaheadFunctions(Object(i.U)(e.gastProductionsCache))}))),!t.DEFER_DEFINITION_ERRORS_HANDLING&&!Object(i.A)(e.definitionErrors))throw n=Object(i.I)(e.definitionErrors,(function(t){return t.message})),new Error("Parser Definition Errors detected:\n "+n.join("\n-------------------------------\n"))}))},t.DEFER_DEFINITION_ERRORS_HANDLING=!1,t}();Object(i.e)(Je,[ve,ye,Te,Ee,Le,Ae,Ce,Pe,Fe,Ge]);var Qe=function(t){function e(e,n){void 0===n&&(n=Ye);var r=Object(i.h)(n);return r.outputCst=!0,t.call(this,e,r)||this}return We(e,t),e}(Je),$e=function(t){function e(e,n){void 0===n&&(n=Ye);var r=Object(i.h)(n);return r.outputCst=!1,t.call(this,e,r)||this}return We(e,t),e}(Je);function tn(t,e){var n=void 0===e?{}:e,i=n.resourceBase,o=void 0===i?"https://unpkg.com/chevrotain@"+r+"/diagrams/":i,a=n.css;return"\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset=\"utf-8\">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n\n<link rel='stylesheet' href='"+(void 0===a?"https://unpkg.com/chevrotain@"+r+"/diagrams/diagrams.css":a)+"'>\n\n<script src='"+o+"vendor/railroad-diagrams.js'><\/script>\n<script src='"+o+"src/diagrams_builder.js'><\/script>\n<script src='"+o+"src/diagrams_behavior.js'><\/script>\n<script src='"+o+'src/main.js\'><\/script>\n\n<div id="diagrams" align="center"></div>    \n\n<script>\n    window.serializedGrammar = '+JSON.stringify(t,null,"  ")+';\n<\/script>\n\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}var en="\n";function nn(t){var e;return"\nfunction "+t.name+"(tokenVocabulary, config) {\n    // invoke super constructor\n    // No support for embedded actions currently, so we can 'hardcode'\n    // The use of CstParser.\n    chevrotain.CstParser.call(this, tokenVocabulary, config)\n\n    const $ = this\n\n    "+(e=t.rules,Object(i.I)(e,(function(t){return n=sn(1,'$.RULE("'+(e=t).name+'", function() {')+en,(n+=an(e.definition,2))+(sn(2,"})")+en);var e,n})).join("\n")+"\n\n    // very important to call this after all the rules have been defined.\n    // otherwise the parser may not work correctly as it will lack information\n    // derived during the self analysis phase.\n    this.performSelfAnalysis(this)\n}\n\n// inheritance as implemented in javascript in the previous decade... :(\n")+t.name+".prototype = Object.create(chevrotain.CstParser.prototype)\n"+t.name+".prototype.constructor = "+t.name+"    \n    "}function rn(t,e,n){var r=sn(n,"$."+(t+e.idx)+"(");return e.separator?(r+="{\n",r+=sn(n+1,"SEP: this.tokensMap."+e.separator.name)+","+en,r+="DEF: "+on(e.definition,n+2)+en,r+=sn(n,"}")+en):r+=on(e.definition,n+1),r+(sn(n,")")+en)}function on(t,e){var n="function() {\n";return(n+=an(t,e))+(sn(e,"}")+en)}function an(t,e){var n="";return Object(i.u)(t,(function(t){n+=function(t,e){if(t instanceof nt)return function(t,e){return sn(e,"$.SUBRULE"+t.idx+"($."+t.nonTerminalName+")"+en)}(t,e);if(t instanceof ot)return rn("OPTION",t,e);if(t instanceof at)return rn("AT_LEAST_ONE",t,e);if(t instanceof st)return rn("AT_LEAST_ONE_SEP",t,e);if(t instanceof lt)return rn("MANY_SEP",t,e);if(t instanceof ct)return rn("MANY",t,e);if(t instanceof ut)return function(t,e){var n=sn(e,"$.OR"+t.idx+"([")+en,r=Object(i.I)(t.definition,(function(t){return function(t,e){var n=sn(e,"{")+en;return n+=sn(e+1,"ALT: function() {")+en,n+=an(t.definition,e+1),(n+=sn(e+1,"}")+en)+sn(e,"}")}(t,e+1)}));return(n+=r.join(",\n"))+(en+sn(e,"])\n"))}(t,e);if(t instanceof dt)return function(t,e){var n=t.terminalType.name;return sn(e,"$.CONSUME"+t.idx+"(this.tokensMap."+n+")"+en)}(t,e);if(t instanceof it)return an(t.definition,e);throw Error("non exhaustive match")}(t,e+1)})),n}function sn(t,e){return Array(4*t+1).join(" ")+e}function cn(t){var e=function(t){return"    \n"+nn(t)+"\nreturn new "+t.name+"(tokenVocabulary, config)    \n"}({name:t.name,rules:t.rules}),r=new Function("tokenVocabulary","config","chevrotain",e);return function(e){return r(t.tokenVocabulary,e,n(1))}}function ln(t){return function(t){return"\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(['chevrotain'], factory);\n    } else if (typeof module === 'object' && module.exports) {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like environments that support module.exports,\n        // like Node.\n        module.exports = factory(require('chevrotain'));\n    } else {\n        // Browser globals (root is window)\n        root.returnExports = factory(root.b);\n    }\n}(typeof self !== 'undefined' ? self : this, function (chevrotain) {\n\n"+nn(t)+"\n    \nreturn {\n    "+t.name+": "+t.name+" \n}\n}));\n"}({name:t.name,rules:t.rules})}function un(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")}var dn=function(){throw new Error("The Parser class has been deprecated, use CstParser or EmbeddedActionsParser instead.\t\nSee: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_7-0-0")}},function(t,e,n){var r=n(27),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();t.exports=o},function(t,e,n){var r,i;"undefined"!=typeof self&&self,void 0===(i="function"==typeof(r=function(){function t(){}t.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},t.prototype.restoreState=function(t){this.idx=t.idx,this.input=t.input,this.groupIdx=t.groupIdx},t.prototype.pattern=function(t){this.idx=0,this.input=t,this.groupIdx=0,this.consumeChar("/");var e=this.disjunction();this.consumeChar("/");for(var n={type:"Flags",loc:{begin:this.idx,end:t.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":s(n,"global");break;case"i":s(n,"ignoreCase");break;case"m":s(n,"multiLine");break;case"u":s(n,"unicode");break;case"y":s(n,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:e,loc:this.loc(0)}},t.prototype.disjunction=function(){var t=[],e=this.idx;for(t.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),t.push(this.alternative());return{type:"Disjunction",value:t,loc:this.loc(e)}},t.prototype.alternative=function(){for(var t=[],e=this.idx;this.isTerm();)t.push(this.term());return{type:"Alternative",value:t,loc:this.loc(e)}},t.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},t.prototype.assertion=function(){var t=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(t)};case"$":return{type:"EndAnchor",loc:this.loc(t)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(t)};case"B":return{type:"NonWordBoundary",loc:this.loc(t)}}throw Error("Invalid Assertion Escape");case"(":var e;switch(this.consumeChar("?"),this.popChar()){case"=":e="Lookahead";break;case"!":e="NegativeLookahead"}c(e);var n=this.disjunction();return this.consumeChar(")"),{type:e,value:n,loc:this.loc(t)}}!function(){throw Error("Internal Error - Should never get here!")}()},t.prototype.quantifier=function(t){var e,n=this.idx;switch(this.popChar()){case"*":e={atLeast:0,atMost:1/0};break;case"+":e={atLeast:1,atMost:1/0};break;case"?":e={atLeast:0,atMost:1};break;case"{":var r=this.integerIncludingZero();switch(this.popChar()){case"}":e={atLeast:r,atMost:r};break;case",":e=this.isDigit()?{atLeast:r,atMost:this.integerIncludingZero()}:{atLeast:r,atMost:1/0},this.consumeChar("}")}if(!0===t&&void 0===e)return;c(e)}if(!0!==t||void 0!==e)return c(e),"?"===this.peekChar(0)?(this.consumeChar("?"),e.greedy=!1):e.greedy=!0,e.type="Quantifier",e.loc=this.loc(n),e},t.prototype.atom=function(){var t,e=this.idx;switch(this.peekChar()){case".":t=this.dotAll();break;case"\\":t=this.atomEscape();break;case"[":t=this.characterClass();break;case"(":t=this.group()}return void 0===t&&this.isPatternCharacter()&&(t=this.patternCharacter()),c(t),t.loc=this.loc(e),this.isQuantifier()&&(t.quantifier=this.quantifier()),t},t.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[o("\n"),o("\r"),o("\u2028"),o("\u2029")]}},t.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},t.prototype.decimalEscapeAtom=function(){return{type:"GroupBackReference",value:this.positiveInteger()}},t.prototype.characterClassEscape=function(){var t,e=!1;switch(this.popChar()){case"d":t=l;break;case"D":t=l,e=!0;break;case"s":t=d;break;case"S":t=d,e=!0;break;case"w":t=u;break;case"W":t=u,e=!0}return c(t),{type:"Set",value:t,complement:e}},t.prototype.controlEscapeAtom=function(){var t;switch(this.popChar()){case"f":t=o("\f");break;case"n":t=o("\n");break;case"r":t=o("\r");break;case"t":t=o("\t");break;case"v":t=o("\v")}return c(t),{type:"Character",value:t}},t.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var t=this.popChar();if(!1===/[a-zA-Z]/.test(t))throw Error("Invalid ");return{type:"Character",value:t.toUpperCase().charCodeAt(0)-64}},t.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:o("\0")}},t.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},t.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},t.prototype.identityEscapeAtom=function(){return{type:"Character",value:o(this.popChar())}},t.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:o(this.popChar())}}},t.prototype.characterClass=function(){var t=[],e=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),e=!0);this.isClassAtom();){var n=this.classAtom();if("Character"===n.type&&this.isRangeDash()){this.consumeChar("-");var r=this.classAtom();if("Character"===r.type){if(r.value<n.value)throw Error("Range out of order in character class");t.push({from:n.value,to:r.value})}else a(n.value,t),t.push(o("-")),a(r.value,t)}else a(n.value,t)}return this.consumeChar("]"),{type:"Set",complement:e,value:t}},t.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},t.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:o("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},t.prototype.group=function(){var t=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),t=!1;break;default:this.groupIdx++}var e=this.disjunction();this.consumeChar(")");var n={type:"Group",capturing:t,value:e};return t&&(n.idx=this.groupIdx),n},t.prototype.positiveInteger=function(){var t=this.popChar();if(!1===i.test(t))throw Error("Expecting a positive integer");for(;r.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)},t.prototype.integerIncludingZero=function(){var t=this.popChar();if(!1===r.test(t))throw Error("Expecting an integer");for(;r.test(this.peekChar(0));)t+=this.popChar();return parseInt(t,10)},t.prototype.patternCharacter=function(){var t=this.popChar();switch(t){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:o(t)}}},t.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},t.prototype.isRangeDash=function(){return"-"===this.peekChar()&&this.isClassAtom(1)},t.prototype.isDigit=function(){return r.test(this.peekChar(0))},t.prototype.isClassAtom=function(t){switch(void 0===t&&(t=0),this.peekChar(t)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},t.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},t.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},t.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}},t.prototype.isQuantifier=function(){var t=this.saveState();try{return void 0!==this.quantifier(!0)}catch(t){return!1}finally{this.restoreState(t)}},t.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},t.prototype.parseHexDigits=function(t){for(var e="",r=0;r<t;r++){var i=this.popChar();if(!1===n.test(i))throw Error("Expecting a HexDecimal digits");e+=i}return{type:"Character",value:parseInt(e,16)}},t.prototype.peekChar=function(t){return void 0===t&&(t=0),this.input[this.idx+t]},t.prototype.popChar=function(){var t=this.peekChar(0);return this.consumeChar(),t},t.prototype.consumeChar=function(t){if(void 0!==t&&this.input[this.idx]!==t)throw Error("Expected: '"+t+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++},t.prototype.loc=function(t){return{begin:t,end:this.idx}};var e,n=/[0-9a-fA-F]/,r=/[0-9]/,i=/[1-9]/;function o(t){return t.charCodeAt(0)}function a(t,e){void 0!==t.length?t.forEach((function(t){e.push(t)})):e.push(t)}function s(t,e){if(!0===t[e])throw"duplicate flag "+e;t[e]=!0}function c(t){if(void 0===t)throw Error("Internal Error - Should never get here!")}var l=[];for(e=o("0");e<=o("9");e++)l.push(e);var u=[o("_")].concat(l);for(e=o("a");e<=o("z");e++)u.push(e);for(e=o("A");e<=o("Z");e++)u.push(e);var d=[o(" "),o("\f"),o("\n"),o("\r"),o("\t"),o("\v"),o("\t"),o(" "),o(" "),o(" "),o(" "),o(" "),o(" "),o(" "),o(" "),o(" "),o(" "),o(" "),o(" "),o(" "),o("\u2028"),o("\u2029"),o(" "),o(" "),o("　"),o("\ufeff")];function f(){}return f.prototype.visitChildren=function(t){for(var e in t){var n=t[e];t.hasOwnProperty(e)&&(void 0!==n.type?this.visit(n):Array.isArray(n)&&n.forEach((function(t){this.visit(t)}),this))}},f.prototype.visit=function(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t)}this.visitChildren(t)},f.prototype.visitPattern=function(t){},f.prototype.visitFlags=function(t){},f.prototype.visitDisjunction=function(t){},f.prototype.visitAlternative=function(t){},f.prototype.visitStartAnchor=function(t){},f.prototype.visitEndAnchor=function(t){},f.prototype.visitWordBoundary=function(t){},f.prototype.visitNonWordBoundary=function(t){},f.prototype.visitLookahead=function(t){},f.prototype.visitNegativeLookahead=function(t){},f.prototype.visitCharacter=function(t){},f.prototype.visitSet=function(t){},f.prototype.visitGroup=function(t){},f.prototype.visitGroupBackReference=function(t){},f.prototype.visitQuantifier=function(t){},{RegExpParser:t,BaseRegExpVisitor:f,VERSION:"0.5.0"}})?r.apply(e,[]):r)||(t.exports=i)},function(t,e,n){var r=n(54),i=n(60);t.exports=function(t,e){var n=i(t,e);return r(n)?n:void 0}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,n){var r=n(44),i=n(45),o=n(46),a=n(47),s=n(48);function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=a,c.prototype.set=s,t.exports=c},function(t,e,n){var r=n(25);t.exports=function(t,e){for(var n=t.length;n--;)if(r(t[n][0],e))return n;return-1}},function(t,e,n){var r=n(14),i=n(56),o=n(57),a=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":a&&a in Object(t)?i(t):o(t)}},function(t,e,n){var r=n(4)(Object,"create");t.exports=r},function(t,e,n){var r=n(70);t.exports=function(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}},function(t,e,n){var r=n(29),i=n(30);t.exports=function(t,e,n,o){var a=!n;n||(n={});for(var s=-1,c=e.length;++s<c;){var l=e[s],u=o?o(n[l],t[l],l,n,t):void 0;void 0===u&&(u=t[l]),a?i(n,l,u):r(n,l,u)}return n}},function(t,e,n){var r=n(4)(n(2),"Map");t.exports=r},function(t,e,n){var r=n(2).Symbol;t.exports=r},function(t,e,n){var r=n(31),i=n(84),o=n(35);t.exports=function(t){return o(t)?r(t):i(t)}},function(t,e){var n=Array.isArray;t.exports=n},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,n){(function(t){var r=n(27),i=e&&!e.nodeType&&e,o=i&&"object"==typeof t&&t&&!t.nodeType&&t,a=o&&o.exports===i&&r.process,s=function(){try{return o&&o.require&&o.require("util").types||a&&a.binding&&a.binding("util")}catch(t){}}();t.exports=s}).call(this,n(17)(t))},function(t,e){var n=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||n)}},function(t,e,n){var r=n(31),i=n(87),o=n(35);t.exports=function(t){return o(t)?r(t,!0):i(t)}},function(t,e,n){var r=n(92),i=n(36),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(t){return null==t?[]:(t=Object(t),r(a(t),(function(e){return o.call(t,e)})))}:i;t.exports=s},function(t,e,n){var r=n(96),i=n(13),o=n(97),a=n(98),s=n(99),c=n(9),l=n(28),u=l(r),d=l(i),f=l(o),h=l(a),p=l(s),m=c;(r&&"[object DataView]"!=m(new r(new ArrayBuffer(1)))||i&&"[object Map]"!=m(new i)||o&&"[object Promise]"!=m(o.resolve())||a&&"[object Set]"!=m(new a)||s&&"[object WeakMap]"!=m(new s))&&(m=function(t){var e=c(t),n="[object Object]"==e?t.constructor:void 0,r=n?l(n):"";if(r)switch(r){case u:return"[object DataView]";case d:return"[object Map]";case f:return"[object Promise]";case h:return"[object Set]";case p:return"[object WeakMap]"}return e}),t.exports=m},function(t,e,n){var r=n(102);t.exports=function(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}},function(t,e){t.exports=function(t,e){return t===e||t!=t&&e!=e}},function(t,e,n){var r=n(9),i=n(5);t.exports=function(t){if(!i(t))return!1;var e=r(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n(55))},function(t,e){var n=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return n.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},function(t,e,n){var r=n(30),i=n(25),o=Object.prototype.hasOwnProperty;t.exports=function(t,e,n){var a=t[e];o.call(t,e)&&i(a,n)&&(void 0!==n||e in t)||r(t,e,n)}},function(t,e,n){var r=n(75);t.exports=function(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}},function(t,e,n){var r=n(77),i=n(78),o=n(16),a=n(32),s=n(81),c=n(82),l=Object.prototype.hasOwnProperty;t.exports=function(t,e){var n=o(t),u=!n&&i(t),d=!n&&!u&&a(t),f=!n&&!u&&!d&&c(t),h=n||u||d||f,p=h?r(t.length,String):[],m=p.length;for(var v in t)!e&&!l.call(t,v)||h&&("length"==v||d&&("offset"==v||"parent"==v)||f&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||s(v,m))||p.push(v);return p}},function(t,e,n){(function(t){var r=n(2),i=n(80),o=e&&!e.nodeType&&e,a=o&&"object"==typeof t&&t&&!t.nodeType&&t,s=a&&a.exports===o?r.Buffer:void 0,c=(s?s.isBuffer:void 0)||i;t.exports=c}).call(this,n(17)(t))},function(t,e){t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},function(t,e){t.exports=function(t,e){return function(n){return t(e(n))}}},function(t,e,n){var r=n(26),i=n(33);t.exports=function(t){return null!=t&&i(t.length)&&!r(t)}},function(t,e){t.exports=function(){return[]}},function(t,e,n){var r=n(38),i=n(39),o=n(22),a=n(36),s=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)r(e,o(t)),t=i(t);return e}:a;t.exports=s},function(t,e){t.exports=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}},function(t,e,n){var r=n(34)(Object.getPrototypeOf,Object);t.exports=r},function(t,e,n){var r=n(38),i=n(16);t.exports=function(t,e,n){var o=e(t);return i(t)?o:r(o,n(t))}},function(t,e,n){var r=n(42);t.exports=function(t){return r(t,5)}},function(t,e,n){var r=n(43),i=n(74),o=n(29),a=n(76),s=n(86),c=n(89),l=n(90),u=n(91),d=n(93),f=n(94),h=n(95),p=n(23),m=n(100),v=n(101),_=n(107),g=n(16),y=n(32),b=n(109),x=n(5),w=n(111),S=n(15),O=n(21),M={};M["[object Arguments]"]=M["[object Array]"]=M["[object ArrayBuffer]"]=M["[object DataView]"]=M["[object Boolean]"]=M["[object Date]"]=M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Map]"]=M["[object Number]"]=M["[object Object]"]=M["[object RegExp]"]=M["[object Set]"]=M["[object String]"]=M["[object Symbol]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M["[object Error]"]=M["[object Function]"]=M["[object WeakMap]"]=!1,t.exports=function t(e,n,j,I,T,E){var A,L=1&n,C=2&n,P=4&n;if(j&&(A=T?j(e,I,T,E):j(e)),void 0!==A)return A;if(!x(e))return e;var k=g(e);if(k){if(A=m(e),!L)return l(e,A)}else{var N=p(e),R="[object Function]"==N||"[object GeneratorFunction]"==N;if(y(e))return c(e,L);if("[object Object]"==N||"[object Arguments]"==N||R&&!T){if(A=C||R?{}:_(e),!L)return C?d(e,s(A,e)):u(e,a(A,e))}else{if(!M[N])return T?e:{};A=v(e,N,L)}}E||(E=new r);var z=E.get(e);if(z)return z;E.set(e,A),w(e)?e.forEach((function(r){A.add(t(r,n,j,r,e,E))})):b(e)&&e.forEach((function(r,i){A.set(i,t(r,n,j,i,e,E))}));var B=k?void 0:(P?C?h:f:C?O:S)(e);return i(B||e,(function(r,i){B&&(r=e[i=r]),o(A,i,t(r,n,j,i,e,E))})),A}},function(t,e,n){var r=n(7),i=n(49),o=n(50),a=n(51),s=n(52),c=n(53);function l(t){var e=this.__data__=new r(t);this.size=e.size}l.prototype.clear=i,l.prototype.delete=o,l.prototype.get=a,l.prototype.has=s,l.prototype.set=c,t.exports=l},function(t,e){t.exports=function(){this.__data__=[],this.size=0}},function(t,e,n){var r=n(8),i=Array.prototype.splice;t.exports=function(t){var e=this.__data__,n=r(e,t);return!(n<0||(n==e.length-1?e.pop():i.call(e,n,1),--this.size,0))}},function(t,e,n){var r=n(8);t.exports=function(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}},function(t,e,n){var r=n(8);t.exports=function(t){return r(this.__data__,t)>-1}},function(t,e,n){var r=n(8);t.exports=function(t,e){var n=this.__data__,i=r(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}},function(t,e,n){var r=n(7);t.exports=function(){this.__data__=new r,this.size=0}},function(t,e){t.exports=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}},function(t,e){t.exports=function(t){return this.__data__.get(t)}},function(t,e){t.exports=function(t){return this.__data__.has(t)}},function(t,e,n){var r=n(7),i=n(13),o=n(61);t.exports=function(t,e){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([t,e]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(t,e),this.size=n.size,this}},function(t,e,n){var r=n(26),i=n(58),o=n(5),a=n(28),s=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,u=c.toString,d=l.hasOwnProperty,f=RegExp("^"+u.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!o(t)||i(t))&&(r(t)?f:s).test(a(t))}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var r=n(14),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;t.exports=function(t){var e=o.call(t,s),n=t[s];try{t[s]=void 0;var r=!0}catch(t){}var i=a.call(t);return r&&(e?t[s]=n:delete t[s]),i}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e,n){var r,i=n(59),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";t.exports=function(t){return!!o&&o in t}},function(t,e,n){var r=n(2)["__core-js_shared__"];t.exports=r},function(t,e){t.exports=function(t,e){return null==t?void 0:t[e]}},function(t,e,n){var r=n(62),i=n(69),o=n(71),a=n(72),s=n(73);function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=a,c.prototype.set=s,t.exports=c},function(t,e,n){var r=n(63),i=n(7),o=n(13);t.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},function(t,e,n){var r=n(64),i=n(65),o=n(66),a=n(67),s=n(68);function c(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=r,c.prototype.delete=i,c.prototype.get=o,c.prototype.has=a,c.prototype.set=s,t.exports=c},function(t,e,n){var r=n(10);t.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(t,e){t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},function(t,e,n){var r=n(10),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(r){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(e,t)?e[t]:void 0}},function(t,e,n){var r=n(10),i=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return r?void 0!==e[t]:i.call(e,t)}},function(t,e,n){var r=n(10);t.exports=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?"__lodash_hash_undefined__":e,this}},function(t,e,n){var r=n(11);t.exports=function(t){var e=r(this,t).delete(t);return this.size-=e?1:0,e}},function(t,e){t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},function(t,e,n){var r=n(11);t.exports=function(t){return r(this,t).get(t)}},function(t,e,n){var r=n(11);t.exports=function(t){return r(this,t).has(t)}},function(t,e,n){var r=n(11);t.exports=function(t,e){var n=r(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}},function(t,e,n){var r=n(4),i=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=i},function(t,e,n){var r=n(12),i=n(15);t.exports=function(t,e){return t&&r(e,i(e),t)}},function(t,e){t.exports=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}},function(t,e,n){var r=n(79),i=n(6),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(t){return i(t)&&a.call(t,"callee")&&!s.call(t,"callee")};t.exports=c},function(t,e,n){var r=n(9),i=n(6);t.exports=function(t){return i(t)&&"[object Arguments]"==r(t)}},function(t,e){t.exports=function(){return!1}},function(t,e){var n=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&n.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,n){var r=n(83),i=n(18),o=n(19),a=o&&o.isTypedArray,s=a?i(a):r;t.exports=s},function(t,e,n){var r=n(9),i=n(33),o=n(6),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,t.exports=function(t){return o(t)&&i(t.length)&&!!a[r(t)]}},function(t,e,n){var r=n(20),i=n(85),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return i(t);var e=[];for(var n in Object(t))o.call(t,n)&&"constructor"!=n&&e.push(n);return e}},function(t,e,n){var r=n(34)(Object.keys,Object);t.exports=r},function(t,e,n){var r=n(12),i=n(21);t.exports=function(t,e){return t&&r(e,i(e),t)}},function(t,e,n){var r=n(5),i=n(20),o=n(88),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return o(t);var e=i(t),n=[];for(var s in t)("constructor"!=s||!e&&a.call(t,s))&&n.push(s);return n}},function(t,e){t.exports=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}},function(t,e,n){(function(t){var r=n(2),i=e&&!e.nodeType&&e,o=i&&"object"==typeof t&&t&&!t.nodeType&&t,a=o&&o.exports===i?r.Buffer:void 0,s=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=s?s(n):new t.constructor(n);return t.copy(r),r}}).call(this,n(17)(t))},function(t,e){t.exports=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}},function(t,e,n){var r=n(12),i=n(22);t.exports=function(t,e){return r(t,i(t),e)}},function(t,e){t.exports=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}},function(t,e,n){var r=n(12),i=n(37);t.exports=function(t,e){return r(t,i(t),e)}},function(t,e,n){var r=n(40),i=n(22),o=n(15);t.exports=function(t){return r(t,o,i)}},function(t,e,n){var r=n(40),i=n(37),o=n(21);t.exports=function(t){return r(t,o,i)}},function(t,e,n){var r=n(4)(n(2),"DataView");t.exports=r},function(t,e,n){var r=n(4)(n(2),"Promise");t.exports=r},function(t,e,n){var r=n(4)(n(2),"Set");t.exports=r},function(t,e,n){var r=n(4)(n(2),"WeakMap");t.exports=r},function(t,e){var n=Object.prototype.hasOwnProperty;t.exports=function(t){var e=t.length,r=new t.constructor(e);return e&&"string"==typeof t[0]&&n.call(t,"index")&&(r.index=t.index,r.input=t.input),r}},function(t,e,n){var r=n(24),i=n(103),o=n(104),a=n(105),s=n(106);t.exports=function(t,e,n){var c=t.constructor;switch(e){case"[object ArrayBuffer]":return r(t);case"[object Boolean]":case"[object Date]":return new c(+t);case"[object DataView]":return i(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(t,n);case"[object Map]":return new c;case"[object Number]":case"[object String]":return new c(t);case"[object RegExp]":return o(t);case"[object Set]":return new c;case"[object Symbol]":return a(t)}}},function(t,e,n){var r=n(2).Uint8Array;t.exports=r},function(t,e,n){var r=n(24);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}},function(t,e){var n=/\w*$/;t.exports=function(t){var e=new t.constructor(t.source,n.exec(t));return e.lastIndex=t.lastIndex,e}},function(t,e,n){var r=n(14),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;t.exports=function(t){return o?Object(o.call(t)):{}}},function(t,e,n){var r=n(24);t.exports=function(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}},function(t,e,n){var r=n(108),i=n(39),o=n(20);t.exports=function(t){return"function"!=typeof t.constructor||o(t)?{}:r(i(t))}},function(t,e,n){var r=n(5),i=Object.create,o=function(){function t(){}return function(e){if(!r(e))return{};if(i)return i(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=o},function(t,e,n){var r=n(110),i=n(18),o=n(19),a=o&&o.isMap,s=a?i(a):r;t.exports=s},function(t,e,n){var r=n(23),i=n(6);t.exports=function(t){return i(t)&&"[object Map]"==r(t)}},function(t,e,n){var r=n(112),i=n(18),o=n(19),a=o&&o.isSet,s=a?i(a):r;t.exports=s},function(t,e,n){var r=n(23),i=n(6);t.exports=function(t){return i(t)&&"[object Set]"==r(t)}},function(t,e,n){"use strict";n.r(e),n.d(e,"convertStyle",(function(){return H}));var r=n(1),i=Object(r.createToken)({name:"Bar",pattern:/\|/}),o=Object(r.createToken)({name:"LCurly",pattern:/{/}),a=Object(r.createToken)({name:"RCurly",pattern:/}/}),s=Object(r.createToken)({name:"LSquare",pattern:/\[/}),c=Object(r.createToken)({name:"RSquare",pattern:/]/}),l=Object(r.createToken)({name:"Comma",pattern:/,/}),u=Object(r.createToken)({name:"Colon",pattern:/:/}),d=Object(r.createToken)({name:"Semicolon",pattern:/;/}),f=Object(r.createToken)({name:"Equal",pattern:/=/}),h=Object(r.createToken)({name:"NotEqual",pattern:/!=/}),p=Object(r.createToken)({name:"LessThan",pattern:/</}),m=Object(r.createToken)({name:"GreaterThan",pattern:/>/}),v=Object(r.createToken)({name:"LessThanOrEqual",pattern:/<=/}),_=Object(r.createToken)({name:"GreaterThanOrEqual",pattern:/>=/}),g=Object(r.createToken)({name:"Identifier",pattern:/[a-zA-Z0-9_]+/}),y=Object(r.createToken)({name:"ColorLiteral",pattern:/#[0-9a-fA-F]{6,8}/}),b=Object(r.createToken)({name:"NumberLiteral",pattern:/[-+]?([0-9]+(\.[0-9]+)?|\.[0-9]+)/}),x=Object(r.createToken)({name:"StringLiteral",pattern:/"[^"]+"/}),w=Object(r.createToken)({name:"Comment",pattern:/\/\*(\*(?!\/)|[^*])*\*\//,group:r.Lexer.SKIPPED}),S=Object(r.createToken)({name:"InlineComment",pattern:/\/\/(.*)\n/,group:r.Lexer.SKIPPED}),O=[Object(r.createToken)({name:"WhiteSpace",pattern:/\s+/,group:r.Lexer.SKIPPED}),w,S,l,u,d,i,o,a,s,c,f,h,v,_,p,m,b,x,y,g],M={icon_margin_zpt:["icon"],text_margin_zpt:["text"],text2_margin_zpt:["text2"],margin_zpt:["icon","text"]},j=["visible","appear"],I=["top_bottom","left_right"],T=function(t){var e,n;n=t,(e=w).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=w.prototype;function w(){var e;return(e=t.call(this,O)||this).selector=e.RULE("selector",(function(){var t,n;e.CONSUME(s);var r=e.CONSUME(g);return e.OPTION((function(){t=e.OR1([{ALT:function(){return e.CONSUME(f)}},{ALT:function(){return e.CONSUME(h)}},{ALT:function(){return e.CONSUME(p)}},{ALT:function(){return e.CONSUME(m)}},{ALT:function(){return e.CONSUME(v)}},{ALT:function(){return e.CONSUME(_)}}]),n=e.OR2([{ALT:function(){return e.CONSUME2(g)}},{ALT:function(){return e.CONSUME(b)}}])})),e.CONSUME(c),[r.image,t?t.image:"=",n?e.formatToken(n):1]})),e.selectorANDGroup=e.RULE("selectorANDGroup",(function(){var t=[];return e.MANY((function(){t.push(e.SUBRULE(e.selector))})),t})),e.selectorORGroup=e.RULE("selectorORGroup",(function(){var t=[];return e.MANY_SEP({SEP:i,DEF:function(){return t.push(e.SUBRULE(e.selectorANDGroup))}}),t})),e.curve=e.RULE("curve",(function(){var t=[];return e.CONSUME(o),e.MANY((function(){e.CONSUME(g),e.CONSUME(u),e.OR([{ALT:function(){e.CONSUME(s),e.MANY_SEP({SEP:l,DEF:function(){return t.push(e.SUBRULE(e.controlPoint))}}),e.CONSUME(c)}},{ALT:function(){e.CONSUME2(g)}}]),e.CONSUME(d)})),e.CONSUME(a),t})),e.margins=e.RULE("margins",(function(){var t={};return e.CONSUME(o),e.MANY((function(){var n=e.CONSUME(g).image;e.CONSUME(u);var r=e.SUBRULE(e.curlyBraceBlock).rules;"visible"!==n&&"appear"!==n||(t[n]={},void 0!==r.top_bottom&&(t[n].top_bottom=r.top_bottom),void 0!==r.left_right&&(t[n].left_right=r.left_right)),e.CONSUME(d)})),e.CONSUME(a),t})),e.array=e.RULE("array",(function(){var t=[];return e.CONSUME(s),e.MANY((function(){var n=e.OR([{ALT:function(){return e.CONSUME(g)}},{ALT:function(){return e.CONSUME(b)}},{ALT:function(){return e.CONSUME(y)}},{ALT:function(){return e.CONSUME(x)}}]);t.push(e.formatToken(n)),e.OPTION((function(){e.CONSUME(l)}))})),e.CONSUME(c),t})),e.controlPoint=e.RULE("controlPoint",(function(){var t={};return e.CONSUME(o),e.MANY((function(){var n=e.formatToken(e.CONSUME(g));e.CONSUME(u);var r=e.OR([{ALT:function(){return e.CONSUME(b)}},{ALT:function(){return e.CONSUME(y)}}]);e.CONSUME(d),t[n]=e.formatToken(r)})),e.CONSUME(a),[t.key,t.value,t.base?t.base:1]})),e.declaration=e.RULE("declaration",(function(){var t=[],n=e.CONSUME(g).image;if(e.CONSUME(u),void 0!==M[n]){var r=e.SUBRULE(e.margins);M[n].forEach((function(e){j.forEach((function(n){void 0!==r[n]&&I.forEach((function(i){void 0!==r[n][i]&&t.push({property:e+"_"+n+"_margin_"+i+"_zpt",value:r[n][i]})}))}))}))}else{var i=e.OR([{ALT:function(){return e.CONSUME2(g)}},{ALT:function(){return e.CONSUME(b)}},{ALT:function(){return e.CONSUME(y)}},{ALT:function(){return e.CONSUME(x)}},{ALT:function(){return e.SUBRULE(e.curve)}},{ALT:function(){return e.SUBRULE(e.array)}}]);t.push({property:n,value:"image"in i?e.formatToken(i):i})}return e.CONSUME(d),t})),e.declarationBlock=e.RULE("declarationBlock",(function(){var t=[],n={};e.MANY((function(){e.OR1([{ALT:function(){var t=e.SUBRULE(e.declaration);(Array.isArray(t)?t:[]).forEach((function(t){n[t.property]=t.value}))}},{ALT:function(){var n=e.SUBRULE(e.selectorORGroup);e.OR2([{ALT:function(){var r=Object.assign({},e.SUBRULE(e.curlyBraceBlock));r.selector=n,t.push(r)}},{ALT:function(){var r=Object.assign({},e.SUBRULE(e.angleBraceBlock));r.selector=n,t.push(r)}}])}}])}));var r={};return t.length&&(r.children=t),r.rules=n,r})),e.curlyBraceBlock=e.RULE("curlyBraceBlock",(function(){e.CONSUME(o);var t=e.SUBRULE(e.declarationBlock);return e.CONSUME(a),t})),e.angleBraceBlock=e.RULE("angleBraceBlock",(function(){e.CONSUME(p);var t=Object.assign({},e.SUBRULE(e.declarationBlock));return e.CONSUME(m),t.isMod=!0,t})),e.zss=e.RULE("zss",(function(){var t=[];return e.MANY((function(){var n=e.SUBRULE(e.selectorORGroup);e.OR([{ALT:function(){var r=Object.assign({},e.SUBRULE(e.curlyBraceBlock));r.selector=n,t.push(r)}},{ALT:function(){var r=Object.assign({},e.SUBRULE(e.angleBraceBlock));r.selector=n,t.push(r)}}])})),{selector:[[]],rules:{},children:t}})),e.performSelfAnalysis(),e}return r.hexToRgb=function(t){6===(t=t.slice(1)).length&&(t="ff"+t);var e=parseInt(t,16);return(4278190080&e)>>24<<24|(16711680&e)>>16|(65280&e)>>8<<8|(255&e)<<16},r.formatToken=function(t){var e=void 0!==t.tokenType?t.tokenType.name:void 0;return"NumberLiteral"===e?parseFloat(t.image):"ColorLiteral"===e?this.hexToRgb(t.image):t.image},w}(r.EmbeddedActionsParser),E=new r.Lexer(O),A=new T,L={symbol:{line_symbol:0,area_symbol:1,building_symbol:2,point_symbol:3,label_point_symbol:4,label_line_symbol:5,dashed_line_symbol:6,one_way_line_symbol:7,poi_symbol:8,pixel_line_symbol:9,model_symbol:10,phased_area_symbol:11,striped_line_symbol:12,floor_symbol:13,transparent_line_symbol:14,fence_symbol:15,unknown_symbol:100500},possible_label_placements:{no_label:0,bottom_center:1,bottom_right:2,bottom_left:4,circle_bottom_right:8,right_bottom:16,right_center:32,right_top:64,circle_top_right:128,top_center:256,top_right:512,top_left:1024,circle_top_left:2048,left_top:4096,left_center:8192,left_bottom:16384,circle_bottom_left:32768,center_center:65536}},C={"=":0,">":1,"<":2,">=":3,"<=":4,"!=":5},P={begin:0,top:0,left:0,center:1,right:2,bottom:2,end:2};function k(t,e,n,r,i,o,a){if("possible_label_placements"===t){var s=L.possible_label_placements;return Array.isArray(e)?e.reduce((function(t,e){return t|s[e]}),0):s[e]}if("phase"===t||"phase2"===t||"phase3"===t||"wall_phase"===t){var c=r[e];return"number"==typeof e?e:(void 0===c&&console.log("Unknown phase "+e),c||0)}if("font"===t||"font2"===t){var l=n[e];return void 0===l&&console.log("Unknown font "+e),l||0}if("symbol"===t){var u=L.symbol[e];return void 0===u?(console.log("Unknown symbol "+e),L.symbol.unknown_symbol):u}if("raster_set"===t){var d=i[e];return void 0===d?(console.log("Unknown raster_set "+e),NaN):d}if("labeling_group"===t||"icon_labeling_group"===t||"text_labeling_group"===t||"text2_labeling_group"===t){var f=o[e];return void 0===f?(console.log("Unknown labeling_group "+e),o.default):f}if("label_halign"===t||"label_valign"===t){var h=P[e];return void 0===h&&console.log("Unknown label_align "+e),h||0}return"true"===e?1:"false"===e?0:"string"==typeof e&&e in a?a[e]:e}var N=["color","color2","color3","border_color","contour_color","dash_color","dash2_color","space_color","space2_color","font_color","halo_color","font2_color","halo2_color","wall_color","width_zpt","width2_zpt","width3_zpt","border_width_zpt","opacity","outer_edge_width_zpt","dash_length_zpt","dash2_length_zpt","space_length_zpt","length_zpt","font_size_zpt","font2_size_zpt","duplication_spacing_zpt","poi_label_offset","label2_offset","shift_zpt","icon_width_zpt","height"],R=new ArrayBuffer(4),z=new Float32Array(R),B=new Uint32Array(R);function F(t){return z[0]=t,B[0].toString(36)}var D={db_icon_priority:"icon_priority",db_label_priority:"label_priority",db_label2_priority:"label2_priority"},U=n(41),Z=n.n(U);function H(t){var e=t.zss,n=void 0===e?"":e,r=t.phases,i=void 0===r?{}:r,o=t.rasterSets,a=void 0===o?[]:o,s=t.labelingGroups,c=void 0===s?{}:s,l=t.constantStrings,u=void 0===l?{}:l,d=t.defaultProps,f=void 0===d?{}:d,h=function(t){var e=E.tokenize(t);A.input=e.tokens;var n=A.zss();return{lexerErrors:e.errors,parserErrors:A.errors,ast:n}}(n);G("lexer",h.lexerErrors,n),G("parser",h.parserErrors);var p=h.ast;!function t(e){if(e.selector.forEach((function(t){t.forEach((function(t){"g_z_level"===t[0]&&(">"===t[1]||">="===t[1]?e.rules.min_zoom=t[2]:"<"!==t[1]&&"<="!==t[1]||(e.rules.max_zoom=t[2]))}))})),e.selector=e.selector.map((function(t){return t.filter((function(t){return"g_z_level"!==t[0]}))})),e.children){var n=[];e.children.forEach((function(t){var e,r;t.selector.length>1&&(e=t.selector,r=!1,e.forEach((function(t){t.forEach((function(t){"g_z_level"===t[0]&&(r=!0)}))})),r)?t.selector.forEach((function(e){var r=Z()(t);r.selector=[e],n.push(r)})):n.push(t)})),e.children=n,e.children.forEach((function(e){return t(e)}))}}(p),function t(e){var n={};for(var r in e.rules)void 0!==D[r]?n[D[r]]=e.rules[r]:(n[r]=e.rules[r],r.startsWith("db_")&&console.log("WARNING: database property "+r+" is overridden in ZSS."));e.rules=n,e.children&&e.children.forEach((function(e){return t(e)}))}(p);var m,v,_=(function t(e,n,r){Object.keys(e.rules).forEach((function(t){if(N.includes(t)){var i=e.rules[t];Array.isArray(i)||(i=[[0,i,1]]);var o=i.reduce((function(t,e){return t+(F(e[0])+"_")+F(e[1])+"_"+F(e[2])+"_"}),"");o in r||(n.push(i),r[o]=n.length-1),e.rules[t]=r[o]}})),e.children&&e.children.forEach((function(e){return t(e,n,r)}))}(p,m=[],{}),m),g=function(t){var e=new Set;return function t(e,n){Object.keys(e.rules).forEach((function(t){if("font"===t||"font2"===t){var r=e.rules[t];n.add(r)}})),e.children&&e.children.forEach((function(e){return t(e,n)}))}(t,e),Array.from(e)}(p),y=function(t){var e={};return t.forEach((function(t,n){e[t.name]=n})),e}(a),b=function(t){var e=void 0!==t.groups?t.groups:[],n=void 0!==t.overlay?t.overlay:[],r=void 0!==t.intersect?t.intersect:[];e.includes("default")||e.unshift("default");for(var i=e.reduce((function(t,e,n){return t[e]=n,t}),{}),o=[],a=0;a<e.length;a++){for(var s=[],c=0;c<e.length;c++)s.push(!0);o.push(s)}for(var l=0;l<n.length;l++)for(var u=n[l],d=0;d<u.length;d++)for(var f=d+1;f<u.length;f++){var h=i[u[d]],p=i[u[f]];o[h][p]=!1,o[p][h]=!1}for(var m=0;m<r.length;m++)for(var v=r[m],_=0;_<v.length;_++)for(var g=_+1;g<v.length;g++){var y=i[v[_]],b=i[v[g]];o[y][b]=!0,o[b][y]=!0}return{config:{groups:e,table:o},groupToIndex:i}}(c);return function t(e,n,r,i,o,a){for(var s in e.selector.forEach((function(t){t.forEach((function(t){var e=t[0];t[1]=C[t[1]],t[2]=k(e,t[2],n,r,i,o,a)}))})),e.rules)e.rules[s]=k(s,e.rules[s],n,r,i,o,a);e.children&&e.children.forEach((function(e){return t(e,n,r,i,o,a)}))}(p,(v={},g.forEach((function(t,e){v[t]=e})),v),i,y,b.groupToIndex,u),{ast:p,fonts:g,curves:_,phases:i,rasterSets:a,labelingGroups:b.config,constantStrings:u,defaultProps:f,version:"2.1.0"}}function G(t,e,n){var r;"lexer"===t&&(r=n.split("\n"));for(var i=0;i<5&&i<e.length;i++){var o=e[i],a=["error: "+o.message];"lexer"===t&&a.push("line:"+r[o.line-1]),console.log(a.join("\n"))}if(5<e.length&&console.log(">- Also "+(e.length-5)+" errors found -<"),"parser"===t&&e.length>0)throw new Error("Parser fatal error")}}])},function(t,e){e.read=function(t,e,n,r,i){var o,a,s=8*i-r-1,c=(1<<s)-1,l=c>>1,u=-7,d=n?i-1:0,f=n?-1:1,h=t[e+d];for(d+=f,o=h&(1<<-u)-1,h>>=-u,u+=s;u>0;o=256*o+t[e+d],d+=f,u-=8);for(a=o&(1<<-u)-1,o>>=-u,u+=r;u>0;a=256*a+t[e+d],d+=f,u-=8);if(0===o)o=1-l;else{if(o===c)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,r),o-=l}return(h?-1:1)*a*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var a,s,c,l=8*o-i-1,u=(1<<l)-1,d=u>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,p=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=u):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),(e+=a+d>=1?f/c:f*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=u?(s=0,a=u):a+d>=1?(s=(e*c-1)*Math.pow(2,i),a+=d):(s=e*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;t[n+h]=255&s,h+=p,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+h]=255&a,h+=p,a/=256,l-=8);t[n+h-p]|=128*m}},function(t){t.exports=JSON.parse('{"exportConfig":{},"classes":{"line":0},"sublayers":{"Traffic_jams":0},"version":"","zenithVersion":"","date":"","defaultProps":{},"tileProps":["db_class","db_sublayer","traffic_road_class","traffic_color"],"sepStyles":{"ast":{"selector":[[]],"rules":{},"children":[{"children":[{"rules":{"shift_zpt":1},"isMod":true,"selector":[[["g_dpi",4,96]]]},{"rules":{"shift_zpt":2},"isMod":true,"selector":[[["g_dpi",1,96]]]},{"rules":{"color":3,"color2":4},"isMod":true,"selector":[[["traffic_color",0,0]]]},{"rules":{"color":5,"color2":6},"isMod":true,"selector":[[["traffic_color",0,1]]]},{"rules":{"color":7,"color2":8},"isMod":true,"selector":[[["traffic_color",0,2]]]},{"rules":{"color":9,"color2":10},"isMod":true,"selector":[[["traffic_color",0,3]]]},{"rules":{"color":11,"color2":0},"isMod":true,"selector":[[["traffic_color",0,12]]]},{"rules":{"width_zpt":12,"width2_zpt":13,"width3_zpt":14},"isMod":true,"selector":[[["traffic_road_class",0,3]]]},{"rules":{"width_zpt":12,"width2_zpt":13,"width3_zpt":14},"isMod":true,"selector":[[["traffic_road_class",0,4]]]},{"rules":{"width_zpt":15,"width2_zpt":16,"width3_zpt":17},"isMod":true,"selector":[[["traffic_road_class",0,5]]]},{"rules":{"width_zpt":18,"width2_zpt":19,"width3_zpt":20},"isMod":true,"selector":[[["traffic_road_class",0,6]]]},{"children":[{"rules":{"shift_zpt":21},"isMod":true,"selector":[[["g_dpi",4,96]]]},{"rules":{"shift_zpt":22},"isMod":true,"selector":[[["g_dpi",1,96]]]}],"rules":{},"isMod":true,"selector":[[["traffic_road_class",0,6]]]},{"rules":{"width_zpt":23,"width2_zpt":24,"width3_zpt":25},"isMod":true,"selector":[[["traffic_road_class",0,7]]]},{"children":[{"rules":{"shift_zpt":26},"isMod":true,"selector":[[["g_dpi",4,96]]]},{"rules":{"shift_zpt":27},"isMod":true,"selector":[[["g_dpi",1,96]]]}],"rules":{},"isMod":true,"selector":[[["traffic_road_class",0,7]]]},{"rules":{},"selector":[[]]}],"rules":{"symbol":0,"color3":0,"phase":2000000080.00004,"phase2":2000000080.00003,"phase3":2000000080.00002},"selector":[[["db_sublayer",0,"Traffic_jams"]]]}]},"fonts":[],"curves":[[[0,-1,1]],[[13,3,1],[15,4,1],[17,5,1],[19,10,1]],[[13,4.5,1],[15,6.5,1],[17,8.5,1],[19,15,1]],[[0,-11422125,1]],[[12,-11422125,1],[14,-12278971,1]],[[0,-14829584,1]],[[12,-14829584,1],[14,-15356963,1]],[[0,-15921694,1]],[[12,-15921694,1],[14,-15592756,1]],[[0,-15724403,1]],[[12,-15724403,1],[14,-15856010,1]],[[0,-16251350,1]],[[14,2,1],[20,4.4,1]],[[14,3,1],[20,7.4,1]],[[14,6,1],[20,11,1]],[[14,2,1],[20,7.4,1]],[[14,3,1],[20,10.4,1]],[[14,6,1],[20,14,1]],[[14,2,1],[20,10.8,1]],[[14,3,1],[20,13.8,1]],[[14,6,1],[20,19,1]],[[13,3,1],[15,4.5,1],[17,6.5,1],[19,10,1]],[[13,4.5,1],[15,7.5,1],[17,11.5,1],[19,20,1]],[[14,2,1],[20,13.2,1]],[[14,3,1],[20,16.5,1]],[[14,6,1],[20,22,1]],[[13,3.5,1],[15,5,1],[17,7.5,1],[19,10,1]],[[13,4.5,1],[15,8.5,1],[17,13,1],[19,22,1]]],"phases":{"traffic_line_background":2000000080.00002,"traffic_line_outline":2000000080.00003,"traffic_line":2000000080.00004},"rasterSets":[],"labelingGroups":{"groups":["default"],"table":[[true]]},"constantStrings":{},"defaultProps":{},"version":"2.1.0"}}')},function(t,e,n){t.exports=function(){"use strict";function t(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function e(t,e){return t<e?-1:t>e?1:0}return function(n,r,i,o,a){!function e(n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,c=r-i+1,l=Math.log(s),u=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*u*(s-u)/s)*(c-s/2<0?-1:1);e(n,r,Math.max(i,Math.floor(r-c*u/s+d)),Math.min(o,Math.floor(r+(s-c)*u/s+d)),a)}var f=n[r],h=i,p=o;for(t(n,i,r),a(n[o],f)>0&&t(n,i,o);h<p;){for(t(n,h,p),h++,p--;a(n[h],f)<0;)h++;for(;a(n[p],f)>0;)p--}0===a(n[i],f)?t(n,i,p):t(n,++p,o),p<=r&&(i=p+1),r<=p&&(o=p-1)}}(n,r,i||0,o||n.length-1,a||e)}}()},function(t,e,n){var r=n(94);"string"==typeof r&&(r=[[t.i,r,""]]),n(96)(r,{insert:"head",singleton:!1}),r.locals&&(t.exports=r.locals)},function(t,e,n){(t.exports=n(95)(!1)).push([t.i,".mapgl-hover {\n    cursor: pointer;\n}\n\n.mapgl-dragging {\n    cursor: grabbing;\n}\n\n.mapgl-rotating {\n    cursor: move;\n}\n",""])},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n,r,i,o=t[1]||"",a=t[3];if(!a)return o;if(e&&"function"==typeof btoa){var s=(n=a,r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),"/*# ".concat(i," */")),c=a.sources.map((function(t){return"/*# sourceURL=".concat(a.sourceRoot).concat(t," */")}));return[o].concat(c).concat([s]).join("\n")}return[o].join("\n")}(e,t);return e[2]?"@media ".concat(e[2],"{").concat(n,"}"):n})).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];null!=o&&(r[o]=!0)}for(var a=0;a<t.length;a++){var s=t[a];null!=s[0]&&r[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="(".concat(s[2],") and (").concat(n,")")),e.push(s))}},e}},function(t,e,n){"use strict";var r,i={},o=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}();function a(t,e){for(var n=[],r={},i=0;i<t.length;i++){var o=t[i],a=e.base?o[0]+e.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}function s(t,e){for(var n=0;n<t.length;n++){var r=t[n],o=i[r.id],a=0;if(o){for(o.refs++;a<o.parts.length;a++)o.parts[a](r.parts[a]);for(;a<r.parts.length;a++)o.parts.push(m(r.parts[a],e))}else{for(var s=[];a<r.parts.length;a++)s.push(m(r.parts[a],e));i[r.id]={id:r.id,refs:1,parts:s}}}}function c(t){var e=document.createElement("style");if(void 0===t.attributes.nonce){var r=n.nc;r&&(t.attributes.nonce=r)}if(Object.keys(t.attributes).forEach((function(n){e.setAttribute(n,t.attributes[n])})),"function"==typeof t.insert)t.insert(e);else{var i=o(t.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(e)}return e}var l,u=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function d(t,e,n,r){var i=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=u(e,i);else{var o=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function f(t,e,n){var r=n.css,i=n.media,o=n.sourceMap;if(i&&t.setAttribute("media",i),o&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}var h=null,p=0;function m(t,e){var n,r,i;if(e.singleton){var o=p++;n=h||(h=c(e)),r=d.bind(null,n,o,!1),i=d.bind(null,n,o,!0)}else n=c(e),r=f.bind(null,n,e),i=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else i()}}t.exports=function(t,e){(e=e||{}).attributes="object"==typeof e.attributes?e.attributes:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r));var n=a(t,e);return s(n,e),function(t){for(var r=[],o=0;o<n.length;o++){var c=n[o],l=i[c.id];l&&(l.refs--,r.push(l))}t&&s(a(t,e),e);for(var u=0;u<r.length;u++){var d=r[u];if(0===d.refs){for(var f=0;f<d.parts.length;f++)d.parts[f]();delete i[d.id]}}}}},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"getCenterZoomByPoints",(function(){return p})),n.d(r,"getMousePositionInContainer",(function(){return m})),n.d(r,"projectMapToScreen",(function(){return s.y})),n.d(r,"projectGeoToMap",(function(){return c.l})),n.d(r,"projectGeoToScreen",(function(){return g})),n.d(r,"projectScreenToGeo",(function(){return y})),n.d(r,"getMetersFromPixels",(function(){return b}));var i={};n.r(i),n.d(i,"projectScreenToMap",(function(){return s.A})),n.d(i,"projectMapToScreen",(function(){return s.y})),n.d(i,"setVPMatrix",(function(){return s.G})),n.d(i,"getUrl",(function(){return s.p})),n.d(i,"projectGeoToMap",(function(){return c.l})),n.d(i,"projectMapToGeo",(function(){return c.m})),n.d(i,"getBounds",(function(){return c.c})),n.d(i,"hashToString",(function(){return x.d}));var o={};n.r(o),n.d(o,"linear",(function(){return R})),n.d(o,"ease",(function(){return B})),n.d(o,"easeInQuad",(function(){return F})),n.d(o,"easeOutQuad",(function(){return D})),n.d(o,"easeInOutQuad",(function(){return U})),n.d(o,"easeInCubic",(function(){return Z})),n.d(o,"easeOutCubic",(function(){return H})),n.d(o,"easeInOutCubic",(function(){return G})),n.d(o,"easeInQuart",(function(){return W})),n.d(o,"easeOutQuart",(function(){return V})),n.d(o,"easeInOutQuart",(function(){return q})),n.d(o,"easeInQuint",(function(){return Y})),n.d(o,"easeOutQuint",(function(){return X})),n.d(o,"easeInOutQuint",(function(){return K})),n.d(o,"easeInSine",(function(){return J})),n.d(o,"easeOutSine",(function(){return Q})),n.d(o,"easeInOutSine",(function(){return $})),n.d(o,"easeInExpo",(function(){return tt})),n.d(o,"easeOutExpo",(function(){return et})),n.d(o,"easeInOutExpo",(function(){return nt})),n.d(o,"easeInCirc",(function(){return rt})),n.d(o,"easeOutCirc",(function(){return it})),n.d(o,"easeInOutCirc",(function(){return ot})),n.d(o,"easeInElastic",(function(){return at})),n.d(o,"easeOutElastic",(function(){return st})),n.d(o,"easeInOutElastic",(function(){return ct})),n.d(o,"easeInBack",(function(){return lt})),n.d(o,"easeOutBack",(function(){return ut})),n.d(o,"easeInOutBack",(function(){return dt})),n.d(o,"easeOutBounce",(function(){return ft})),n.d(o,"inertia",(function(){return ht}));var a=n(1),s=n(2),c=n(3),l=n(4),u=n(14),d=n(10);function f(t,e,n){if(0!==t.length){for(var r=Object(s.h)(e),i=u.e(),o=0,a=t;o<a.length;o++){var f=a[o],p=Object(c.l)(f);Object(d.m)(p,-r),u.f(i,p)}var m=l.d();return u.a(m,i),Object(d.m)(m,r),{center:m,zoom:h(i,n)}}}function h(t,e){return Math.min(Object(d.q)(e[0],Math.abs(t.max[0]-t.min[0])),Object(d.q)(e[1],Math.abs(t.max[1]-t.min[1])))}function p(t,e,n){var r=f(t,e,n);if(r)return{zoom:r.zoom,center:Object(c.m)(r.center)}}function m(t,e,n){var r=t.getBoundingClientRect();return[e-r.left-t.clientLeft,n-r.top-t.clientTop]}function v(t,e){for(var n=[],r=0;r<t.length;r++)n[r]=m(e,t[r].clientX,t[r].clientY);return n}function _(t){return t.touches.length>1}function g(t,e,n,r,i,o,a,l){void 0===a&&(a={top:0,right:0,bottom:0,left:0}),void 0===l&&(l={top:0,right:0,bottom:0,left:0});var u={center:Object(c.l)(t),zoom:e,rotation:Object(s.h)(n),size:r,pitch:Object(s.h)(i),viewport:a,padding:l};return Object(s.y)(u,Object(c.l)(o))}function y(t,e,n,r,i,o,a,l){void 0===a&&(a={top:0,right:0,bottom:0,left:0}),void 0===l&&(l={top:0,right:0,bottom:0,left:0});var u={center:Object(c.l)(t),zoom:e,rotation:Object(s.h)(n),size:r,pitch:Object(s.h)(i),viewport:a,padding:l};return Object(c.m)(Object(s.A)(u,o))}function b(t,e,n,r,i,o,a,l,u){void 0===a&&(a={top:0,right:0,bottom:0,left:0}),void 0===l&&(l={top:0,right:0,bottom:0,left:0});var d={center:Object(c.l)(t),zoom:e,rotation:Object(s.h)(n),size:r,pitch:Object(s.h)(i),viewport:a,padding:l},f=Object(c.m)(Object(s.A)(d,o)),h=Object(c.m)(Object(s.A)(d,[o[0]+u,o[1]+u]));return Math.max(1,Object(c.a)(f,h))}var x=n(0),w=n(5),S=n(30),O=0;function M(){return++O}var j=function(t){function e(e){var n=t.call(this)||this;return n.uniqId=M(),n.modules=e.modules,n.mapState=e.state,n.tileObjects=[],n.identifyIds=[],n}return Object(w.c)(e,t),e.prototype.update=function(){},e.prototype.destroy=function(){var t=this,e=this.modules;this.style&&e.dynamicStyle.removeExtractedCurves(this.style),this.tileObjects.forEach((function(n){n.clean(t.mapState),e.tileManager.removeObject(n)})),this.tileObjects=[],e.layers.removeLayer(this),this.mapState.needRerender=!0},e}(S.a),I=n(17),T=n(7),E=n(18),A=n(19),L={fill:{phase:"phase",color:"color",width:"width",dashColor:"dashColor",spaceColor:"spaceColor"},border:{phase:"phase2",color:"color2",width:"width2",dashColor:"dash2Color"},border2:{phase:"phase3",color:"color3",width:"width3"},fontFill:{color:"fontColor",phase:"phase"},fontHalo:{color:"haloColor",phase:"phase"}};function C(t,e,n){return e[L[n||"fill"][t]]}var P=n(9);function k(t,e,n){var r=new P.a(n);r.drawType=P.a.StaticDraw,r.prepare(t.getRenderingContext());var i=e.map((function(t){return t.vaoCreator(r,t.program)}));return{buffer:r,vaos:i}}var N=n(8);function R(t,e,n,r,i){return n+r/i*e}var z=n(84)(.25,.1,.25,1);function B(t,e,n,r,i){return n+r*z(e/i)}function F(t,e,n,r,i){return r*(e/=i)*e+n}function D(t,e,n,r,i){return-r*(e/=i)*(e-2)+n}function U(t,e,n,r,i){return(e/=i/2)<1?r/2*e*e+n:-r/2*(--e*(e-2)-1)+n}function Z(t,e,n,r,i){return r*(e/=i)*e*e+n}function H(t,e,n,r,i){return r*((e=e/i-1)*e*e+1)+n}function G(t,e,n,r,i){return(e/=i/2)<1?r/2*e*e*e+n:r/2*((e-=2)*e*e+2)+n}function W(t,e,n,r,i){return r*(e/=i)*e*e*e+n}function V(t,e,n,r,i){return-r*((e=e/i-1)*e*e*e-1)+n}function q(t,e,n,r,i){return(e/=i/2)<1?r/2*e*e*e*e+n:-r/2*((e-=2)*e*e*e-2)+n}function Y(t,e,n,r,i){return r*(e/=i)*e*e*e*e+n}function X(t,e,n,r,i){return r*((e=e/i-1)*e*e*e*e+1)+n}function K(t,e,n,r,i){return(e/=i/2)<1?r/2*e*e*e*e*e+n:r/2*((e-=2)*e*e*e*e+2)+n}function J(t,e,n,r,i){return-r*Math.cos(e/i*(Math.PI/2))+r+n}function Q(t,e,n,r,i){return r*Math.sin(e/i*(Math.PI/2))+n}function $(t,e,n,r,i){return-r/2*(Math.cos(Math.PI*e/i)-1)+n}function tt(t,e,n,r,i){return 0==e?n:r*Math.pow(2,10*(e/i-1))+n}function et(t,e,n,r,i){return e==i?n+r:r*(1-Math.pow(2,-10*e/i))+n}function nt(t,e,n,r,i){return 0==e?n:e==i?n+r:(e/=i/2)<1?r/2*Math.pow(2,10*(e-1))+n:r/2*(2-Math.pow(2,-10*--e))+n}function rt(t,e,n,r,i){return-r*(Math.sqrt(1-(e/=i)*e)-1)+n}function it(t,e,n,r,i){return r*Math.sqrt(1-(e=e/i-1)*e)+n}function ot(t,e,n,r,i){return(e/=i/2)<1?-r/2*(Math.sqrt(1-e*e)-1)+n:r/2*(Math.sqrt(1-(e-=2)*e)+1)+n}function at(t,e,n,r,i){var o=1.70158,a=0,s=r;return 0==e?n:1==(e/=i)?n+r:(a||(a=.3*i),s<Math.abs(r)?(s=r,o=a/4):o=a/(2*Math.PI)*Math.asin(r/s),-s*Math.pow(2,10*(e-=1))*Math.sin((e*i-o)*(2*Math.PI)/a)+n)}function st(t,e,n,r,i){var o=1.70158,a=0,s=r;return 0==e?n:1==(e/=i)?n+r:(a||(a=.3*i),s<Math.abs(r)?(s=r,o=a/4):o=a/(2*Math.PI)*Math.asin(r/s),s*Math.pow(2,-10*e)*Math.sin((e*i-o)*(2*Math.PI)/a)+r+n)}function ct(t,e,n,r,i){var o=1.70158,a=0,s=r;return 0==e?n:2==(e/=i/2)?n+r:(a||(a=i*(.3*1.5)),s<Math.abs(r)?(s=r,o=a/4):o=a/(2*Math.PI)*Math.asin(r/s),e<1?s*Math.pow(2,10*(e-=1))*Math.sin((e*i-o)*(2*Math.PI)/a)*-.5+n:s*Math.pow(2,-10*(e-=1))*Math.sin((e*i-o)*(2*Math.PI)/a)*.5+r+n)}function lt(t,e,n,r,i,o){return null==o&&(o=1.70158),r*(e/=i)*e*((o+1)*e-o)+n}function ut(t,e,n,r,i,o){return null==o&&(o=1.70158),r*((e=e/i-1)*e*((o+1)*e+o)+1)+n}function dt(t,e,n,r,i,o){return null==o&&(o=1.70158),(e/=i/2)<1?r/2*(e*e*((1+(o*=1.525))*e-o))+n:r/2*((e-=2)*e*((1+(o*=1.525))*e+o)+2)+n}function ft(t,e,n,r,i){return(e/=i)<1/2.75?r*(7.5625*e*e)+n:e<2/2.75?r*(7.5625*(e-=1.5/2.75)*e+.75)+n:e<2.5/2.75?r*(7.5625*(e-=2.25/2.75)*e+.9375)+n:r*(7.5625*(e-=2.625/2.75)*e+.984375)+n}function ht(t,e,n,r,i){return r*(1-Math.pow(1-e/i,a.inertia.nonLinearity+1))+n}var pt={easing:"easeInOutQuad",forceFinalValue:!0,renderAfterUpdate:!0};function mt(t,e){return e.tickers[t]}function vt(t,e,n,r,i,o,a){n.tickers[t]=Object(w.a)(Object(w.a)(Object(w.a)({},pt),e),{from:r,to:i,duration:o,uniforms:a,startTime:n.time})}function _t(t,e){delete e.tickers[t]}function gt(t,e,n){var r=n.tickers[t];if(r){var i,o=n.time-r.startTime;if(r.from.length){i=[];for(var a=0;a<r.from.length;a++){var s=yt(r.easing,r.from[a],r.to[a],r.duration,o);i.push(s)}}else i=yt(r.easing,r.from,r.to,r.duration,o);var c=!1;o>=r.duration&&(r.forceFinalValue&&(i=r.to),c=!0),e.step&&e.step(n,i,r.uniforms),c&&(_t(t,n),e.complete&&e.complete(n)),r.renderAfterUpdate&&(n.needRerender=!0)}}function yt(t,e,n,r,i){return o[t](null,i,e,n-e,r)}var bt=0,xt=function(){function t(t,e,n,r,i){void 0===r&&(r=[0,0,0,0]),this.tickerName="tile-fade-"+t+"-"+bt++,this.readiness=1,this.purpose=t,this.dynamicObject=i,this.mvpMatrix=new Float32Array(E.b()),this.setTileCoords(r);var o=function(t,e,n){for(var r=[],i=[],o=[],a=0;a<e.length;a++){var s=e[a],c=s.symbol,l=s.sink,u=s.generatedObjects,d=s.buffer,f=t.symbolSettingsList[c];if(void 0!==f){var h=f[l];if(void 0!==h){var p=k(t,h,d),m=p.buffer,v=p.vaos;r.push(m);for(var _=0;_<u.length;_++)for(var g=u[_],y=g.rangeStart,b=g.rangeEnd,x=g.uniforms,w=g.hash,S=Object(A.f)(c,l,x),O=0;O<h.length;O++){var M=h[O],j=M.uniformSet||"fill",I=C("phase",S,j);if(!Number.isNaN(I)){var T={layerSettings:M,stride:Object(A.e)(c,l),rangeStart:y,rangeEnd:b,uniforms:S,uniformsHash:w+"_"+j+"_"+n.detailLevel,vao:v[O],tile:n,symbol:c,sink:l};M.identify?o.push(T):i.push(T)}}}}}return{buffers:r,objects:i,identifyObjects:o}}(n,e,this),a=o.buffers,s=o.objects,c=o.identifyObjects;this.buffers=a,this.children=s,this.identifyChildren=c}return t.prototype.setTileCoords=function(t){var e=t[2],n=t[3],r=Object(c.r)(e);this.size=r,this.zoomLevel=e,this.detailLevel=n,this.modelMatrix=E.d(E.b(),Object(c.p)(t),l.i(r,r,N.j))},t.prototype.updateMvpMatrix=function(t){E.g(this.mvpMatrix,t,this.modelMatrix)},t.prototype.startTicker=function(t,e,n,r,i){vt(this.tickerName,{easing:e},t,r,i,n)},t.prototype.updateTicker=function(t){var e=this;gt(this.tickerName,{step:function(t,n){e.readiness=n}},t)},t.prototype.tickerFinished=function(t){return!function(t,e){return!!e.tickers[t]}(this.tickerName,t)},t.prototype.clean=function(t){for(var e=0,n=this.buffers;e<n.length;e++)n[e].remove();this.buffers=[],this.children=[],this.identifyChildren=[],_t(this.tickerName,t)},t}(),wt=n(20),St=n(22);function Ot(t){if(void 0!==t){var e={id:Object(wt.a)(t.id[0],t.id[1]),symbol:t.symbol};return"poi"===t.symbol&&(e.isText=1===t.instanceId),t.sublayer&&(e.isCommercial=Object(St.f)(t.sublayer),e.isPersonal=Object(St.i)(t.sublayer),"poi"!==t.symbol||e.isCommercial||(e.sysCode=t.objectClass)),e}}var Mt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.start=function(t){var e=r,n=e.mapState,i=e.modules,o=e.container;if(0===t.button){var a=m(o,t.clientX,t.clientY);r.contains(a)&&i.handler.block()&&(i.mouseMoveHandler.block(),r.dragStartCursorPoint=a,r.dragStartAnchorPoint=Object(s.y)(n,r.getPosition()),document.addEventListener("mouseup",r.stop),document.addEventListener("mousemove",r.move),r.emitEvent("dragstart",t,n))}},r.move=function(t){var e=r,n=e.dragStartAnchorPoint,i=e.dragStartCursorPoint,o=e.mapState,a=e.container;if(void 0!==n&&void 0!==i){var c=m(a,t.clientX,t.clientY),l=T.b(n);T.a(l,l,c),T.p(l,l,i),r.setPosition(Object(s.A)(o,l)),r.emitEvent("drag",t,o)}},r.stop=function(t){if(0===t.button){r.dragStartCursorPoint=void 0,r.dragStartAnchorPoint=void 0,document.removeEventListener("mouseup",r.stop),document.removeEventListener("mousemove",r.move);var e=r,n=e.modules,i=e.mapState;n.handler.unblock(),n.mouseMoveHandler.unblock(),r.emitEvent("dragend",t,i),r.isInteractive()&&n.identifier.resetCache()}},r.container=e.modules.layout.mapContainer,n&&r.container.addEventListener("mousedown",r.start,!0),r}return Object(w.c)(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this),this.container.removeEventListener("mousedown",this.start,!0),document.removeEventListener("mouseup",this.stop),document.removeEventListener("mousemove",this.move)},e.prototype.emitEvent=function(t,e,n){var r=this.modules,i=this.getPosition(),o=Object(c.m)(i),a=Object(s.y)(n,i),l=r.identifier.searchSync(a),u=void 0!==l&&void 0===l.dynamicObjectId?Ot(l):void 0;this.emit(t,{originalEvent:e,target:u,lngLat:o,point:a})},e}(j),jt=n(12),It=function(t){function e(n,r){var i=t.call(this,n,r.draggable)||this;i.options=Object(s.b)(r,e.options),i.center=Object(c.l)(i.options.coordinates);var o=i.modules,a=o.dynamicStyle,l=o.collector,u=o.renderer,d=o.tileManager,f=o.identifier,h=o.layers;i.style=a.extractCurvesFromStyle({phase:i.options.phase,minZoom:i.options.minZoom,maxZoom:i.options.maxZoom,color:Object(jt.b)(i.options.color),color2:Object(jt.b)(i.options.borderColor),color3:Object(jt.b)(i.options.border2Color),width:i.options.width,width2:Object(jt.d)(i.options.width,i.options.borderWidth),width3:Object(jt.d)(i.options.width,i.options.borderWidth+i.options.border2Width)});var p=Object(c.j)(i.center),m=Object(jt.e)(i.style),v=Object(jt.f)({id:i.options.interactive?[0,0]:NaN});Object(A.c)("circleMarker",a.getStyle(),x.a,l,m,v,[[0],[0]],1,p,-1,-1);var _=l.getAccumulatedData(),g=new xt("dynamicObject",_.data,u,p);return d.addObject(g),i.tileObjects.push(g),i.options.interactive&&i.identifyIds.push(_.identifyIds),h.addLayer(i),l.reset(),i.mapState.needRerender=!0,i.options.interactive&&f.resetCache(),i}return Object(w.c)(e,t),e.prototype.remove=function(){this.options.interactive&&this.modules.identifier.resetCache(),t.prototype.destroy.call(this)},e.prototype.setPosition=function(t){var e=this.mapState,n=this.tileObjects[0];void 0!==n&&(this.center=t,n.setTileCoords(Object(c.j)(t)),e.needRerender=!0)},e.prototype.getPosition=function(){return this.center},e.prototype.isInteractive=function(){return this.options.interactive},e.prototype.contains=function(t){var e=this.mapState,n=Object(s.y)(e,this.center),r=(Array.isArray(this.options.width)?Object(I.c)(this.options.width,e.styleZoom):this.options.width)/2+this.options.borderWidth+this.options.border2Width;return T.e(n,t)<=r},e.options={coordinates:[0,0],minZoom:NaN,maxZoom:NaN,phase:0,color:"#ffffff",width:20,borderColor:"#3388ff",borderWidth:3,border2Color:"#00000000",border2Width:0,interactive:!0,draggable:!1},e}(Mt);function Tt(t,e,n){var r=t.viewport,i=r.top,o=r.right,a=r.bottom,s=r.left,c=e.clientWidth,l=e.clientHeight;t.size=[Math.max(1,c-s-o),Math.max(1,l-i-a)],n.updateIdentifySize()}function Et(t,e){var n=t.padding,r=n.top,i=n.right,o=n.bottom,a=n.left;t.padding={top:r,right:i,bottom:o,left:a},t.needRerender=!0,e.updateIdentifySize()}var At=_t.bind(null,"inertia"),Lt=function(t,e){gt("inertia",{step:function(t,n,r){var i=r.startPoint,o=r.startSpeed,s=r.startTime,d=r.direction,f=l.b(d);l.o(f,f,n),l.a(f,f,i),u.c(t.maxBounds,f)||Ct(e,t),t.center=f,"zoom"===t.zoomTypePreserving?t.styleZoom=Object(c.f)(t.zoom,f):t.zoom=Object(c.h)(t.styleZoom,f);var h=function(t,e,n){return t*Math.pow(1-(n-e)/a.inertia.duration,a.inertia.nonLinearity)}(o,s,t.time);Object(c.t)(h,t.zoom)<a.inertia.minSpeed&&Ct(e,t)}},t)},Ct=function(t,e){_t("inertia",e),t.classList.remove("mapgl-inertia")},Pt=function(t,e,n){void 0===n&&(n={}),_t("center",t),At(t);var r=l.d();if(u.b(r,t.maxBounds,e),!1===n.animate)t.center=r,"zoom"===t.zoomTypePreserving?t.styleZoom=Object(c.f)(t.zoom,e):t.zoom=Object(c.h)(t.styleZoom,e);else{var i=void 0!==n.easing?n.easing:"linear",o=void 0!==n.duration?n.duration:250;vt("center",{easing:i},t,t.center,r,o)}},kt=_t.bind(null,"center"),Nt=gt.bind(null,"center",{step:function(t,e){t.center=e,"zoom"===t.zoomTypePreserving?t.styleZoom=Object(c.f)(t.zoom,e):t.zoom=Object(c.h)(t.styleZoom,e)}}),Rt="rotation";function zt(t,e){return(t-=e)>=Math.PI?t=(t+Math.PI)%(2*Math.PI)-Math.PI:t<-Math.PI&&(t=Math.PI-(Math.PI-t)%(2*Math.PI)),t+e}function Bt(t,e,n){if(void 0===n&&(n={}),_t(Rt,t),!1===n.animate)t.rotation=zt(e,0);else{var r=void 0===n.normalize||n.normalize;vt(Rt,{easing:n.easing||"linear"},t,t.rotation,r?zt(e,t.rotation):e,n.duration||250)}}var Ft=_t.bind(null,Rt),Dt=gt.bind(null,Rt,{step:function(t,e){return t.rotation=zt(e,0)}}),Ut="pitch";function Zt(t,e,n){void 0===n&&(n={}),_t(Ut,t);var r=Object(s.e)(e,t.minPitch,t.maxPitch);!1===n.animate?t.pitch=r:vt(Ut,{easing:n.easing||"linear"},t,t.pitch,r,n.duration||300)}var Ht=_t.bind(null,Ut),Gt=gt.bind(null,Ut,{step:function(t,e){return t.pitch=e}}),Wt=function(t,e,n){void 0===n&&(n={}),_t("zoom",t);var r=Object(s.e)(e,t.minZoom,t.maxZoom);if(r!==t.zoom)if(!1===n.animate)n.zoomPoint&&(l.a(t.center,t.center,Object(s.k)(t,n.zoomPoint,{zoom:r})),u.b(t.center,t.maxBounds,t.center)),t.zoom=r,t.styleZoom=Object(c.f)(r,t.center);else{var i=n.animateHeight?Object(c.u)(t.zoom,t.size):t.zoom,o=n.animateHeight?Object(c.u)(r,t.size):r;vt("zoom",{easing:void 0!==n.easing?n.easing:"easeOutCubic"},t,i,o,void 0!==n.duration?n.duration:250,{zoomPoint:n.zoomPoint,animateHeight:!!n.animateHeight,blockBuildingAnimation:!!n.blockBuildingAnimation})}},Vt=_t.bind(null,"zoom"),qt=gt.bind(null,"zoom",{step:function(t,e,n){void 0===n&&(n={});var r=n.animateHeight?Object(c.i)(e,t.size):e;n.zoomPoint&&(l.a(t.center,t.center,Object(s.k)(t,n.zoomPoint,{zoom:r})),u.b(t.center,t.maxBounds,t.center)),t.zoom=r,t.styleZoom=Object(c.f)(r,t.center)}}),Yt=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!window.PointerEvent,Xt=window.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||Yt||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,Kt=te("webkit"),Jt=te("chrome")||te("crios"),Qt=(window,!Jt&&te("safari")),$t=(te("gecko")&&!Kt&&window.opera,navigator.platform.toUpperCase().indexOf("MAC")>=0);function te(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}function ee(t,e){var n=Object(w.a)({hitType:"event",eventCategory:"Metrics"},t);window.ga&&window.ga(a.analytics.gaName+".send",n)}function ne(t,e){var n,r;function i(){n=!1,r&&(o.apply(void 0,r),r=!1)}function o(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];n?r=o:(t.apply(void 0,o),setTimeout(i,e),n=!0)}return o}function re(t){Vt(t),kt(t),Ft(t),Ht(t),At(t)}var ie=function(){function t(t,e){var n=this;this.onWheelScroll=function(t){t.preventDefault(),void 0===t.deltaMode&&void 0===t.deltaY||(n.state.userHasInteracted=!0,n.screenPoint=m(n.container,t.clientX,t.clientY),t.ctrlKey?n.deltaAccumulator-=10*t.deltaY:1===t.deltaMode?n.deltaAccumulator-=20*t.deltaY:n.deltaAccumulator-=t.deltaY,n.eventCount+=1)},this.startZooming=function(){var t,e=n.state;t=$t?n.getDelta()*a.zoom.macTouchDelta:Object(s.H)(n.getDelta())*a.zoom.mouseDelta;var r=e.zoom+t,i=Object(s.e)(r,e.minZoom,e.maxZoom);i!==e.zoom&&(re(e),Wt(e,i,{duration:a.zoom.animDuration,animate:!$t,zoomPoint:n.screenPoint,blockBuildingAnimation:!0}))},this.stop=function(){n.state.userHasInteracted=!0,Vt(n.state)},this.state=t,this.container=e,$t||(this.startZooming=ne(this.startZooming,a.zoom.throttleDelay)),this.deltaAccumulator=0,this.eventCount=0,this.screenPoint=[0,0],this.container.addEventListener("wheel",this.onWheelScroll),this.container.addEventListener("mousedown",this.stop)}return t.prototype.destroy=function(){this.container.removeEventListener("wheel",this.onWheelScroll),this.container.removeEventListener("mousedown",this.stop)},t.prototype.update=function(){0!==this.eventCount&&(this.startZooming(),this.state.needRerender=!0)},t.prototype.getDelta=function(){var t=this.deltaAccumulator/this.eventCount;return this.deltaAccumulator=0,this.eventCount=0,t},t}(),oe=function(){function t(t){this.defs=t.map((function(t){return new ae(t)}))}return t.prototype.check=function(t){for(var e=this.defs,n=!1,r=0;r<e.length;r++)n?e[r].update(t):n=!e[r].equal(t);return n},t}(),ae=function(){function t(t){this.path=Array.isArray(t.path)?t.path:[t.path],this.type=t.type,"number"===this.type?(this.last=NaN,this.compare=this.primitive,this.updateFn=this.primitiveUpdate):"vec2"===this.type?(this.last=[NaN,NaN],this.compare=this.vec2,this.updateFn=this.vec2Update):"string"===this.type?(this.last="",this.compare=this.primitive,this.updateFn=this.primitiveUpdate):"padding"===this.type&&(this.last={left:0,right:0,bottom:0,top:0},this.compare=this.padding,this.updateFn=this.paddingUpdate)}return t.prototype.equal=function(t){var e=this.take(t),n=this.compare(this.last,e);return this.updateFn(e),n},t.prototype.update=function(t){this.updateFn(this.take(t))},t.prototype.take=function(t){var e=this.path,n=0;do{t=t[e[n++]]}while(n<e.length);return t},t.prototype.primitive=function(t,e){return t===e},t.prototype.padding=function(t,e){return t.top===e.top&&t.bottom===e.bottom&&t.left===e.left&&t.right===e.right},t.prototype.paddingUpdate=function(t){this.last.top=t.top,this.last.bottom=t.bottom,this.last.right=t.right,this.last.left=t.left},t.prototype.vec2=function(t,e){return t[0]===e[0]&&t[1]===e[1]},t.prototype.primitiveUpdate=function(t){this.last=t},t.prototype.vec2Update=function(t){this.last[0]=t[0],this.last[1]=t[1]},t}(),se=function(){function t(t,e){var n=this;this.onMouseUp=function(t){1===t.which&&n.start()},this.onTouchEnd=function(t){0===t.touches.length&&n.start()},this.start=function(){var t=n.state;t.userHasInteracted=!0;var e=n.getCurrentSpeed(t.time),r=l.k(e);if(!(Object(c.t)(r,t.zoom)<=a.inertia.minSpeed)){var i=Object(c.x)(a.inertia.maxSpeed,t.zoom),o=Math.min(r,i),s=n.calcDistanceByStartSpeed(o),u=l.b(t.center),d=l.d();l.n(d,e),function(t,e,n,r,i){vt("inertia",{easing:"inertia"},t,0,i,a.inertia.duration,{startPoint:e,startSpeed:n,direction:r,startTime:t.time})}(t,u,o,d,s),n.container.classList.add("mapgl-inertia")}},this.stop=function(){At(n.state),n.container.classList.remove("mapgl-inertia"),n.times=[],n.positions=[]},this.state=t,this.container=e,this.container.addEventListener("mouseup",this.onMouseUp),this.container.addEventListener("mousedown",this.stop),Xt&&(this.container.addEventListener("touchend",this.onTouchEnd),this.container.addEventListener("touchstart",this.stop)),this.zoomDiffer=new oe([{path:"zoom",type:"number"}]),this.styleZoomDiffer=new oe([{path:"styleZoom",type:"number"}]),this.centerDiffer=new oe([{path:"center",type:"vec2"}]),this.times=[],this.positions=[]}return t.prototype.destroy=function(){this.container.removeEventListener("mouseup",this.onMouseUp),this.container.removeEventListener("mousedown",this.stop),this.container.removeEventListener("touchend",this.onTouchEnd),this.container.removeEventListener("touchstart",this.stop)},t.prototype.update=function(){var t=this.state;this.centerDiffer.check(t)&&this.rememberTimeAndPosition(t),("zoom"===t.zoomTypePreserving?this.zoomDiffer.check(t):this.styleZoomDiffer.check(t))&&this.stop()},t.prototype.removeOldRecords=function(t){for(;t-this.times[0]>100&&this.times.length;)this.times.shift(),this.positions.shift()},t.prototype.rememberTimeAndPosition=function(t){var e=t.time;this.removeOldRecords(e),this.times.push(e),this.positions.push(l.b(t.center))},t.prototype.getCurrentSpeed=function(t){if(this.removeOldRecords(t),this.times.length<2)return l.d();var e=l.b(this.positions[this.positions.length-1]);return l.r(e,e,this.positions[0]),l.o(e,e,1/(this.times[this.times.length-1]-this.times[0])),e},t.prototype.calcDistanceByStartSpeed=function(t){return t*a.inertia.duration/(a.inertia.nonLinearity+1)},t}();function ce(t,e,n,r){if(e&&void 0!==e.dynamicObjectId){var i=t,o=r.layers.getDynamicObjectLayers().find((function(t){return t.uniqId===e.dynamicObjectId}));if(!o)return;o.emit(i,n)}else{var a=t;r.map.emit(a,n)}}var le=function(){function t(t,e){var n=this;this.emitMouseEvent=function(t){var e=m(n.container,t.clientX,t.clientY);n.emitEvent(t,e)},this.emitTouchEvent=function(t){var e=m(n.container,t.changedTouches[0].clientX,t.changedTouches[0].clientY);n.emitEvent(t,e)},this.state=t,this.container=e.layout.mapContainer,this.modules=e,this.container.addEventListener("mousedown",this.emitMouseEvent),this.container.addEventListener("mouseup",this.emitMouseEvent),this.container.addEventListener("touchstart",this.emitTouchEvent),this.container.addEventListener("touchend",this.emitTouchEvent)}return t.prototype.destroy=function(){this.container.removeEventListener("mousedown",this.emitMouseEvent),this.container.removeEventListener("mouseup",this.emitMouseEvent),this.container.removeEventListener("touchstart",this.emitTouchEvent),this.container.removeEventListener("touchend",this.emitTouchEvent)},t.prototype.update=function(){},t.prototype.emitEvent=function(t,e){var n=this;if(this.modules.layout.isActionWithCanvas(t)){var r={originalEvent:t,point:e,lngLat:Object(c.m)(Object(s.A)(this.state,e))},i=t.type;this.modules.identifier.search(i,e).then((function(t){t&&(r.target={id:Object(wt.a)(t.id[0],t.id[1]),symbol:t.symbol}),ce(i,t,r,n.modules)}))}},t}(),ue=function(){function t(t,e,n){var r=this;this.onGestureStart=function(t){t.preventDefault(),r.startRotation=r.state.rotation,r.isGestureStart=!0,r.startZoom=r.state.zoom,r.screenPoint=m(r.container,t.clientX,t.clientY),r.state.userHasInteracted=!0,r.state.disableRotationByUserInteraction||r.container.classList.add("mapgl-rotating"),r.map.emit("interactionstart",{target:"zoom/rotation"})},this.onGestureEnd=function(t){t.preventDefault(),r.isGestureStart&&(r.isGestureStart=!1,r.state.userHasInteracted=!0,r.container.classList.remove("mapgl-rotating"),r.map.emit("interactionend",{target:"zoom/rotation"}))},this.onGestureChange=function(t){t.preventDefault(),r.state.userHasInteracted=!0,r.gestureRotation=t.rotation/40,t.scale>1?r.gestureZoom=t.scale-1:r.gestureZoom=-1/t.scale+1},this.state=t,this.container=e,this.map=n,this.isGestureStart=!1,this.gestureRotation=0,this.gestureZoom=0,this.screenPoint=[0,0],this.startRotation=0,this.startZoom=0,this.container.addEventListener("gesturestart",this.onGestureStart),this.container.addEventListener("gestureend",this.onGestureEnd),this.container.addEventListener("gesturechange",this.onGestureChange)}return t.prototype.destroy=function(){this.container.removeEventListener("gesturestart",this.onGestureStart),this.container.removeEventListener("gestureend",this.onGestureEnd),this.container.removeEventListener("gesturechange",this.onGestureChange)},t.prototype.update=function(){if(0!==this.gestureRotation||0!==this.gestureZoom){var t=this.state,e=this.startZoom+this.gestureZoom,n=this.startRotation+this.gestureRotation,r=l.d();l.a(r,t.center,Object(s.k)(t,this.screenPoint,{zoom:e,rotation:n})),re(t),Pt(t,r,{animate:!1}),Wt(t,e,{animate:!1}),t.disableRotationByUserInteraction||Bt(t,n,{animate:!1}),this.gestureRotation=0,this.gestureZoom=0}},t}(),de=function(t){function e(e){var n=t.call(this)||this;return n.durations=[],n.earlyTimes=[],n.countToCheck=75,n.mayCountMetrics=!1,n.startRenderTime=0,n.catchNextUpdate=!1,n.mapState=e,setTimeout((function(){n.mayCountMetrics=!0}),1e4),n}return Object(w.c)(e,t),e.prototype.update=function(){var t=this.mapState,e=t.time,n=t.needRerender;this.mayCountMetrics?(this.catchNextUpdate&&(this.durations.push(e-this.startRenderTime),this.catchNextUpdate=!1),n&&(this.startRenderTime=e,this.catchNextUpdate=!0),this.durations.length>this.countToCheck&&this.check()):this.earlyTimes.push(e)},e.prototype.getEarlyFps=function(){if(!this.mayCountMetrics){for(var t=[],e=1;e<this.earlyTimes.length;e++)t.push(this.earlyTimes[e]-this.earlyTimes[e-1]);return fe(t)}},e.prototype.check=function(){var t=fe(this.durations);this.emit("fps",t),t<a.performanceCheck.fpsCaveat&&(this.mapState.performanceCaveatEmitted=!0,this.emit("performancecaveat")),this.durations=[],this.countToCheck=Math.min(1e3,2*this.countToCheck)},e}(S.a);function fe(t){t.sort((function(t,e){return t-e}));var e=t[Math.floor(3*t.length/4)];return Math.round(1e3/e)}var he=n(35),pe=function(){function t(){this.differ=new oe([{path:"center",type:"vec2"},{path:"zoom",type:"number"},{path:"rotation",type:"number"},{path:"pitch",type:"number"}]),this.debouncedSet=Object(he.a)((function(t){vt("stillness",{},t,t.stillness,1,400)}),100,!1),this.stillnessTickerUpdate=gt.bind(null,"stillness",{step:function(t,e){t.stillness=e}})}return t.prototype.update=function(t){this.differ.check(t)&&(t.stillness=0,_t("stillness",t),this.debouncedSet(t)),this.stillnessTickerUpdate(t)},t}(),me=function(){function t(t,e){var n=this;this.onTouchStart=function(){n.isTouchStartEmitted=!0},this.onMouseOut=function(t){if(n.prevGeo){var e=m(n.container,t.clientX,t.clientY);ce("mouseout",n.prevGeo,{originalEvent:t,lngLat:Object(c.m)(Object(s.A)(n.state,e)),point:e,target:Ot(n.prevGeo)},n.modules),n.prevGeo=void 0,n.skipIdentifyEvents=!0,n.modules.tileManager.regionalTileLayer.resetHoverId(),n.container.classList.remove("mapgl-hover")}},this.onMouseMove=function(t){if(n.isTouchStartEmitted)n.isTouchStartEmitted=!1;else if(n.skipIdentifyEvents=!1,!n.isBlocked){var e=m(n.container,t.clientX,t.clientY),r={originalEvent:t,lngLat:Object(c.m)(Object(s.A)(n.state,e)),point:e};Promise.resolve().then((function(){return n.modules.layout.isActionWithCanvas(t)?n.modules.identifier.search("mouseMove",e):void 0})).then((function(t){if(!n.skipIdentifyEvents){var e=t&&n.prevGeo&&(!T.i(t.id,n.prevGeo.id)||t.instanceId!==n.prevGeo.instanceId||t.dynamicObjectId!==n.prevGeo.dynamicObjectId||t.symbol!==n.prevGeo.symbol);r.target=Ot(t),!n.prevGeo||t&&!e||(ce("mouseout",n.prevGeo,Object(w.a)(Object(w.a)({},r),{target:Ot(n.prevGeo)}),n.modules),n.prevGeo=void 0,n.container.classList.remove("mapgl-hover"),n.modules.tileManager.regionalTileLayer.resetHoverId()),!t||n.prevGeo&&!e||(n.prevGeo=t,n.container.classList.add("mapgl-hover"),ce("mouseover",t,r,n.modules),n.modules.tileManager.regionalTileLayer.setHoverId(t.id)),ce("mousemove",t,r,n.modules)}}))}},this.state=t,this.modules=e,this.isTouchStartEmitted=!1,this.skipIdentifyEvents=!1,this.isBlocked=!1,this.prevGeo=void 0,this.container=this.modules.layout.mapContainer,this.container.addEventListener("touchstart",this.onTouchStart),this.container.addEventListener("mousemove",this.onMouseMove),this.container.addEventListener("mouseout",this.onMouseOut)}return t.prototype.destroy=function(){this.container.removeEventListener("touchstart",this.onTouchStart),this.container.removeEventListener("mousemove",this.onMouseMove),this.container.removeEventListener("mouseout",this.onMouseOut)},t.prototype.update=function(){},t.prototype.block=function(){this.isBlocked=!0},t.prototype.unblock=function(){this.isBlocked=!1},t}(),ve=function(t,e,n,r){_t("buildingHeight"+r,t),!1===n.animate?(e.set(r,n.to),t.needLabeling=!0):vt("buildingHeight"+r,{easing:n.easing},t,n.from,n.to,n.duration)},_e=function(){function t(t,e){this.state=t,this.modules=e,this.differ=new oe([{path:"styleZoom",type:"number"}]),this.buildingHeights=new Map,this.minZoomBuildingHeight=1/0}return t.prototype.getBuildingHeight=function(t){return void 0!==t?(this.buildingHeights.has(t)||this.addBuildingHeightZoom(t),this.buildingHeights.get(t)||0):this.getDefaultBuildingHeight()},t.prototype.update=function(){var t=this;this.buildingHeights.forEach((function(e,n){var r,i,o;t.updateByZoom(n,e),t.isAnimating()&&(r=t.state,i=t.buildingHeights,o=n,gt.call(null,"buildingHeight"+o,{step:function(t,e){return i.set(o,e)},complete:function(t){return t.needLabeling=!0}},r))}))},t.prototype.isAnimating=function(){var t=this;return Array.from(this.buildingHeights.keys()).some((function(e){return void 0!==mt("buildingHeight"+e,t.state)}))},t.prototype.clearBuildingHeights=function(){this.buildingHeights.clear(),this.minZoomBuildingHeight=1/0},t.prototype.getDefaultBuildingHeight=function(){var t=this.minZoomBuildingHeight!==1/0?this.minZoomBuildingHeight:16;return this.state.styleZoom<t?0:1},t.prototype.updateByZoom=function(t,e){var n=this.state,r=mt("zoom",n),i=mt("buildingHeight"+t,n),o=void 0!==i?i.to:e,s=void 0!==r?r.uniforms.blockBuildingAnimation:this.differ.check(n);n.styleZoom>=t&&this.modules.tileManager.viewportTilesReady()&&1!==o&&!s?ve(n,this.buildingHeights,{animate:!0,easing:a.buildingAnimation.easing,from:e,to:1,duration:a.buildingAnimation.duration*(1-e)},t):n.styleZoom<t&&0!==o&&ve(n,this.buildingHeights,{animate:!1,to:0},t)},t.prototype.addBuildingHeightZoom=function(t){var e=t<this.state.styleZoom?0:1;this.buildingHeights.set(t,e),this.minZoomBuildingHeight>t&&(this.minZoomBuildingHeight=t)},t}(),ge=n(63),ye=function(){function t(){this._objects=[],this.type=0}return t.prototype.render=function(){return this._objects=[],this},t.prototype.addObject=function(t){return this._objects.push(t),this},t.prototype.hasObjects=function(){return this._objects.length>0},t}(),be=function(t){function e(){var e=t.call(this)||this;return e.type=17,e}return Object(w.c)(e,t),e.prototype.render=function(t){return this._objects.forEach((function(e){return e.render(t)})),this._objects=[],this},e}(ye),xe=function(){function t(t){if((t=t||{}).canvas){this._canvasElement="string"==typeof t.canvas?document.getElementById(t.canvas):t.canvas;var e={antialias:void 0===t.antialias||t.antialias,stencil:void 0!==t.stencil&&t.stencil,failIfMajorPerformanceCaveat:void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,preserveDrawingBuffer:void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer};this._gl=2===t.version?this._canvasElement.getContext("webgl2",e):this._canvasElement.getContext("webgl",e)||this._canvasElement.getContext("experimental-webgl",e)}else this._gl=t.gl;this._pixelRatio=t.pixelRatio||1,this.autoClear=void 0===t.autoClear||t.autoClear,this.clearColor=t.clearColor||[1,1,1,1],this.sortObjects=!0,this._plugins=[],this._pluginsByType={},this._maxPluginOrder=0,this.addPlugin(new be,0),this.webGlExtensions={}}return t.prototype.addPlugin=function(t,e){return void 0===e&&(e=this._maxPluginOrder+1),this._plugins.push({plugin:t,order:e}),this._plugins.sort((function(t,e){return t.order-e.order})),this._pluginsByType[t.type]=t,this._maxPluginOrder=Math.max.apply(Math,this._plugins.map((function(t){return t.order}))),this},t.prototype.removePlugin=function(t){var e=this;return this._plugins.some((function(n,r){return n.plugin instanceof t&&(delete e._pluginsByType[e._plugins[r].plugin.type],e._plugins.splice(r,1),!0)})),this},t.prototype.setPixelRatio=function(t){return this._pixelRatio=t,this},t.prototype.getPixelRatio=function(){return this._pixelRatio},t.prototype.setSize=function(t,e){return this._size=[t*this._pixelRatio,e*this._pixelRatio],this._canvasElement&&(this._canvasElement.width=this._size[0],this._canvasElement.height=this._size[1],this._canvasElement.style.width=t+"px",this._canvasElement.style.height=e+"px"),this.setViewport(),this},t.prototype.setViewport=function(t,e){return void 0!==t&&void 0!==e?this._gl.viewport(0,0,t,e):this._gl.viewport(0,0,this._size[0],this._size[1]),this},t.prototype.getSize=function(){return this._size},t.prototype.setRenderTarget=function(t){return this._renderTarget=t,this},t.prototype.readPixels=function(t,e,n,r,i){var o=this._gl;return this._renderTarget?(this._renderTarget.bind(o),o.readPixels(t,e,n,r,o.RGBA,o.UNSIGNED_BYTE,i),this._renderTarget.unbind(o)):o.readPixels(t,e,n,r,o.RGBA,o.UNSIGNED_BYTE,i),this},t.prototype.clear=function(){var t=this._gl;return t.clearColor.apply(t,this.clearColor),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this},t.prototype.render=function(t,e,n){var r=this._gl;t.typifyForRender(this._pluginsByType),this._renderTarget&&this._renderTarget.bind(r),r.clearDepth(1),r.clearStencil(0),this.autoClear&&this.clear(),e.updateLocalMatrix(),e.updateWorldMatrix();for(var i={renderer:this,extensions:this.webGlExtensions,scene:t,camera:e,gl:r,userData:n},o=this._plugins.map((function(t){return t.plugin})).filter((function(t){return t.hasObjects()})),a=0;a<o.length;a++)o[a].render(i,o[a-1],o[a+1]);return this._renderTarget&&this._renderTarget.unbind(r),this},t.prototype.addExtension=function(t){return this.webGlExtensions[t]=this._gl.getExtension(t),this},t}(),we=function(){function t(e,n){void 0===n&&(n={}),this._src=e||null,this.options=Object.assign({},t.defaultOptions,n),this._glContext=null}return t.prototype.enable=function(t,e){var n=void 0!==e?e:this.options.unit;return void 0!==n&&t.activeTexture(t.TEXTURE0+n),this._texture||this.prepare(t),t.bindTexture(t.TEXTURE_2D,this._texture),this},t.prototype.remove=function(){return this._texture&&(this._glContext.deleteTexture(this._texture),this._glContext=null,this._texture=null),this},t.prototype.getTexture=function(){return this._texture},t.prototype.subImage=function(t,e,n,r){return t.bindTexture(t.TEXTURE_2D,this._texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,this.options.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiplyAlpha),t.texSubImage2D(t.TEXTURE_2D,0,n,r,this._toGlParam(t,this.options.format),t.UNSIGNED_BYTE,e),this},t.prototype.prepare=function(e){return this._glContext=e,this._texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this._texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this.options.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiplyAlpha),this.options.size?e.texImage2D(e.TEXTURE_2D,0,this._toGlParam(e,this.options.format),this.options.size[0],this.options.size[1],0,this._toGlParam(e,this.options.format),e.UNSIGNED_BYTE,this._src):e.texImage2D(e.TEXTURE_2D,0,this._toGlParam(e,this.options.format),this._toGlParam(e,this.options.format),e.UNSIGNED_BYTE,this._src),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this._toGlParam(e,this.options.wrapS)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this._toGlParam(e,this.options.wrapT)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this._toGlParam(e,this.options.magFilter)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this._toGlParam(e,this.options.minFilter)),this.options.generateMipmaps&&this.options.minFilter!==t.NearestFilter&&this.options.minFilter!==t.LinearFilter&&e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null),this},t.prototype._toGlParam=function(e,n){return n===t.ClampToEdgeWrapping?e.CLAMP_TO_EDGE:n===t.Repeat?e.REPEAT:n===t.MirroredRepeat?e.MIRRORED_REPEAT:n===t.NearestFilter?e.NEAREST:n===t.NearestMipMapNearestFilter?e.NEAREST_MIPMAP_NEAREST:n===t.NearestMipMapLinearFilter?e.NEAREST_MIPMAP_LINEAR:n===t.LinearFilter?e.LINEAR:n===t.LinearMipMapNearestFilter?e.LINEAR_MIPMAP_NEAREST:n===t.LinearMipMapLinearFilter?e.LINEAR_MIPMAP_LINEAR:n===t.RgbaFormat?e.RGBA:n===t.AlphaFormat?e.ALPHA:n===t.RgbFormat?e.RGB:null},t}();we.ClampToEdgeWrapping=8,we.Repeat=9,we.MirroredRepeat=10,we.NearestFilter=1,we.NearestMipMapNearestFilter=2,we.NearestMipMapLinearFilter=3,we.LinearFilter=4,we.LinearMipMapNearestFilter=5,we.LinearMipMapLinearFilter=6,we.RgbaFormat=11,we.AlphaFormat=12,we.RgbFormat=13,we.defaultOptions={magFilter:we.LinearFilter,minFilter:we.LinearMipMapLinearFilter,wrapS:we.ClampToEdgeWrapping,wrapT:we.ClampToEdgeWrapping,format:we.RgbaFormat,generateMipmaps:!0,flipY:!0,premultiplyAlpha:!0};var Se=we,Oe=function(){function t(e){void 0===e&&(e={}),this.options=Object.assign({},t.defaultOptions,e),this._glContext=null}return t.prototype.bind=function(t){return this._frameBuffer||this._prepare(t),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),this},t.prototype.unbind=function(t){return t.bindFramebuffer(t.FRAMEBUFFER,null),this},t.prototype.remove=function(){return this._unprepare(),this},t.prototype.setSize=function(t){return this.options.size=t,this._unprepare(),this},t.prototype.getTexture=function(){return this._texture},t.prototype._prepare=function(t){this._glContext=t,this._texture=new Se(null,this.options),this._texture.prepare(t),this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),this._renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this._renderBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.options.size[0],this.options.size[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._texture.getTexture(),0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._renderBuffer),this._checkComplete(t),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},t.prototype._unprepare=function(){if(this._frameBuffer){var t=this._glContext;this._texture.remove(t),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._renderBuffer),this._frameBuffer=null,this._renderBuffer=null,this._texture=null}},t.prototype._checkComplete=function(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);e!==t.FRAMEBUFFER_COMPLETE&&(e===t.FRAMEBUFFER_UNSUPPORTED?console.log("Framebuffer is unsupported"):e===t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT?console.log("Framebuffer incomplete attachment"):e===t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS?console.log("Framebuffer incomplete dimensions"):e===t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT?console.log("Framebuffer incomplete missing attachment"):console.log("Unexpected framebuffer status: "+e))},t}();Oe.defaultOptions=Object.assign({},Se.defaultOptions,{size:[0,0],generateMipmaps:!1});var Me=Oe,je=a.floors.wallMinBrightness,Ie=a.floors.wallMaxBrightness/je-1,Te=[Ie,Ie,Ie],Ee=a.fences.lightIntensity,Ae=[Ee,Ee,Ee],Le=[.05,.05,.05],Ce=[1,0,0],Pe=[1,1,1],ke=function(){},Ne=function(t,e,n){var r=n.size,i=window.devicePixelRatio;e.bind(t,{u_vec2_vpt_size:[r[0]*i,r[1]*i]})},Re=function(t,e,n){var r=Object(c.v)(n.zoom);e.bind(t,{u_vec3_projection_scale_style_scale_dpi:[r,r,N.n*window.devicePixelRatio]})},ze=function(t,e,n){var r=Object(c.v)(n.styleZoom);e.bind(t,{u_vec3_projection_scale_style_scale_dpi:[r,r,N.n*window.devicePixelRatio]})},Be=function(t,e,n,r){e.bind(t,{u_float_height_factor:r.buildingHeightAnimator.getDefaultBuildingHeight()})},Fe=function(t,e,n){e.bind(t,{u_float_height_limitation:Object(c.u)(n.zoom,n.size)*Math.cos(n.pitch)*.75,u_float_tile_height:N.j})},De=function(t,e){e.bind(t,{u_float_height_limitation:N.j,u_float_tile_height:N.j})},Ue=function(t,e){e.bind(t,{u_vec3_light_color:Le,u_vec3_light_direction:Ce,u_vec3_ambient_color:Pe})},Ze=function(t,e){e.bind(t,{u_vec3_light_color:Ae,u_vec3_light_direction:Ce,u_vec3_ambient_color:Pe})},He=function(t,e){e.bind(t,{u_vec3_light_color:Te,u_vec3_light_direction:Ce,u_vec3_ambient_color:Pe})},Ge=function(t,e,n){e.bind(t,{u_float_rounding_factor:n.stillness})},We=function(t,e){e.bind(t,{u_float_border_width_offset:1/window.devicePixelRatio})},Ve=function(t,e){e.bind(t,{u_float_z_offset:0})},qe=function(t,e){e.bind(t,{u_float_z_offset:-1e-5})},Ye=function(t,e){e.bind(t,{u_sr2d_texture:0})},Xe=function(t,e){e.bind(t,{u_vec2_scale_limits:[0,N.m]})},Ke=function(t,e){e.bind(t,{u_vec4_border_color:[0,0,0,0]})},Je=function(t,e){e.bind(t,{u_vec4_space_color:[0,0,0,0]})},Qe=function(t,e,n,r){r.assetManager.textures.forEach((function(e){return e.enable(t)}))};function $e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e,n,r,i){t.forEach((function(t){return t(e,n,r,i)}))}}var tn=n(21),en=n(38);function nn(t,e){return 0===e||void 0===e?1:1===e?t.labelingOpacity:1-t.labelingOpacity}var rn=function(t,e,n,r,i,o){var a=r.styleManager,s=i.uniforms,c=C("color",s,i.layerSettings.uniformSet);return tn.c(o,Object(I.a)(a,s.styleId,c,n.styleZoom)),!0},on=function(t,e,n,r,i,o){var s=i.uniforms.type;return s===en.b.WallSide?(o[0]*=a.floors.wallMinBrightness,o[1]*=a.floors.wallMinBrightness,o[2]*=a.floors.wallMinBrightness):s===en.b.WallTop&&tn.l(o,.97,.97,.97,1),!0},an=function(t,e,n,r,i,o){return o[0]*=a.floors.wallMinBrightness,o[1]*=a.floors.wallMinBrightness,o[2]*=a.floors.wallMinBrightness,!0},sn=function(t,e,n,r,i,o){var a=r.modelManager;return tn.k(o,o,a.getOpacity(i.uniforms.id,i.uniforms.minStyleZoom)),!0},cn=function(t,e,n,r,i,o){var a=r.modelManager;if(!a.hasModel(i.uniforms.hiddenObjectId))return!0;var s=a.getVisibleModelData(i.uniforms.hiddenObjectId);if(!s)return!0;var c=1-s.opacity;return!(c<.5||(tn.k(o,o,c),0))},ln=function(t,e){return e.bind(t,{u_float_opacity:1}),!0},un=function(t,e,n,r,i,o){var a=r.styleManager,s=n.styleZoom,c=n.stillness,l=i.uniforms,u=l.fillColor,d=l.width,f=l.styleId,h=Number.isNaN(u)||void 0===u?o:Object(I.a)(a,f,u,s),p=Number.isNaN(d)||void 0===d?1:Object(I.a)(a,f,d,s);return tn.e(o,h)&&1===o[3]&&p<=1&&tn.k(o,o,c),!0},dn=function(t,e,n,r,i,o){return tn.k(o,o,n.stillness),!0},fn=function(t,e,n,r,i,o){return tn.k(o,o,i.tile.readiness),0!==o[3]&&(e.bind(t,{u_vec4_color:o}),!0)},hn=function(t,e,n,r,i){var o=r.styleManager,a=i.uniforms,s=a.borderColor,c=a.styleId,l=Object(I.a)(o,c,s,n.styleZoom);return tn.k(l,l,i.tile.readiness),e.bind(t,{u_vec4_border_color:l}),!0},pn=function(t,e,n,r,i){var o=r.styleManager,a=i.layerSettings,s=i.uniforms,c=s.styleId,l=C("width",s,a.uniformSet),u=Number.isNaN(l)||void 0===l?1:Object(I.b)(o,c,l,n.styleZoom);return 0!==u&&(e.bind(t,{u_float_width:u*window.devicePixelRatio}),!0)},mn=function(t,e,n,r,i){var o=r.styleManager,a=i.uniforms,s=a.width,c=a.width2,l=a.width3,u=a.styleId,d=Number.isNaN(s)?1:Object(I.b)(o,u,s,n.styleZoom),f=Number.isNaN(c)?0:Object(I.b)(o,u,c,n.styleZoom),h=Number.isNaN(l)?0:Object(I.b)(o,u,l,n.styleZoom),p=Math.max(d,f,h);return 0!==p&&(e.bind(t,{u_float_width:p*window.devicePixelRatio}),!0)},vn=function(t,e,n,r,i){var o=r.styleManager,a=Object(I.b)(o,i.uniforms.styleId,i.uniforms.shift,n.styleZoom);return e.bind(t,{u_float_shift:a}),!0},_n=function(t,e,n,r,i){return 0!==nn(n,i.uniforms.animDirection)},gn=function(t,e,n,r,i){var o=nn(n,i.uniforms.animDirection);return 0!==o&&(e.bind(t,{u_float_opacity:o}),!0)},yn=function(t,e,n,r,i){var o=i.uniforms.opacity||1;return e.bind(t,{u_float_opacity:i.tile.readiness*o}),!0},bn=function(t,e,n,r,i){var o=r.styleManager,a=Object(I.b)(o,i.uniforms.styleId,i.uniforms.opacity,n.styleZoom)||1;return e.bind(t,{u_float_opacity:i.tile.readiness*a}),!0},xn=function(t,e,n,r,i){return!r.floorManager.hasDisplayedFloorBuilding(i.uniforms.hiddenObjectId)},wn=function(t,e,n,r,i){var o=r.modelManager;if(!o.hasModel(i.uniforms.hiddenObjectId))return!0;var a=o.getVisibleModelData(i.uniforms.hiddenObjectId);return!a||1!==a.opacity},Sn=function(t,e,n,r,i){return e.bind(t,{u_sr2d_texture:i.uniforms.atlasIndex}),!0},On=function(t,e,n,r,i){return-1===i.uniforms.styleId||n.pitch<=Object(s.h)(a.camera.hidePointObjectsAtPitch)},Mn=function(t,e,n,r,i){var o=r.assetManager,a=i.uniforms,s=a.styleId,c=a.font,l=a.range,u=o.getFontTexture(s,c,l);return void 0!==u&&(u.enable(t),!0)},jn=function(t,e,n,r,i){var o=r.imageManager.getTexture(i.uniforms.textureIndex);return void 0!==o&&(o.enable(t,0),e.bind(t,{u_sr2d_texture:0}),!0)},In=function(t,e,n,r,i){var o,a=r.styleManager,s=n.styleZoom,c=i.uniforms,l=i.tile,u=c.spaceColor,d=c.styleId;if(!(null===(o=a.getStyle(d))||void 0===o?void 0:o.curves[u]))return!0;var f=Object(I.a)(a,d,u,s);return tn.k(f,f,l.readiness),e.bind(t,{u_vec4_space_color:f}),!0},Tn=function(t,e,n,r,i){var o=r.styleManager,a=n.styleZoom,l=i.uniforms,u=i.layerSettings,d=i.tile,f=l.dashLength,h=l.dash2Length,p=l.spaceLength,m=l.styleId,v=u.uniformSet,_=C("dashColor",l,v),g=Object(I.a)(o,m,_,a);tn.k(g,g,d.readiness);var y=Math.floor(a),b=Math.pow(2,Object(s.l)(a)),x=Object(I.b)(o,m,f,y)*b,w=Object(I.b)(o,m,h,y)*b,S=Object(I.b)(o,m,p,y)*b,O="fill"===v?x:w;return e.bind(t,{u_vec4_dash_color:g,u_vec2_scaler_params:[0,N.m],u_float_dash_length:Object(c.w)(x,d.size),u_float_dash2_length:Object(c.w)(O,d.size),u_float_space_length:Object(c.w)(S,d.size)}),!0},En=function(t,e,n,r,i){var o=i.uniforms,a=o.tipHeightMultiplier,s=o.wingHeightMultiplier,l=o.wingWidthMultiplier,u=o.wingNormal,d=o.tipNormal;return e.bind(t,{u_vec2_wing_normal:u,u_vec2_tip_normal:d,u_float_tip_height_multiplier:a,u_float_wing_height_multiplier:s,u_float_wing_width_multiplier:l,u_float_size_factor:Object(c.w)(1,i.tile.size)/2}),!0},An=function(t,e,n,r,i){var o=r.styleManager,a=i.uniforms,s=a.length,c=a.width,l=a.borderWidth,u=a.styleId,d=n.styleZoom;return e.bind(t,{u_float_length:Object(I.b)(o,u,s,d),u_float_width:Object(I.b)(o,u,c,d),u_float_border_width:Object(I.b)(o,u,l,d)}),!0},Ln=function(t,e,n,r,i){var o=r.styleManager,a=i.tile,s=i.uniforms,l=s.width,u=s.borderWidth,d=s.tipMovementAmplitude,f=s.styleId,h=s.isLongArrow,p=i.tile.dynamicObject,m=n.styleZoom,v=Number.isNaN(d)?0:Object(I.b)(o,f,d,m);return e.bind(t,{u_float_width_zpt:Object(I.b)(o,f,l,m),u_float_border_width_zpt:Object(I.b)(o,f,u,m),u_float_tip_movement_amplitude:Object(c.w)(v,a.size),u_float_vertex_shift:h?0:p.bouncePosition,u_float_relative_end_position:h?p.growPosition:1}),!0},Cn=function(t,e,n,r,i){var o=r.modelManager,a=i.uniforms,s=a.texture,c=a.modelIndex,l=o.getTexture(c,s);return void 0!==l&&(l.enable(t,0),e.bind(t,{u_sr2d_texture:0}),!0)},Pn=function(t,e,n,r,i){var o=r.modelManager,a=o.getOpacity(i.uniforms.id,i.uniforms.minStyleZoom),s=1===o.getBuildingHeight(i.uniforms.id)?1:a;return e.bind(t,{u_float_height_factor:s}),!0},kn=function(t,e,n,r,i){var o=r.styleManager,a=i.uniforms,s=a.styleId,c=Object(I.b)(o,s,a.height,n.styleZoom);return e.bind(t,{u_float_height_factor:Object(d.p)(c)}),!0},Nn=function(t,e,n,r,i){var o=r.modelManager,a=r.buildingHeightAnimator.getBuildingHeight(i.uniforms.minStyleZoom);return i.uniforms.hiddenObjectId&&o.setBuildingHeight(i.uniforms.hiddenObjectId,a),e.bind(t,{u_float_height_factor:a}),!0},Rn=function(t,e,n,r,i){var o=r.modelManager,a=r.buildingHeightAnimator,s=a.getBuildingHeight(i.uniforms.minStyleZoom);if(o.hasModel(i.uniforms.hiddenObjectId)){var c=o.getVisibleModelData(i.uniforms.hiddenObjectId);c&&(s=s-a.getBuildingHeight(c.minStyleZoom)>.5?s:0)}return 0!==s},zn=function(t,e,n,r,i){var o=n.styleZoom,s=i.tile,c=i.uniforms,l=Number.isNaN(c.minStyleZoom)?-1/0:c.minStyleZoom,u=Number.isNaN(c.maxStyleZoom)?1/0:c.maxStyleZoom,d="terrain"===s.purpose||"traffic"===s.purpose||"raster"===s.purpose,f="dynamicObject"===s.purpose,h=!d||l>s.detailLevel,p=!d||u<s.detailLevel+1||s.detailLevel===a.tiles.maxDetailLevel;return(!h||o>=l)&&(!p||(f?o<=u:o<u))},Bn=function(t,e,n,r,i){var o=n.styleZoom,a=i.uniforms,s=Number.isNaN(a.minStyleZoom)?-1/0:a.minStyleZoom,c=Number.isNaN(a.maxStyleZoom)?1/0:a.maxStyleZoom;return o>=s&&o<c},Fn=function(t,e,n,r,i){var o=r.styleManager,a=i.tile,s=i.uniforms,l=i.layerSettings,u=s.styleId,d=C("width",s,l.uniformSet),f=Object(I.b)(o,u,d,n.styleZoom);return 0!==f&&(e.bind(t,{u_float_width:Object(c.w)(f,a.size)/2,u_float_width_offset:Object(c.w)(1/window.devicePixelRatio,a.size)/2}),!0)},Dn=function(t,e,n,r,i){return-1===i.uniforms.styleId||Math.floor(n.styleZoom)>=i.tile.detailLevel},Un=function(t,e,n,r,i){var o=r.styleManager,s=i.uniforms,c=s.fontSize,l=s.styleId,u=Object(I.b)(o,l,c,n.styleZoom);return e.bind(t,{u_float_scale:u*window.devicePixelRatio/a.fonts.baseSize}),!0},Zn=function(t,e,n,r,i){var o=i.uniforms,a=o.haloRadius,s=o.haloColor;return a>0&&!Number.isNaN(s)},Hn=function(t,e,n,r,i){var o=r.styleManager,s=i.uniforms,c=i.layerSettings.uniformSet,l=s.fontSize,u=s.haloRadius,d=s.styleId,f=C("color",s,c),h=n.styleZoom,p=window.devicePixelRatio,m=Object(I.b)(o,d,l,h)/a.fonts.baseSize,v=m*p,_=a.fonts.gamma/v,g="fontHalo"===c?(6-u/m)/8:.75;return e.bind(t,{u_float_buffer:g,u_float_gamma:_,u_vec4_color:Object(I.a)(o,d,f,h)}),!0},Gn=function(t,e,n,r,i){var o=i.uniforms,a=o.offsetX,s=o.offsetY,c=window.devicePixelRatio;return e.bind(t,{u_vec2_offset:[a*c,s*c]}),!0},Wn=function(t,e,n){return e.bind(t,{u_float_style_zoom:n.styleZoom}),!0},Vn=function(t,e,n,r,i){var o=i.tile,a=n.zoom,s=256*Math.pow(2,a-o.zoomLevel)*window.devicePixelRatio;return e.bind(t,{u_float_tile_to_pixel_ratio:1/s}),!0};function qn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=[0,0,0,0];return function(e,r,i,o,a){for(var s=0;s<t.length;s++)if(!t[s](e,r,i,o,a,n))return!1;return!0}}var Yn=function(t){t.depthMask(!0),t.enable(t.DEPTH_TEST),t.depthFunc(t.LESS),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.disable(t.BLEND),t.blendFunc(t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.disable(t.POLYGON_OFFSET_FILL)},Xn=function(t){Yn(t),t.depthMask(!1),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},Kn=function(t){Yn(t),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.disable(t.CULL_FACE)},Jn=function(t){Yn(t),t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},Qn=function(t){Yn(t),t.disable(t.DEPTH_TEST)},$n=function(t){Yn(t),t.depthMask(!1)},tr=function(t){Yn(t),t.colorMask(!1,!1,!1,!1)},er=function(t){Yn(t),t.depthFunc(t.EQUAL),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},nr=function(t){Yn(t),t.disable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},rr=function(t){Yn(t),t.polygonOffset(1,2),t.enable(t.POLYGON_OFFSET_FILL),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},ir=function(t){Yn(t),t.disable(t.CULL_FACE)},or=function(t){Yn(t),t.disable(t.DEPTH_TEST),t.cullFace(t.FRONT),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},ar=function(){function t(t,e){void 0===e&&(e={}),this._buffer=t,this.options=Object.assign({},P.a.defaultOptions,e)}return t.prototype.bind=function(t,e){this._buffer.bind(t,e,this.options)},t}(),sr=function(){function t(t,e){void 0===e&&(e={}),this._vao=null,this._attributes=e,this._shaderProgram=t,this._ext=null}return t.prototype.bind=function(t){var e=t.extensions.OES_vertex_array_object;return e?this._bind(t.gl,e):this._shaderProgram.bind(t.gl,null,this._attributes),this},t.prototype.unbind=function(){return this._ext&&this._ext.bindVertexArrayOES(null),this},t.prototype.remove=function(){return this._vao&&this._ext.deleteVertexArrayOES(this._vao),this},t.prototype._bind=function(t,e){this._vao?e.bindVertexArrayOES(this._vao):this._prepare(t,e)},t.prototype._prepare=function(t,e){this._ext=e,this._vao=e.createVertexArrayOES(),e.bindVertexArrayOES(this._vao);var n=this._shaderProgram.attributes,r=this._attributes;for(var i in r){var o=n[i];!0!==o.index&&t.enableVertexAttribArray(o.location),r[i].bind(t,o.location)}},t}(),cr=n(53),lr=n(61),ur=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:8,offset:0,normalized:!0});return new sr(e,{a_vec2_vertex:n})},dr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:8,offset:0,normalized:!0}),r=new ar(t,{itemSize:4,dataType:P.a.UnsignedByte,stride:8,offset:4,normalized:!0});return new sr(e,{a_vec2_vertex:n,a_vec4_identifier:r})},fr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:8,offset:0,normalized:!0}),r=new ar(t,{itemSize:4,dataType:P.a.Byte,stride:8,offset:4,normalized:!1});return new sr(e,{a_vec2_vertex:n,a_vec4_normals:r})},hr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:12,offset:0,normalized:!0}),r=new ar(t,{itemSize:4,dataType:P.a.Byte,stride:12,offset:4,normalized:!1});return new sr(e,{a_vec2_vertex:n,a_vec4_normals:r})},pr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:16,offset:0,normalized:!0}),r=new ar(t,{itemSize:4,dataType:P.a.Byte,stride:16,offset:4,normalized:!1}),i=new ar(t,{itemSize:2,dataType:P.a.Float,stride:16,offset:8,normalized:!1});return new sr(e,{a_vec2_vertex:n,a_vec4_normals:r,a_vec2_shift:i})},mr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:12,offset:0,normalized:!0}),r=new ar(t,{itemSize:4,dataType:P.a.Byte,stride:12,offset:4,normalized:!1}),i=new ar(t,{itemSize:4,dataType:P.a.UnsignedByte,stride:12,offset:8,normalized:!0});return new sr(e,{a_vec2_vertex:n,a_vec4_normals:r,a_vec4_identifier:i})},vr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:28,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.Short,stride:28,offset:4,normalized:!1}),i=new ar(t,{itemSize:2,dataType:P.a.Byte,stride:28,offset:8,normalized:!1}),o=new ar(t,{itemSize:1,dataType:P.a.Float,stride:28,offset:12,normalized:!1}),a=new ar(t,{itemSize:1,dataType:P.a.Float,stride:28,offset:16,normalized:!1}),s=new ar(t,{itemSize:1,dataType:P.a.Float,stride:28,offset:20,normalized:!1}),c=new ar(t,{itemSize:4,dataType:P.a.UnsignedByte,stride:28,offset:24,normalized:!0});return new sr(e,{a_vec2_vertex:n,a_vec2_texture_widen:i,a_vec2_widen:r,a_float_vertex_distance:o,a_float_component_distance:a,a_float_object_length:s,a_vec4_identifier:c})},_r=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:16,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.Short,stride:16,offset:8,normalized:!1}),i=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:16,offset:12,normalized:!1});return new sr(e,{a_vec4_position:n,a_vec2_offset:r,a_vec2_texcoord:i})},gr=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:20,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.Short,stride:20,offset:8,normalized:!1}),i=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:20,offset:12,normalized:!1});return new sr(e,{a_vec4_position:n,a_vec2_offset:r,a_vec2_texcoord:i})},yr=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:20,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.Short,stride:20,offset:8,normalized:!1}),i=new ar(t,{itemSize:4,dataType:P.a.UnsignedByte,stride:20,offset:16,normalized:!0});return new sr(e,{a_vec4_position:n,a_vec2_offset:r,a_vec4_identifier:i})},br=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:28,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:28,offset:8,normalized:!1}),i=new ar(t,{itemSize:2,dataType:P.a.Float,stride:28,offset:12,normalized:!1}),o=new ar(t,{itemSize:2,dataType:P.a.Float,stride:28,offset:20,normalized:!1});return new sr(e,{a_vec4_position:n,a_vec2_offset:i,a_vec2_texcoord:r,a_vec2_style_zoom_limits:o})},xr=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:16,offset:0,normalized:!0}),r=new ar(t,{itemSize:3,dataType:P.a.Byte,stride:16,offset:8,normalized:!1});return new sr(e,{a_vec3_vertex:n,a_vec3_normal:r})},wr=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:16,offset:0,normalized:!0}),r=new ar(t,{itemSize:4,dataType:P.a.UnsignedByte,stride:16,offset:12,normalized:!0});return new sr(e,{a_vec3_vertex:n,a_vec4_identifier:r})},Sr=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:16,offset:0,normalized:!0}),r=new ar(t,{itemSize:1,dataType:P.a.Short,stride:16,offset:6,normalized:!0}),i=new ar(t,{itemSize:2,dataType:P.a.Byte,stride:16,offset:8,normalized:!1}),o=new ar(t,{itemSize:2,dataType:P.a.Byte,stride:16,offset:10,normalized:!1}),a=new ar(t,{itemSize:3,dataType:P.a.Byte,stride:16,offset:12,normalized:!1});return new sr(e,{a_vec4_vertex:n,a_vec2_normal:i,a_vec2_normal_delta:o,a_vec3_direction:a,a_float_distance:r})},Or=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:24,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.Short,stride:24,offset:8,normalized:!1}),i=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:24,offset:12,normalized:!1}),o=new ar(t,{itemSize:2,dataType:P.a.Short,stride:24,offset:16,normalized:!1});return new sr(e,{a_vec3_position:n,a_vec2_offset:r,a_vec2_texcoord:i,a_vec2_range:o})},Mr=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:24,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.Short,stride:24,offset:8,normalized:!1}),i=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:24,offset:12,normalized:!1}),o=new ar(t,{itemSize:2,dataType:P.a.Short,stride:24,offset:16,normalized:!1}),a=new ar(t,{itemSize:4,dataType:P.a.UnsignedByte,stride:24,offset:20,normalized:!0});return new sr(e,{a_vec3_position:n,a_vec2_offset:r,a_vec2_texcoord:i,a_vec2_range:o,a_vec4_identifier:a})},jr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:16,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.Short,stride:16,offset:8,normalized:!1}),i=new ar(t,{itemSize:2,dataType:P.a.Short,stride:16,offset:12,normalized:!1});return new sr(e,{a_vec2_position:n,a_vec2_direction:r,a_vec2_widen_direction:i})},Ir=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:16,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:16,offset:8,normalized:!1});return new sr(e,{a_vec3_vertex:n,a_vec2_texcoord:r})},Tr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:8,offset:0,normalized:!0}),r=new ar(t,{itemSize:4,dataType:P.a.Byte,stride:8,offset:4,normalized:!1});return new sr(e,{a_vec3_vertex:n,a_vec4_direction_distance:r})},Er=function(t,e){var n=new ar(t,{itemSize:3,dataType:P.a.UnsignedShort,stride:12,offset:0,normalized:!0}),r=new ar(t,{itemSize:4,dataType:P.a.Byte,stride:12,offset:8,normalized:!1});return new sr(e,{a_vec3_vertex:n,a_vec4_direction_distance:r})},Ar=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:36,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:36,offset:4,normalized:!0}),i=new ar(t,{itemSize:4,dataType:P.a.Byte,stride:36,offset:8,normalized:!1}),o=new ar(t,{itemSize:2,dataType:P.a.Short,stride:36,offset:12,normalized:!1}),a=new ar(t,{itemSize:2,dataType:P.a.Short,stride:36,offset:16,normalized:!1}),s=new ar(t,{itemSize:1,dataType:P.a.Float,stride:36,offset:20,normalized:!1}),c=new ar(t,{itemSize:1,dataType:P.a.Float,stride:36,offset:24,normalized:!1}),l=new ar(t,{itemSize:1,dataType:P.a.Float,stride:36,offset:28,normalized:!1}),u=new ar(t,{itemSize:4,dataType:P.a.UnsignedByte,stride:36,offset:32,normalized:!0});return new sr(e,{a_vec2_vertex:n,a_vec2_segment_end:r,a_vec4_texture_widen_arrow_widen:i,a_vec2_widen:o,a_vec2_direction:a,a_float_distance_from_start:s,a_float_object_length:c,a_float_type:l,a_vec4_identifier:u})},Lr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:12,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.Short,stride:12,offset:4,normalized:!1});return new sr(e,{a_vec4_vertex:n,a_vec2_widen:r})},Cr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:12,offset:0,normalized:!0}),r=new ar(t,{itemSize:2,dataType:P.a.Short,stride:12,offset:4,normalized:!1}),i=new ar(t,{itemSize:4,dataType:P.a.UnsignedByte,stride:12,offset:8,normalized:!0});return new sr(e,{a_vec4_vertex:n,a_vec2_widen:r,a_vec4_identifier:i})},Pr=function(t,e){var n=cr.sinks.fill.stride,r=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:n,offset:0,normalized:!1}),i=new ar(t,{itemSize:2,dataType:P.a.Short,stride:n,offset:4,normalized:!1}),o=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:n,offset:8,normalized:!1});return new sr(e,{a_vec2_position:r,a_vec2_offset:i,a_vec2_texcoord:o})},kr=function(t,e){var n=cr.sinks.fill.stride,r=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:n,offset:0,normalized:!1}),i=new ar(t,{itemSize:2,dataType:P.a.Short,stride:n,offset:4,normalized:!1}),o=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:n,offset:8,normalized:!1}),a=new ar(t,{itemSize:4,dataType:P.a.UnsignedByte,stride:n,offset:12,normalized:!0});return new sr(e,{a_vec2_position:r,a_vec2_offset:i,a_vec2_texcoord:o,a_vec4_identifier:a})},Nr=function(t,e){var n=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:8,offset:0,normalized:!0});return new sr(e,{a_vec2_vertex:n})},Rr=function(t,e){var n=lr.sinks.fill.stride,r=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:n,offset:0,normalized:!0}),i=new ar(t,{itemSize:2,dataType:P.a.UnsignedShort,stride:n,offset:4,normalized:!1});return new sr(e,{a_vec2_vertex:r,a_vec2_texcoord:i})},zr=function(){function t(t){this.gl=t,this.ext=t.getExtension("EXT_disjoint_timer_query"),this.queries=[]}return t.prototype.addTimer=function(){if(this.ext){var t=this.ext.createQueryEXT();this.queries.push(t),this.ext.beginQueryEXT(this.ext.TIME_ELAPSED_EXT,t)}},t.prototype.stopTimer=function(){this.ext&&this.queries.length&&this.ext.endQueryEXT(this.ext.TIME_ELAPSED_EXT)},t.prototype.tryToGetFirstTimerValue=function(){if(this.ext){var t=this.queries[0];if(t){var e=this.ext,n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT),r=this.gl.getParameter(e.GPU_DISJOINT_EXT);if(n&&!r){var i=e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT);return e.deleteQueryEXT(t),this.queries.shift(),Number(i)}}}},t}(),Br=function(){function t(t){this.name=t.name,this.index=t.index,this.location=void 0!==t.location?t.location:-1,this._enable=!1}return t.prototype.bindLocation=function(t,e){return-1!==this.location&&!0!==this.index&&t.bindAttribLocation(e,this.location,this.name),this},t.prototype.getLocation=function(t,e){return-1===this.location&&!0!==this.index&&(this.location=t.getAttribLocation(e,this.name)),this},t.prototype.bind=function(t,e){return this._enable||!0===this.index||(t.enableVertexAttribArray(this.location),this._enable=!0),e.bind(t,this.location),this},t.prototype.disable=function(t){return this._enable&&!0!==this.index&&(t.disableVertexAttribArray(this.location),this._enable=!1),this},t}(),Fr=function(){function t(t){this.name=t.name,this.type=t.type,this.location=-1}return t.prototype.getLocation=function(t,e){return this.location=t.getUniformLocation(e,this.name),this},t.prototype.bind=function(t,e){var n=this.type;return"mat2"===n?t.uniformMatrix2fv(this.location,!1,e):"mat3"===n?t.uniformMatrix3fv(this.location,!1,e):"mat4"===n?t.uniformMatrix4fv(this.location,!1,e):"2f"===n?t.uniform2f(this.location,e[0],e[1]):"3f"===n?t.uniform3f(this.location,e[0],e[1],e[2]):"4f"===n?t.uniform4f(this.location,e[0],e[1],e[2],e[3]):"2i"===n?t.uniform2i(this.location,e[0],e[1]):"3i"===n?t.uniform3i(this.location,e[0],e[1],e[2]):"4i"===n?t.uniform4i(this.location,e[0],e[1],e[2],e[3]):t["uniform"+n](this.location,e),this},t}(),Dr=function(){function t(t){var e=this;t=t||{},this._vertexShader=t.vertex,this._fragmentShader=t.fragment,this.uniforms={},t.uniforms=t.uniforms||[],t.uniforms.forEach((function(t){e.uniforms[t.name]=new Fr(t)})),this.attributes={},t.attributes=t.attributes||[],t.attributes.forEach((function(t){e.attributes[t.name]=new Br(t)})),this._linked=!1,this._located=!1}return t.prototype.enable=function(t){return this.link(t),this.locate(t),t.useProgram(this._webglProgram),this},t.prototype.bind=function(t,e,n){if(e)for(var r in e)this.uniforms[r].bind(t,e[r]);if(n)for(var r in n)this.attributes[r].bind(t,n[r]);return this},t.prototype.disable=function(t){for(var e in this.attributes)this.attributes[e].disable(t);return this},t.prototype.link=function(t){if(this._linked)return this;for(var e in this._webglProgram=t.createProgram(),this._vertexShader&&t.attachShader(this._webglProgram,this._vertexShader.get(t)),this._fragmentShader&&t.attachShader(this._webglProgram,this._fragmentShader.get(t)),this.attributes)this.attributes[e].bindLocation(t,this._webglProgram);return t.linkProgram(this._webglProgram),this._linked=!0,this},t.prototype.locate=function(t){if(this._located)return this;for(var e in this.attributes)this.attributes[e].getLocation(t,this._webglProgram);for(var e in this.uniforms)this.uniforms[e].getLocation(t,this._webglProgram);return this._located=!0,this},t}(),Ur="vec4 apply_opacity(const vec4 color, const float opacity)\n{\nreturn color * opacity;\n}\n",Zr={affine_step:"\nfloat affine_step(const float edge0, const float edge1, const float x)\n{\nreturn clamp((x - edge0) / (edge1 - edge0), 0., 1.);\n}\n",apply_opacity:Ur,color:"varying vec4 v_vec4_color;\nvoid main()\n{\ngl_FragColor = v_vec4_color;\n}\n",line:"varying vec4 v_vec4_color;\nvarying float v_float_distance;\nvoid main()\n{\ngl_FragColor = v_vec4_color * (1. - abs(v_float_distance * gl_FragCoord.w));\n}\n",lowp_float:"precision lowp float;\n",mediump_float:"precision mediump float;\n",highp_float:"precision highp float;\n",pixel_line:"uniform vec4 u_vec4_color;\nvarying vec2 v_vec2_normal;\nvarying float v_float_half_width;\nvoid main()\n{\n    \n    float opacity = 1.0 - affine_step(\n        v_float_half_width - 1.0,\n        v_float_half_width,\n        length(v_vec2_normal)\n    );\n    gl_FragColor = u_vec4_color * opacity;\n}\n",pointsprite:"uniform sampler2D u_sr2d_texture;\nuniform float u_float_opacity;\nvarying vec2 v_vec2_texcoord;\nvoid main()\n{\ngl_FragColor = apply_opacity(texture2D(u_sr2d_texture, v_vec2_texcoord), u_float_opacity);\n}\n",striped_line:"varying vec4 v_vec4_dash_color;\nvarying vec4 v_vec4_space_color;\nvarying vec4 v_vec4_border_color;\nvarying vec2 v_vec2_circle;\nvarying float v_float_width;\nvarying float v_float_part_color_swap_threshold;\nvarying float v_float_distance_in_parts;\nvec4 distance_func_smooth(in vec4 main_color, in vec4 border_color, in vec2 circle)\n{\nfloat circle_length = length(circle);\nfloat distance = circle_length - v_float_width;\nmat2 derivatives = mat2(dFdx(v_vec2_circle), dFdy(v_vec2_circle));\nvec2 circle_dx = derivatives[0];\nvec2 circle_dy = derivatives[1];\nfloat distance_dx = dot(v_vec2_circle, circle_dx);\nfloat distance_dy = dot(v_vec2_circle, circle_dy);\nfloat derivative_denominator = circle_length;\nfloat width = max(abs(distance_dx), abs(distance_dy));\nvec4 from_main_to_border = mix(\nmain_color,\nborder_color,\naffine_step(-width, 0., distance * derivative_denominator));\nvec4 from_color_to_fade = mix(\nfrom_main_to_border,\nvec4(0.),\naffine_step(0., +width, distance * derivative_denominator));\nreturn from_color_to_fade;\n}\nfloat calculate_segment_color_factor(in float distance_in_parts, in float threshold)\n{\nfloat color_factor = abs(fract(distance_in_parts + 0.5 - 0.5 * threshold) - 0.5);\nfloat parts_affine_step_width = fwidth(distance_in_parts);\nfloat smoothed_color_factor = affine_step(\n0.5 * threshold - 0.5 * parts_affine_step_width,\n0.5 * threshold + 0.5 * parts_affine_step_width,\ncolor_factor);\nreturn smoothed_color_factor;\n}\nvoid main()\n{\nvec4 current_segment_color = mix(\nv_vec4_dash_color,\nv_vec4_space_color,\ncalculate_segment_color_factor(\nv_float_distance_in_parts,\nv_float_part_color_swap_threshold));\nvec4 final_border_color = (1.0 - v_vec4_border_color.a) * current_segment_color + v_vec4_border_color;\ngl_FragColor = distance_func_smooth(current_segment_color, final_border_color, v_vec2_circle);\n}\n",label:"uniform sampler2D u_sr2d_texture;\nuniform float u_float_buffer;\nuniform float u_float_gamma;\nuniform vec4 u_vec4_color;\nuniform float u_float_opacity;\nvarying vec2 v_vec2_texcoord;\nvoid main() {\n    float dist = texture2D(u_sr2d_texture, v_vec2_texcoord).a;\n    float alpha = smoothstep(\n        u_float_buffer - u_float_gamma,\n        u_float_buffer + u_float_gamma,\n        dist\n    );\n    gl_FragColor = apply_opacity(u_vec4_color * alpha, u_float_opacity);\n}\n",one_way_line:"uniform vec2 u_vec2_wing_normal;\nuniform vec2 u_vec2_tip_normal;\nuniform float u_float_width;\nuniform float u_float_length;\nuniform vec2 u_vec2_vpt_size;\nuniform float u_float_tip_height_multiplier;\nuniform float u_float_wing_height_multiplier;\nvarying vec4 v_vec4_color;\nvarying vec4 v_vec4_border_color;\nvarying vec2 v_vec2_texcoord;\nvarying float v_float_border_width;\nvarying float v_float_zpt_to_texcoord_factor;\nvarying float v_float_outer_width;\nvarying float v_float_opacity;\nfloat one_way_line_distance(const ArrowDistances ad)\n{\nreturn max(max(max(ad.top_tip_cut, ad.bottom_tip_cut), max(ad.top_left_wing, ad.top_right_wing)), min(ad.line, min(ad.bottom_left_wing, ad.bottom_right_wing)));\n}\nvoid main()\n{\nmat2 derivatives = mat2(dFdx(v_vec2_texcoord), dFdy(v_vec2_texcoord));\nArrowDistanceParameters arrow_parameters = calculate_arrow_distance_parameters(\nu_vec2_wing_normal,\nu_vec2_tip_normal,\nu_float_width * v_float_zpt_to_texcoord_factor,\nu_float_length * v_float_zpt_to_texcoord_factor,\nu_float_tip_height_multiplier,\nu_float_wing_height_multiplier);\nfloat border_clipping = (abs(v_vec2_texcoord.y) - v_float_outer_width) / max(abs(derivatives[0].y), abs(derivatives[1].y));\nfloat fill_factor = affine_step(-1., 0., one_way_line_distance(calculate_arrow_distances(arrow_parameters, v_vec2_texcoord, 0., derivatives)));\nfloat border_factor = max(border_clipping, affine_step(0., 1., one_way_line_distance(calculate_arrow_distances(arrow_parameters, v_vec2_texcoord, v_float_border_width, derivatives))));\ngl_FragColor = apply_opacity(mix(mix(v_vec4_color, v_vec4_border_color, fill_factor), vec4(0.), border_factor), v_float_opacity);\n}\n",color_identify:"varying vec4 v_vec4_identifier;\nvoid main()\n{\ngl_FragColor = v_vec4_identifier;\n}\n",pointsprite_identify:"uniform sampler2D u_sr2d_texture;\nvarying vec2 v_vec2_texcoord;\nvarying vec4 v_vec4_identifier;\nvoid main()\n{\nvec4 color = texture2D(u_sr2d_texture, v_vec2_texcoord);\nif (color.a < 0.3) {\ndiscard;\n} else {\ngl_FragColor = v_vec4_identifier;\n}\n}\n",model:"uniform sampler2D u_sr2d_texture;\nuniform vec4 u_vec4_color;\nvarying vec2 v_vec2_texcoord;\nvoid main()\n{\ngl_FragColor = texture2D(u_sr2d_texture, v_vec2_texcoord) * u_vec4_color;\n}\n",simple_line:"uniform vec4 u_vec4_color;\nvarying float v_float_distance;\nvarying float v_float_distance_offset;\nvoid main()\n{\nvec4 color = u_vec4_color;\ngl_FragColor = color * clamp(\n1. + v_float_distance_offset - abs(v_float_distance * gl_FragCoord.w),\n0.,\n1.);\n}\n",enable_standard_derivatives:"#extension GL_OES_standard_derivatives: enable\n",arrow_functions:"struct ArrowDistanceParameters\n{\nvec2 wing_normal;\nvec2 tip_normal;\nvec2 mirrored_wing_normal;\nvec2 mirrored_tip_normal;\nfloat width;\nfloat full_length;\nfloat arrow_height;\n};\nArrowDistanceParameters calculate_arrow_distance_parameters(\nconst vec2 wing_normal,\nconst vec2 tip_normal,\nconst float width_zpt,\nconst float length_zpt,\nconst float tip_height_multiplier,\nconst float wing_height_multiplier)\n{\nvec2 mirrored_wing_normal = vec2(wing_normal.x, -wing_normal.y);\nvec2 mirrored_tip_normal = vec2(tip_normal.x, -tip_normal.y);\nfloat width = 0.5 * width_zpt;\nfloat length = 0.5 * length_zpt;\nfloat arrow_height = width_zpt * (tip_height_multiplier - wing_height_multiplier);\nreturn ArrowDistanceParameters(\nwing_normal,\ntip_normal,\nmirrored_wing_normal,\nmirrored_tip_normal,\nwidth,\nlength,\narrow_height);\n}\nstruct ArrowDistances\n{\nfloat top_tip_cut;\nfloat bottom_tip_cut;\nfloat line;\nfloat bottom_left_wing;\nfloat bottom_right_wing;\nfloat top_left_wing;\nfloat top_right_wing;\n};\nArrowDistances calculate_arrow_distances(\nconst ArrowDistanceParameters arrow_parameters,\nconst vec2 texcoord,\nconst float offset,\nconst mat2 derivatives)\n{\nfloat derivatives_x_multiplier = 1. / max(abs(derivatives[0].x), abs(derivatives[1].x));\nfloat dt = ( texcoord.x - arrow_parameters.full_length - offset) * derivatives_x_multiplier;\nfloat d0 = (-texcoord.x - arrow_parameters.full_length - offset) * derivatives_x_multiplier;\nfloat d1 = (abs(texcoord.y) - arrow_parameters.width - offset) / max(abs(derivatives[0].y), abs(derivatives[1].y));\nfloat d2 = (dot(texcoord - vec2(arrow_parameters.full_length - arrow_parameters.arrow_height, 0.), arrow_parameters.wing_normal) - offset) / max(abs(dot(derivatives[0], arrow_parameters.wing_normal)), abs(dot(derivatives[1], arrow_parameters.wing_normal)));\nfloat d3 = (dot(texcoord - vec2(arrow_parameters.full_length - arrow_parameters.arrow_height, 0.), arrow_parameters.mirrored_wing_normal) - offset) / max(abs(dot(derivatives[0], arrow_parameters.mirrored_wing_normal)), abs(dot(derivatives[1], arrow_parameters.mirrored_wing_normal)));\nfloat d4 = (dot(texcoord - vec2(arrow_parameters.full_length, 0.), arrow_parameters.tip_normal) - offset) / max(abs(dot(derivatives[0], arrow_parameters.tip_normal)), abs(dot(derivatives[1], arrow_parameters.tip_normal)));\nfloat d5 = (dot(texcoord - vec2(arrow_parameters.full_length, 0.), arrow_parameters.mirrored_tip_normal) - offset) / max(abs(dot(derivatives[0], arrow_parameters.mirrored_tip_normal)), abs(dot(derivatives[1], arrow_parameters.mirrored_tip_normal)));\nreturn ArrowDistances(dt, d0, d1, d2, d3, d4, d5);\n}\n",circle_functions:"\nconst float g_distance_precision_limit = 1e-4;\nstruct CircleDistance\n{\nfloat distance;\nfloat width;\n};\nCircleDistance circle_color_distance(\nconst mat2 derivatives,\nconst vec2 circle,\nconst float circle_width)\n{\nfloat circle_length = length(circle);\nfloat distance = circle_length - circle_width;\nvec2 circle_dx = derivatives[0];\nvec2 circle_dy = derivatives[1];\nfloat distance_dx = dot(circle, circle_dx);\nfloat distance_dy = dot(circle, circle_dy);\nfloat derivative_denominator = circle_length;\nfloat width = max(abs(distance_dx), abs(distance_dy));\nreturn CircleDistance(\ndistance * derivative_denominator,\nwidth);\n}\nvec4 distance_to_color(\nconst float fill_distance,\nconst float border_distance,\nconst vec4 fill_color,\nconst vec4 border_color)\n{\nfloat fill_factor = affine_step(-1., 0., fill_distance);\nfloat border_factor = affine_step(0., 1., border_distance);\nreturn\nmix(mix(fill_color, border_color, fill_factor), vec4(.0), border_factor);\n}\nvec4 distance_to_color(\nconst CircleDistance circle_distance,\nconst vec4 fill_color)\n{\nfloat fill_factor = circle_distance.distance < g_distance_precision_limit\n? 0.\n: affine_step(0., circle_distance.width, circle_distance.distance);\nreturn mix(fill_color, vec4(0.), fill_factor);\n}\n",arrow_line:"uniform vec2 u_vec2_wing_normal;\nuniform vec2 u_vec2_tip_normal;\nuniform float u_float_tip_height_multiplier;\nuniform float u_float_wing_height_multiplier;\nvarying vec2 v_vec2_line_type_arrow_tail;\nvarying vec4 v_vec4_arrow_width_length_border_outer;\nvarying vec4 v_vec4_texcoord_arrow_line;\nvarying vec4 v_vec4_distance_vertex_hiding;\nvarying vec4 v_vec4_color;\nvarying vec4 v_vec4_border_color;\nconst float g_type_arrow = 1.;\nconst float g_type_start_border = 2.;\nbool lookalike(const float a, const float b)\n{\nreturn abs(a - b) < 1e-4;\n}\nfloat filter_border(const float start, const float value)\n{\nreturn step(start, value) * 2. - 1.;\n}\nfloat arrow_distance(\nconst ArrowDistanceParameters arrow_parameters,\nconst vec2 texcoord,\nconst float offset,\nconst mat2 derivatives,\nconst float line_distance,\nconst float line_distance_no_offset)\n{\nArrowDistances ad = calculate_arrow_distances(arrow_parameters, texcoord, offset, derivatives);\nfloat derivatives_x_multiplier = 1. / max(abs(derivatives[0].x), abs(derivatives[1].x));\nfloat intersection_point = arrow_parameters.full_length - arrow_parameters.arrow_height - arrow_parameters.width * u_vec2_wing_normal.y / u_vec2_wing_normal.x;\nfloat tail_arrow_intersection = filter_border(-1., (texcoord.x - intersection_point) * derivatives_x_multiplier);\nfloat tail_hide_part = v_vec2_line_type_arrow_tail.y;\nfloat tail_hide_mask = (-texcoord.x - tail_hide_part) * derivatives_x_multiplier;\nfloat clipped_tail = max(tail_hide_mask, max(line_distance, max(ad.top_left_wing, ad.top_right_wing)));\nfloat line_without_offset = filter_border(0., line_distance_no_offset);\nfloat wings_with_tail = max(min(min(ad.bottom_left_wing, ad.bottom_right_wing), line_without_offset), max(ad.top_left_wing, ad.top_right_wing));\nreturn (v_vec4_distance_vertex_hiding.x < v_vec4_distance_vertex_hiding.y)\n? max(ad.top_tip_cut, max(-max(tail_arrow_intersection, line_without_offset), wings_with_tail))\n: max(ad.top_tip_cut, min(clipped_tail, max(-max(tail_arrow_intersection, line_without_offset), wings_with_tail)));\n}\nvec4 distance_to_arrow_line_color(\nconst float fill_distance,\nconst float border_distance)\n{\nreturn distance_to_color(fill_distance, border_distance, v_vec4_color, v_vec4_border_color);\n}\nvec4 arrow_color(\nconst vec2 texcoord,\nconst ArrowDistanceParameters arrow_parameters,\nconst float line_fill_distance,\nconst float line_border_distance)\n{\nmat2 derivatives = mat2(dFdx(texcoord), dFdy(texcoord));\nfloat border_clipping = (abs(texcoord.y) - v_vec4_arrow_width_length_border_outer.w) / max(abs(derivatives[0].y), abs(derivatives[1].y));\nfloat arrow_border_distance = arrow_distance(\narrow_parameters,\ntexcoord,\nv_vec4_arrow_width_length_border_outer.z,\nderivatives,\nline_border_distance,\nline_fill_distance);\nfloat border_factor = max(border_clipping, affine_step(0., 1., arrow_border_distance));\nreturn distance_to_arrow_line_color(\narrow_distance(arrow_parameters, texcoord, 0., derivatives, line_fill_distance, line_fill_distance),\nborder_factor);\n}\nfloat line_start_distance(\nconst vec2 texcoord,\nconst float offset,\nconst mat2 derivatives,\nconst float line_distance)\n{\nfloat tail_hide_part = v_vec2_line_type_arrow_tail.y;\nfloat d0 = (-texcoord.x - offset) / max(abs(derivatives[0].x), abs(derivatives[1].x));\nfloat dh = (texcoord.x - tail_hide_part) / max(abs(derivatives[0].x), abs(derivatives[1].x));\nreturn max(d0, max(line_distance, dh));\n}\nvec4 line_color(const float line_fill_distance, const float line_border_distance)\n{\nfloat type = v_vec2_line_type_arrow_tail.x;\nfloat fill_distance = line_fill_distance;\nfloat border_distance = line_border_distance;\nif (lookalike(type, g_type_start_border))\n{\nvec2 texcoord = v_vec4_texcoord_arrow_line.xy;\nmat2 derivatives = mat2(dFdx(texcoord), dFdy(texcoord));\nfill_distance = line_start_distance(texcoord, 0., derivatives, line_fill_distance);\nborder_distance = line_start_distance(texcoord, v_vec4_arrow_width_length_border_outer.z, derivatives, line_border_distance);\n}\nreturn distance_to_arrow_line_color(fill_distance, border_distance);\n}\nvec4 arrow_line_color()\n{\nif (lookalike(min(v_vec4_distance_vertex_hiding.y, 1.), 1.)\n|| lookalike(v_vec4_distance_vertex_hiding.w, 1.)\n|| !lookalike(v_vec2_line_type_arrow_tail.x, g_type_arrow) && (v_vec4_distance_vertex_hiding.x < v_vec4_distance_vertex_hiding.y || v_vec4_distance_vertex_hiding.x > v_vec4_distance_vertex_hiding.z))\n{\ndiscard;\n}\nArrowDistanceParameters arrow_parameters = calculate_arrow_distance_parameters(\nu_vec2_wing_normal,\nu_vec2_tip_normal,\nv_vec4_arrow_width_length_border_outer.x,\nv_vec4_arrow_width_length_border_outer.y,\nu_float_tip_height_multiplier,\nu_float_wing_height_multiplier);\nfloat line_width = arrow_parameters.width;\nfloat line_border = v_vec4_arrow_width_length_border_outer.z;\nvec2 line_texcoord = v_vec4_texcoord_arrow_line.zw;\nmat2 line_derivatives = mat2(dFdx(line_texcoord), dFdy(line_texcoord));\nCircleDistance circle_fill_distance = circle_color_distance(line_derivatives, line_texcoord, line_width);\nCircleDistance circle_border_distance = circle_color_distance(line_derivatives, line_texcoord, line_width + line_border);\nfloat line_fill_distance = affine_step(-1., 0., circle_fill_distance.distance / circle_fill_distance.width) - 1.;\nfloat line_border_distance = affine_step(0., circle_border_distance.width, circle_border_distance.distance);\nreturn lookalike(v_vec2_line_type_arrow_tail.x, g_type_arrow)\n? arrow_color(v_vec4_texcoord_arrow_line.xy, arrow_parameters, line_fill_distance, line_border_distance)\n: line_color(line_fill_distance, line_border_distance);\n}\nvoid main()\n{\ngl_FragColor = arrow_line_color();\n}\n",arrow_line_identify:"\nvarying vec2 v_vec2_line_type_arrow_tail;\nvarying vec4 v_vec4_distance_vertex_hiding;\nvarying vec4 v_vec4_identifier;\nconst float g_type_arrow = 1.;\nbool lookalike(const float a, const float b)\n{\nreturn abs(a - b) < 1e-5;\n}\nvoid main()\n{\nif (lookalike(min(v_vec4_distance_vertex_hiding.y, 1.), 1.)\n|| lookalike(v_vec4_distance_vertex_hiding.w, 1.)\n|| !lookalike(v_vec2_line_type_arrow_tail.x, g_type_arrow) && (v_vec4_distance_vertex_hiding.x < v_vec4_distance_vertex_hiding.y || v_vec4_distance_vertex_hiding.x > v_vec4_distance_vertex_hiding.z))\n{\ndiscard;\n}\n    gl_FragColor = v_vec4_identifier;\n}\n",circle_marker:"uniform vec4 u_vec4_color;\nvarying vec2 v_vec2_circle;\nvarying float v_float_width;\nvoid main() {\n    float center_distance = dot(v_vec2_circle, v_vec2_circle);\n    gl_FragColor = u_vec4_color * affine_step(1.0, 1.0 - 4.0 / v_float_width, center_distance);\n}\n",road:"uniform vec4 u_vec4_color;\nvarying vec2 v_vec2_normal;\nvarying float v_float_half_width;\nvoid main()\n{\n    \n    float opacity = 1.0 - affine_step(\n        v_float_half_width - length(fwidth(v_vec2_normal)),\n        v_float_half_width,\n        length(v_vec2_normal)\n    );\n    gl_FragColor = u_vec4_color * opacity;\n}\n",road_identify:"varying vec4 v_vec4_identifier;\nvarying vec2 v_vec2_normal;\nvarying float v_float_half_width;\nvoid main()\n{\n    if (dot(v_vec2_normal, v_vec2_normal) > v_float_half_width * v_float_half_width) {\n        discard;\n    }\n    gl_FragColor = v_vec4_identifier;\n}\n",stretchable_image:"uniform sampler2D u_sr2d_texture;\nvarying vec2 v_vec2_texcoord;\nvoid main()\n{\n  gl_FragColor = texture2D(u_sr2d_texture, v_vec2_texcoord);\n}\n",stretchable_image_identify:"uniform sampler2D u_sr2d_texture;\nvarying vec2 v_vec2_texcoord;\nvarying vec4 v_vec4_identifier;\nvoid main()\n{\n  vec4 color = texture2D(u_sr2d_texture, v_vec2_texcoord);\n  if (color.a < 0.1) {\n    discard;\n  } else {\n    gl_FragColor = v_vec4_identifier;\n  }\n}\n",rect:"uniform vec4 u_vec4_color;\nvoid main()\n{\ngl_FragColor = u_vec4_color;\n}\n",rect_with_texture:"uniform sampler2D u_sr2d_texture;\nuniform float u_float_opacity;\nvarying vec2 v_vec2_texcoord;\nvoid main()\n{\n  gl_FragColor = apply_opacity(texture2D(u_sr2d_texture, v_vec2_texcoord), u_float_opacity);\n}\n"},Hr={apply_height_factor:"vec4 apply_z_limitation(vec4 vertex, float tile_height, float height_limitation)\n{\nvertex.z = min(vertex.z, height_limitation / tile_height);\nreturn vertex;\n}\nvec4 apply_height_factor(const vec3 vertex, const float height_factor)\n{\nvec3 result_vertex = vertex;\nresult_vertex.z *= height_factor;\nreturn vec4(result_vertex, 1.0);\n}\n",apply_opacity:Ur,color:"uniform mat4 u_mat4_mvp;\nuniform vec4 u_vec4_color;\nuniform float u_float_opacity;\nattribute vec2 a_vec2_vertex;\nvarying vec4 v_vec4_color;\nvoid main()\n{\nv_vec4_color = apply_opacity(u_vec4_color, u_float_opacity);\ngl_Position = u_mat4_mvp * vec4(a_vec2_vertex, 0.0, 1.0);\n}\n",diffuse:"uniform mat4 u_mat4_mvp;\nuniform vec3 u_vec3_light_direction;\nuniform vec3 u_vec3_light_color;\nuniform vec3 u_vec3_ambient_color;\nuniform vec4 u_vec4_color;\nuniform float u_float_height_limitation;\nuniform float u_float_tile_height;\nuniform float u_float_height_factor;\nuniform float u_float_opacity;\nattribute vec3 a_vec3_vertex;\nattribute vec3 a_vec3_normal;\nvarying vec4 v_vec4_color;\nconst float g_wall_offset_isometric = .001;\nconst float g_wall_offset_perspective = 8.;\nvoid main()\n{\nv_vec4_color = apply_opacity(\nvec4(\nu_vec4_color.rgb * (u_vec3_ambient_color + u_vec3_light_color * abs(dot(u_vec3_light_direction, normalize_s08(a_vec3_normal)))),\nu_vec4_color.a),\nu_float_opacity);\nvec4 vertex_hf = apply_height_factor(a_vec3_vertex, u_float_height_factor);\ngl_Position = u_mat4_mvp * apply_z_limitation(vertex_hf, u_float_tile_height, u_float_height_limitation);\nif (normalize_s08(a_vec3_normal).z < .5)\n{\nif ((u_mat4_mvp[0][3] == 0.) && (u_mat4_mvp[1][3] == 0.) && (u_mat4_mvp[2][3] == 0.))\n{\ngl_Position.z += g_wall_offset_isometric;\n}\nelse\n{\ngl_Position.z += g_wall_offset_perspective;\n}\n}\n}\n",line:"uniform mat4 u_mat4_mvp;\nuniform vec2 u_vec2_vpt_size;\nuniform vec3 u_vec3_light_direction;\nuniform vec3 u_vec3_light_color;\nuniform vec3 u_vec3_ambient_color;\nuniform vec4 u_vec4_color;\nuniform float u_float_height_limitation;\nuniform float u_float_tile_height;\nuniform float u_float_height_factor;\nuniform float u_float_opacity;\nattribute vec4 a_vec4_vertex;\nattribute vec2 a_vec2_normal;\nattribute vec2 a_vec2_normal_delta;\nattribute vec3 a_vec3_direction;\nattribute float a_float_distance;\nvarying vec4 v_vec4_color;\nvarying float v_float_distance;\nconst float g_shift_pixels = 1.;\nconst float g_min_denominator = 1e-4;\nconst float g_w_factor = 1e-6;\nvec2 multiply_complex(vec2 lhs, vec2 rhs)\n{\nreturn vec2(lhs.x * rhs.x - lhs.y * rhs.y, lhs.x * rhs.y + lhs.y * rhs.x);\n}\nvoid main()\n{\nvec2 half_viewport = u_vec2_vpt_size / vec2(2.);\nvec4 clip_space_direction = u_mat4_mvp * vec4(normalize_s08(a_vec3_direction), 0.);\nvec4 vertex_hf = apply_height_factor(a_vec4_vertex.xyz, u_float_height_factor);\nvec4 clip_space_vertex = u_mat4_mvp * apply_z_limitation(vertex_hf, u_float_tile_height, u_float_height_limitation);\nvec2 screen_space_direction = (clip_space_direction.xy * clip_space_vertex.w - clip_space_vertex.xy * clip_space_direction.w) * half_viewport;\nvec2 screen_space_perp = vec2(-screen_space_direction.y, screen_space_direction.x);\nfloat denominator = max(g_min_denominator, length(screen_space_perp));\nvec2 bevel_normal = normalize_s08(a_vec2_normal);\nvec2 normal_delta = normalize_s08(a_vec2_normal_delta);\nvec4 clip_space_bevel_normal = u_mat4_mvp * vec4(bevel_normal, 0., 0.);\nvec2 screen_space_bevel_normal = (clip_space_bevel_normal.xy * clip_space_vertex.w - clip_space_vertex.xy * clip_space_bevel_normal.w) * half_viewport;\nfloat bevel_denominator = max(g_min_denominator, length(screen_space_bevel_normal));\nfloat normal_factor = -dot(screen_space_bevel_normal, screen_space_perp) / denominator / bevel_denominator;\nvec2 wall_normal = multiply_complex(bevel_normal, vec2(normal_delta.x, sign(normal_factor) * normal_delta.y));\nfloat bevel_diffuse = abs(dot(u_vec3_light_direction.xy, bevel_normal));\nfloat wall_diffuse = abs(dot(u_vec3_light_direction.xy, wall_normal));\nfloat diffuse = mix(bevel_diffuse, wall_diffuse, abs(normal_factor));\ngl_Position = g_w_factor * (clip_space_vertex + vec4(screen_space_perp / half_viewport, 0., 0.) * g_shift_pixels * a_float_distance / denominator * clip_space_vertex.w);\nv_vec4_color = vec4(u_vec4_color.rgb * (u_vec3_ambient_color + u_vec3_light_color * diffuse), u_vec4_color.a);\nv_float_distance = a_float_distance * gl_Position.w;\n}\n",packed_attributes:"\nvec2 normalize_s08(vec2 value)\n{\nreturn value * (1. / 127.);\n}\nvec3 normalize_s08(vec3 value)\n{\nreturn value * (1. / 127.);\n}\nfloat normalize_s16(float value)\n{\nreturn value * (1. / 32767.);\n}\nvec2 normalize_s16(vec2 value)\n{\nreturn value * (1. / 32767.);\n}\nvec3 normalize_s16(vec3 value)\n{\nreturn value * (1. / 32767.);\n}\nvec2 unpack_widen(vec2 widen_packed)\n{\nreturn normalize_s08(widen_packed) * sqrt(2.);\n}\nvec2 unpack_texcoord(vec2 texcoord)\n{\nreturn texcoord * (1. / 32768.);\n}\nvec2 unpack_model_texcoord(vec2 texcoord)\n{\nconst float min_value = -3.0;\nconst float max_value = 5.0;\nreturn texcoord * (max_value - min_value) / 65536.0 + min_value;\n}\n",pixel_line:"attribute vec2 a_vec2_vertex;\nattribute vec4 a_vec4_normals;\nuniform mat4 u_mat4_mvp;\nuniform vec2 u_vec2_vpt_size;\nuniform float u_float_width;\nvarying vec2 v_vec2_normal;\nvarying float v_float_half_width;\nconst float g_w_factor = 1e-6;\nconst float normal_unpack_multiplier = 0.011135539861205473;\nconst float g_min_denominator = 1e-4;\nvoid main()\n{\n    \n    float half_width = 0.5 * (u_float_width + 1.0);\n    vec2 half_viewport = u_vec2_vpt_size / vec2(2.0);\n    \n    vec2 extender = a_vec4_normals.xy * normal_unpack_multiplier;\n    \n    vec4 vertex_clip = u_mat4_mvp * vec4(a_vec2_vertex, 0.0, 1.0);\n    vec4 extender_clip = u_mat4_mvp * vec4(extender, 0.0, 0.0);\n    \n    vec2 extender_ndc = extender_clip.xy * vertex_clip.w - vertex_clip.xy * extender_clip.w;\n    vec2 extender_screen = extender_ndc * half_viewport;\n    \n    \n    float denominator = max(g_min_denominator, length(extender_screen));\n    float extender_multiplier = half_width * length(extender) / denominator;\n    \n    vec4 shifted_position = vertex_clip +\n        vec4(extender_ndc, 0.0, 0.0) * extender_multiplier * vertex_clip.w;\n    gl_Position = g_w_factor * shifted_position;\n    v_vec2_normal = extender * half_width;\n    v_float_half_width = half_width;\n}\n",pixel_offset:"\nconst float g_min_denominator = 1e-7;\nconst float g_max_factor = 10000.;\nfloat calculate_multiplication_factor(\nvec2 half_viewport,\nvec4 clip_space_widen,\nvec4 clip_space_widen_perp,\nvec4 clip_space_vertex,\nfloat shift_pixels)\n{\nfloat limited_factor = 0.;\n{\nvec2 screen_space_widen = (clip_space_widen.xy * clip_space_vertex.w - clip_space_vertex.xy * clip_space_widen.w) * half_viewport;\nvec2 screen_space_widen_perp = (clip_space_widen_perp.xy * clip_space_vertex.w - clip_space_vertex.xy * clip_space_widen_perp.w) * half_viewport;\nvec2 perp = vec2(screen_space_widen_perp.y, -screen_space_widen_perp.x);\nfloat perp_length = length(perp);\nvec4 v = clip_space_vertex;\nvec4 n = clip_space_widen;\nfloat denominator = dot(perp, screen_space_widen) / shift_pixels - n.w * v.w * perp_length;\nif (abs(denominator) > g_min_denominator)\n{\nfloat factor = v.w * v.w * perp_length / denominator;\nlimited_factor = sign(factor) * min(g_max_factor, abs(factor));\n}\n}\nreturn limited_factor;\n}\n",pointsprite:"uniform mat4 u_mat4_mvp;\nuniform vec2 u_vec2_vpt_size;\nuniform vec3 u_vec3_projection_scale_style_scale_dpi;\nuniform float u_float_height_factor;\nuniform float u_float_rounding_factor;\nattribute vec3 a_vec3_position;\nattribute vec2 a_vec2_offset;\nattribute vec2 a_vec2_texcoord;\nattribute vec2 a_vec2_range;\nattribute vec2 a_vec2_rescale;\nvarying vec2 v_vec2_texcoord;\nvoid main()\n{\nvec2 inv_half_size = 2.0 / u_vec2_vpt_size;\nvec4 anchor = u_mat4_mvp * apply_height_factor(a_vec3_position, u_float_height_factor);\nvec2 offset = rescale(a_vec2_offset, a_vec2_rescale, a_vec2_range, u_vec3_projection_scale_style_scale_dpi.y);\nvec2 pos_2d = anchor.xy + overlay_transform(offset, inv_half_size) * anchor.w;\nvec2 corner = make_position(pos_2d, anchor.w, inv_half_size, u_float_rounding_factor);\ngl_Position = vec4(corner, anchor.z, clipw(anchor.w, a_vec2_range, u_vec3_projection_scale_style_scale_dpi.y));\nv_vec2_texcoord = unpack_texcoord(a_vec2_texcoord);\n}\n",precision_constants:"\nconst float g_circle_scale_precision_factor = 1e8;\n",striped_line:"uniform mat4 u_mat4_mvp;\nuniform vec4 u_vec4_dash_color;\nuniform vec4 u_vec4_space_color;\nuniform vec4 u_vec4_border_color;\nuniform mediump vec2 u_vec2_vpt_size;\nuniform vec3 u_vec3_projection_scale_style_scale_dpi;\nuniform float u_float_width;\nuniform float u_float_width_offset;\nuniform vec2 u_vec2_scaler_params;\nuniform float u_float_dash_length;\nuniform float u_float_space_length;\nuniform float u_float_dash2_length;\nuniform float u_float_opacity;\nattribute vec2 a_vec2_vertex;\nattribute vec2 a_vec2_texture_widen;\nattribute vec2 a_vec2_widen;\nattribute float a_float_vertex_distance;\nattribute float a_float_component_distance;\nattribute float a_float_object_length;\nvarying vec4 v_vec4_dash_color;\nvarying vec4 v_vec4_space_color;\nvarying vec4 v_vec4_border_color;\nvarying vec2 v_vec2_circle;\nvarying float v_float_width;\nvarying float v_float_part_color_swap_threshold;\nvarying float v_float_distance_in_parts;\nconst float g_shift_pixels = 2.;\nconst float g_w_factor = 1e-7;\nPolylineDistance decode_line_distance()\n{\nreturn PolylineDistance(\na_float_vertex_distance,\na_float_component_distance,\na_float_object_length);\n}\nStripedLineInParams decode_line_params(const Scale scale)\n{\nfloat width = calculate_final_width(scale, u_float_width, u_float_width_offset);\nfloat dash_length  = scale.calculation * u_float_dash_length;\nfloat space_length = scale.calculation * u_float_space_length;\nfloat dash2_length = scale.calculation * u_float_dash2_length;\nreturn StripedLineInParams(\ndash_length,\nspace_length,\ndash2_length,\nwidth);\n}\nvoid main()\n{\nScale scale = calculate_scale(u_vec3_projection_scale_style_scale_dpi, u_vec2_scaler_params);\nStripedLineInParams params = decode_line_params(scale);\nvec2 widen = unpack_widen(a_vec2_widen);\nvec2 widen_perp = vec2(-widen.y, widen.x);\nvec4 clip_space_widen = u_mat4_mvp * vec4(widen, 0., 0.);\nvec4 clip_space_widen_perp = u_mat4_mvp * vec4(widen_perp, 0., 0.);\nvec4 clip_space_vertex = u_mat4_mvp * vec4(a_vec2_vertex, 0.0, 1.0) + clip_space_widen * params.line_width;\nvec2 half_viewport = 0.5 * u_vec2_vpt_size;\nfloat limited_factor = calculate_multiplication_factor(\nhalf_viewport,\nclip_space_widen,\nclip_space_widen_perp,\nclip_space_vertex,\ng_shift_pixels);\nPolylineDistance distance_decoded = decode_line_distance();\nStripedLineOutParams output_params;\ncalculate_line_params(distance_decoded, params, output_params);\nvec2 texture_widen_with_shift_sign = unpack_widen(a_vec2_texture_widen);\nfloat shift_sign = sign(dot(widen, texture_widen_with_shift_sign));\nvec2 texture_widen = shift_sign * texture_widen_with_shift_sign;\nvec2 texture_widen_perp = vec2(-texture_widen.y, texture_widen.x);\nfloat distance_shift = shift_sign * abs(dot(widen, texture_widen_perp)) * params.line_width;\nfloat circle_factor = g_circle_scale_precision_factor / scale.calculation;\nv_vec2_circle = texture_widen * (params.line_width + limited_factor) * circle_factor;\nv_float_width = params.line_width * circle_factor;\nv_float_part_color_swap_threshold = output_params.part_color_swap_threshold;\nv_float_distance_in_parts = output_params.distance_in_parts;\nv_vec4_dash_color = apply_opacity(u_vec4_dash_color, u_float_opacity);\nv_vec4_space_color = apply_opacity(u_vec4_space_color, u_float_opacity);\nv_vec4_border_color = apply_opacity(u_vec4_border_color, u_float_opacity);\ngl_Position = (clip_space_vertex + clip_space_widen * limited_factor) * g_w_factor;\n}\n",striped_line_identify:"uniform mat4 u_mat4_mvp;\nuniform vec4 u_vec4_dash_color;\nuniform vec4 u_vec4_space_color;\nuniform vec4 u_vec4_border_color;\nuniform mediump vec2 u_vec2_vpt_size;\nuniform vec3 u_vec3_projection_scale_style_scale_dpi;\nuniform float u_float_width;\nuniform float u_float_width_offset;\nuniform vec2 u_vec2_scaler_params;\nuniform float u_float_dash_length;\nuniform float u_float_space_length;\nuniform float u_float_dash2_length;\nuniform float u_float_opacity;\nattribute vec2 a_vec2_vertex;\nattribute vec2 a_vec2_texture_widen;\nattribute vec2 a_vec2_widen;\nattribute float a_float_vertex_distance;\nattribute float a_float_component_distance;\nattribute float a_float_object_length;\nattribute vec4 a_vec4_identifier;\nvarying vec4 v_vec4_identifier;\nvarying vec4 v_vec4_dash_color;\nvarying vec4 v_vec4_space_color;\nvarying vec4 v_vec4_border_color;\nvarying vec2 v_vec2_circle;\nvarying float v_float_width;\nvarying float v_float_part_color_swap_threshold;\nvarying float v_float_distance_in_parts;\nconst float g_shift_pixels = 2.;\nconst float g_w_factor = 1e-7;\nPolylineDistance decode_line_distance()\n{\nreturn PolylineDistance(\na_float_vertex_distance,\na_float_component_distance,\na_float_object_length);\n}\nStripedLineInParams decode_line_params(const Scale scale)\n{\nfloat width = calculate_final_width(scale, u_float_width, u_float_width_offset);\nfloat dash_length  = scale.calculation * u_float_dash_length;\nfloat space_length = scale.calculation * u_float_space_length;\nfloat dash2_length = scale.calculation * u_float_dash2_length;\nreturn StripedLineInParams(\ndash_length,\nspace_length,\ndash2_length,\nwidth);\n}\nvoid main()\n{\nScale scale = calculate_scale(u_vec3_projection_scale_style_scale_dpi, u_vec2_scaler_params);\nStripedLineInParams params = decode_line_params(scale);\nvec2 widen = unpack_widen(a_vec2_widen);\nvec2 widen_perp = vec2(-widen.y, widen.x);\nvec4 clip_space_widen = u_mat4_mvp * vec4(widen, 0., 0.);\nvec4 clip_space_widen_perp = u_mat4_mvp * vec4(widen_perp, 0., 0.);\nvec4 clip_space_vertex = u_mat4_mvp * vec4(a_vec2_vertex, 0.0, 1.0) + clip_space_widen * params.line_width;\nvec2 half_viewport = 0.5 * u_vec2_vpt_size;\nfloat limited_factor = calculate_multiplication_factor(\nhalf_viewport,\nclip_space_widen,\nclip_space_widen_perp,\nclip_space_vertex,\ng_shift_pixels);\nPolylineDistance distance_decoded = decode_line_distance();\nStripedLineOutParams output_params;\ncalculate_line_params(distance_decoded, params, output_params);\nvec2 texture_widen_with_shift_sign = unpack_widen(a_vec2_texture_widen);\nfloat shift_sign = sign(dot(widen, texture_widen_with_shift_sign));\nvec2 texture_widen = shift_sign * texture_widen_with_shift_sign;\nvec2 texture_widen_perp = vec2(-texture_widen.y, texture_widen.x);\nfloat distance_shift = shift_sign * abs(dot(widen, texture_widen_perp)) * params.line_width;\nfloat circle_factor = g_circle_scale_precision_factor / scale.calculation;\nv_vec2_circle = texture_widen * (params.line_width + limited_factor) * circle_factor;\nv_float_width = params.line_width * circle_factor;\nv_float_part_color_swap_threshold = output_params.part_color_swap_threshold;\nv_float_distance_in_parts = output_params.distance_in_parts;\nv_vec4_dash_color = apply_opacity(u_vec4_dash_color, u_float_opacity);\nv_vec4_space_color = apply_opacity(u_vec4_space_color, u_float_opacity);\nv_vec4_border_color = apply_opacity(u_vec4_border_color, u_float_opacity);\nv_vec4_identifier = a_vec4_identifier;\nif (vec4(1., 1., 1., 1.) != a_vec4_identifier)\n{\ngl_Position = (clip_space_vertex + clip_space_widen * limited_factor) * g_w_factor;\n}\nelse\n{\ngl_Position = vec4(1., 1., 1., 1.);\n}\n}\n",striped_line_functions:"struct PolylineDistance\n{\nfloat vertex_distance_from_start;\nfloat segment_distance_from_start;\nfloat total_length;\n};\nstruct StripedLineInParams\n{\nfloat dash_length;\nfloat space_length;\nfloat dash2_length;\nfloat line_width;\n};\nstruct StripedLineOutParams\n{\nfloat part_color_swap_threshold;\nfloat distance_in_parts;\n};\nvoid calculate_line_params(in PolylineDistance polyline_distance, in StripedLineInParams striped_line_params, out StripedLineOutParams line_params)\n{\nfloat requested_part_length =\nstriped_line_params.dash_length\n+ striped_line_params.space_length;\nfloat space2_length = requested_part_length - striped_line_params.dash2_length;\nfloat min_part_length =\nrequested_part_length\n- 0.5 * min(striped_line_params.space_length, space2_length);\nfloat part_count = max(\nfloor(polyline_distance.total_length / requested_part_length + 0.5),\n1.0);\nfloat part_length = polyline_distance.total_length / part_count;\nfloat dash_length = (part_length / requested_part_length) * striped_line_params.dash2_length;\nfloat part_color_swap_threshold;\nif (polyline_distance.total_length < min_part_length)\n{\ndash_length = part_length;\npart_color_swap_threshold = 1.0;\n}\nelse\n{\npart_color_swap_threshold = dash_length / part_length;\n}\nfloat segment_start = fract((polyline_distance.segment_distance_from_start + 0.5 * dash_length) / part_length);\nfloat vertex_normalized_distance = segment_start + polyline_distance.vertex_distance_from_start / part_length;\nline_params = StripedLineOutParams(\npart_color_swap_threshold,\nvertex_normalized_distance);\n}\n",label_fixed_anchor:"uniform mat4 u_mat4_mvp;\nattribute vec4 a_vec4_position;\nattribute vec2 a_vec2_offset;\nattribute vec2 a_vec2_texcoord;\nuniform vec2 u_vec2_offset;\nuniform vec2 u_vec2_vpt_size;\nuniform float u_float_scale;\nuniform float u_float_height_factor;\nvarying vec2 v_vec2_texcoord;\nvoid main() {\n    vec4 ndcPosition = u_mat4_mvp * apply_height_factor(a_vec4_position.xyz, u_float_height_factor);\n    ndcPosition.xyz = ndcPosition.xyz / ndcPosition.w;\n    ndcPosition.w = 1.0;\n    ndcPosition.xy += (a_vec2_offset * u_float_scale + u_vec2_offset) / u_vec2_vpt_size * 2.0;\n    gl_Position = ndcPosition;\n    v_vec2_texcoord = unpack_texcoord(a_vec2_texcoord);\n}\n",label_fixed_anchor_identify:"uniform mat4 u_mat4_mvp;\nattribute vec4 a_vec4_position;\nattribute vec2 a_vec2_offset;\nattribute vec4 a_vec4_identifier;\nuniform vec2 u_vec2_offset;\nuniform vec2 u_vec2_vpt_size;\nuniform float u_float_scale;\nvarying vec4 v_vec4_identifier;\nvoid main() {\n    v_vec4_identifier = a_vec4_identifier;\n    if (vec4(1., 1., 1., 1.) != a_vec4_identifier)\n    {\n        vec4 ndcPosition = u_mat4_mvp * a_vec4_position;\n        ndcPosition.xyz = ndcPosition.xyz / ndcPosition.w;\n        ndcPosition.w = 1.0;\n        ndcPosition.xy += (a_vec2_offset * u_float_scale + u_vec2_offset) / u_vec2_vpt_size * 2.0;\n        gl_Position = ndcPosition;\n    }\n    else\n    {\n        gl_Position = vec4(1., 1., 1., 1.);\n    }\n}\n",label_directional:"uniform mat4 u_mat4_mvp;\nattribute vec4 a_vec4_position;\nattribute vec2 a_vec2_offset;\nattribute vec2 a_vec2_texcoord;\nattribute vec2 a_vec2_style_zoom_limits;\nuniform float u_float_style_zoom;\nuniform float u_float_scale;\nuniform float u_float_tile_to_pixel_ratio;\nvarying vec2 v_vec2_texcoord;\nfloat clipw(const float w, const vec2 range, const float zoom) {\n    return w * (step(range.x, zoom) - step(range.y, zoom));\n}\nvoid main() {\n    vec4 newPosition = a_vec4_position;\n    newPosition.xy += a_vec2_offset * u_float_scale * u_float_tile_to_pixel_ratio;\n    newPosition = u_mat4_mvp * newPosition;\n    gl_Position = vec4(newPosition.xyz, clipw(newPosition.w, a_vec2_style_zoom_limits, u_float_style_zoom));\n    v_vec2_texcoord = unpack_texcoord(a_vec2_texcoord);\n}\n",one_way_line:"uniform vec4 u_vec4_color;\nuniform vec4 u_vec4_border_color;\nuniform mat4 u_mat4_mvp;\nuniform mediump vec2 u_vec2_vpt_size;\nuniform vec3 u_vec3_projection_scale_style_scale_dpi;\nuniform vec2 u_vec2_scale_limits;\nuniform float u_float_border_width;\nuniform float u_float_border_width_offset;\nuniform float u_float_size_factor;\nuniform mediump float u_float_width;\nuniform mediump float u_float_length;\nuniform float u_float_wing_width_multiplier;\nuniform float u_float_opacity;\nattribute vec2 a_vec2_position;\nattribute vec2 a_vec2_direction;\nattribute vec2 a_vec2_widen_direction;\nvarying vec4 v_vec4_color;\nvarying vec4 v_vec4_border_color;\nvarying vec2 v_vec2_texcoord;\nvarying float v_float_border_width;\nvarying float v_float_zpt_to_texcoord_factor;\nvarying float v_float_outer_width;\nvarying float v_float_opacity;\nconst float g_shift_pixels = 2.;\nconst float g_w_factor = 1e-7;\nvoid main()\n{\nfloat style_scale_clamped = clamp(u_vec3_projection_scale_style_scale_dpi.y, u_vec2_scale_limits.x, u_vec2_scale_limits.y);\nfloat scale_ratio = u_vec3_projection_scale_style_scale_dpi.x / u_vec3_projection_scale_style_scale_dpi.y;\nfloat calculation_scale = style_scale_clamped * scale_ratio;\nArrowParameters arrow_parameters = calculate_arrow_parameters(\ncalculation_scale,\nu_float_width,\nu_float_border_width,\nu_float_length,\nu_float_wing_width_multiplier,\nu_float_size_factor);\nv_float_zpt_to_texcoord_factor = arrow_parameters.zpt_to_texcoord_factor;\nv_float_outer_width = arrow_parameters.outer_width;\nvec2 direction = normalize_s08(a_vec2_direction);\nvec2 untransformed_widen = a_vec2_widen_direction * arrow_parameters.widen_size;\nvec2 widen = multiply_complex(untransformed_widen * arrow_parameters.final_size, direction);\nfloat shift_pixels = g_shift_pixels * sqrt(2.) / min(abs(untransformed_widen.x), abs(untransformed_widen.y));\nVertexShiftParameters shift_parameters = calculate_vertex_shift_parameters(\nu_mat4_mvp,\nu_vec2_vpt_size,\na_vec2_position,\nwiden,\nshift_pixels);\ngl_Position = shift_parameters.clip_space_vertex / arrow_parameters.final_size * g_w_factor;\nv_vec2_texcoord = untransformed_widen * (1. + shift_parameters.limited_factor);\nfloat border_width = u_float_border_width * v_float_zpt_to_texcoord_factor;\nfloat border_width_offset = u_float_border_width_offset * v_float_zpt_to_texcoord_factor;\nv_float_border_width = max(0., border_width - u_vec3_projection_scale_style_scale_dpi.y / style_scale_clamped * border_width_offset);\nv_vec4_color = apply_opacity(u_vec4_color, u_float_opacity);\nv_vec4_border_color = apply_opacity(u_vec4_border_color, u_float_opacity);\nv_float_opacity = u_float_opacity;\n}\n",round_position:"\nvec4 round_position(const vec4 position, const vec2 half_viewport)\n{\nif (\nposition.w < 0.\n|| position.x < -position.w\n|| position.x > position.w\n|| position.y < -position.w\n|| position.y > position.w\n|| position.z < -position.w\n|| position.z > position.w)\n{\nreturn position;\n}\nelse\n{\nreturn vec4(\nsign(position.xy) * floor(abs(position.xy) * half_viewport / position.w + .5)\n* position.w / half_viewport,\nposition.zw);\n}\n}\n",color_identify:"uniform mat4 u_mat4_mvp;\nuniform vec2 u_vec2_vpt_size;\nattribute vec2 a_vec2_vertex;\nattribute vec4 a_vec4_identifier;\nvarying vec4 v_vec4_identifier;\nvoid main()\n{\nv_vec4_identifier = a_vec4_identifier;\nif (vec4(1., 1., 1., 1.) != a_vec4_identifier)\n{\ngl_Position = round_position(u_mat4_mvp * vec4(a_vec2_vertex, 0.0, 1.), .5 * u_vec2_vpt_size);\n}\nelse\n{\ngl_Position = vec4(1., 1., 1., 1.);\n}\n}\n",model_identify:"uniform mat4 u_mat4_mvp;\nuniform vec2 u_vec2_vpt_size;\nattribute vec3 a_vec3_vertex;\nattribute vec4 a_vec4_identifier;\nvarying vec4 v_vec4_identifier;\nvoid main()\n{\nv_vec4_identifier = a_vec4_identifier;\nif (vec4(1., 1., 1., 1.) != a_vec4_identifier)\n{\ngl_Position = round_position(u_mat4_mvp * vec4(a_vec3_vertex, 1.), .5 * u_vec2_vpt_size);\n}\nelse\n{\ngl_Position = vec4(1., 1., 1., 1.);\n}\n}\n",pointsprite_identify:"uniform mat4 u_mat4_mvp;\nuniform vec2 u_vec2_vpt_size;\nuniform vec3 u_vec3_projection_scale_style_scale_dpi;\nuniform float u_float_height_factor;\nattribute vec3 a_vec3_position;\nattribute vec2 a_vec2_offset;\nattribute vec2 a_vec2_texcoord;\nattribute vec2 a_vec2_range;\nattribute vec2 a_vec2_rescale;\nattribute vec4 a_vec4_identifier;\nvarying vec2 v_vec2_texcoord;\nvarying vec4 v_vec4_identifier;\nvoid main()\n{\nif (vec4(1., 1., 1., 1.) != a_vec4_identifier)\n{\nvec2 inv_half_size = 2.0 / u_vec2_vpt_size;\nvec4 anchor = u_mat4_mvp * apply_height_factor(a_vec3_position, u_float_height_factor);\nvec2 offset = rescale(a_vec2_offset, a_vec2_rescale, a_vec2_range, u_vec3_projection_scale_style_scale_dpi.y);\nvec2 pos_2d = anchor.xy + overlay_transform(offset, inv_half_size) * anchor.w;\nvec2 corner = make_position(pos_2d, anchor.w, inv_half_size, 1.0);\ngl_Position = vec4(corner, anchor.z, clipw(anchor.w, a_vec2_range, u_vec3_projection_scale_style_scale_dpi.y));\n}\nelse\n{\ngl_Position = vec4(1., 1., 1., 1.);\n}\nv_vec2_texcoord = unpack_texcoord(a_vec2_texcoord);\nv_vec4_identifier = a_vec4_identifier;\n}\n",model:"uniform mat4 u_mat4_mvp;\nuniform float u_float_height_factor;\nattribute vec3 a_vec3_vertex;\nattribute vec2 a_vec2_texcoord;\nvarying vec2 v_vec2_texcoord;\nvoid main()\n{\nv_vec2_texcoord = unpack_model_texcoord(a_vec2_texcoord);\ngl_Position = u_mat4_mvp * apply_height_factor(a_vec3_vertex, u_float_height_factor);\n}\n",simple_line:"uniform mat4 u_mat4_mvp;\nuniform vec2 u_vec2_vpt_size;\nuniform float u_float_width;\nuniform float u_float_height_factor;\nuniform float u_float_height_limitation;\nuniform float u_float_tile_height;\nuniform float u_float_z_offset;\nattribute vec3 a_vec3_vertex;\nattribute vec4 a_vec4_direction_distance;\nvarying float v_float_distance;\nvarying float v_float_distance_offset;\nconst float g_smooth_width = 1.;\nconst float g_min_denominator = 1e-4;\nconst float g_w_factor = 1e-6;\nvoid main()\n{\nfloat shift_pixels = 0.5 * max(u_float_width - 1., 0.);\nfloat shift_pixels_added = shift_pixels + g_smooth_width;\nvec3 direction = a_vec4_direction_distance.xyz;\nfloat distance = a_vec4_direction_distance.w;\nvec2 half_viewport = u_vec2_vpt_size / vec2(2.);\nvec4 clip_space_direction = u_mat4_mvp * vec4(normalize_s08(direction), 0.);\nvec4 clip_space_vertex = u_mat4_mvp * apply_z_limitation(\napply_height_factor(a_vec3_vertex, u_float_height_factor),\nu_float_tile_height, u_float_height_limitation\n);\nvec2 screen_space_direction =\n(clip_space_direction.xy * clip_space_vertex.w - clip_space_vertex.xy * clip_space_direction.w) * half_viewport;\nvec2 screen_space_perp = vec2(-screen_space_direction.y, screen_space_direction.x);\nfloat denominator = max(g_min_denominator, length(screen_space_perp));\ngl_Position = g_w_factor * (clip_space_vertex + vec4(screen_space_perp / half_viewport, 0., 0.)\n* distance * shift_pixels_added / denominator * clip_space_vertex.w);\ngl_Position.z += u_float_z_offset;\nv_float_distance = shift_pixels_added * distance * gl_Position.w;\nv_float_distance_offset = shift_pixels;\n}\n",arrow_line_entrance:"uniform vec4 u_vec4_color;\nuniform vec4 u_vec4_border_color;\nuniform mat4 u_mat4_mvp;\nuniform mediump vec2 u_vec2_vpt_size;\nuniform vec3 u_vec3_projection_scale_style_scale_dpi;\nuniform vec2 u_vec2_scale_limits;\nuniform float u_float_width_zpt;\nuniform float u_float_wing_width_multiplier;\nuniform float u_float_border_width_zpt;\nuniform float u_float_size_factor;\nuniform float u_float_border_width_offset;\nuniform float u_float_tip_height_multiplier;\nuniform float u_float_relative_end_position;\nuniform float u_float_tip_movement_amplitude;\nuniform float u_float_vertex_shift; \nuniform float u_float_opacity;\nattribute vec2 a_vec2_vertex;\nattribute vec2 a_vec2_segment_end;\nattribute vec4 a_vec4_texture_widen_arrow_widen;\nattribute vec2 a_vec2_widen;\nattribute vec2 a_vec2_direction; \nattribute float a_float_distance_from_start;\nattribute float a_float_object_length;\nattribute float a_float_type;\nattribute vec4 a_vec4_identifier; \nvarying vec2 v_vec2_line_type_arrow_tail;\nvarying vec4 v_vec4_arrow_width_length_border_outer;\nvarying vec4 v_vec4_texcoord_arrow_line;\nvarying vec4 v_vec4_distance_vertex_hiding;\nvarying vec4 v_vec4_identifier;\nvarying vec4 v_vec4_color;\nvarying vec4 v_vec4_border_color;\nconst float g_w_factor = 1e-7;\nconst float g_type_line = 0.;\nconst float g_type_arrow = 1.;\nconst float g_type_start_border = 2.;\nconst float g_type_line_ending = 3.;\nconst float g_type_line_cut = 4.;\nconst float g_shift_pixels = 2.;\nconst float g_line_overlapping_part = .2;\nstruct ArrowLineViewParameters\n{\nfloat vertex_type;\nfloat width_zpt;\nfloat border_width_zpt;\nfloat border_width_offset;\nfloat arrow_segment_length_zpt;\nfloat wing_width_multiplier;\nfloat size_factor;\nvec2 vertex_position;\nvec2 vertex_widen;\nvec2 line_texture_widen;\nvec2 arrow_texture_widen;\nvec2 segment_direction;\nfloat segment_length;\nfloat distance_to_end;\n};\nstruct DistanceShiftParameters\n{\nfloat shift;\nbool invisible;\n};\nvec2 perp(const vec2 vector)\n{\nreturn vec2(-vector.y, vector.x);\n}\nvec2 vertex_shift(const Scale scale)\n{\nreturn u_float_vertex_shift * u_float_tip_movement_amplitude * normalize_s08(a_vec2_direction) * scale.calculation;\n}\nvec2 arrow_shift(const ArrowLineViewParameters view)\n{\nreturn view.segment_direction * view.distance_to_end;\n}\nfloat erase_length_end()\n{\nreturn clamp(u_float_relative_end_position, 0., 1.) * a_float_object_length;\n}\nvoid set_texcoord_varyings(const vec2 arrow_texcoord, const vec2 line_texcoord)\n{\nv_vec4_texcoord_arrow_line = vec4(arrow_texcoord, line_texcoord);\n}\nvoid set_arrow_varyings(\nconst float arrow_width,\nconst float arrow_length,\nconst float arrow_border,\nconst float arrow_outer_width,\nconst float arrow_tail_hide_part)\n{\nv_vec4_arrow_width_length_border_outer = vec4(\narrow_width,\narrow_length,\narrow_border,\narrow_outer_width);\nv_vec2_line_type_arrow_tail = vec2(\na_float_type,\narrow_tail_hide_part);\n}\nDistanceShiftParameters calculate_entrance_arrow_distances(\nconst ArrowLineViewParameters view,\nconst float signed_distance_shift,\nconst float arrow_final_size,\nconst float entrance_arrow_distance_shift)\n{\nDistanceShiftParameters line_distance_parameters = DistanceShiftParameters(\nsigned_distance_shift + entrance_arrow_distance_shift,\nfalse);\nif (a_float_type == g_type_arrow)\n{\nbool outside_of_current_segment = view.distance_to_end > view.segment_length + entrance_arrow_distance_shift;\nbool inside_end_hide = a_float_distance_from_start + entrance_arrow_distance_shift > erase_length_end();\nreturn DistanceShiftParameters(\nline_distance_parameters.shift + view.distance_to_end,\noutside_of_current_segment || inside_end_hide\n);\n}\nelse\n{\nreturn line_distance_parameters;\n}\n}\nvoid set_distance_varyings(\nconst ArrowLineViewParameters view,\nconst float arrow_final_size,\nconst float signed_shift_distance)\n{\nfloat entrance_arrow_distance_shift = arrow_final_size * (2. - g_line_overlapping_part);\nDistanceShiftParameters distance_shift_parameters = calculate_entrance_arrow_distances(\nview,\nsigned_shift_distance,\narrow_final_size,\nentrance_arrow_distance_shift);\nv_vec4_distance_vertex_hiding =\nvec4(\na_float_distance_from_start + distance_shift_parameters.shift,\n0.,\nerase_length_end(),\ndistance_shift_parameters.invisible\n? a_float_object_length\n: 0.\n) / a_float_object_length;\n}\nArrowLineViewParameters decode_arrow_line_view_parameters()\n{\nfloat width_zpt = u_float_width_zpt;\nfloat border_width_zpt = u_float_border_width_zpt;\nfloat arrow_segment_length_zpt = width_zpt * u_float_tip_height_multiplier + border_width_zpt;\nfloat vertex_type = a_float_type;\nvec2 segment_direction = (vertex_type == g_type_line_ending || vertex_type == g_type_line_cut)\n? normalize(a_vec2_vertex - a_vec2_segment_end)\n: normalize(a_vec2_segment_end - a_vec2_vertex);\nfloat segment_length = length(a_vec2_segment_end - a_vec2_vertex);\nfloat distance_to_end = erase_length_end() - a_float_distance_from_start;\nreturn ArrowLineViewParameters(\nvertex_type,\nwidth_zpt,\nborder_width_zpt,\nu_float_border_width_offset,\narrow_segment_length_zpt,\nu_float_wing_width_multiplier,\nu_float_size_factor,\na_vec2_vertex,\nunpack_widen(a_vec2_widen),\nunpack_widen(a_vec4_texture_widen_arrow_widen.xy),\nunpack_widen(a_vec4_texture_widen_arrow_widen.zw),\nsegment_direction,\nsegment_length,\ndistance_to_end);\n}\nvec4 process_arrow_line_vertex(const Scale scale, const mat4 mvp, const vec2 vpt_size)\n{\nArrowLineViewParameters view = decode_arrow_line_view_parameters();\nArrowParameters arrow_parameters = calculate_arrow_parameters(\nscale.calculation,\nview.width_zpt,\nview.border_width_zpt,\nview.arrow_segment_length_zpt,\nview.wing_width_multiplier,\nview.size_factor);\nvec2 vertex_widen = view.vertex_widen;\nvec2 texture_widen_with_sign = view.line_texture_widen;\nfloat shift_sign = sign(dot(vertex_widen, texture_widen_with_sign));\nvec2 line_texture_widen = shift_sign * texture_widen_with_sign;\nfloat line_final_size = (view.width_zpt + 2. * view.border_width_zpt) * view.size_factor * scale.calculation;\nfloat final_size = (view.vertex_type == g_type_arrow)\n? arrow_parameters.final_size\n: line_final_size;\nvec2 line_texture_widen_perp = perp(line_texture_widen);\nfloat shift_distance = abs(dot(vertex_widen, line_texture_widen_perp)) * final_size;\nvec2 shift_direction = line_texture_widen_perp * sign(dot(vertex_widen, line_texture_widen_perp));\nvec2 line_vertex_shift = vertex_widen * final_size - shift_direction * max(0., shift_distance - .5 * view.segment_length);\nvec2 arrow_vertex_widen = vertex_widen * arrow_parameters.final_size;\nvec2 scene_vertex_shift = (view.vertex_type == g_type_arrow)\n? arrow_vertex_widen\n: line_vertex_shift;\nvec2 arrow_position_shift = (view.vertex_type == g_type_arrow)\n? arrow_shift(view)\n: vec2(0.);\nfloat shift_pixels = g_shift_pixels * sqrt(2.);\nVertexShiftParameters line_shift_parameters = calculate_vertex_shift_parameters(\nmvp,\nvpt_size,\nview.vertex_position + (vertex_shift(scale) + arrow_position_shift),\nscene_vertex_shift,\nshift_pixels);\nfloat arrow_line_texcoord_scale = line_final_size / arrow_parameters.final_size;\nfloat line_texcoord_scale = (view.vertex_type != g_type_arrow)\n? arrow_line_texcoord_scale\n: 1.;\nvec2 line_texcoord = line_texture_widen * (1. + line_shift_parameters.limited_factor) * line_texcoord_scale;\nfloat arrow_texcoord_scale = (view.vertex_type == g_type_start_border)\n? arrow_line_texcoord_scale\n: 1.;\nvec2 arrow_texcoord = view.arrow_texture_widen * (1. + line_shift_parameters.limited_factor) * arrow_texcoord_scale;\nset_texcoord_varyings(arrow_texcoord, line_texcoord);\nfloat arrow_width = view.width_zpt * arrow_parameters.zpt_to_texcoord_factor;\nfloat arrow_length = view.arrow_segment_length_zpt * arrow_parameters.zpt_to_texcoord_factor;\nfloat texcoord_border_width = view.border_width_zpt * arrow_parameters.zpt_to_texcoord_factor;\nfloat border_width_texcoord_offset = view.border_width_offset * arrow_parameters.zpt_to_texcoord_factor;\nfloat arrow_border = max(0., texcoord_border_width - scale.style / scale.style_clamped * border_width_texcoord_offset);\nfloat tail_shift_direction = (view.vertex_type == g_type_line_ending || view.vertex_type == g_type_start_border) ? 1. : -1.;\nfloat tail_hide_shift = dot(arrow_vertex_widen, tail_shift_direction * view.segment_direction);\nfloat arrow_tail_hide_part = (view.distance_to_end - tail_hide_shift) * arrow_parameters.zpt_to_texcoord_factor / view.size_factor;\nset_arrow_varyings(\narrow_width,\narrow_length,\narrow_border,\narrow_parameters.outer_width,\narrow_tail_hide_part);\nset_distance_varyings(\nview,\narrow_parameters.final_size,\nshift_sign * shift_distance);\nreturn line_shift_parameters.clip_space_vertex / final_size;\n}\nvoid main()\n{\nv_vec4_identifier = a_vec4_identifier; \nScale scale = calculate_scale(u_vec3_projection_scale_style_scale_dpi, u_vec2_scale_limits);\nvec4 processed_vertex = process_arrow_line_vertex(scale, u_mat4_mvp, u_vec2_vpt_size);\ngl_Position = processed_vertex * g_w_factor;\nv_vec4_color = apply_opacity(u_vec4_color, u_float_opacity);\nv_vec4_border_color = apply_opacity(u_vec4_border_color, u_float_opacity);\n}\n",diffuse_identify:"uniform mat4 u_mat4_mvp;\nuniform vec2 u_vec2_vpt_size;\nuniform float u_float_height_limitation;\nuniform float u_float_tile_height;\nuniform float u_float_height_factor;\nattribute vec3 a_vec3_vertex;\nattribute vec4 a_vec4_identifier;\nvarying vec4 v_vec4_identifier;\nvoid main()\n{\nv_vec4_identifier = a_vec4_identifier;\nif (vec4(1., 1., 1., 1.) != a_vec4_identifier)\n{\nvec4 vertex_hf = apply_height_factor(a_vec3_vertex, u_float_height_factor);\ngl_Position = round_position(\nu_mat4_mvp * apply_z_limitation(vertex_hf, u_float_tile_height, u_float_height_limitation),\n.5 * u_vec2_vpt_size);\n}\nelse\n{\ngl_Position = vec4(1., 1., 1., 1.);\n}\n}\n",calculate_scale:"struct Scale\n{\nfloat projection;\nfloat style;\nfloat style_clamped;\nfloat calculation;\n};\nScale calculate_scale(const vec3 projection_scale_style_scale_dpi, const vec2 scale_limits)\n{\nfloat style_scale_clamped = clamp(projection_scale_style_scale_dpi.y, scale_limits.x, scale_limits.y);\nfloat scale_ratio = projection_scale_style_scale_dpi.x / projection_scale_style_scale_dpi.y;\nfloat calculation_scale = style_scale_clamped * scale_ratio;\nreturn Scale(\nprojection_scale_style_scale_dpi.x,\nprojection_scale_style_scale_dpi.y,\nstyle_scale_clamped,\ncalculation_scale);\n}\nconst float g_min_scale_factor = 1e-2;\nconst float g_max_scale_factor = 1e2;\nconst float g_base_scale_numerator = 1e2;\nfloat normalize_scale_to_tile(const float scale, const float tile_size)\n{\nreturn clamp(\n    (scale - g_min_scale_factor) / (tile_size - g_min_scale_factor),\n    g_min_scale_factor,\n    g_max_scale_factor);\n}",line_width:"float calculate_final_width(\nconst Scale scale,\nconst float width,\nconst float width_offset)\n{\nfloat final_width = max(0., scale.calculation * width - scale.projection * width_offset);\nreturn final_width;\n}\n",arrow_functions:"\nvec2 multiply_complex(const vec2 lhs, const vec2 rhs)\n{\nreturn vec2(lhs.x * rhs.x - lhs.y * rhs.y, lhs.x * rhs.y + lhs.y * rhs.x);\n}\nstruct ArrowParameters\n{\nfloat zpt_to_texcoord_factor;\nfloat final_size;\nfloat outer_width;\nvec2 widen_size;\n};\nArrowParameters calculate_arrow_parameters(\nconst float calculation_scale,\nconst float width_zpt,\nconst float border_width_zpt,\nconst float segment_length_zpt,\nconst float wing_width_multiplier,\nconst float size_factor)\n{\nfloat quad_width = 2.0 * border_width_zpt + 2.0 * wing_width_multiplier * width_zpt;\nfloat quad_height = 2.0 * border_width_zpt + segment_length_zpt;\nfloat max_quad_dimension = max(quad_width, quad_height);\nfloat zpt_to_texcoord_factor = 2.0 / max_quad_dimension;\nfloat final_size = calculation_scale * size_factor * max_quad_dimension;\nvec2 widen_size = 0.5 * vec2(quad_height, quad_width) * zpt_to_texcoord_factor;\nfloat outer_width = (width_zpt * wing_width_multiplier + border_width_zpt) * zpt_to_texcoord_factor;\nreturn ArrowParameters(\nzpt_to_texcoord_factor,\nfinal_size,\nouter_width,\nwiden_size);\n}\nstruct VertexShiftParameters\n{\nvec4 clip_space_vertex;\nfloat limited_factor;\n};\nVertexShiftParameters calculate_vertex_shift_parameters(\nconst mat4 mvp,\nconst vec2 vpt_size,\nconst vec2 vertex,\nconst vec2 widen,\nconst float shift_pixels)\n{\nvec2 widen_perp = vec2(-widen.y, widen.x);\nvec4 clip_space_widen = mvp * vec4(widen, 0., 0.);\nvec4 clip_space_widen_perp = mvp * vec4(widen_perp, 0., 0.);\nvec2 half_viewport = vpt_size / 2.;\nvec4 clip_space_vertex = mvp * vec4(vertex, 0.0, 1.0) + clip_space_widen;\nfloat limited_factor = calculate_multiplication_factor(\nhalf_viewport,\nclip_space_widen,\nclip_space_widen_perp,\nclip_space_vertex,\nshift_pixels);\nreturn VertexShiftParameters(\nclip_space_vertex + clip_space_widen * limited_factor,\nlimited_factor);\n}\n",circle_marker:"attribute vec4 a_vec4_vertex;\nattribute vec2 a_vec2_widen;\nuniform mat4 u_mat4_mvp;\nuniform vec2 u_vec2_vpt_size;\nuniform float u_float_width;\nvarying vec2 v_vec2_circle;\nvarying float v_float_width;\nvoid main() {\n    vec4 clip_space_position = u_mat4_mvp * a_vec4_vertex;\n    vec4 ndc_position = clip_space_position / clip_space_position.w;\n    ndc_position.xy += a_vec2_widen * u_float_width / u_vec2_vpt_size;\n    gl_Position = ndc_position;\n    v_vec2_circle = a_vec2_widen;\n    v_float_width = u_float_width;\n}\n",circle_marker_identify:"attribute vec4 a_vec4_vertex;\nattribute vec2 a_vec2_widen;\nattribute vec4 a_vec4_identifier;\nuniform mat4 u_mat4_mvp;\nuniform vec2 u_vec2_vpt_size;\nuniform float u_float_width;\nvarying vec2 v_vec2_circle;\nvarying vec4 v_vec4_identifier;\nvoid main() {\n    v_vec2_circle = a_vec2_widen;\n    v_vec4_identifier = a_vec4_identifier;\n    if (vec4(1., 1., 1., 1.) != a_vec4_identifier)\n    {\n        vec4 clip_space_position = u_mat4_mvp * a_vec4_vertex;\n        vec4 ndc_position = clip_space_position / clip_space_position.w;\n        ndc_position.xy += a_vec2_widen * u_float_width / u_vec2_vpt_size;\n        gl_Position = ndc_position;\n    }\n    else\n    {\n        gl_Position = vec4(1., 1., 1., 1.);\n    }\n}\n",raster_functions:"\nfloat unpack_scale(float value)\n{\nreturn exp(abs(value) / 256.) * sign(value);\n}\nfloat unpack_positive_value(float value)\n{\nreturn exp(value / 256.);\n}\nvec2 make_position(const vec2 position, const float w, const vec2 inv_half_size, const float rounding_factor)\n{\nvec2 non_rounded_position = (position + w) / (w * inv_half_size);\nvec2 rounded_position = floor(non_rounded_position + 0.5);\nvec2 rounding_delta = rounded_position - non_rounded_position;\nvec2 pixel_coord = non_rounded_position + rounding_factor * rounding_delta - 0.5;\nreturn (pixel_coord * inv_half_size) * w - w;\n}\nvec2 overlay_transform(const vec2 position, const vec2 inv_half_size)\n{\nreturn position * inv_half_size;\n}\nfloat clipw(const float w, const vec2 range, const float scale)\n{\nreturn w * (step(unpack_scale(range.x), scale) - step(unpack_positive_value(range.y), scale));\n}\nvec2 rescale(const vec2 corner, const vec2 rescale, const vec2 scale_range, const float style_scale)\n{\nif (scale_range.x < 0.)\n{\nfloat default_scale_denominator = unpack_positive_value(rescale.x);\nfloat rescale_coeff = unpack_positive_value(rescale.y);\nfloat min_scale = unpack_positive_value(-scale_range.x);\nfloat stretch_exponent = floor(0.5 + log2(\nmax(1., 1. + rescale_coeff * (1. / max(min_scale, style_scale) - default_scale_denominator))));\nreturn corner.xy * exp2(stretch_exponent);\n}\nreturn corner;\n}\n",road:"attribute vec2 a_vec2_vertex;\nattribute vec4 a_vec4_normals;\nattribute vec2 a_vec2_shift;\nuniform mat4 u_mat4_mvp;\nuniform float u_float_width;\nuniform float u_float_tile_to_pixel_ratio;\nuniform float u_float_shift;\nvarying vec2 v_vec2_normal;\nvarying float v_float_half_width;\nconst float g_w_factor = 1e-6;\nconst float normal_unpack_multiplier = 0.011135539861205473;\nvoid main()\n{\n    \n    float half_width = 0.5 * (u_float_width + 1.0);\n    \n    vec4 normals = a_vec4_normals * normal_unpack_multiplier * half_width;\n    vec2 extender = normals.xy;\n    vec2 normal = normals.zw;\n    vec2 shift = a_vec2_shift * u_float_shift;\n    \n    vec4 shifted_vertex = vec4(a_vec2_vertex + (shift + extender) * u_float_tile_to_pixel_ratio, 0.0, 1.0);\n    gl_Position = g_w_factor * u_mat4_mvp * shifted_vertex;\n    v_vec2_normal = normal;\n    v_float_half_width = half_width;\n}\n",road_identify:"attribute vec2 a_vec2_vertex;\nattribute vec4 a_vec4_normals;\nattribute vec4 a_vec4_identifier;\nuniform mat4 u_mat4_mvp;\nuniform float u_float_width;\nuniform float u_float_tile_to_pixel_ratio;\nvarying vec2 v_vec2_normal;\nvarying vec4 v_vec4_identifier;\nvarying float v_float_half_width;\nconst float g_w_factor = 1e-6;\nconst float normal_unpack_multiplier = 0.011135539861205473;\nvoid main()\n{\n    \n    float half_width = 0.5 * (u_float_width + 1.0);\n    \n    vec4 normals = a_vec4_normals * normal_unpack_multiplier * half_width;\n    vec2 extender = normals.xy;\n    vec2 normal = normals.zw;\n    if (vec4(1., 1., 1., 1.) != a_vec4_identifier) {\n        \n        vec4 shifted_vertex = vec4(a_vec2_vertex + extender * u_float_tile_to_pixel_ratio, 0.0, 1.0);\n        gl_Position = g_w_factor * u_mat4_mvp * shifted_vertex;\n    } else {\n        gl_Position = vec4(1., 1., 1., 1.);\n    }\n    v_vec2_normal = normal;\n    v_vec4_identifier = a_vec4_identifier;\n    v_float_half_width = half_width;\n}\n",stretchable_image:"uniform mat4 u_mat4_mvp;\nuniform vec4 u_vec4_color;\nuniform vec2 u_vec2_vpt_size;\nuniform float u_float_rounding_factor;\nattribute vec2 a_vec2_position;\nattribute vec2 a_vec2_offset;\nattribute vec2 a_vec2_texcoord;\nvarying vec2 v_vec2_texcoord;\nvoid main()\n{\n  vec2 inv_half_size = 2.0 / u_vec2_vpt_size;\n  vec4 anchor = u_mat4_mvp * vec4(a_vec2_position, 0.0, 1.0);\n  vec2 pos_2d = anchor.xy + overlay_transform(a_vec2_offset, inv_half_size) * anchor.w;\nvec2 pos_2d_rounded = make_position(pos_2d, anchor.w, inv_half_size, u_float_rounding_factor);\n  gl_Position = vec4(pos_2d_rounded, anchor.z, anchor.w);\n  v_vec2_texcoord = unpack_texcoord(a_vec2_texcoord);\n}\n",stretchable_image_identify:"uniform mat4 u_mat4_mvp;\nuniform vec4 u_vec4_color;\nuniform vec2 u_vec2_vpt_size;\nuniform float u_float_rounding_factor;\nattribute vec2 a_vec2_position;\nattribute vec2 a_vec2_offset;\nattribute vec2 a_vec2_texcoord;\nattribute vec4 a_vec4_identifier;\nvarying vec2 v_vec2_texcoord;\nvarying vec4 v_vec4_identifier;\nvoid main()\n{\n  if (vec4(1., 1., 1., 1.) != a_vec4_identifier)\n  {\n    vec2 inv_half_size = 2.0 / u_vec2_vpt_size;\n    vec4 anchor = u_mat4_mvp * vec4(a_vec2_position, 0.0, 1.0);\n    vec2 pos_2d = anchor.xy + overlay_transform(a_vec2_offset, inv_half_size) * anchor.w;\n  vec2 pos_2d_rounded = make_position(pos_2d, anchor.w, inv_half_size, u_float_rounding_factor);\n    gl_Position = vec4(pos_2d_rounded, anchor.z, anchor.w);\n  }\n  else\n  {\n    gl_Position = vec4(1., 1., 1., 1.);\n  }\n  v_vec2_texcoord = unpack_texcoord(a_vec2_texcoord);\n  v_vec4_identifier = a_vec4_identifier;\n}\n",rect:"uniform mat4 u_mat4_mvp;\nattribute vec2 a_vec2_vertex;\nvoid main()\n{\ngl_Position = u_mat4_mvp * vec4(a_vec2_vertex, 0.0, 1.0);\n}\n",rect_with_texture:"uniform mat4 u_mat4_mvp;\nattribute vec2 a_vec2_vertex;\nattribute vec2 a_vec2_texcoord;\nvarying vec2 v_vec2_texcoord;\nvoid main()\n{\ngl_Position = u_mat4_mvp * vec4(a_vec2_vertex, 0.0, 1.0);\nv_vec2_texcoord = unpack_texcoord(a_vec2_texcoord);\n}\n"},Gr={color:["apply_opacity","color"],diffuse:["packed_attributes","apply_height_factor","apply_opacity","diffuse"],line:["packed_attributes","apply_height_factor","apply_opacity","line"],pixelLine:["pixel_line"],pointSprite:["packed_attributes","apply_height_factor","raster_functions","pointsprite"],labelPoint:["packed_attributes","apply_height_factor","label_fixed_anchor"],labelPointIdentify:["label_fixed_anchor_identify"],labelLine:["packed_attributes","label_directional"],stripedLine:["packed_attributes","pixel_offset","calculate_scale","line_width","apply_opacity","precision_constants","striped_line_functions","striped_line"],stripedLineIdentify:["packed_attributes","pixel_offset","calculate_scale","line_width","apply_opacity","precision_constants","striped_line_functions","striped_line_identify"],oneWayLine:["packed_attributes","pixel_offset","arrow_functions","apply_opacity","one_way_line"],colorIdentify:["round_position","color_identify"],modelIdentify:["round_position","model_identify"],buildingIdentify:["round_position","apply_height_factor","diffuse_identify"],pointSpriteIdentify:["packed_attributes","apply_height_factor","raster_functions","pointsprite_identify"],model:["packed_attributes","apply_height_factor","model"],simpleLine:["packed_attributes","apply_height_factor","simple_line"],entranceArrow:["packed_attributes","pixel_offset","arrow_functions","calculate_scale","apply_opacity","arrow_line_entrance"],circleMarker:["circle_marker"],circleMarkerIdentify:["circle_marker_identify"],rect:["rect"],road:["road"],roadIdentify:["road_identify"],rectWithTexture:["packed_attributes","apply_opacity","raster_functions","rect_with_texture"],stretchableImage:["packed_attributes","raster_functions","stretchable_image"],stretchableImageIdentify:["packed_attributes","raster_functions","stretchable_image_identify"]},Wr={color:["lowp_float","color"],line:["mediump_float","line"],pixelLine:["mediump_float","affine_step","pixel_line"],pointSprite:["mediump_float","apply_opacity","pointsprite"],label:["mediump_float","apply_opacity","label"],stripedLine:["enable_standard_derivatives","mediump_float","affine_step","striped_line"],oneWayLine:["enable_standard_derivatives","mediump_float","affine_step","apply_opacity","arrow_functions","one_way_line"],colorIdentify:["lowp_float","color_identify"],pointSpriteIdentify:["mediump_float","pointsprite_identify"],model:["lowp_float","model"],simpleLine:["lowp_float","simple_line"],entranceArrow:["enable_standard_derivatives","highp_float","affine_step","arrow_functions","circle_functions","arrow_line"],entranceArrowIdentify:["lowp_float","arrow_line_identify"],circleMarker:["mediump_float","affine_step","circle_marker"],rect:["lowp_float","rect"],road:["enable_standard_derivatives","mediump_float","affine_step","road"],roadIdentify:["enable_standard_derivatives","lowp_float","road_identify"],stretchableImage:["mediump_float","stretchable_image"],rectWithTexture:["mediump_float","apply_opacity","rect_with_texture"],stretchableImageIdentify:["mediump_float","stretchable_image_identify"]},Vr=function(){function t(e,n,r){void 0===r&&(r=[]),this.type="vertex"===e?t.Vertex:t.Fragment,this._code=Array.isArray(n)?n.join("\n"):n||"",this._code=r.map((function(t){return void 0!==t.value?"#define "+t.type+" "+t.value:"#define "+t.type})).join("\n")+"\n"+this._code}return t.prototype.get=function(t){return this._shader||this._compile(t),this._shader},t.prototype.remove=function(t){this._shader&&t.deleteShader(this._shader)},t.prototype._compile=function(e){var n=this.type===t.Vertex?e.VERTEX_SHADER:e.FRAGMENT_SHADER,r=this._shader=e.createShader(n);e.shaderSource(r,this._code),e.compileShader(r)},t}();Vr.Vertex=1,Vr.Fragment=2;var qr=Vr,Yr={},Xr={};for(var Kr in Gr){var Jr=Gr[Kr].map((function(t){return Hr[t]}));Xr[Kr]=Jr}for(var Kr in Wr)Jr=Wr[Kr].map((function(t){return Zr[t]})),Yr[Kr]=Jr;function Qr(t){return new qr("vertex",Xr[t])}function $r(t){return new qr("fragment",Yr[t])}var ti,ei=n(41),ni=function(t){function e(e,n){var r=t.call(this,{canvas:n.layout.canvas,antialias:!1,stencil:!0,clearColor:Object(ei.b)(e.defaultBackgroundColor).map((function(t){return t/255})),preserveDrawingBuffer:e.preserveDrawingBuffer})||this;r.trackContextLost=function(t){t.preventDefault(),r.modules.map.destroy(),ee({eventAction:"WebGlContext",eventLabel:"webglcontextlost"}),ee({eventCategory:"WebGlContext",eventAction:"webglcontextlost",eventLabel:t.statusMessage||""})},r.vpMatrix=E.b(),r.state=e,r.modules=n,r.identifyBuffer=new Me;var i,o={diffuse:new Dr({vertex:Qr("diffuse"),fragment:$r("color"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec3_light_direction",type:"3fv"},{name:"u_vec3_light_color",type:"3fv"},{name:"u_vec3_ambient_color",type:"3fv"},{name:"u_vec4_color",type:"4fv"},{name:"u_float_height_limitation",type:"1f"},{name:"u_float_tile_height",type:"1f"},{name:"u_float_height_factor",type:"1f"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec3_vertex",location:0},{name:"a_vec3_normal",location:1}]}),labelLine:new Dr({vertex:Qr("labelLine"),fragment:$r("label"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_float_tile_to_pixel_ratio",type:"1f"},{name:"u_sr2d_texture",type:"1i"},{name:"u_float_buffer",type:"1f"},{name:"u_float_gamma",type:"1f"},{name:"u_float_scale",type:"1f"},{name:"u_vec4_color",type:"4fv"},{name:"u_float_style_zoom",type:"1f"},{name:"u_float_height_factor",type:"1f"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec4_position",location:0},{name:"a_vec2_offset",location:1},{name:"a_vec2_texcoord",location:2},{name:"a_vec2_style_zoom_limits",location:3}]}),labelPoint:new Dr({vertex:Qr("labelPoint"),fragment:$r("label"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2f"},{name:"u_sr2d_texture",type:"1i"},{name:"u_float_buffer",type:"1f"},{name:"u_float_gamma",type:"1f"},{name:"u_float_scale",type:"1f"},{name:"u_vec4_color",type:"4fv"},{name:"u_vec2_offset",type:"2f"},{name:"u_float_height_factor",type:"1f"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec4_position",location:0},{name:"a_vec2_offset",location:1},{name:"a_vec2_texcoord",location:2}]}),labelPointIdentify:new Dr({vertex:Qr("labelPointIdentify"),fragment:$r("colorIdentify"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2f"},{name:"u_float_scale",type:"1f"},{name:"u_vec2_offset",type:"2f"}],attributes:[{name:"a_vec4_position",location:0},{name:"a_vec2_offset",location:1},{name:"a_vec4_identifier",location:2}]}),line:new Dr({vertex:Qr("line"),fragment:$r("line"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_vec3_light_direction",type:"3fv"},{name:"u_vec3_light_color",type:"3fv"},{name:"u_vec3_ambient_color",type:"3fv"},{name:"u_vec4_color",type:"4fv"},{name:"u_float_height_limitation",type:"1f"},{name:"u_float_tile_height",type:"1f"},{name:"u_float_height_factor",type:"1f"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec4_vertex",location:0},{name:"a_vec2_normal",location:1},{name:"a_vec2_normal_delta",location:2},{name:"a_vec3_direction",location:3},{name:"a_float_distance",location:4}]}),pixelLine:new Dr({vertex:Qr("pixelLine"),fragment:$r("pixelLine"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_vec4_color",type:"4fv"},{name:"u_float_width",type:"1f"}],attributes:[{name:"a_vec2_vertex",location:0},{name:"a_vec4_normals",location:1}]}),pointSprite:new Dr({vertex:Qr("pointSprite"),fragment:$r("pointSprite"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_vec3_projection_scale_style_scale_dpi",type:"3fv"},{name:"u_sr2d_texture",type:"1i"},{name:"u_float_rounding_factor",type:"1f"},{name:"u_float_height_factor",type:"1f"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec3_position",location:0},{name:"a_vec2_offset",location:1},{name:"a_vec2_texcoord",location:2},{name:"a_vec2_range",location:3},{name:"a_vec2_rescale",location:4}]}),pointSpriteIdentify:new Dr({vertex:Qr("pointSpriteIdentify"),fragment:$r("pointSpriteIdentify"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_vec3_projection_scale_style_scale_dpi",type:"3fv"},{name:"u_sr2d_texture",type:"1i"},{name:"u_float_height_factor",type:"1f"}],attributes:[{name:"a_vec3_position",location:0},{name:"a_vec2_offset",location:1},{name:"a_vec2_texcoord",location:2},{name:"a_vec2_range",location:3},{name:"a_vec2_rescale",location:4},{name:"a_vec4_identifier",location:5}]}),stripedLine:new Dr({vertex:Qr("stripedLine"),fragment:$r("stripedLine"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_vec3_projection_scale_style_scale_dpi",type:"3fv"},{name:"u_vec2_scaler_params",type:"2fv"},{name:"u_float_dash_length",type:"1f"},{name:"u_float_space_length",type:"1f"},{name:"u_float_dash2_length",type:"1f"},{name:"u_vec4_dash_color",type:"4fv"},{name:"u_vec4_space_color",type:"4fv"},{name:"u_vec4_border_color",type:"4fv"},{name:"u_float_width",type:"1f"},{name:"u_float_width_offset",type:"1f"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec2_vertex",location:0},{name:"a_vec2_texture_widen",location:1},{name:"a_vec2_widen",location:2},{name:"a_float_vertex_distance",location:3},{name:"a_float_component_distance",location:4},{name:"a_float_object_length",location:5},{name:"a_vec4_identifier",location:6}]}),stripedLineIdentify:new Dr({vertex:Qr("stripedLineIdentify"),fragment:$r("colorIdentify"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_vec3_projection_scale_style_scale_dpi",type:"3fv"},{name:"u_vec2_scaler_params",type:"2fv"},{name:"u_float_dash_length",type:"1f"},{name:"u_float_space_length",type:"1f"},{name:"u_float_dash2_length",type:"1f"},{name:"u_vec4_dash_color",type:"4fv"},{name:"u_vec4_space_color",type:"4fv"},{name:"u_vec4_border_color",type:"4fv"},{name:"u_float_width",type:"1f"},{name:"u_float_width_offset",type:"1f"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec2_vertex",location:0},{name:"a_vec2_texture_widen",location:1},{name:"a_vec2_widen",location:2},{name:"a_float_vertex_distance",location:3},{name:"a_float_component_distance",location:4},{name:"a_float_object_length",location:5},{name:"a_vec4_identifier",location:6}]}),vtxColor:new Dr({vertex:Qr("color"),fragment:$r("color"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec4_color",type:"4fv"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec2_vertex",location:0}]}),vtxColorIdentify:new Dr({vertex:Qr("colorIdentify"),fragment:$r("colorIdentify"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"}],attributes:[{name:"a_vec2_vertex",location:0},{name:"a_vec4_identifier",location:1}]}),modelIdentify:new Dr({vertex:Qr("modelIdentify"),fragment:$r("colorIdentify"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"}],attributes:[{name:"a_vec3_vertex",location:0},{name:"a_vec4_identifier",location:1}]}),buildingIdentify:new Dr({vertex:Qr("buildingIdentify"),fragment:$r("colorIdentify"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_float_height_limitation",type:"1f"},{name:"u_float_tile_height",type:"1f"},{name:"u_float_height_factor",type:"1f"}],attributes:[{name:"a_vec3_vertex",location:0},{name:"a_vec4_identifier",location:1}]}),oneWayLine:new Dr({vertex:Qr("oneWayLine"),fragment:$r("oneWayLine"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2f"},{name:"u_vec3_projection_scale_style_scale_dpi",type:"3fv"},{name:"u_vec4_color",type:"4f"},{name:"u_vec4_border_color",type:"4f"},{name:"u_vec2_wing_normal",type:"2f"},{name:"u_vec2_tip_normal",type:"2f"},{name:"u_float_width",type:"1f"},{name:"u_float_length",type:"1f"},{name:"u_float_border_width",type:"1f"},{name:"u_float_border_width_offset",type:"1f"},{name:"u_float_size_factor",type:"1f"},{name:"u_vec2_scale_limits",type:"2fv"},{name:"u_float_tip_height_multiplier",type:"1f"},{name:"u_float_wing_height_multiplier",type:"1f"},{name:"u_float_wing_width_multiplier",type:"1f"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec2_position",location:0},{name:"a_vec2_direction",location:1},{name:"a_vec2_widen_direction",location:2}]}),model:new Dr({vertex:Qr("model"),fragment:$r("model"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec4_color",type:"4fv"},{name:"u_sr2d_texture",type:"1i"},{name:"u_float_height_factor",type:"1f"}],attributes:[{name:"a_vec3_vertex",location:0},{name:"a_vec2_texcoord",location:1}]}),simpleLine:new Dr({vertex:Qr("simpleLine"),fragment:$r("simpleLine"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_vec4_color",type:"4fv"},{name:"u_float_width",type:"1f"},{name:"u_float_height_factor",type:"1f"},{name:"u_float_height_limitation",type:"1f"},{name:"u_float_tile_height",type:"1f"},{name:"u_float_z_offset",type:"1f"}],attributes:[{name:"a_vec3_vertex",location:0},{name:"a_vec4_direction_distance",location:1}]}),road:new Dr({vertex:Qr("road"),fragment:$r("road"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec4_color",type:"4fv"},{name:"u_float_width",type:"1f"},{name:"u_float_tile_to_pixel_ratio",type:"1f"},{name:"u_float_shift",type:"1f"}],attributes:[{name:"a_vec2_vertex",location:0},{name:"a_vec4_normals",location:1},{name:"a_vec2_shift",location:2}]}),roadIdentify:new Dr({vertex:Qr("roadIdentify"),fragment:$r("roadIdentify"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_float_width",type:"1f"},{name:"u_float_tile_to_pixel_ratio",type:"1f"}],attributes:[{name:"a_vec2_vertex",location:0},{name:"a_vec4_normals",location:1},{name:"a_vec4_identifier",location:2}]}),entrance:new Dr({vertex:Qr("entranceArrow"),fragment:$r("entranceArrow"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2f"},{name:"u_vec3_projection_scale_style_scale_dpi",type:"3fv"},{name:"u_vec2_scale_limits",type:"2fv"},{name:"u_vec4_color",type:"4f"},{name:"u_vec4_border_color",type:"4f"},{name:"u_vec2_wing_normal",type:"2f"},{name:"u_vec2_tip_normal",type:"2f"},{name:"u_float_width_zpt",type:"1f"},{name:"u_float_tip_height_multiplier",type:"1f"},{name:"u_float_wing_width_multiplier",type:"1f"},{name:"u_float_wing_height_multiplier",type:"1f"},{name:"u_float_border_width_zpt",type:"1f"},{name:"u_float_size_factor",type:"1f"},{name:"u_float_border_width_offset",type:"1f"},{name:"u_float_total_line_length",type:"1f"},{name:"u_float_relative_end_position",type:"1f"},{name:"u_float_vertex_shift",type:"1f"},{name:"u_float_tip_movement_amplitude",type:"1f"},{name:"u_vec2_bounce_direction",type:"2f"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec2_vertex",location:0},{name:"a_vec2_segment_end",location:1},{name:"a_vec4_texture_widen_arrow_widen",location:2},{name:"a_vec2_widen",location:3},{name:"a_vec2_direction",location:4},{name:"a_float_distance_from_start",location:5},{name:"a_float_object_length",location:6},{name:"a_float_type",location:7},{name:"a_vec4_identifier",location:8}]}),entranceIdentify:new Dr({vertex:Qr("entranceArrow"),fragment:$r("entranceArrowIdentify"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2f"},{name:"u_vec3_projection_scale_style_scale_dpi",type:"3fv"},{name:"u_vec2_scale_limits",type:"2fv"},{name:"u_vec4_color",type:"4f"},{name:"u_vec4_border_color",type:"4f"},{name:"u_vec2_wing_normal",type:"2f"},{name:"u_vec2_tip_normal",type:"2f"},{name:"u_float_width_zpt",type:"1f"},{name:"u_float_tip_height_multiplier",type:"1f"},{name:"u_float_wing_width_multiplier",type:"1f"},{name:"u_float_wing_height_multiplier",type:"1f"},{name:"u_float_border_width_zpt",type:"1f"},{name:"u_float_size_factor",type:"1f"},{name:"u_float_border_width_offset",type:"1f"},{name:"u_float_total_line_length",type:"1f"},{name:"u_float_relative_end_position",type:"1f"},{name:"u_float_vertex_shift",type:"1f"},{name:"u_float_tip_movement_amplitude",type:"1f"},{name:"u_vec2_bounce_direction",type:"2f"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec2_vertex",location:0},{name:"a_vec2_segment_end",location:1},{name:"a_vec4_texture_widen_arrow_widen",location:2},{name:"a_vec2_widen",location:3},{name:"a_vec2_direction",location:4},{name:"a_float_distance_from_start",location:5},{name:"a_float_object_length",location:6},{name:"a_float_type",location:7},{name:"a_vec4_identifier",location:8}]}),circleMarker:new Dr({vertex:Qr("circleMarker"),fragment:$r("circleMarker"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_vec4_color",type:"4fv"},{name:"u_float_width",type:"1f"}],attributes:[{name:"a_vec4_vertex",location:0},{name:"a_vec2_widen",location:1}]}),rect:new Dr({vertex:Qr("rect"),fragment:$r("rect"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec4_color",type:"4fv"}],attributes:[{name:"a_vec2_vertex",location:0}]}),rectWithTexture:new Dr({vertex:Qr("rectWithTexture"),fragment:$r("rectWithTexture"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_sr2d_texture",type:"1i"},{name:"u_float_opacity",type:"1f"}],attributes:[{name:"a_vec2_vertex",location:0},{name:"a_vec2_texcoord",location:1}]}),circleMarkerIdentify:new Dr({vertex:Qr("circleMarkerIdentify"),fragment:$r("colorIdentify"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_float_width",type:"1f"}],attributes:[{name:"a_vec4_vertex",location:0},{name:"a_vec2_widen",location:1},{name:"a_vec4_identifier",location:2}]}),stretchableImage:new Dr({vertex:Qr("stretchableImage"),fragment:$r("stretchableImage"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_sr2d_texture",type:"1i"},{name:"u_float_rounding_factor",type:"1f"}],attributes:[{name:"a_vec2_position",location:0},{name:"a_vec2_offset",location:1},{name:"a_vec2_texcoord",location:2}]}),stretchableImageIdentify:new Dr({vertex:Qr("stretchableImageIdentify"),fragment:$r("stretchableImageIdentify"),uniforms:[{name:"u_mat4_mvp",type:"mat4"},{name:"u_vec2_vpt_size",type:"2fv"},{name:"u_sr2d_texture",type:"1i"},{name:"u_float_rounding_factor",type:"1f"}],attributes:[{name:"a_vec2_position",location:0},{name:"a_vec2_offset",location:1},{name:"a_vec2_texcoord",location:2},{name:"a_vec4_identifier",location:3}]})};return n.map.once("idle",(function(){return function(t,e){if(window.requestIdleCallback){var n=function(n){var r=t[n];window.requestIdleCallback((function(){r.link(e),setTimeout((function(){window.requestIdleCallback((function(){return r.locate(e)}))}),2e3)}))};for(var r in t)n(r)}}(o,r._gl)})),r.symbolSettingsList={line:{solid:[{program:(i=o).road,vaoCreator:hr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn,Vn,pn),uniformSet:"fill"},{program:i.road,vaoCreator:hr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn,Vn,pn),uniformSet:"border"},{program:i.road,vaoCreator:hr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn,Vn,pn),uniformSet:"border2"},{identify:!0,program:i.roadIdentify,vaoCreator:mr,stateBinder:$n,globalBinder:ke,objectBinder:qn(zn,Vn,mn)}]},area:{fill:[{program:i.vtxColor,vaoCreator:ur,stateBinder:Xn,globalBinder:ke,objectBinder:qn(zn,xn,rn,fn,ln)},{identify:!0,program:i.vtxColorIdentify,vaoCreator:dr,stateBinder:$n,globalBinder:Ne,objectBinder:qn(zn,xn)}],stroke:[{program:i.simpleLine,vaoCreator:Tr,stateBinder:Xn,globalBinder:$e(Ne,Ve),objectBinder:qn(zn,xn,rn,un,fn,pn),subphase:1}]},phasedArea:{fill:[{program:i.vtxColor,vaoCreator:ur,stateBinder:Xn,globalBinder:ke,objectBinder:qn(zn,xn,rn,fn,ln)},{identify:!0,program:i.vtxColorIdentify,vaoCreator:dr,stateBinder:$n,globalBinder:Ne,objectBinder:qn(zn,xn)}],stroke:[{program:i.simpleLine,vaoCreator:Tr,stateBinder:Xn,globalBinder:$e(Ne,Ve),objectBinder:qn(zn,xn,rn,un,fn,pn),subphase:1}]},building:{fill:[{program:i.diffuse,vaoCreator:xr,stateBinder:tr,globalBinder:$e(Ue,Fe),objectBinder:qn(zn,xn,rn,cn,fn,Nn,ln)},{program:i.diffuse,vaoCreator:xr,stateBinder:er,globalBinder:$e(Ue,Fe),objectBinder:qn(zn,xn,rn,cn,fn,Nn,ln),subphase:1},{identify:!0,program:i.buildingIdentify,vaoCreator:wr,stateBinder:Yn,globalBinder:$e(Fe,Ne),objectBinder:qn(zn,xn,wn,Nn)}],wallStroke:[{program:i.line,vaoCreator:Sr,stateBinder:Xn,globalBinder:$e(Ue,Fe,Ne),objectBinder:qn(zn,xn,Rn,rn,dn,cn,fn,Nn,ln),subphase:3}],roofStroke:[{program:i.simpleLine,vaoCreator:Er,stateBinder:Xn,globalBinder:$e(Ne,Fe,qe),objectBinder:qn(zn,xn,rn,un,cn,fn,pn,Nn),subphase:4}]},point:{raster:[{program:i.pointSprite,vaoCreator:Or,stateBinder:nr,globalBinder:$e(Qe,Ne,ze,Ge,Be),objectBinder:qn(On,zn,Dn,xn,yn,Sn)},{identify:!0,program:i.pointSpriteIdentify,vaoCreator:Mr,stateBinder:Qn,globalBinder:$e(Qe,Ne,ze,Be),objectBinder:qn(On,zn,Dn,xn,Sn)}]},labelPoint:{raster:[{program:i.labelPoint,vaoCreator:_r,stateBinder:nr,globalBinder:$e(Be,Ne),objectBinder:qn(Bn,Zn,gn,Mn,Un,Hn,Gn),uniformSet:"fontHalo"},{program:i.labelPoint,vaoCreator:_r,stateBinder:nr,globalBinder:$e(Ye,Be,Ne),objectBinder:qn(Bn,gn,Mn,Un,Hn,Gn),uniformSet:"fontFill",subphase:1}]},labelLine:{raster:[{program:i.labelLine,vaoCreator:br,stateBinder:nr,globalBinder:$e(Ye,Be),objectBinder:qn(Bn,Zn,gn,Mn,Un,Hn,Vn,Wn),uniformSet:"fontHalo"},{program:i.labelLine,vaoCreator:br,stateBinder:nr,globalBinder:$e(Ye,Be),objectBinder:qn(Bn,gn,Mn,Un,Hn,Vn,Wn),uniformSet:"fontFill",subphase:1}]},dashedLine:{stroke:[{program:i.stripedLine,vaoCreator:vr,stateBinder:Jn,globalBinder:$e(Ne,Re,Ke,Je),objectBinder:qn(zn,Tn,Fn,In,ln),uniformSet:"fill"},{program:i.stripedLine,vaoCreator:vr,stateBinder:Jn,globalBinder:$e(Ne,Re,Ke,Je),objectBinder:qn(zn,Tn,Fn,ln),uniformSet:"border"},{identify:!0,program:i.stripedLineIdentify,vaoCreator:vr,stateBinder:$n,globalBinder:$e(Ne,Re,Ke,Je),objectBinder:qn(zn,Tn,Fn,ln,In)}]},stripedLine:{stroke:[{program:i.stripedLine,vaoCreator:vr,stateBinder:Jn,globalBinder:$e(Ne,Re),objectBinder:qn(zn,hn,In,Tn,Fn,ln),uniformSet:"fill"},{identify:!0,program:i.stripedLineIdentify,vaoCreator:vr,stateBinder:$n,globalBinder:$e(Ne,Re),objectBinder:qn(zn,hn,In,Tn,Fn,ln)}]},oneWayLine:{raster:[{program:i.oneWayLine,vaoCreator:jr,stateBinder:Jn,globalBinder:$e(Ne,Re,Xe,We),objectBinder:qn(Bn,gn,rn,fn,hn,En,An)}]},poi:{raster:[{program:i.pointSprite,vaoCreator:Or,stateBinder:nr,globalBinder:$e(Qe,Ne,ze,Ge,Be),objectBinder:qn(Bn,gn,Sn)},{identify:!0,program:i.pointSpriteIdentify,vaoCreator:Mr,stateBinder:Qn,globalBinder:$e(Qe,Ne,ze,Be),objectBinder:qn(Bn,Sn)}],text:[{program:i.labelPoint,vaoCreator:gr,stateBinder:nr,globalBinder:$e(Ye,Be,Ne),objectBinder:qn(Bn,Zn,gn,Mn,Un,Hn,Gn),uniformSet:"fontHalo",subphase:1},{program:i.labelPoint,vaoCreator:gr,stateBinder:nr,globalBinder:$e(Ye,Be,Ne),objectBinder:qn(Bn,gn,Mn,Un,Hn,Gn),uniformSet:"fontFill",subphase:2},{identify:!0,program:i.labelPointIdentify,vaoCreator:yr,stateBinder:Qn,globalBinder:Ne,objectBinder:qn(Bn,_n,Un,Gn),subphase:1}]},pixelLine:{stroke:[{program:i.pixelLine,vaoCreator:fr,stateBinder:Jn,globalBinder:Ne,objectBinder:qn(zn,rn,fn,pn)}]},model:{fill:[{program:i.model,vaoCreator:Ir,stateBinder:rr,globalBinder:ke,objectBinder:qn(zn,rn,sn,fn,Pn,Cn),subphase:2},{program:i.modelIdentify,vaoCreator:wr,stateBinder:Yn,globalBinder:Ne,objectBinder:qn(zn),subphase:2,identify:!0}],stroke:[{program:i.simpleLine,vaoCreator:Er,stateBinder:Xn,globalBinder:$e(Ne,De,Ve),objectBinder:qn(zn,rn,sn,fn,pn,Pn),subphase:5}]},marker:{raster:[{program:i.pointSprite,vaoCreator:Or,stateBinder:nr,globalBinder:$e(Qe,Ne,ze,Ge,Be),objectBinder:qn(gn,Sn)},{identify:!0,program:i.pointSpriteIdentify,vaoCreator:Mr,stateBinder:Qn,globalBinder:$e(Qe,Ne,ze,Be),objectBinder:qn(Sn)}],text:[{program:i.labelPoint,vaoCreator:gr,stateBinder:nr,globalBinder:$e(Ye,Be,Ne),objectBinder:qn(Zn,gn,Mn,Un,Hn,Gn),uniformSet:"fontHalo",subphase:1},{program:i.labelPoint,vaoCreator:gr,stateBinder:nr,globalBinder:$e(Ye,Be,Ne),objectBinder:qn(gn,Mn,Un,Hn,Gn),uniformSet:"fontFill",subphase:2},{identify:!0,program:i.labelPointIdentify,vaoCreator:yr,stateBinder:Qn,globalBinder:Ne,objectBinder:qn(_n,Un,Gn),subphase:1}]},polyline:{solid:[{program:i.road,vaoCreator:hr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn,Vn,pn),uniformSet:"fill"},{program:i.road,vaoCreator:hr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn,Vn,pn),uniformSet:"border"},{program:i.road,vaoCreator:hr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn,Vn,pn),uniformSet:"border2"},{identify:!0,program:i.roadIdentify,vaoCreator:mr,stateBinder:Qn,globalBinder:ke,objectBinder:qn(zn,Vn,mn)}]},shiftedLine:{solid:[{program:i.road,vaoCreator:pr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn,pn,Vn,vn),uniformSet:"fill"},{program:i.road,vaoCreator:pr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn,pn,Vn,vn),uniformSet:"border"},{program:i.road,vaoCreator:pr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn,pn,Vn,vn),uniformSet:"border2"}]},polygon:{fill:[{program:i.vtxColor,vaoCreator:ur,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn,ln)},{identify:!0,program:i.vtxColorIdentify,vaoCreator:dr,stateBinder:Qn,globalBinder:Ne,objectBinder:qn(zn)}],stroke:[{program:i.simpleLine,vaoCreator:Tr,stateBinder:Jn,globalBinder:$e(Ne,Ve),objectBinder:qn(zn,rn,un,fn,pn)}]},circleMarker:{fill:[{program:i.circleMarker,vaoCreator:Lr,stateBinder:Jn,globalBinder:$e(Ne),objectBinder:qn(zn,rn,fn,pn),uniformSet:"fill",subphase:2},{program:i.circleMarker,vaoCreator:Lr,stateBinder:Jn,globalBinder:$e(Ne),objectBinder:qn(zn,rn,fn,pn),uniformSet:"border",subphase:1},{program:i.circleMarker,vaoCreator:Lr,stateBinder:Jn,globalBinder:$e(Ne),objectBinder:qn(zn,rn,fn,pn),uniformSet:"border2"},{identify:!0,program:i.circleMarkerIdentify,vaoCreator:Cr,stateBinder:Qn,globalBinder:$e(Ne),objectBinder:qn(zn,mn)}]},entrance:{stroke:[{program:i.entrance,vaoCreator:Ar,stateBinder:Jn,globalBinder:$e(Ne,Re,Xe,We),objectBinder:qn(zn,rn,fn,hn,En,Ln,ln)},{identify:!0,program:i.entranceIdentify,vaoCreator:Ar,stateBinder:Qn,globalBinder:$e(Ne,Re,Xe,We),objectBinder:qn(zn,En,Ln,ln)}]},floor:{fill:[{program:i.vtxColor,vaoCreator:ur,stateBinder:Xn,globalBinder:ke,objectBinder:qn(zn,rn,fn,ln)},{identify:!0,program:i.vtxColorIdentify,vaoCreator:dr,stateBinder:$n,globalBinder:Ne,objectBinder:qn(zn)}],stroke:[{program:i.simpleLine,vaoCreator:Tr,stateBinder:Xn,globalBinder:$e(Ne,Ve),objectBinder:qn(zn,rn,un,fn,pn),subphase:1}],wallStroke:[{program:i.line,vaoCreator:Sr,stateBinder:Xn,globalBinder:$e(He,Ne,Fe,Be),objectBinder:qn(zn,rn,an,dn,fn,ln),subphase:6}],wallSide:[{program:i.diffuse,vaoCreator:xr,stateBinder:ir,globalBinder:$e(He,Fe,Be),objectBinder:qn(zn,rn,on,fn,ln),subphase:7},{identify:!0,program:i.buildingIdentify,vaoCreator:wr,stateBinder:Yn,globalBinder:$e(Fe,Ne,Be),objectBinder:qn(zn),subphase:7}],roofStroke:[{program:i.simpleLine,vaoCreator:Er,stateBinder:Xn,globalBinder:$e(Be,Ne,Fe,qe),objectBinder:qn(zn,rn,on,fn,pn),subphase:8}]},fence:{fill:[{program:i.diffuse,vaoCreator:xr,stateBinder:Kn,globalBinder:$e(Ze,Fe),objectBinder:qn(zn,kn,rn,fn,ln),subphase:9}],wallStroke:[{program:i.line,vaoCreator:Sr,stateBinder:Xn,globalBinder:$e(Ze,Ne,Fe),objectBinder:qn(zn,kn,rn,dn,fn,ln),subphase:10}],roofStroke:[{program:i.simpleLine,vaoCreator:Er,stateBinder:Xn,globalBinder:$e(Ne,Fe,Ve),objectBinder:qn(zn,kn,rn,fn,pn),subphase:11}]},stretchableImage:{fill:[{program:i.stretchableImage,vaoCreator:Pr,stateBinder:or,globalBinder:$e(Ne,Ge),objectBinder:qn(zn,jn)},{identify:!0,program:i.stretchableImageIdentify,vaoCreator:kr,stateBinder:$n,globalBinder:$e(Ne,Ge),objectBinder:qn(zn,jn)}]},rect:{fill:[{program:i.rect,vaoCreator:Nr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,rn,fn)},{identify:!0,program:i.vtxColorIdentify,vaoCreator:dr,stateBinder:$n,globalBinder:Ne,objectBinder:qn(zn)}]},rectWithTexture:{fill:[{program:i.rectWithTexture,vaoCreator:Rr,stateBinder:Jn,globalBinder:ke,objectBinder:qn(zn,jn,bn),uniformSet:"fill"}]}},r.addExtension("OES_vertex_array_object").addExtension("OES_element_index_uint").addExtension("OES_standard_derivatives"),r.setPixelRatio(window.devicePixelRatio).setSize(n.layout.mapContainer.clientWidth,n.layout.mapContainer.clientHeight),e.collectStats&&(r.timers=new zr(r._gl)),n.layout.canvas.addEventListener("webglcontextlost",r.trackContextLost),r}return Object(w.c)(e,t),e.prototype.setClearColor=function(t){return this.clearColor=Object(ei.b)(t).map((function(t){return t/255})),this.state.needRerender=!0,this},e.prototype.setSize=function(t,e){return this.modules.layout.setCanvasSize(t,e),this.updateIdentifySize(),this},e.prototype.updateIdentifySize=function(){var t=window.devicePixelRatio,e=this.state.size;return this.identifyBuffer.setSize([Math.ceil(e[0]*a.identify.pixelDensity*t),Math.ceil(e[1]*a.identify.pixelDensity*t)]),this},e.prototype.render=function(t){Object(s.G)(this.vpMatrix,this.state);var e=this._gl,n=this.state,r=n.size,i=n.viewport,o=window.devicePixelRatio;if(e.viewport(i.left*o,i.bottom*o,r[0]*o,r[1]*o),e.clearDepth(1),e.clearStencil(0),this.state.collectStats&&this.timers&&this.timers.addTimer(),t.render(e,this.webGlExtensions,this.vpMatrix,!1),this.state.collectStats&&this.timers){this.timers.stopTimer();var a=this.timers.tryToGetFirstTimerValue();a&&this.modules.map.emit("gpuRenderTime",a)}return this},e.prototype.renderIdentify=function(t){var e=this._gl,n=this.identifyBuffer.options.size;this.identifyBuffer.bind(e),e.viewport(0,0,n[0],n[1]),e.depthMask(!0),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),e.clearDepth(1),e.clearStencil(0),t.render(e,this.webGlExtensions,this.vpMatrix,!0),this.identifyBuffer.unbind(e),this.state.needRerender=!0},e.prototype.getPixels=function(){var t=this._gl,e=this.identifyBuffer.options.size,n=new Uint8Array(e[0]*e[1]*4);return this.identifyBuffer.bind(t),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,n),this.identifyBuffer.unbind(t),n},e.prototype.getRenderingContext=function(){return this._gl},e.prototype.destroy=function(){this.modules.layout.canvas.removeEventListener("webglcontextlost",this.trackContextLost);var t=this._gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this.modules.layout.destroy()},e}(xe),ri=n(49),ii=n(25);function oi(t,e,n){t.status===ti.Generating&&(t.generatedData=e),n&&t.params.setTileIds(n)}function ai(t,e){t.status=ti.Initial,t.generatedData=void 0,void 0!==t.objects&&t.objects.forEach((function(t){return t.clean(e)})),t.objects=void 0,t.ready=!1,t.tile.currentMod===t&&(t.tile.currentMod=void 0)}function si(t){return t.status===ti.Initial}function ci(t,e,n,r){var i=r.renderer;switch(t.status){case ti.Initial:t.useful&&(t.status=ti.Loading);break;case ti.Loading:t.useful?t.tile.serverMetadata&&(t.status=ti.Loaded):t.status=ti.Initial;break;case ti.Loaded:(function(t,e,n){switch(t.tile.type){case"terrain":return Boolean(t.useful&&t.tile.serverMetadata&&function(t,e,n){for(var r=n.assetManager,i=n.modelManager,o=0;o<t.length;o++){var s=t[o],c=s.regionId,l=s.metatileHash;if(!r.getMetatile(l)||e.styleZoom>a.loadModelsInfoStyleZoom&&!i.isModelsInfoLoaded(c))return!1}return!0}(t.tile.serverMetadata,e,n));case"traffic":return Boolean(t.useful&&t.tile.serverMetadata);case"raster":return Boolean(t.useful);default:return!1}})(t,n,r)&&(t.status=ti.Generating,t.needGenerate=!0);break;case ti.Generating:t.generatedData&&(t.status=ti.Generated,t.ready=!0,t.objects=t.generatedData.map((function(e){var n=e.collectorOutput.data;return new xt(t.tile.type,n,i,t.tile.coords)})),e.add(t.key,t))}}!function(t){t[t.Initial=0]="Initial",t[t.Loading=1]="Loading",t[t.Loaded=2]="Loaded",t[t.Generating=3]="Generating",t[t.Generated=4]="Generated"}(ti||(ti={}));var li,ui,di=function(){function t(t,e){var n=this;this.state=t,this.modules=e,this.identifyData=[],this.needsUpdate=!1,this.forceUpdate=!1,this.searchQueue=new Map,this.stateDiffer=new oe([{path:"center",type:"vec2"},{path:"zoom",type:"number"},{path:"size",type:"vec2"},{path:"rotation",type:"number"},{path:"pitch",type:"number"},{path:"padding",type:"padding"}]),this.debouncedFillCache=Object(he.a)((function(){n.needsUpdate=!0}),a.identify.cacheDebounceTime)}return t.prototype.resetCache=function(){this.colorBuffer=void 0,this.debouncedFillCache()},t.prototype.search=function(t,e,n){var r=this;return void 0===n&&(n=!1),void 0===this.colorBuffer&&n&&(this.needsUpdate=!0),this.forceUpdate=n,new Promise((function(n){r.searchQueue.set(t,{point:e,resolve:n})}))},t.prototype.searchSync=function(t){return this.searchHigherPriority(t)},t.prototype.update=function(){var t=this;this.stateDiffer.check(this.state)&&(this.resetCache(),this.searchQueue.size>0&&this.searchQueue.clear()),this.needsUpdate&&(this.modules.tileManager.isIdle()&&this.modules.labeler.isIdle()&&this.modules.assetManager.isIdle()||this.forceUpdate)&&(this.fillCache(),this.needsUpdate=!1,this.forceUpdate=!1),void 0!==this.colorBuffer&&this.searchQueue.size>0&&(this.searchQueue.forEach((function(e){e.resolve(t.searchHigherPriority(e.point))})),this.searchQueue.clear())},t.prototype.searchHigherPriority=function(t){var e,n=this.state.viewport,r=T.j(t[0]-n.left,t[1]-n.top),i=this.state.identifyPickDistance*window.devicePixelRatio,o=1/0,a=!1,s=T.d();for(s[0]=r[0]-i;s[0]<r[0]+i;s[0]++)for(s[1]=r[1]-i;s[1]<r[1]+i;s[1]++){var c=this.searchPointInCache(s);if(c){var l=void 0!==c.dynamicObjectId;if(!a||l){var u=T.f(r,s);(!e||!a&&l||c.phase>e.phase||c.phase===e.phase&&u<o)&&(e=c,o=u,l&&(a=!0))}}}return e},t.prototype.searchPointInCache=function(t){if(void 0!==this.colorBuffer){var e=a.identify.pixelDensity*window.devicePixelRatio,n=this.modules.renderer.identifyBuffer.options.size,r=this.state.size;if(!(t[0]<0||t[0]>r[0]-1||t[1]<0||t[1]>r[1]-1)){var i=Math.floor(t[0]*e),o=4*((n[1]-1-Math.floor(t[1]*e))*n[0]+i),s=(this.colorBuffer[o+3]<<24|this.colorBuffer[o+2]<<16|this.colorBuffer[o+1]<<8|this.colorBuffer[o])>>>0;return this.indexToIdentifierResponse(s)}}},t.prototype.fillCache=function(){var t=this;this.identifyData=[],this.modules.renderer.renderIdentify(this.modules.tileManager),this.colorBuffer=this.modules.renderer.getPixels(),this.modules.tileManager.getDisplayedMods().forEach((function(e){var n=function(t){return t.generatedData?t.generatedData.map((function(t){return{ids:t.collectorOutput.identifyIds,metatileHash:t.metatileHash}})):[]}(e);t.identifyData=t.identifyData.concat(n)})),this.modules.modelManager.getDisplayedMods().forEach((function(e){t.identifyData.push({ids:e.identifyIds,metatileHash:e.model.metatileHash})})),this.modules.floorManager.getDisplayedMods().forEach((function(e){var n=e.getIdentifyIds();n&&Object.keys(n).forEach((function(e){t.identifyData.push({ids:n[e],metatileHash:Number(e)})}))}));var e=this.modules.personalPoiManager.getIdentifyDataChunk();void 0!==e&&this.identifyData.push(e),this.modules.layers.getDynamicObjectLayers().forEach((function(e){e.identifyIds.forEach((function(n){return t.identifyData.push({dynamicObjectId:e.uniqId,ids:n,metatileHash:-1})}))}))},t.prototype.indexToIdentifierResponse=function(t){for(var e,n=0;n<this.identifyData.length;n++){var r=this.identifyData[n],i=r.dynamicObjectId,o=r.ids,a=r.metatileHash,s=o.startIndex,c=o.endIndex,l=o.idBuffer,u=o.phaseBuffer,d=o.sublayerBuffer,f=o.symbolBuffer,h=o.instanceIdBuffer,p=o.objectClassBuffer,m=o.strings;if(!(t<s||t>c)){var v=t-s,_=new Uint32Array(l,4*v*2,2),g=new Uint32Array(d)[v],y=new Uint8Array(h)[v],b=new Uint32Array(p,4*v*2,2),x=void 0,w="",S=this.modules.assetManager.getMetatile(a);if(S){S.sublayersByIndex[g]&&(x=S.sublayersByIndex[g]);var O=m[t];w=void 0!==O?O.objectClass:(null===(e=null==S?void 0:S.objectClassesByIndex)||void 0===e?void 0:e[b[0]])?S.objectClassesByIndex[b[0]]:Object(wt.a)(b[0],b[1])}var M=new Uint8Array(f)[v];return{id:new Uint32Array(_),phase:new Float32Array(u)[v],dynamicObjectId:i,sublayer:x,symbol:ii.a[M],instanceId:y,objectClass:w}}}},t}(),fi=n(24),hi=n(48),pi=n(54),mi=n(11),vi=n(77),_i=n(91),gi=function(){function t(t,e){var n=this;this.loadFont=function(t,e){var r=n.requestFontRanges.get(t,e);return r||(r=fetch(n.state.fontUrl+"/"+t+"_"+e+".pbf").then((function(t){if(!t.ok)throw new Error;return t})).catch((function(){return console.error("Could not load font "+t+" for range "+e+" fallback to the default font "+N.c),fetch(n.state.fontUrl+"/"+N.c+"_"+e+".pbf").then((function(t){if(!t.ok)throw new Error("Could not load default font "+N.c+" for range "+e);return t}))})).then((function(t){return t.arrayBuffer()})).then((function(r){var i=Object(pi.b)(r);return n.prepareFontAtlas(t,e,i),n.modules.workers.labeling.appendFont(t,i.glyphData),n.modules.workers.labeling.markFontAsLoaded(t,e)})).catch((function(r){return console.error(r),n.modules.workers.labeling.markFontAsLoaded(t,e)})),n.requestFontRanges.set(t,e,r)),r},this.state=t,this.modules=e,this.requestedMetatiles=new Set,this.metatiles={},this.loadedRasters={},this.failedRasters={},this.requestedRasters={},this.svgs={},this.textures=[],this.fontGlyphs={},this.fontTextures=new hi.a,this.requestFontRanges=new hi.a,this.metatileLoader=function(e,r){var i=Object(x.d)(e),o=Object(s.p)("metatile",{host:t.tileServer,tileSet:t.tileSet,protocol:t.tileProtocol,subdomain:t.subdomains[0],hash:i});fetch(o).then((function(t){if(!t.ok)throw new Error('Failed to load metatile "'+i+'"');return t.json()})).then((function(t){return n.setMetatile(e,r,t)})).catch((function(t){return console.error(t)}))};var r=this.modules.workers.fnRegistry;r.set("addNewRasterSets",(function(t,e){var r=n.modules.styleManager.getStyle(t);if(r){var i=r.rasterSets;e.forEach((function(t){i[t.index]=t}))}else console.error("Not found style "+t+" in AssetManager#addNewRasterSets")})),r.set("loadFont",this.loadFont),this.setPreparedMetatile(-1,x.a),this.setMetatile(-2,-2,_i),this.metatiles[N.i]=new vi.a(r)}return t.prototype.loadMetatile=function(t,e){this.requestedMetatiles.has(t)||(this.requestedMetatiles.add(t),this.metatileLoader(t,e))},t.prototype.setMetatile=function(t,e,n,r){var i=Object(x.g)(n);this.setPreparedMetatile(t,i),void 0===this.projectMetatileMetadata&&Object(mi.m)(e)&&(this.projectMetatileMetadata={regionId:e,metatileHash:t});var o={version:n.version,ast:n.sepStyles.ast,fonts:n.sepStyles.fonts,curves:n.sepStyles.curves,labelingGroups:n.sepStyles.labelingGroups,rasterSets:n.sepStyles.rasterSets,urls:{icons:{png:this.state.tileProtocol+"://"+this.state.tileServer+"/metafiles/"+Object(x.d)(t)+"/{name}_{width}_{height}.png?ts="+this.state.tileSet,svg:r?r+".svg":this.state.tileProtocol+"://"+this.state.tileServer+"/metafiles/"+Object(x.d)(t)+"/{name}.svg?ts="+this.state.tileSet}},styleStateKeys:[]};this.modules.styleManager.createOldStyle(t,o)},t.prototype.setPreparedMetatile=function(t,e){this.metatiles[t]=e,this.modules.workers.parser.setMetatile(t,e),this.modules.workers.labeling.setMetatile(t,e)},t.prototype.prepareRasters=function(t,e,n){var r,i=this,o=this.modules.styleManager.getStyle(t);if(o){for(var c=o.rasterSets,l=this.modules.renderer.getRenderingContext(),u=e.length/7,d=function(t){var u=e[7*t],d=e[7*t+1],h=e[7*t+6],p=e[7*t+2],m=e[7*t+3],v=e[7*t+4],_=e[7*t+5],g=c[u];if(g.isSvg){var y={x:p,y:m,w:v,h:_,anchorX:g.anchorX,anchorY:g.anchorY,atlasIndex:h,isPacked:!0};g.rasters[d]=y;var b=null===(r=f.svgs[o.id])||void 0===r?void 0:r[u];if(void 0!==b){var x=f.textures[y.atlasIndex];Object(s.J)(b,y.w,y.h).then((function(t){x.subImage(l,t,y.x,y.y),i.state.needRerender=!0}))}}else{var w=g.rasters[d];w.x=p,w.y=m,w.atlasIndex=h,w.isPacked=!0}void 0===f.textures[h]&&(f.textures[h]=new Se(void 0,{size:a.atlasSize,flipY:!1,unit:h,magFilter:Se.LinearFilter,minFilter:Se.LinearFilter}).prepare(f.modules.renderer.getRenderingContext()));var S=f.textures[h],O=n&&n[t];if(void 0!==O)return S.subImage(l,O,p,m),f.state.needRerender=!0,"continue"},f=this,h=0;h<u;h++)d(h);this.modules.workers.labeling.updatePackingInfo(t,e)}else console.error("Not found style "+t+" in AssetManager#prepareRasters")},t.prototype.loadRasters=function(t){for(var e=t.length/3,n=0;n<e;n++){var r=t[3*n],i=t[3*n+1],o=t[3*n+2],a=i<<16|o,s=this.modules.styleManager.getStyle(r);s?(this.loadedRasters[r]||(this.loadedRasters[s.id]=new Set,this.failedRasters[s.id]=new Set,this.requestedRasters[s.id]=new Set),this.requestedRasters[r].has(a)||(this.requestedRasters[r].add(a),s.rasterSets[i].isSvg?this.loadSvg(s,i):this.loadPng(s,i,o))):console.error("Not found style "+r+" in AssetManager#loadRasters")}},t.prototype.getMetatile=function(t){return this.metatiles[t]},t.prototype.getProjectMetadata=function(){return this.projectMetatileMetadata},t.prototype.getFontGlyphs=function(t){return this.fontGlyphs[t]||{}},t.prototype.getFontTexture=function(t,e,n){var r=this.modules.styleManager.getStyle(t);if(r){var i=r.fonts[e];return this.fontTextures.get(i,n)}console.error("Not found style "+t+" in AssetManager#getFontTexture")},t.prototype.isIdle=function(){var t=0,e=0;for(var n in this.requestedRasters)t+=this.requestedRasters[n].size,e+=this.loadedRasters[n].size+this.failedRasters[n].size;return t===e},t.prototype.dangerouslySetMetatiles=function(t){this.metatiles=t},t.prototype.dangerouslySetRasters=function(t,e){this.loadedRasters=t,this.failedRasters=e},t.prototype.prepareFontAtlas=function(t,e,n){var r=n.bitmap,i=n.width,o=n.height,a=n.glyphData;for(var s in this.fontGlyphs[t]||(this.fontGlyphs[t]={}),a)this.fontGlyphs[t][s]=a[s];var c=new Se(new Uint8Array(r),{size:[i,o],magFilter:Se.LinearFilter,minFilter:Se.LinearFilter,format:Se.AlphaFormat,premultiplyAlpha:!1,flipY:!1,unit:0});this.fontTextures.set(t,e,c),this.state.needLabeling=!0},t.prototype.loadPng=function(t,e,n){var r=this,i=this.modules.renderer.getRenderingContext(),o=e<<16|n,a=t.rasterSets[e],c=a.rasters[n],l=this.textures[c.atlasIndex],u="";if(a.type===fi.d.Unique){var d=Object(wt.a)(a.id[0],a.id[1]);u=Object(s.p)("dynamicPoi",{host:this.state.tileServer,tileSet:this.state.tileSet,protocol:this.state.tileProtocol,subdomain:Object(s.n)(this.state.subdomains,d),id:d,width:c.w.toString(),height:c.h.toString(),regionId:String(a.regionId)})}else a.type===fi.d.Static&&(u=Object(s.q)(t.urls.icons.png,{subdomain:Object(s.n)(this.state.subdomains,a.name),name:a.name,width:c.w.toString(),height:c.h.toString()}));this.modules.workers.parser.prepareAtlas(u).then((function(e){e?(e.isBitmap?(l.subImage(i,e.data[0],c.x,c.y),r.state.needRerender=!0):Object(s.d)(e.data[0]).then((function(t){l.subImage(i,t,c.x,c.y),r.state.needRerender=!0})),r.loadedRasters[t.id].add(o)):r.failedRasters[t.id].add(o)}))},t.prototype.loadSvg=function(t,e){var n=this,r=this.modules.renderer.getRenderingContext(),i=e<<16|0,o=t.rasterSets[e],a=Object(s.q)(t.urls.icons.svg,{subdomain:Object(s.n)(this.state.subdomains,o.name),name:o.fileName||o.name});this.svgs[t.id]||(this.svgs[t.id]={}),fetch(a).then((function(t){if(!t.ok)throw new Error("Not 2xx response");return t.text()})).then((function(a){n.svgs[t.id][e]=a;for(var c=function(t){var e=n.textures[t.atlasIndex];Object(s.J)(a,t.w,t.h).then((function(i){e.subImage(r,i,t.x,t.y),n.state.needRerender=!0}))},l=0,u=o.rasters;l<u.length;l++)c(u[l]);n.loadedRasters[t.id].add(i)})).catch((function(e){console.error(e),n.failedRasters[t.id].add(i)}))},t}(),yi=n(26),bi=function(){},xi=function(){function t(t,e){void 0===e&&(e=bi),this.queue=[],this.data={},this.size=t,this.onRemove=e}return t.prototype.add=function(t,e){this.data[t]||(this.queue.push(t),this.data[t]=e,this.shrink(this.size))},t.prototype.remove=function(t){this.data[t]&&(this.queue.splice(this.queue.indexOf(t),1),delete this.data[t])},t.prototype.get=function(t){var e=this.data[t];return e&&(this.queue.splice(this.queue.indexOf(t),1),this.queue.push(t)),e},t.prototype.reset=function(){this.shrink(0)},t.prototype.setSize=function(t){this.size=t,this.shrink(t)},t.prototype.getSize=function(){return this.size},t.prototype.keys=function(){return this.queue},t.prototype.getData=function(){var t=this;return Object.keys(this.data).map((function(e){return t.data[e]}))},t.prototype.shrink=function(t){for(;this.queue.length>t;){var e=this.queue.shift(),n=this.data[e];delete this.data[e],this.onRemove(e,n)}},t}(),wi=function(t){return"model-readiness-"+t},Si=function(){function t(t,e){var n=this;this.state=t,this.modules=e,this.cache=new xi(a.modelCacheSize,(function(t,e){return n.clearMod(e)})),this.selectedIds=new yi.a(this.modules.tileManager.getSelectedIds()),this.modelIds=new Set,this.viewportModelIds=new Set,this.requestedModelsInfo=new Set,this.loadedModelsInfo=new Set,this.readiness={},this.modelCount=0,this.textures={},this.objects=[],this.models=new Map,this.buildingsHeight=new Map,this.mods=[],this.animatingModelCount=0}return t.prototype.appendModelsInfo=function(t,e,n){var r=this;n.forEach((function(n){var i=Object(w.a)(Object(w.a)({},n),{regionId:t,metatileHash:e,index:r.modelCount++,idLoHi:Object(wt.b)(n.id)}),o={key:i.index+"_false",status:"initial",model:i,selected:!1,object:void 0,identifyIds:void 0,minStyleZoom:-1/0,maxStyleZoom:1/0},a={key:i.index+"_true",status:"initial",model:i,selected:!0,object:void 0,identifyIds:void 0,minStyleZoom:-1/0,maxStyleZoom:1/0};i.nonSelectedMod=o,i.selectedMod=a,r.mods.push(o,a),r.models.set(i.id,i),r.modelIds.add(i.id)})),this.findViewportModels()},t.prototype.loadModelsInfo=function(t,e){var n=this;if(!this.requestedModelsInfo.has(t)){this.requestedModelsInfo.add(t);var r=Object(s.p)("modelInfo",{host:this.state.tileServer,tileSet:this.state.tileSet,protocol:this.state.tileProtocol,subdomain:this.state.subdomains[0],regionId:t.toString()});fetch(r).then((function(e){if(!e.ok)throw new Error("Failed to load models info for region "+t);return e.json()})).then((function(r){n.modules.workers.parser.appendHiddenObjectIds(r.map((function(t){return Object(wt.b)(t.id)}))),n.appendModelsInfo(t,e,r),n.loadedModelsInfo.add(t)})).catch((function(e){n.loadedModelsInfo.add(t),console.error(e)}))}},t.prototype.resetCache=function(){var t=this;this.models.forEach((function(e){t.clearMod(e.selectedMod),t.clearMod(e.nonSelectedMod),t.cache.remove(e.selectedMod.key),t.cache.remove(e.nonSelectedMod.key),_t(wi(e.id),t.state)})),this.animatingModelCount=0,this.objects.length=0},t.prototype.isModelsInfoLoaded=function(t){return this.loadedModelsInfo.has(t)},t.prototype.getTexture=function(t,e){return this.textures[t+"_"+e]},t.prototype.findViewportModels=function(){var t=this,e=this.state.styleZoom,n=this.modules.tileManager.getViewportVertices();this.viewportModelIds.clear(),this.models.forEach((function(r){var i=r.bound,o=r.minZoom,a=r.maxZoom;Object(s.C)(i,n)&&e>=o&&e<a&&t.viewportModelIds.add(r.id)}))},t.prototype.getDisplayedMods=function(){return this.mods.filter((function(t){return"displayed"===t.status}))},t.prototype.update=function(){var t=this,e=this.mods,n=this.models,r=this.state.styleZoom;this.selectedIds=new yi.a(this.modules.tileManager.getSelectedIds()),r>a.loadModelsInfoStyleZoom&&this.modules.tileManager.getViewportTiles().forEach((function(e){var n=e.serverMetadata;n&&n.forEach((function(e){return t.loadModelsInfo(e.regionId,e.metatileHash)}))}));for(var i=0;i<e.length;i++){var o=e[i],s=this.checkModUsefulness(o,this.selectedIds),c=this.modules.floorManager.hasDisplayedFloorBuilding(o.model.id),l=!!this.modules.assetManager.getMetatile(o.model.metatileHash),u=this.modules.buildingHeightAnimator.isAnimating(),d=s&&!c,f=o.status;"initial"===o.status&&d&&l?(this.loadModel(o),f="loading"):"ready"===o.status&&d?(this.addObject(o.object),this.state.needRerender=!0,this.modules.identifier.debouncedFillCache(),f="displayed"):"ready"!==o.status||d?"cached"===o.status&&d?(this.addObject(o.object),this.state.needRerender=!0,this.modules.identifier.debouncedFillCache(),this.cache.get(o.key),f="displayed"):"displayed"!==o.status||(s||u)&&!c||(this.removeObject(o.object),this.state.needRerender=!0,this.modules.identifier.debouncedFillCache(),this.cache.add(o.key,o),f="cached"):(this.cache.add(o.key,o),f="cached"),o.status=f}n.forEach((function(e){var n=e.id;gt(wi(e.id),{step:function(e,r){return t.readiness[n]=r},complete:function(){return t.animatingModelCount--}},t.state)}))},t.prototype.getOpacity=function(t,e){return(void 0!==this.readiness[t]?this.readiness[t]:0)*this.modules.buildingHeightAnimator.getBuildingHeight(e)},t.prototype.hasModel=function(t){return this.modelIds.has(t)},t.prototype.setBuildingHeight=function(t,e){this.buildingsHeight.set(t,e)},t.prototype.getBuildingHeight=function(t){return this.buildingsHeight.get(t)||0},t.prototype.getVisibleModelData=function(t){var e=this.models.get(t);if(e){var n=this.getModelCurrentMod(t);if(n){var r=Math.max(e.minZoom,n.minStyleZoom),i=Math.min(e.maxZoom,n.maxStyleZoom),o=this.state.styleZoom;if(!(o<r||o>=i))return{minStyleZoom:r,maxStyleZoom:i,opacity:this.getOpacity(t,r)}}}},t.prototype.isAnimating=function(){return this.animatingModelCount>0},t.prototype.getModelCurrentMod=function(t){var e=this.models.get(t);if(e)return this.checkModUsefulness(e.selectedMod,this.selectedIds)?e.selectedMod:this.checkModUsefulness(e.nonSelectedMod,this.selectedIds)?e.nonSelectedMod:void 0},t.prototype.loadModel=function(t){var e=this,n=t.model,r=n.regionId,i=n.metatileHash,o=n.fileName,a=n.index,c=n.matrix,l=n.offset,u=n.idLoHi,d={fileName:o,offset:l,matrix:c,regionId:r,metatileHash:i,selected:t.selected,id:u,modelIndex:a,pixelRatio:window.devicePixelRatio,tileServer:this.state.tileServer,tileSet:this.state.tileSet,tileProtocol:this.state.tileProtocol,subdomain:Object(s.n)(this.state.subdomains,o),styleState:this.state.styleState};this.modules.workers.parser.generateModel(d).then((function(n){var r=n.objects,i=r.data,o=r.identifyIds,a=n.textures;t.object&&e.removeObject(t.object),t.object=new xt("model",i,e.modules.renderer),t.minStyleZoom=Math.min.apply(Math,t.object.children.map((function(t){var e=t.uniforms.minStyleZoom;return Number.isNaN(e)?-1/0:e}))),t.maxStyleZoom=Math.max.apply(Math,t.object.children.map((function(t){var e=t.uniforms.maxStyleZoom;return Number.isNaN(e)?1/0:e}))),t.identifyIds=o;var s=t.model;s.texturesLoaded?t.status="ready":(s.texturesLoaded=!0,s.textureCount=a.data.length,a.isBitmap?e.prepareImageBitmapTextures(t,a.data):e.prepareRawTextures(t,a.data),e.startReadinessTicker(s))}))},t.prototype.prepareImageBitmapTextures=function(t,e){var n=this;e.forEach((function(e,r){n.textures[t.model.index+"_"+r]=new Se(e,{flipY:!1})})),t.status="ready"},t.prototype.prepareRawTextures=function(t,e){var n=this,r=e.length;e.forEach((function(e,i){Object(s.d)(e).then((function(e){n.textures[t.model.index+"_"+i]=new Se(e,{flipY:!1}),0==--r&&(t.status="ready")}))}))},t.prototype.clearMod=function(t){var e=t.model;if(t.status="initial",void 0!==t.object&&(t.object.clean(this.state),t.object=void 0),"initial"===this.getSiblingMod(t).status){for(var n=0;n<e.textureCount;n++)delete this.textures[e.index+"_"+n];e.texturesLoaded=!1}},t.prototype.addObject=function(t){this.objects.push(t)},t.prototype.removeObject=function(t){var e=this.objects.indexOf(t);-1!==e&&this.objects.splice(e,1)},t.prototype.getSiblingMod=function(t){return t.selected?t.model.nonSelectedMod:t.model.selectedMod},t.prototype.checkModUsefulness=function(t,e){var n=t.model;if(!this.viewportModelIds.has(n.id))return!1;var r=e.has(n.idLoHi);return r===t.selected||!(!r||t.selected||void 0!==this.getSiblingMod(t).object||void 0===t.object)},t.prototype.startReadinessTicker=function(t){this.readiness[t.id]=0,vt(wi(t.id),{easing:a.buildingAnimation.easing},this.state,0,1,a.buildingAnimation.duration),this.animatingModelCount++},t}(),Oi=n(15),Mi=function(){function t(t){this.modules=t,this.modCache=new Map,this.isGenerating=!1,this.currentPois=[],this.currentIdSet=new yi.a,this.currentTrafficState=!1,this.currentSelectedIds=[],this.currentModKey="ppoi_false_"}return t.prototype.setPersonalPoi=function(t){this.currentPois=t;for(var e=new yi.a,n=0,r=t;n<r.length;n++){var i=r[n];e.add(Object(wt.b)(i.id))}this.currentIdSet=e,this.modCache.clear(),this.displayedModKey=void 0},t.prototype.redraw=function(){this.modCache.clear(),this.displayedModKey=void 0},t.prototype.getIdentifyDataChunk=function(){return this.identifyDataChunk},t.prototype.update=function(){if(void 0===this.regionMetadata&&(this.regionMetadata=this.modules.assetManager.getProjectMetadata()),void 0!==this.regionMetadata){this.updateModKey();var t=this.currentModKey,e=this.modCache.get(t);void 0!==e||this.isGenerating||this.generate(t,this.currentPois,this.regionMetadata),void 0!==e&&t!==this.displayedModKey&&this.show(t,e,this.regionMetadata)}},t.prototype.generate=function(t,e,n){var r=this,i=n.regionId,o=n.metatileHash;this.isGenerating=!0,this.modules.workers.parser.generatePersonalPoi(e,i,o,window.devicePixelRatio,this.modules.tileManager.getSelectedIds(),this.modules.map.state.styleState).then((function(e){var n=e.collectorOutput,i=e.styleId,o=n.packedRasters,a=n.rastersToLoad;void 0!==o&&r.modules.assetManager.prepareRasters(i,o),r.modules.assetManager.loadRasters(a),r.modCache.set(t,e),r.isGenerating=!1}))},t.prototype.show=function(t,e,n){var r=n.metatileHash,i=e.collectorOutput,o=i.labels,a=i.identifyIds,s=e.styleId;this.modules.labeler.removeLabels("ppoi"),void 0!==o&&this.modules.labeler.addLabels("ppoi",Oi.b.PersonalPoi,[{metatileHash:r,labels:o,styleId:s}]),this.identifyDataChunk={metatileHash:r,ids:a},this.modules.identifier.resetCache(),this.displayedModKey=t},t.prototype.updateModKey=function(){var t=Object(mi.g)(this.modules.tileManager.getSelectedIds(),this.currentIdSet),e=this.modules.trafficTileLayer.isEnabled();Object(mi.f)(this.currentSelectedIds,t)&&this.currentTrafficState===e||(this.currentTrafficState=e,this.currentSelectedIds=t,this.currentModKey="ppoi_"+e+"_"+t)},t}(),ji=n(81),Ii=n.n(ji),Ti=n(44),Ei=n(45),Ai=n(16),Li=function(){function t(){var t;this.connector=new Ti.a,this.fnRegistry=new Ei.a(this.connector),this.parserWorker=Ii()(98),this.connector.addWorker(Ai.b.Parser,this.parserWorker),this.labelingWorker=Ii()(99),this.connector.addWorker(Ai.b.Labeling,this.labelingWorker),this.sourceWorker=Ii()(100),this.connector.addWorker(Ai.b.Source,this.sourceWorker),this.parser={setMetatile:(t=this.fnRegistry).get(Ai.b.Parser,"setMetatile"),fetchTile:t.get(Ai.b.Parser,"fetchTile"),deleteTile:t.get(Ai.b.Parser,"deleteTile"),abortTileRequest:t.get(Ai.b.Parser,"abortTileRequest"),generateTile:t.get(Ai.b.Parser,"generateTile"),generateFloor:t.get(Ai.b.Parser,"generateFloor"),loadFloor:t.get(Ai.b.Parser,"loadFloor"),generateModel:t.get(Ai.b.Parser,"generateModel"),appendHiddenObjectIds:t.get(Ai.b.Parser,"appendHiddenObjectIds"),prepareAtlas:t.get(Ai.b.Parser,"prepareAtlas"),packRasters:t.get(Ai.b.Parser,"packRasters"),fetchTrafficTile:t.get(Ai.b.Parser,"fetchTrafficTile"),deleteTrafficTile:t.get(Ai.b.Parser,"deleteTrafficTile"),abortTrafficTileRequest:t.get(Ai.b.Parser,"abortTrafficTileRequest"),generateTrafficTile:t.get(Ai.b.Parser,"generateTrafficTile"),generatePersonalPoi:t.get(Ai.b.Parser,"generatePersonalPoi"),addStyle:t.get(Ai.b.Parser,"addStyle"),bindStyleToMetatileHash:t.get(Ai.b.Parser,"bindStyleToMetatileHash"),useSingleStyle:t.get(Ai.b.Parser,"useSingleStyle")},this.labeling=function(t){return{setMetatile:t.get(Ai.b.Labeling,"setMetatile"),appendFont:t.get(Ai.b.Labeling,"appendFont"),markFontAsLoaded:t.get(Ai.b.Labeling,"markFontAsLoaded"),addNewRasterSets:t.get(Ai.b.Labeling,"addNewRasterSets"),updatePackingInfo:t.get(Ai.b.Labeling,"updatePackingInfo"),addStyle:t.get(Ai.b.Labeling,"addStyle"),bindStyleToMetatileHash:t.get(Ai.b.Labeling,"bindStyleToMetatileHash"),useSingleStyle:t.get(Ai.b.Labeling,"useSingleStyle")}}(this.fnRegistry),this.source=function(t){return{addSource:t.get(Ai.b.Source,"addSource"),removeSource:t.get(Ai.b.Source,"removeSource"),getTile:t.get(Ai.b.Source,"getTile")}}(this.fnRegistry)}return t.prototype.destroy=function(){this.parserWorker.terminate(),this.labelingWorker.terminate(),this.sourceWorker.terminate()},t}(),Ci=function(t){function e(n,r){var i=t.call(this)||this;i.options=Object(s.b)(r,e.options),i.uniqId=M(),i.labelKey="html-"+i.uniqId,i.mapPoint=Object(c.l)(i.options.coordinates),i.screenPoint=[0,0],i.html=function(t){var e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.zIndex=String(t.zIndex),t.interactive||(e.style.pointerEvents="none"),t.animate&&(e.style.opacity="0",e.style.transition="opacity "+t.duration+"ms",e.style["will-change"]="opacity");var n=document.createElement("div");return"string"==typeof t.html?n.innerHTML=t.html:n.append(t.html),e.append(n),e}(i.options),i.isHidden=!0,i.targetOpacity=0,i.modules=n.modules,i.modules.layers.addLayer(i),i.mapState=n.state,i.rounder=i.options.disableRounding?ki:Pi;var o=i.options,a=o.offset,l=o.labeling;return"none"!==l.type&&i.modules.labeler.addLabelBox(i.labelKey,{id:i.uniqId,width:l.width,height:l.height,position:i.mapPoint,offset:a,labelingGroup:i.getLabelingGroup(),parentPoiId:"pinnedToPoi"===l.type?l.poiId:void 0}),i}return Object(w.c)(e,t),e.prototype.destroy=function(){this.removeHtml(),this.modules.labeler.removeLabels(this.labelKey),this.modules.layers.removeLayer(this)},e.prototype.update=function(){var t=this.checkZoom(),e=!this.isInvolvedInLabeling()||this.modules.labeler.isLabelBoxSurvived(this.uniqId);t&&e?this.show():this.hide(),this.updatePosition()},e.prototype.setContent=function(t){this.options.html=t,this.html.innerHTML="";var e=document.createElement("div");"string"==typeof t?e.innerHTML=t:e.append(t),this.html.append(e)},e.prototype.setLabelingSize=function(t,e){"none"!==this.options.labeling.type&&(this.options.labeling.width=t,this.options.labeling.height=e,this.updateLabelBox())},e.prototype.setPosition=function(t){this.mapPoint=Object(c.l)(t),this.updateLabelBox()},e.prototype.setOffset=function(t){this.options.offset=[t[0],t[1]],this.updateLabelBox()},e.prototype.setMinZoom=function(t){this.options.minZoom=t},e.prototype.setMaxZoom=function(t){this.options.maxZoom=t},e.prototype.getZIndex=function(){return this.options.zIndex},e.prototype.getOffset=function(){return this.options.offset},e.prototype.getPosition=function(){return Object(c.m)(this.mapPoint)},e.prototype.getHtmlElement=function(){return this.html.firstChild},e.prototype.dangerouslyGetRootElement=function(){return this.html},e.prototype.isShown=function(){return!this.isHidden},e.prototype.show=function(){var t=this;if(this.isHidden&&(this.isHidden=!1,this.appendHtml(),this.emit("shown",{id:this.uniqId.toString(),point:[this.screenPoint[0],this.screenPoint[1]]}),this.options.animate)){if(this.showAnimationTimer)return;this.hideAnimationTimer&&(clearTimeout(this.hideAnimationTimer),this.hideAnimationTimer=void 0),1!==this.targetOpacity&&(this.showAnimationTimer=window.setTimeout((function(){t.setHtmlOpacity(1),t.showAnimationTimer=void 0}),0))}},e.prototype.hide=function(){var t=this;if(!this.isHidden)if(this.isHidden=!0,this.options.animate){if(this.hideAnimationTimer)return;this.showAnimationTimer&&(clearTimeout(this.showAnimationTimer),this.showAnimationTimer=void 0),this.setHtmlOpacity(0),this.hideAnimationTimer=window.setTimeout((function(){t.removeHtml(),t.hideAnimationTimer=void 0}),this.options.duration)}else this.removeHtml()},e.prototype.setHtmlOpacity=function(t){this.html.style.opacity=String(t),this.targetOpacity=t},e.prototype.removeHtml=function(){this.html.remove(),this.screenPoint=[0,0]},e.prototype.appendHtml=function(){this.getMarkerContainer().appendChild(this.html)},e.prototype.getMarkerContainer=function(){return this.options.preventMapInteractions?this.modules.layout.htmlContainerOutMap:this.modules.layout.htmlContainerInMap},e.prototype.updatePosition=function(){var t=Object(s.y)(this.mapState,this.mapPoint);this.rounder(t,t[0]+this.options.offset[0],t[1]+this.options.offset[1],this.mapState.stillness),T.h(this.screenPoint,t)||(this.html.style.transform="translate3d("+t[0]+"px, "+t[1]+"px, 0px)",this.screenPoint=t)},e.prototype.updateLabelBox=function(){if("none"!==this.options.labeling.type){var t=this.options,e=t.labeling,n=e.width,r=e.height,i=t.offset;this.modules.labeler.removeLabels(this.labelKey),this.modules.labeler.addLabelBox(this.labelKey,{id:this.uniqId,width:n,height:r,position:this.mapPoint,offset:i,labelingGroup:this.getLabelingGroup(),parentPoiId:"pinnedToPoi"===this.options.labeling.type?this.options.labeling.poiId:void 0})}},e.prototype.getLabelingGroup=function(){return this.isInvolvedInLabeling()?"markerText":"htmlLabel"},e.prototype.checkZoom=function(){var t=this.mapState.zoom,e=this.options,n=e.minZoom,r=e.maxZoom;return t>=n&&t<r},e.prototype.isInvolvedInLabeling=function(){return"full"===this.options.labeling.type||"pinnedToPoi"===this.options.labeling.type},e.options={coordinates:[0,0],html:"",offset:[0,0],animate:!0,duration:500,labeling:{type:"none"},interactive:!0,preventMapInteractions:!1,zIndex:0,minZoom:-1/0,maxZoom:1/0,disableRounding:!1},e}(S.a),Pi=function(t,e,n,r){var i=Math.round(e)-e,o=Math.round(n)-n;t[0]=e+r*i,t[1]=n+r*o},ki=function(t,e,n){t[0]=e,t[1]=n},Ni=function(){function t(t){this.state=t,this.layers=[]}return t.prototype.addLayer=function(t){this.layers.push(t),this.state.needRerender=!0},t.prototype.removeLayer=function(t){var e=this.layers.indexOf(t);-1!==e&&(this.layers.splice(e,1),this.state.needRerender=!0)},t.prototype.removeLayerByName=function(t){for(var e=Object(w.e)(this.layers),n=0;n<e.length;n++){var r=e[n];"name"in r&&r.name===t&&r.destroy()}},t.prototype.getLayers=function(){return this.layers},t.prototype.getDynamicObjectLayers=function(){return this.layers.filter((function(t){return t instanceof j}))},t.prototype.getHtmlMarkers=function(){return this.layers.filter((function(t){return t instanceof Ci}))},t}(),Ri=n(43),zi=function(){return""},Bi=function(){function t(t){this.modules=t,this.cache={}}return t.prototype.getRasterSet=function(t,e,n,r){var i=this.getKey(t,n,r),o=this.getFromCache(i,e);if(o)return o;var a=this.loadIcon(t,e,n,r);return this.storeInCache(a,i,e),a},t.prototype.loadIcon=function(t,e,n,r){return Object(w.b)(this,void 0,Promise,(function(){var i,o,a,c,l,u;return Object(w.d)(this,(function(d){switch(d.label){case 0:return i=this.modules,o=i.dynamicStyle,a=i.workers,c=i.assetManager,l=t,e?[4,this.loadImageForTransformer(t).then((function(t){return e(t)})).catch((function(){return t}))]:[3,2];case 1:l=d.sent(),d.label=2;case 2:return[4,this.loadImage(l)];case 3:return u=d.sent(),[2,Promise.resolve().then((function(){n=void 0!==n?n:[u.width,u.height],r=void 0!==r?[r[0]/n[0],r[1]/n[1]]:[.5,.5];var t=[n[0]*window.devicePixelRatio,n[1]*window.devicePixelRatio],e=Object(Ri.a)([{w:t[0],h:t[1],x:0,y:0,atlasIndex:0,isPacked:!1,anchorX:r[0],anchorY:r[1]}]);o.appendRasterSet(e),a.labeling.addNewRasterSets(-1,[e]);var i=new Uint16Array(3);return i[0]=t[0],i[1]=t[1],i[2]=e.index,a.parser.packRasters(i).then((function(n){return{packedRasters:n.packedRasters,rasterSet:e,scaledSize:t}}))})).then((function(t){var e=t.packedRasters,n=t.rasterSet,r=t.scaledSize;return void 0!==e&&c.prepareRasters(-1,e,[Object(s.D)(u,r)]),n}))]}}))}))},t.prototype.getFromCache=function(t,e){var n=this.cache[t];if(n)return n.get(e||zi)},t.prototype.storeInCache=function(t,e,n){this.cache[e]||(this.cache[e]=new Map),this.cache[e].set(n||zi,t)},t.prototype.getKey=function(t,e,n){return t+"_"+(void 0!==e?e[0]+","+e[1]:"")+"_"+(void 0!==n?n[0]+","+n[1]:"")},t.prototype.loadImage=function(t){return new Promise((function(e){var n=new Image;n.crossOrigin="Anonymous",n.src=t,n.onload=function(){e(n)}}))},t.prototype.loadImageForTransformer=function(t){return-1===t.indexOf(".svg")?new Promise((function(e){var n=new Image;n.crossOrigin="Anonymous",n.src=t,n.onload=function(){e({type:"raster",source:n})},n.onerror=function(){e({type:"unknown"})}})):new Promise((function(e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){200===n.status&&0!==n.response.byteLength?e({type:"vector",source:n.response}):e({type:"unknown"})},n.onerror=function(){e({type:"unknown"})},n.send()}))},t}(),Fi=function(){function t(t,e,n,r,i,o,a,s,c,l,u){this.key=n,this.id=r,this.object=void 0,this.ready=!1,this.modules=t,this.mapState=e,this.status="initial",this.regionId=i,this.metatileHash=N.i,this.styleId=o,this.floorIndex=a,this.cache=s,this.onGenerated=u,this.useful=!0,this.selectedIds=c.slice(0),this.needFilterIds=l}return t.prototype.update=function(){var t=this;switch(this.status){case"initial":this.useful&&(this.modules.workers.parser.generateFloor(this.id,this.regionId,this.styleId,window.devicePixelRatio,this.floorIndex,this.selectedIds,this.modules.map.state.disableCommercialPoi,this.mapState.styleState).then((function(e){var n=e.collectorOutput.packedRasters,r=e.styleId;n&&t.modules.assetManager.prepareRasters(r,n),t.processResponse=e})),this.status="generating");break;case"generating":if(this.useful&&this.processResponse){var e=this.processResponse,n=e.collectorOutput.data,r=e.tileCoords;this.object=new xt("dynamicObject",n,this.modules.renderer,r),this.status="generated",this.ready=!0,this.cache.add(this.key,this),this.onGenerated(this)}}},t.prototype.getLabels=function(){return this.processResponse&&this.processResponse.collectorOutput.labels?[{metatileHash:this.metatileHash,labels:this.processResponse.collectorOutput.labels,styleId:this.processResponse.styleId}]:[]},t.prototype.getGeoIds=function(){if(this.processResponse)return this.processResponse.collectorOutput.geoIds},t.prototype.canBeRemoved=function(){return"initial"===this.status},t.prototype.remove=function(){"generated"===this.status&&this.cache.remove(this.key),this.status="initial",this.object&&this.object.clean(this.mapState),this.ready=!1},t.prototype.getIdentifyIds=function(){if(this.processResponse){var t={};return t[this.metatileHash]=this.processResponse.collectorOutput.identifyIds,t}},t.prototype.isDataEmpty=function(){return!this.processResponse||0===this.processResponse.collectorOutput.data.length},t}(),Di=function(){function t(t,e,n,r,i,o,a,s){var c,l=this;this.onModGenerated=function(t){var e=l.idSetByFloorIndex.get(t.floorIndex);if(!e){e=new yi.a;var n=t.getGeoIds();n&&e.addFromFlatArray(n),l.idSetByFloorIndex.set(t.floorIndex,e)}t.needFilterIds&&(t.needFilterIds=!1,t.selectedIds=Object(mi.g)(t.selectedIds,e))},this.modules=t,this.mapState=e,this.id=n,this.regionId=r,this.styleId=null===(c=t.styleManager.getStyleForTerrainTiles(i))||void 0===c?void 0:c.id,this.idSetByFloorIndex=new Map,this.cache=o,this.floorIndex=a,this.createNewMod(a,s)}return t.prototype.update=function(){this.currentMod&&this.currentMod.useful&&this.currentMod.update(),this.newMod&&this.newMod.useful&&this.newMod.update()},t.prototype.getCurrentMod=function(){return this.currentMod},t.prototype.commitMod=function(){this.newMod&&this.newMod.ready&&(this.currentMod=this.newMod,this.newMod=void 0)},t.prototype.setUsefulMod=function(t,e){this.floorIndex=t;var n=this.idSetByFloorIndex.get(t);if(n&&(e=Object(mi.g)(e,n)),this.currentMod||this.newMod){if(this.currentMod&&Object(mi.f)(this.currentMod.selectedIds,e)&&this.currentMod.floorIndex===t)return this.currentMod.useful=!0,void(this.newMod=void 0);this.newMod&&Object(mi.f)(this.newMod.selectedIds,e)&&this.newMod.floorIndex===t?this.newMod.useful=!0:this.createNewMod(t,e)}else this.createNewMod(t,e)},t.prototype.getUsefulMod=function(){return this.currentMod&&this.currentMod.useful?this.currentMod:this.newMod&&this.newMod.useful?this.newMod:void 0},t.prototype.setAllModsNeedless=function(){this.currentMod&&(this.currentMod.useful=!1),this.newMod&&(this.newMod.useful=!1)},t.prototype.canBeRemoved=function(){return(!this.currentMod||this.currentMod.canBeRemoved())&&(!this.newMod||this.newMod.canBeRemoved())},t.prototype.remove=function(){this.currentMod&&this.currentMod.remove(),this.newMod&&this.newMod.remove()},t.prototype.createNewMod=function(t,e){var n=function(t,e,n){return"floor_plan_"+t+"_"+e+"_"+n}(this.id,t,e),r=this.cache.get(n);if(r)this.newMod=r,this.newMod.useful=!0;else{if(void 0===this.styleId)return;var i=!this.idSetByFloorIndex.has(t);this.newMod=new Fi(this.modules,this.mapState,n,this.id,this.regionId,this.styleId,t,this.cache,e,i,this.onModGenerated)}},t}(),Ui=function(){function t(t,e){this.state=t,this.modules=e,this.floors=new Map,this.complexDescriptors=new Map,this.hiddenObjectIds=new Map,this.displayedMods=new Map,this.requestedFloors=new Set,this.needUpdate=!1,this.cache=new xi(10,(function(t,e){return e.remove()})),this.stateDiffer=new oe([{path:"center",type:"vec2"},{path:"zoom",type:"number"},{path:"size",type:"vec2"},{path:"rotation",type:"number"},{path:"pitch",type:"number"},{path:"padding",type:"padding"}])}return t.prototype.update=function(){var t=this;if(this.stateDiffer.check(this.state)||this.needUpdate){this.needUpdate=!1;var e=this.findActiveFloor();if(this.activeFloor!==e){if(this.activeFloor&&this.modules.map.emit("floorcomplexhide",{id:this.activeFloor}),e){var n=this.complexDescriptors.get(e);if(n){var r=n.id,i=n.regionId,o=n.metatileHash,a=n.defaultFloor,s=n.floorNames,c=this.floors.get(e);c?c.setUsefulMod(c.floorIndex,this.modules.tileManager.getSelectedIds()):(c=new Di(this.modules,this.state,r,i,o,this.cache,a,this.modules.tileManager.getSelectedIds()),this.floors.set(e,c));var l=c.getUsefulMod();this.modules.map.emit("floorcomplexshow",{id:r,currentFloor:l?l.floorIndex:a,floorNames:s,firmsToFloorIndexMap:n.firmsToFloorIndexMap})}}this.activeFloor=e}}if(this.floors.forEach((function(t){return t.setAllModsNeedless()})),this.activeFloor){var u=this.floors.get(this.activeFloor);u&&u.setUsefulMod(u.floorIndex,this.modules.tileManager.getSelectedIds())}this.floors.forEach((function(e,n){e.update(),e.canBeRemoved()&&t.floors.delete(n)})),this.updateScene(),this.commitMods()},t.prototype.getActiveFloorHiddenIds=function(){var t=[];if(!this.activeFloor)return t;var e=this.complexDescriptors.get(this.activeFloor),n=this.floors.get(this.activeFloor);if(!e||!n)return t;var r=n.getCurrentMod();if(!r)return t;if(r.isDataEmpty())return t;for(var i=0;i<e.buildings.length;i++){var o=this.hiddenObjectIds.get(e.buildings[i]);o&&o.forEach((function(e){return t.push(e)}))}return t},t.prototype.prepareFloors=function(t,e,n){var r=this;n.forEach((function(n,i,o){var a=Object(wt.a)(i,o),s=r.hiddenObjectIds.get(a);void 0===s&&(s=new Set,r.hiddenObjectIds.set(a,s));for(var c=0;c<n.length;c+=2)s.add(Object(wt.a)(n[c],n[c+1]));r.loadFloor(a,t,e)}))},t.prototype.changeFloorNumber=function(t,e){var n=this.floors.get(t),r=this.complexDescriptors.get(t);n&&r&&(n.setUsefulMod(e,this.modules.tileManager.getSelectedIds()),this.modules.map.emit("floorcomplexlevelchange",{id:t,floorIndex:e,floorName:r.floorNames[e]}))},t.prototype.resetCache=function(){var t=this;this.floors.forEach((function(e,n){e.remove(),t.floors.delete(n)})),this.cache.reset(),this.activeFloor=void 0,this.needUpdate=!0},t.prototype.getDisplayedMods=function(){var t=[];return this.displayedMods.forEach((function(e){return t.push(e)})),t},t.prototype.hasDisplayedFloorBuilding=function(t){if(!this.activeFloor)return!1;var e=this.complexDescriptors.get(this.activeFloor),n=this.floors.get(this.activeFloor);if(!e||!n)return!1;var r=n.getCurrentMod();if(!r||!r.ready)return!1;if(r.isDataEmpty())return!1;for(var i=0;i<e.buildings.length;i++){var o=this.hiddenObjectIds.get(e.buildings[i]);if(o&&o.has(t))return!0}return!1},t.prototype.loadFloor=function(t,e,n){var r=this;this.requestedFloors.has(t)||(this.requestedFloors.add(t),this.modules.workers.parser.loadFloor(t,this.state.floorsUrl).then((function(i){"error"!==i.type?(r.complexDescriptors.set(t,{id:t,regionId:e,metatileHash:n,center:i.center,defaultFloor:i.defaultFloor,floorNames:i.floorNames,buildings:i.buildings,bound:i.bound,firmsToFloorIndexMap:i.firmsToFloorIndexMap}),r.needUpdate=!0):404!==i.errorStatus&&console.error("Loading floor "+t+" failed")})))},t.prototype.updateScene=function(){var t=this,e=!1,n=new Map;if(this.activeFloor){var r=this.floors.get(this.activeFloor);if(!r)return;var i=r.getCurrentMod();i&&i.ready&&n.set(i.key,i)}this.displayedMods.forEach((function(r,i){n.has(i)||(t.removeFloorMod(r),e=!0)})),n.forEach((function(n,r){t.displayedMods.has(r)||(t.addFloorMod(n),e=!0),t.cache.get(r)})),e&&(this.displayedMods=n,this.state.needLabeling=!0,this.state.needRerender=!0,this.modules.identifier.resetCache())},t.prototype.addFloorMod=function(t){t.object&&(this.modules.tileManager.addObject(t.object),this.modules.labeler.addLabels(t.key,Oi.b.Floor,t.getLabels()))},t.prototype.removeFloorMod=function(t){t.object&&(this.modules.tileManager.removeObject(t.object),this.modules.labeler.removeLabels(t.key))},t.prototype.commitMods=function(){if(this.activeFloor){var t=this.floors.get(this.activeFloor);t&&t.commitMod()}},t.prototype.findActiveFloor=function(){var t=this.complexDescriptors,e=this.state,n=e.center,r=e.zoom,i=e.styleZoom,o=e.rotation,l=e.size,u=e.pitch,d=e.viewport,f=e.padding;if(!(i<a.floors.displayStyleZoom)){var h,p=Object(c.e)({center:n,zoom:r,rotation:o,size:[l[0]-a.floors.viewportPadding*window.devicePixelRatio,l[1]-a.floors.viewportPadding*window.devicePixelRatio],pitch:u,viewport:d,padding:f}),m=1/0;return t.forEach((function(t){var e=T.f(n,t.center);m>e&&Object(s.C)(t.bound,p)&&(m=e,h=t)})),h?h.id:void 0}},t}(),Zi=function(t,e,n,r,i,o){for(var a=$i(o,n),s=0;s<a.length;s++)Hi(t,e,n,r,i,a[s])},Hi=function(t,e,n,r,i,o){for(var a=to(o,n),s=0;s<a.length;s++)Gi(t,e,n,r,i,a[s])},Gi=function(t,e,n,r,i,o){eo(o,n).forEach((function(o){Wi(t,e,n,r,i,o)}))},Wi=function(t,e,n,r,i,o){var a=o[0].layerSettings,s=a.program,c=a.globalBinder;s.enable(t),c(t,s,n,r),no(o,n).forEach((function(o){Vi(t,e,n,r,i,o)}))},Vi=function(t,e,n,r,i,o){(0,o[0].layerSettings.stateBinder)(t),ro(o,n).forEach((function(o){Yi(t,e,n,r,i,o)}))},qi=new Float32Array(E.b()),Yi=function(t,e,n,r,i,o){var a=o[0],s=a.layerSettings,c=s.objectBinder,l=s.program;c(t,l,n,r,a)&&o.forEach((function(r){"model"!==r.symbol?l.bind(t,{u_mat4_mvp:r.tile.mvpMatrix}):(E.g(qi,i,r.uniforms.matrix),l.bind(t,{u_mat4_mvp:qi})),r.vao.bind({gl:t,extensions:e});var o=r.rangeStart/r.stride,a=(r.rangeEnd-r.rangeStart)/r.stride,s=1===r.uniforms.primitiveType?t.TRIANGLE_STRIP:t.TRIANGLES;t.drawArrays(s,o,a),n.collectStats&&!r.layerSettings.identify&&(n.stats.drawCount++,n.stats.vertexCount+=a)}))},Xi=function(t,e){return Number(t)-Number(e)},Ki=function(t){return function(e,n){for(var r={},i=0;i<e.length;i++){var o=e[i],a=t(o,n),s=r[a];void 0===s?r[a]=[o]:s.push(o)}var c=Object.keys(r);c.sort(Xi);var l=[];for(i=0;i<c.length;i++)l.push(r[c[i]]);return l}},Ji=function(t){return function(e,n){for(var r=new Map,i=0;i<e.length;i++){var o=e[i],a=t(o,n);r.has(a)?r.get(a).push(o):r.set(a,[o])}return r}},Qi=Ki((function(t,e){var n=t.tile,r=n.purpose,i=n.detailLevel,o=t.uniforms.styleId,s=a.tiles.maxDetailLevel;if(-1===o)return 1;if("terrain"===r){var c=Math.min(Math.floor(e.styleZoom),s);return Math.min(i-c,0)}return 0})),$i=Ki((function(t){return C("phase",t.uniforms,t.layerSettings.uniformSet)})),to=Ki((function(t){return t.layerSettings.subphase||0})),eo=Ji((function(t){return t.layerSettings.program})),no=Ji((function(t){return t.layerSettings.stateBinder})),ro=Ji((function(t){return t.uniformsHash+"_"+t.tile.readiness}));!function(t){t[t.Stationary=0]="Stationary",t[t.ZoomingIn=1]="ZoomingIn",t[t.ZoomingOut=2]="ZoomingOut"}(li||(li={})),function(t){t[t.ByOne=0]="ByOne",t[t.WaitingAll=1]="WaitingAll"}(ui||(ui={}));var io,oo=function(){function t(t,e){for(var n in void 0===t&&(t=[]),void 0===e&&(e={}),this.params={},this.params.selectedIds=Object(w.e)(t),e)this.params["__style_state_"+n]=e[n]}return t.equal=function(t,e){return Object(s.g)(t.params,e.params)},t.prototype.clone=function(){var e=new t;for(var n in this.params)e.params[n]=this.get(n);return e},t.prototype.stringify=function(){var t=[];for(var e in this.params)t.push(e+"="+this.get(e));return t.join(";")},t.prototype.get=function(t){var e=this.params[t];return Array.isArray(e)?this.tileIds&&"selectedIds"===t?Object(mi.g)(e,this.tileIds):e.slice():"object"==typeof e?Object(w.a)({},e):e},t.prototype.setTileIds=function(t){this.tileIds=t},t}();function ao(t,e,n,r){var i=[];n.oldHoverTileObjects.forEach((function(n){n.tickerFinished(e)?(t.tileManager.removeObject(n),n.clean(e)):i.push(n)})),n.oldHoverTileObjects=i,void 0!==r?e.performanceCaveatEmitted||n.hover&&n.hover.id[0]===r[0]&&n.hover.id[1]===r[1]||function(t,e,n,r){n.idSet&&n.idSet.has(r)&&function(t,e){return Math.min(Math.floor(t.styleZoom),a.tiles.maxDetailLevel)===e.coords[3]}(e,n)?function(t,e,n){var r=e.newMod||e.currentMod,i={tileInfo:Object(mi.e)(e.coords),pixelRatio:self.devicePixelRatio,selectedIds:(null==r?void 0:r.params.get("selectedIds"))||[],styleState:t.map.state.styleState,floorsEnabled:t.map.state.floorsEnabled,disableCommercialPoi:t.map.state.disableCommercialPoi,hoverId:n};return t.workers.parser.generateTile(i)}(t,n,r).then((function(i){so(n,e);var o={id:r,tileObjects:[]};i.results.forEach((function(r){var i=new xt("hover",r.collectorOutput.data,t.renderer,n.coords);o.tileObjects.push(i),t.tileManager.addObject(i),i.startTicker(e,a.houseHover.inAnimationType,a.houseHover.inAnimationTime,0,1)})),n.hover=o})):so(n,e)}(t,e,n,r):so(n,e)}function so(t,e){t.hover&&(t.hover.tileObjects.forEach((function(n){t.oldHoverTileObjects.push(n),n.startTicker(e,a.houseHover.outAnimationType,a.houseHover.outAnimationTime,1,0)})),t.hover=void 0)}function co(t){if(t.newMod&&t.newMod.needGenerate)return t.newMod.needGenerate=!1,t.newMod}function lo(t){return(!t.currentMod||si(t.currentMod))&&(!t.newMod||si(t.newMod))}function uo(t){t.currentMod=void 0}function fo(t){return t.currentMod&&t.currentMod.useful?t.currentMod:t.newMod&&t.newMod.useful?t.newMod:void 0}function ho(t){t.currentMod&&(t.currentMod.useful=!1),t.newMod&&(t.newMod.useful=!1)}function po(t,e,n){if(t.idSet&&e.setTileIds(t.idSet),t.currentMod||t.newMod){if(t.currentMod&&oo.equal(t.currentMod.params,e))return t.currentMod.useful=!0,void(t.newMod=void 0);t.newMod&&oo.equal(t.newMod.params,e)?t.newMod.useful=!0:mo(t,e,n)}else mo(t,e,n)}function mo(t,e,n){var r=Object(mi.i)(t.coords,e),i=n.get(r);i?(t.newMod=i,t.newMod.useful=!0):(t.newMod=function(t,e,n){return{key:e,labelsKey:t.type+"_"+e,useful:!0,ready:!1,needGenerate:!1,tile:t,status:ti.Initial,params:n.clone()}}(t,r,e),t.idSet&&t.newMod.params.setTileIds(t.idSet))}function vo(t,e,n,r){switch(t.status){case io.Initial:t.newMod&&t.newMod.useful&&(t.status=io.Loading,t.needFetch=!0);break;case io.Loading:t.newMod&&t.newMod.useful?t.serverMetadata&&(t.status=io.Loaded):(t.status=io.Initial,t.needAbortFetch=!0);break;case io.Loaded:}t.currentMod&&ci(t.currentMod,e,n,r),t.newMod&&(ci(t.newMod,e,n,r),t.newMod.needGenerate&&(t.needGenerate=!0))}function _o(t){var e,n=t.viewportTiles;for(var r in t.tiles)ho(t.tiles[r]);for(var i,o,a=new oo(t.selectedIds,null===(e=t.mapState)||void 0===e?void 0:e.styleState),s=0;s<n.length;s++){r=n[s];var c=t.tiles[r];c||(c=t.tiles[r]=(i=t.type,o=Object(mi.o)(r),{type:i,key:Object(mi.c)(o),coords:o,zoomLevel:o[2],detailLevel:o[3],needFetch:!1,needAbortFetch:!1,needGenerate:!1,status:io.Initial,oldHoverTileObjects:[]})),po(c,a,t.tileModsCache)}}function go(t,e){for(var n=0;n<e.length;n++){var r=fo(t[e[n]]);if(!r||!r.ready)return!1}return!0}function yo(t){var e=[];for(var n in t.tiles){var r=t.tiles[n];r.needFetch&&(r.needFetch=!1,e.push(r))}return e}function bo(t){var e=[];for(var n in t.tiles){var r=t.tiles[n];r.needAbortFetch&&(r.needAbortFetch=!1,e.push(r))}return e}function xo(t){var e=[];for(var n in t.tiles){var r=t.tiles[n];r.needGenerate&&(r.needGenerate=!1,e.push(r))}return e}function wo(t){var e=new Set(t.viewportTiles),n=new Set(t.tileModsCache.getData().map((function(t){return t.tile}))),r=[];for(var i in t.tiles){var o=t.tiles[i];!lo(o)||e.has(i)||t.zoomDirection!==li.Stationary||n.has(o)||r.push(o)}return r}function So(t,e,n,r,i,o,a,s,c){return{type:t,minZoomLevel:n,maxZoomLevel:r,minDetailLevel:i,maxDetailLevel:o,maxDisplayLevel:c,tiles:{},viewportTiles:[],zoomLevel:Math.floor(e),zoomDirection:li.Stationary,zoomStartZoom:0,tileModsCache:new xi(0,(function(t,e){a.labeler.removeLabels(e.labelsKey),ai(e,s)})),tileModsCacheMaxCount:0,selectedIds:[],displayedMods:{},tilesAppearance:ui.ByOne,mapState:s}}function Oo(t){for(var e in t.tiles)n=t.tiles[e],r=t.mapState,n.currentMod&&ai(n.currentMod,r),n.newMod&&ai(n.newMod,r);var n,r;t.tiles={},t.viewportTiles=[],t.zoomDirection=li.Stationary,t.tileModsCache.reset(),t.displayedMods={},t.tilesAppearance=ui.ByOne}function Mo(t,e,n,r){var i=n.displayedMods,o=Object(s.I)(i,r);o.forEach((function(n){if(void 0!==n.objects){var i=!0;for(var o in r)if(Object(mi.l)(n.tile,r[o].tile)){i=!1;break}n.objects.forEach((function(n){t.addObject(n),i&&n.startTicker(e,a.tileAnimation.type,a.tileAnimation.time,0,1)}))}}));var c=Object(s.I)(r,i);c.forEach((function(e){var n;void 0!==e.objects&&(e.objects.forEach((function(e){return t.removeObject(e)})),null===(n=e.tile.hover)||void 0===n||n.tileObjects.forEach((function(e){return t.removeObject(e)})))}));var l=o.length>0||c.length>0;return l&&(e.needLabeling=!0,e.needRerender=!0),l}function jo(t,e,n){(function(t,e){var n=Math.floor(e),r=n-t.zoomLevel;t.zoomDirection===li.Stationary&&(r>0?(t.zoomDirection=li.ZoomingIn,t.zoomStartZoom=t.zoomLevel):r<0&&(t.zoomDirection=li.ZoomingOut,t.zoomStartZoom=t.zoomLevel)),t.zoomLevel=n})(t,e.styleZoom),function(t,e){if(t.zoomLevel<t.minZoomLevel||t.maxDisplayLevel&&t.zoomLevel>t.maxDisplayLevel)t.viewportTiles=[];else{var n=Object(s.e)(t.zoomLevel,t.minZoomLevel,t.maxZoomLevel),r=Object(s.e)(t.zoomLevel,t.minDetailLevel,t.maxDetailLevel);t.viewportTiles=Object(mi.h)(e,n,r)}}(t,n),function(t){var e=Math.round((Object.keys(t.displayedMods).length+t.viewportTiles.length)*a.tiles.cacheRatio);t.tileModsCacheMaxCount<e&&(t.tileModsCacheMaxCount=e),e>t.tileModsCacheMaxCount/2&&t.tileModsCache.setSize(e)}(t),_o(t)}!function(t){t[t.Initial=0]="Initial",t[t.Loading=1]="Loading",t[t.Loaded=2]="Loaded"}(io||(io={}));var Io=n(76);function To(t){var e=t.currentMod;return void 0!==e&&e.ready}function Eo(t,e){var n=t.currentMod;return void 0!==n&&void 0!==e[n.key]}function Ao(t,e){var n=e.currentMod;void 0!==n&&(t[n.key]=n)}function Lo(t,e,n){for(var r=0,i=e;r<i.length;r++)for(var o=i[r],a=0,s=Object(mi.p)(n,o);a<s.length;a++)c=t,void 0!==(l=s[a].currentMod)&&delete c[l.key];var c,l}function Co(t,e,n){for(var r in function(t,e,n){for(var r in t.tiles)vo(t.tiles[r],t.tileModsCache,e,n)}(t,e,n),function(t){var e=t.tilesAppearance,n=t.tiles,r=t.viewportTiles;switch(e){case ui.ByOne:Po(n,r);break;case ui.WaitingAll:go(n,r)&&(t.tilesAppearance=ui.ByOne,Po(n,r))}}(t),function(t){var e=t.tiles,n=t.viewportTiles,r=t.zoomDirection,i=t.zoomStartZoom,o=t.maxZoomLevel,a=t.zoomLevel,s=t.displayedMods;switch(r){case li.Stationary:t.displayedMods=function(t,e){for(var n={},r=0,i=e;r<i.length;r++){var o=t[i[r]];To(o)&&Ao(n,o)}return n}(e,n);break;case li.ZoomingIn:t.displayedMods=function(t,e,n,r,i){for(var o={},a=[],s=0,c=e;s<c.length;s++){var l=t[c[s]];if(To(l))Ao(o,l);else for(var u=l.detailLevel-1;u>=r;u--){var d=Object(mi.q)(t,l,u,i);if(void 0!==d&&!a.includes(d)&&To(d)&&Eo(d,n)){Ao(o,d),a.push(d);break}}}return Lo(o,a,t),o}(e,n,s,i,o);break;case li.ZoomingOut:t.displayedMods=function(t,e,n,r,i,o){var a={},s=[],c=new Set(e);for(var l in t){var u=t[l];c.has(u.key)?To(u)&&(Ao(a,u),s.push(u)):u.detailLevel>i||u.detailLevel<r||c.has(Object(mi.j)(u,r,o))&&To(u)&&Eo(u,n)&&(Ao(a,u),u.detailLevel<i&&s.push(u))}return Lo(a,s,t),a}(e,n,s,a,i,o)}}(t),t.displayedMods)t.tileModsCache.get(r);(function(t){var e=t.tiles,n=t.displayedMods,r=t.viewportTiles;for(var i in e)if(!r.includes(i)){var o=e[i],a=o.currentMod;a&&!n[a.key]&&uo(o)}})(t),function(t){switch(t.zoomDirection){case li.ZoomingIn:(t.zoomLevel<=t.zoomStartZoom||ko(t))&&(t.zoomDirection=li.Stationary,t.zoomStartZoom=t.zoomLevel);break;case li.ZoomingOut:(t.zoomLevel>=t.zoomStartZoom||ko(t))&&(t.zoomDirection=li.Stationary,t.zoomStartZoom=t.zoomLevel)}}(t)}function Po(t,e){for(var n=0;n<e.length;n++)(r=t[e[n]]).newMod&&r.newMod.ready&&(r.currentMod=r.newMod,r.newMod=void 0);var r}function ko(t){for(var e=t.tiles,n=t.viewportTiles,r=t.displayedMods,i=0;i<n.length;i++){var o=fo(e[n[i]]);if(!o)return!1;if(void 0===r[o.key])return!1}return!0}function No(t,e,n,r){if(!e.disableHoverStyles)for(var i in n.tiles)ao(t,e,n.tiles[i],r)}var Ro=function(){function t(t,e,n,r,i,o){this.modules=i,this.mapState=o,this.prevStyleState=o.styleState,this.gridState=So("terrain",o.styleZoom,t,e,n,r,i,this.mapState)}return t.prototype.destroy=function(){Oo(this.gridState)},t.prototype.redraw=function(){Oo(this.gridState),jo(this.gridState,this.mapState,this.modules.tileManager.getViewportVertices())},t.prototype.getDisplayedMods=function(){var t=[];for(var e in this.gridState.displayedMods){var n=this.gridState.displayedMods[e];t.push(n)}return t},t.prototype.getSelectedIds=function(){return this.gridState.selectedIds},t.prototype.getViewportTiles=function(){for(var t=[],e=this.gridState.viewportTiles,n=0;n<e.length;n++){var r=this.gridState.tiles[e[n]];r&&t.push(r)}return t},t.prototype.viewportTilesReady=function(){return go(this.gridState.tiles,this.gridState.viewportTiles)},t.prototype.setSelectedIds=function(t){void 0===t&&(t=[]),function(t,e){t.selectedIds=e,t.tilesAppearance=ui.WaitingAll,_o(t)}(this.gridState,t)},t.prototype.setHoverId=function(t){No(this.modules,this.mapState,this.gridState,t)},t.prototype.resetHoverId=function(){No(this.modules,this.mapState,this.gridState)},t.prototype.getTileCount=function(){var t=0;for(var e in this.gridState.displayedMods){var n=this.gridState.displayedMods[e].objects;void 0!==n&&(t+=n.length)}return t},t.prototype.isBlank=function(){for(var t=0,e=this.gridState.viewportTiles;t<e.length;t++){var n=e[t],r=this.gridState.tiles[n],i=r.serverMetadata;if(void 0!==i&&0!==i.length){var o=fo(r);if(o&&o.ready)return!1}}return!0},t.prototype.updateViewport=function(t){jo(this.gridState,this.mapState,t)},t.prototype.update=function(){var t=Object(w.a)({},this.gridState.displayedMods);this.mapState.styleState!==this.prevStyleState&&(_o(this.gridState),this.prevStyleState=this.mapState.styleState),Co(this.gridState,this.mapState,this.modules),this.fetch(yo(this.gridState)),this.abortFetch(bo(this.gridState)),this.generate(xo(this.gridState)),this.clearTiles(wo(this.gridState)),Mo(this.modules.tileManager,this.mapState,this.gridState,t)},t.prototype.fetch=function(t){var e=this;t.sort((function(t,n){return Object(mi.a)(e.mapState.center,t,n)})).forEach((function(t){return function(t,e,n){var r=e.assetManager,i=e.map;e.workers.parser.fetchTile({coords:t.coords,tileServer:n.tileServer,tileSet:n.tileSet,tileProtocol:n.tileProtocol,subdomains:n.subdomains,tileKey:n.tileKey,appId:n.appId,lang:n.lang,defaultLang:n.tileServerDefaultLang,sessionId:n.sessionId}).then((function(e){if(void 0!==e){var o=e.metadata,a=e.invalidTileKey;t.status===io.Loading&&(t.serverMetadata=o),o.forEach((function(e){r.loadMetatile(e.metatileHash,e.regionId),i.emit("tileload",{tileCoords:t.coords,regionId:e.regionId}),Object(mi.m)(e.regionId)&&n.shownRegionIds.add(e.regionId)})),a&&i.emit("invalidtilekey")}}))}(t,e.modules,e.mapState)}))},t.prototype.abortFetch=function(t){var e=this;t.forEach((function(t){return e.modules.workers.parser.abortTileRequest(t.key)}))},t.prototype.generate=function(t){var e=this,n=[];t.sort((function(t,n){return Object(mi.a)(e.mapState.center,t,n)})).forEach((function(t){var r=co(t);if(r){var i={tileInfo:Object(mi.e)(t.coords),pixelRatio:self.devicePixelRatio,selectedIds:(null==r?void 0:r.params.get("selectedIds"))||[],styleState:e.mapState.styleState,floorsEnabled:e.mapState.floorsEnabled,disableCommercialPoi:e.mapState.disableCommercialPoi};n.push(i),e.modules.workers.parser.generateTile(i).then((function(n){var i,o,a=n.results;a.forEach((function(t){var n=t.styleId,r=t.metatileHash,i=t.regionId,o=t.collectorOutput,a=o.packedRasters,s=o.rastersToLoad,c=o.floorHidingMap;void 0!==a&&e.modules.assetManager.prepareRasters(n,a),e.modules.assetManager.loadRasters(s),e.modules.floorManager.prepareFloors(i,r,new Io.a(c))})),t.idSet||(t.idSet=(i=a,o=new yi.a,i.forEach((function(t){o.addFromFlatArray(t.collectorOutput.geoIds)})),o)),oi(r,a,t.idSet),e.modules.labeler.addTileLabels(r.labelsKey,Oi.b.Tile,function(t){var e=t.generatedData,n=[];if(!e)return n;for(var r=0;r<e.length;r++){var i=e[r];i.collectorOutput.labels&&n.push({metatileHash:i.metatileHash,labels:i.collectorOutput.labels,styleId:i.styleId})}return n}(r))}))}})),n.forEach((function(t){e.modules.workers.parser.generateTile(Object(w.a)(Object(w.a)({},t),{generateOnlySelectedPoi:!0})).then((function(t){t.results.forEach((function(t){var n=t.collectorOutput,r=t.styleId,i=n.packedRasters,o=n.rastersToLoad;void 0!==i&&e.modules.assetManager.prepareRasters(r,i),e.modules.assetManager.loadRasters(o)}))}))}))},t.prototype.clearTiles=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];this.modules.workers.parser.deleteTile(r.key),delete this.gridState.tiles[r.key]}},t}(),zo=l.d(),Bo=function(t){function e(n,r){var i=t.call(this,n)||this;i.options=Object(s.b)(r,e.options),i.vectors=i.options.coordinates.map((function(t){return t.map(c.l)})),i.bouncePosition=0,i.growPosition=1;var o=i.modules,l=o.renderer,u=o.tileManager,d=o.dynamicStyle,f=o.collector,h=o.layers,p={phase:i.options.phase,minZoom:i.options.minZoom,maxZoom:i.options.maxZoom,color:Object(jt.b)(i.options.color),borderColor:Object(jt.b)(i.options.borderColor),width:i.options.width,borderWidth:i.options.borderWidth,wingWidthMultiplier:i.options.wingWidthMultiplier,wingHeightMultiplier:i.options.wingHeightMultiplier,tipHeightMultiplier:i.options.tipHeightMultiplier,tipMovementAmplitude:i.options.tipMovementAmplitude,groupId:i.uniqId};i.style=d.extractCurvesFromStyle(p);for(var m=Object(jt.e)(i.style),v=i.getTileInfo(),_=0;_<i.vectors.length;_++){var g=i.vectors[_],y=i.getVertices(g,v),b=Object(jt.f)({id:[_,0]});Object(A.c)("entrance",d.getStyle(),x.a,f,m,b,y,g.length,v.coords,-1,-1)}var w=f.getAccumulatedData(),S=new xt("dynamicObject",w.data,l,v.coords,i);if(i.tileObjects.push(S),u.addObject(S),i.identifyIds.push(w.identifyIds),i.options.animate){var O="entrance-bounce-"+i.uniqId,M="entrance-grow-"+i.uniqId;i.bounceTickerUpdate=gt.bind(null,O,{step:function(t,e){return i.bouncePosition=e},complete:function(){i.bounceTickerUpdate=void 0}},i.mapState),i.growTickerUpdate=gt.bind(null,M,{step:function(t,e){return i.growPosition=e},complete:function(){i.growTickerUpdate=void 0}},i.mapState),vt(O,{easing:a.entranceAnimation.bounceType},i.mapState,-1,0,a.entranceAnimation.bounceTime),vt(M,{easing:a.entranceAnimation.growType},i.mapState,0,1,a.entranceAnimation.growTime)}else i.bouncePosition=0,i.growPosition=1;return h.addLayer(i),f.reset(),i.mapState.needRerender=!0,i}return Object(w.c)(e,t),e.prototype.update=function(){this.bounceTickerUpdate&&this.bounceTickerUpdate(),this.growTickerUpdate&&this.growTickerUpdate()},e.prototype.entranceAnimationInProgress=function(){return void 0!==this.bounceTickerUpdate||void 0!==this.growTickerUpdate},e.prototype.getTileInfo=function(){for(var t=u.e(),e=0;e<this.vectors.length;e++)for(var n=this.vectors[e],r=0;r<n.length;r++)u.f(t,n[r]);return Object(mi.e)(Object(c.d)(t))},e.prototype.getVertices=function(t,e){for(var n=[[],[],[]],r=0,i=0;i<t.length;i++){if(Object(c.k)(zo,t[i],e),n[0][i]=zo[0],n[1][i]=zo[1],0!==i){var o=n[0][i]-n[0][i-1],a=n[1][i]-n[1][i-1];r+=Math.sqrt(o*o+a*a)}n[2][i]=Math.round(r)}return n},e.options={coordinates:[],animate:!0,phase:0,minZoom:NaN,maxZoom:NaN,color:"#0085a0",borderColor:"#ffffff",width:3,borderWidth:1,wingWidthMultiplier:2,wingHeightMultiplier:.667,tipHeightMultiplier:4,tipMovementAmplitude:20},e}(j),Fo=function(){function t(t,e){this.objects=[],this.state=t,this.modules=e;var n=a.tiles.maxUniverseZoom,r=a.tiles.maxRegionalZoom,i=a.tiles.maxDetailLevel;this.universeTileLayer=new Ro(0,n,0,n,e,t),this.regionalTileLayer=new Ro(n+1,r,n+1,i,e,t),this.stateDiffer=new oe([{path:"center",type:"vec2"},{path:"zoom",type:"number"},{path:"size",type:"vec2"},{path:"rotation",type:"number"},{path:"pitch",type:"number"},{path:"padding",type:"padding"}]),this.viewportVertices=Object(c.e)(t),this.selectedIds=[]}return t.prototype.redraw=function(){this.modules.labeler.clearPreviousLabels(),this.universeTileLayer.resetHoverId(),this.regionalTileLayer.resetHoverId(),this.universeTileLayer.redraw(),this.regionalTileLayer.redraw(),this.state.needRerender=!0},t.prototype.setSelectedIds=function(t){void 0===t&&(t=[]),t.sort(mi.b),this.selectedIds=t,this.universeTileLayer.setSelectedIds(t),this.regionalTileLayer.setSelectedIds(t)},t.prototype.getSelectedIds=function(){return this.selectedIds},t.prototype.getViewportVertices=function(){return this.viewportVertices},t.prototype.getViewportTiles=function(){return this.universeTileLayer.getViewportTiles().concat(this.regionalTileLayer.getViewportTiles())},t.prototype.viewportTilesReady=function(){return this.universeTileLayer.viewportTilesReady()&&this.regionalTileLayer.viewportTilesReady()},t.prototype.getDisplayedMods=function(){return this.universeTileLayer.getDisplayedMods().concat(this.regionalTileLayer.getDisplayedMods())},t.prototype.isIdle=function(){return this.viewportTilesReady()&&!this.state.needRerender&&!this.modules.buildingHeightAnimator.isAnimating()&&!this.modules.modelManager.isAnimating()&&!this.checkEntranceAnimation()},t.prototype.update=function(){var t=this.state;this.stateDiffer.check(t)&&(this.viewportVertices=Object(c.e)(t),this.universeTileLayer.updateViewport(this.viewportVertices),this.regionalTileLayer.updateViewport(this.viewportVertices),this.modules.modelManager.findViewportModels(),t.needLabeling=!0),this.universeTileLayer.update(),this.regionalTileLayer.update(),this.updateTickers(),this.modules.modelManager.update(),t.collectStats&&(this.state.stats.tileCount=this.universeTileLayer.getTileCount()+this.regionalTileLayer.getTileCount(),this.state.stats.dynamicTileCount=this.objects.filter((function(t){return"dynamicObject"===t.purpose})).length)},t.prototype.render=function(t,e,n,r){for(var i=[],o=this.objects,a=0;a<o.length;a++){var s=o[a],c=r?s.identifyChildren:s.children;i.push.apply(i,c),s.updateMvpMatrix(n)}var l=this.modules.modelManager.objects;for(a=0;a<l.length;a++)c=r?l[a].identifyChildren:l[a].children,i.push.apply(i,c);!function(t,e,n,r,i,o){for(var a=Qi(o,n),s=0;s<a.length;s++)Zi(t,e,n,r,i,a[s])}(t,e,this.state,this.modules,n,i)},t.prototype.addObject=function(t){-1===this.objects.indexOf(t)&&(this.objects.push(t),this.state.needRerender=!0)},t.prototype.removeObject=function(t){var e=this.objects.indexOf(t);-1!==e&&(this.objects.splice(e,1),this.state.needRerender=!0)},t.prototype.destroy=function(){var t=this;this.regionalTileLayer.destroy(),this.universeTileLayer.destroy(),this.objects.forEach((function(e){return e.clean(t.state)}))},t.prototype.updateTickers=function(){var t=this;this.objects.forEach((function(e){return e.updateTicker(t.state)}))},t.prototype.checkEntranceAnimation=function(){return this.modules.layers.getLayers().some((function(t){return t instanceof Bo&&t.entranceAnimationInProgress()}))},t}(),Do=gt.bind(null,"labelingOpacity",{step:function(t,e){return t.labelingOpacity=e}}),Uo=function(){function t(t,e){this.state=t,this.modules=e,this.isLabelingInProgress=!1,this.skipHysteresisInNextLabeling=!1,this.activeLabelKeys=[],this.survivedLabelBoxes=new Set,this.worker=function(t){return{appendLabels:t.get(Ai.b.Labeling,"appendLabels"),appendLabelBox:t.get(Ai.b.Labeling,"appendLabelBox"),removeLabels:t.get(Ai.b.Labeling,"removeLabels"),processLabels:t.get(Ai.b.Labeling,"processLabels"),clearPreviousLabels:t.get(Ai.b.Labeling,"clearPreviousLabels")}}(this.modules.workers.fnRegistry),this.setLabelingInterval(a.labeling.interval)}return t.prototype.update=function(){Do(this.state),this.state.needLabeling&&!this.isLabelingInProgress&&(this.state.needLabeling=!1,this.isLabelingInProgress=!0,this.throttledUpdateLabeling())},t.prototype.isIdle=function(){return void 0===this.state.tickers.labelingOpacity&&!this.isLabelingInProgress&&!this.state.needLabeling},t.prototype.setLabelingInterval=function(t){var e=this;this.throttledUpdateLabeling=ne((function(){e.generateLabelingTile()}),t)},t.prototype.addLabels=function(t,e,n){this.worker.appendLabels(t,e,n),this.activeLabelKeys.push(t),this.state.needLabeling=!0},t.prototype.addTileLabels=function(t,e,n){this.worker.appendLabels(t,e,n),this.state.needLabeling=!0},t.prototype.addLabelBox=function(t,e){this.worker.appendLabelBox(t,e),this.state.needLabeling=!0},t.prototype.removeLabels=function(t){this.worker.removeLabels(t);var e=this.activeLabelKeys.indexOf(t);-1!==e&&this.activeLabelKeys.splice(e,1),this.state.needLabeling=!0},t.prototype.isLabelBoxSurvived=function(t){return this.survivedLabelBoxes.has(t)},t.prototype.clearPreviousLabels=function(){this.worker.clearPreviousLabels()},t.prototype.resetHysteresis=function(){this.skipHysteresisInNextLabeling=!0,this.state.needLabeling=!0},t.prototype.generateLabelingTile=function(){var t=this,e=Object(c.d)(Object(c.c)(this.state),a.labeling.tileMultiplier),n=this.modules.floorManager.getActiveFloorHiddenIds(),r=this.modules.tileManager,i=r.regionalTileLayer,o=r.universeTileLayer,l=i.getDisplayedMods().map((function(t){return t.labelsKey}));i.isBlank()&&l.push.apply(l,o.getDisplayedMods().map((function(t){return t.labelsKey})));var u=Object(w.a)(Object(w.a)({},Object(s.v)(this.state,["center","zoom","styleZoom","rotation","size","pitch","promoMode","viewport","padding"])),{buildingHeight:this.modules.buildingHeightAnimator.getDefaultBuildingHeight()});this.worker.processLabels(Object(w.e)(l,this.activeLabelKeys),u,Object(mi.e)(e),window.devicePixelRatio,n,a.labeling.commercialMargins,this.skipHysteresisInNextLabeling).then((function(n){t.survivedLabelBoxes.clear(),n.survivedLabelBoxIds.forEach((function(e){return t.survivedLabelBoxes.add(e)})),t.labelTile&&(t.modules.tileManager.removeObject(t.labelTile),t.labelTile.clean(t.state)),t.modules.assetManager.loadRasters(n.collectorOutput.rastersToLoad),t.labelTile=new xt("labeling",n.collectorOutput.data,t.modules.renderer,e),t.modules.tileManager.addObject(t.labelTile);var r=a.labeling,i=r.animationTime,o=r.animationType,s=r.interval;vt("labelingOpacity",{easing:o},t.state,0,1,Math.min(i,s)),t.state.needRerender=!0,t.isLabelingInProgress=!1})),this.skipHysteresisInNextLabeling=!1},t}(),Zo=10,Ho=7,Go=3,Wo=2,Vo=0,qo=4,Yo=2,Xo="#ffffff",Ko="#667799",Jo="#ffffff",Qo=5,$o=4,ta=2,ea=1,na="#667799",ra="#ffffff",ia="#00000026",oa="#66779966",aa=13,sa={start:{en:"Start",ru:"Старт"},addPoint:{en:"Add point",ru:"Добавить точку"},meter:{en:"m",ru:"м"},kilometer:{en:"km",ru:"км"}};function ca(t,e,n){return e?sa.start[n]||sa.start.en:t<1e3?t+" "+(sa.meter[n]||sa.meter.en):(t/1e3).toFixed(1)+" "+(sa.kilometer[n]||sa.kilometer.en)}function la(t,e){return'\n        <div style="font-size: '+e+'px;\n            color: #667799;\n            user-select: none;\n            font-family: SuisseIntl, Helvetica, Arial, sans-serif;\n            text-shadow: 1px 0px 1px #fff, -1px 0px 1px #fff, 0px 1px 1px #fff, 0px -1px 1px #fff;\n            white-space: nowrap;\n            cursor: pointer;\n        ">\n            '+t+"\n        </div>\n    "}function ua(t,e,n,r){return new It(r,{coordinates:t,interactive:n,draggable:n,width:e?Ho:Vo,borderWidth:e?Go:qo,border2Width:e?Wo:Yo,color:Xo,borderColor:Ko,border2Color:Jo,phase:Zo})}function da(t,e,n){return new us(n,{coordinates:t,phase:Qo,phase2:Qo-1,phase3:Qo-2,width:$o,width2:e?0:$o+2*ta,width3:e?0:$o+2*(ta+ea),color:e?oa:na,color2:ra,color3:ia,interactive:!e})}var fa=function(t){function e(e,n,r,i){var o=t.call(this)||this;o.markerOrLabelMouseover=function(){o.markerOrLabelHovered||(o.markerOrLabelHovered=!0,void 0===o.hoverTimer&&o.emit("mouseover"))},o.markerOrLabelMouseout=function(){o.markerOrLabelHovered&&(o.markerOrLabelHovered=!1,o.hoverTimer=window.setTimeout((function(){o.markerOrLabelHovered||(o.emit("mouseout"),o.hoverTimer=void 0)}),100))},o.onClick=function(){return o.emit("click")},o.labelText=ca(i,r,e.state.lang),o.point=n,o.distance=i,o.label=function(t,e,n){var r=la(e,aa),i=function(t,e){return.55*e*t.length}(e,aa);return new Ci(n,{coordinates:t,html:r,offset:[(Ho+Go+Wo)/2+2,-aa/2-2],labeling:{type:"full",width:i,height:aa},animate:!1,zIndex:Qo+1})}(n,o.labelText,e),o.marker=ua(n,r,!0,e),o.markerOrLabelHovered=!1;var a=o.label.dangerouslyGetRootElement();return a.addEventListener("mouseover",o.markerOrLabelMouseover),a.addEventListener("mouseout",o.markerOrLabelMouseout),a.addEventListener("click",o.onClick),o.marker.on("mouseover",(function(){return o.markerOrLabelMouseover()})),o.marker.on("mouseout",(function(){return o.markerOrLabelMouseout()})),o.marker.on("dragstart",(function(t){return o.emit("dragstart",t)})),o.marker.on("dragend",(function(t){return o.emit("dragend",t)})),o}return Object(w.c)(e,t),e.prototype.getDistance=function(){return this.distance},e.prototype.getPoint=function(){return this.point},e.prototype.getMarkerUniqId=function(){return this.marker.uniqId},e.prototype.getLabelUniqId=function(){return this.label.uniqId},e.prototype.setPoint=function(t){this.point=t},e.prototype.remove=function(){this.marker.remove();var t=this.label.dangerouslyGetRootElement();t.removeEventListener("mouseover",this.markerOrLabelMouseover),t.removeEventListener("mouseout",this.markerOrLabelMouseout),t.removeEventListener("click",this.onClick),this.label.destroy()},e.prototype.activateHover=function(){this.label.setContent('\n        <img style="\n            user-select: none;\n            width: 24px;\n            height: 24px;\n            margin-top: -4px;\n            cursor: pointer;\n        " src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjIiIGhlaWdodD0iMjIiPjxkZWZzPjxwYXRoIGlkPSJBIiBkPSJNMTIgMTAuNTg2bDMuNzkzLTMuNzkzIDEuNDE0IDEuNDE0TDEzLjQxNCAxMmwzLjc5MyAzLjc5My0xLjQxNCAxLjQxNEwxMiAxMy40MTRsLTMuNzkzIDMuNzkzLTEuNDE0LTEuNDE0TDEwLjU4NiAxMiA2Ljc5MyA4LjIwN2wxLjQxNC0xLjQxNEwxMiAxMC41ODZ6Ii8+PC9kZWZzPjxnIGZpbGwtcnVsZT0iZXZlbm9kZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEgLTEpIj48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMC41IiBmaWxsPSIjZmZmIiBzdHJva2U9IiMwMDAiIHN0cm9rZS1vcGFjaXR5PSIuMTUiLz48bWFzayBpZD0iQiIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjQSIvPjwvbWFzaz48dXNlIGZpbGw9IiMwMDAiIGZpbGwtcnVsZT0ibm9uemVybyIgeGxpbms6aHJlZj0iI0EiLz48ZyBmaWxsPSIjMjYyNjI2IiBtYXNrPSJ1cmwoI0IpIj48cGF0aCBkPSJNMCAwaDI0djI0SDB6Ii8+PC9nPjwvZz48L3N2Zz4=" alt="close">\n    ')},e.prototype.deactivateHover=function(){this.label.setContent(la(this.labelText,aa))},e}(S.a),ha=function(){function t(t,e){var n=this;this.onDocumentMouseMove=function(t){n.mousePos=m(n.modules.layout.rootContainer,t.clientX,t.clientY),n.needsUpdate=!0},this.modules=e,this.state=t,this.joints=[],this.enabled=!1,this.needsUpdate=!1,this.hidePreviewLine=!1,this.hideMouseElem=!1,this.mousePos=[0,0],document.addEventListener("mousemove",this.onDocumentMouseMove),this.langDiffer=new oe([{path:"lang",type:"string"}])}return t.prototype.destroy=function(){document.removeEventListener("mousemove",this.onDocumentMouseMove)},t.prototype.enable=function(){this.enabled||(this.enabled=!0,this.state.identifyPickDistance=2*a.identify.pickDistance,this.popup=new Ci(this.modules.map,{coordinates:[0,0],html:"",interactive:!1,animate:!1,zIndex:1}))},t.prototype.disable=function(){this.enabled=!1,this.reset(),void 0!==this.mouseElem&&(this.mouseElem.remove(),this.mouseElem=void 0),this.state.identifyPickDistance=a.identify.pickDistance,this.popup&&(this.popup.destroy(),this.popup=void 0)},t.prototype.update=function(){this.enabled&&(this.langDiffer.check(this.state)&&this.recalculate(),this.needsUpdate&&(this.needsUpdate=!1,this.drawMousePoint(),this.drawPreviewLine()))},t.prototype.setPoints=function(t){var e=this;this.reset(),t.forEach((function(t){return e.addPointToEnd(t)})),this.drawPolyline(),this.sendRulerChangeEvent(!1)},t.prototype.handleClick=function(t,e){var n=this.getJointByUniqId(e&&e.dynamicObjectId);if(n){var r=this.getJointIndexByReferer(n);void 0!==r&&(n.remove(),this.joints.splice(r,1),this.recalculate(),this.hidePreviewLine=!1,this.hideMouseElem=!1),this.popup&&this.popup.setContent("")}else if(e&&this.polyline&&this.polyline.uniqId===e.dynamicObjectId){var i=this.polyline.snapPoint(t.point),o=this.getJointIndexByDistance(i.distance),a=this.createJoint(i.point,!1,i.distance);this.joints.splice(o,0,a),this.hidePreviewLine=!0,this.hideMouseElem=!0,this.drawPolyline(),this.sendRulerChangeEvent(!0),this.popup&&this.popup.setContent("")}else this.addPointToEnd(t.lngLat),this.drawPolyline(),this.sendRulerChangeEvent(!0)},t.prototype.recalculate=function(){var t=this,e=[];this.joints.forEach((function(n,r){n.remove();var i=0===r,o=0;if(!i){var a=e[r-1];o=a.getDistance()+Object(c.a)(a.getPoint(),n.getPoint())}var s=t.createJoint(n.getPoint(),i,o);e.push(s)})),this.joints=e,this.drawPolyline(),this.sendRulerChangeEvent(!0)},t.prototype.sendRulerChangeEvent=function(t){this.modules.map.emit("rulerchange",{points:this.getPoints(),isUser:t})},t.prototype.getJointByUniqId=function(t){if(void 0!==t)for(var e=0,n=this.joints;e<n.length;e++){var r=n[e];if(t===r.getMarkerUniqId()||t===r.getLabelUniqId())return r}},t.prototype.getJointIndexByDistance=function(t){for(var e=0,n=0,r=this.joints;n<r.length&&!(t<r[n].getDistance());n++)e++;return e},t.prototype.getJointIndexByReferer=function(t){for(var e=0,n=0,r=this.joints;n<r.length;n++){if(r[n]===t)return e;e++}},t.prototype.getPoints=function(){return this.joints.map((function(t){return t.getPoint()}))},t.prototype.reset=function(){this.joints.forEach((function(t){return t.remove()})),this.joints=[],void 0!==this.polyline&&(this.polyline.remove(),this.polyline=void 0),void 0!==this.previewLine&&(this.previewLine.remove(),this.previewLine=void 0),this.hidePreviewLine=!1,this.hideMouseElem=!1,this.popup&&this.popup.setContent("")},t.prototype.createJoint=function(t,e,n){var r=this,i=new fa(this.modules.map,t,e,n);return i.on("mouseover",(function(){void 0===r.draggableJointIndex&&(r.requestUpdate(!0,!0),i.activateHover())})),i.on("mouseout",(function(){void 0===r.draggableJointIndex&&(r.requestUpdate(!1,!0),i.deactivateHover())})),i.on("dragstart",(function(){r.requestUpdate(!1,!0),r.draggableJointIndex=r.getJointIndexByReferer(i)})),i.on("dragend",(function(t){r.requestUpdate(!1,!0),r.draggableJointIndex=void 0,i.setPoint(t.lngLat),r.recalculate()})),i.on("click",(function(){var t=r.getJointIndexByReferer(i);void 0!==t&&(i.remove(),r.joints.splice(t,1),r.recalculate(),r.hidePreviewLine=!1,r.hideMouseElem=!1),r.popup&&r.popup.setContent("")})),i},t.prototype.addPointToEnd=function(t){var e=!0,n=0;if(this.joints.length>0){e=!1;var r=this.joints[this.joints.length-1];n=r.getDistance()+Object(c.a)(r.getPoint(),t)}var i=this.createJoint(t,e,n);this.joints.push(i)},t.prototype.drawPolyline=function(){var t=this;void 0!==this.polyline&&(this.polyline.remove(),this.polyline=void 0);var e=this.getPoints();if(!(e.length<2)){var n=da(e,!1,this.modules.map);n.on("mousemove",(function(e){if(void 0===t.draggableJointIndex){if(t.popup){var r=n.snapPoint(e.point),i=ca(r.distance,!1,t.state.lang);t.popup.setPosition(r.point),t.popup.setContent(function(t,e){return'\n        <div style="text-shadow: 1px 0px 1px #fff, -1px 0px 1px #fff, 0px 1px 1px #fff, 0px -1px 1px #fff;\n            user-select: none;\n            color: #667799;\n            font-family: SuisseIntl, Helvetica, Arial, sans-serif;\n            font-size: 13px;\n            margin: -12px 0 0 12px; /** отступы от точки наведения */\n            white-space: nowrap;\n            cursor: pointer;\n        ">\n            '+t+"\n            <br>\n            "+function(t){return sa.addPoint[t]||sa.addPoint.en}(e)+"\n        </div>\n    "}(i,t.state.lang)),t.snapPoint=r.point}t.requestUpdate(!0,!1)}})),n.on("mouseout",(function(){void 0===t.draggableJointIndex&&(t.popup&&t.popup.setContent(""),t.requestUpdate(!1,!0))})),this.polyline=n}},t.prototype.requestUpdate=function(t,e){this.hidePreviewLine=t,this.hideMouseElem=e,this.needsUpdate=!0},t.prototype.getPreviewPoints=function(){var t=this.getPoints();if(this.hidePreviewLine||t.length<1)return[];var e=this.draggableJointIndex,n=Object(c.m)(Object(s.A)(this.state,this.mousePos));if(void 0===e||1===t.length)return[];if(e===this.joints.length-1)return[t[t.length-2],n];if(0===e)return[t[1],n];var r=this.joints[e-1],i=this.joints[e+1];return[r.getPoint(),n,i.getPoint()]},t.prototype.drawPreviewLine=function(){void 0!==this.previewLine&&(this.previewLine.remove(),this.previewLine=void 0);var t=this.getPreviewPoints();t.length<1||(this.previewLine=da(t,!0,this.modules.map))},t.prototype.drawMousePoint=function(){void 0!==this.mouseElem&&(this.mouseElem.remove(),this.mouseElem=void 0),this.hideMouseElem||void 0===this.snapPoint||(this.mouseElem=ua(this.snapPoint,!0,!1,this.modules.map))},t}(),pa=function(){function t(t,e,n){this.type=t,this.handler=n,this.mouseDownPoint=e,this.handler.mapState.userHasInteracted=!0,this.handler.modules.map.emit("interactionstart",{target:"pitch/rotation"})}return t.prototype.processAction=function(t){switch(t.type){case"mousemove":return this.processMouseMoveAction(t);case"mouseup":return this.processMouseUpAction(t);case"keyup":return this.processKeyUpAction(t);default:return this}},t.prototype.processMouseMoveAction=function(t){var e=m(this.handler.container,t.clientX,t.clientY);return new ma(this.type,this.mouseDownPoint,e,this.handler)},t.prototype.processMouseUpAction=function(t){var e=this;switch(this.type){case"keyPrimary":if(0===t.button&&(t.ctrlKey||t.metaKey))return this.returnToInitialState();break;case"secondary":if(2===t.button){var n=m(this.handler.container,t.clientX,t.clientY),r={originalEvent:t,lngLat:Object(c.m)(Object(s.A)(this.handler.mapState,n)),point:n};return this.handler.modules.identifier.search("contextmenu",n,!0).then((function(t){r.target=Ot(t),ce("contextmenu",t,r,e.handler.modules)})),this.returnToInitialState()}break;case"auxiliary":if(1===t.button)return this.returnToInitialState()}return this},t.prototype.processKeyUpAction=function(t){return"keyPrimary"!==this.type||"Control"!==t.key&&"Meta"!==t.key?this:(this.handler.modules.map.emit("interactionend",{target:"pitch/rotation"}),new va(this.mouseDownPoint,this.handler))},t.prototype.returnToInitialState=function(){return this.handler.mapState.userHasInteracted=!0,this.handler.modules.map.emit("interactionend",{target:"pitch/rotation"}),new Oa(this.handler)},t}(),ma=function(){function t(t,e,n,r){this.type=t,this.mouseDownPoint=e,this.mouseMovePoint=n,this.handler=r,this.handler.mapState.userHasInteracted=!0,this.handler.mapState.disablePitchByUserInteraction&&this.handler.mapState.disableRotationByUserInteraction||this.handler.container.classList.add("mapgl-rotating"),this.update(this.handler.mapState)}return t.prototype.processAction=function(t){switch(t.type){case"mousemove":return this.processMouseMoveAction(t);case"mouseleave":return this.returnToInitialState();case"mouseup":return this.processMouseUpAction(t);case"keyup":return this.processKeyUpAction(t);default:return this}},t.prototype.update=function(t){0===this.mouseDownPoint[0]&&0===this.mouseDownPoint[1]&&(this.mouseDownPoint=this.mouseMovePoint);var e=Object(s.u)(t.size,this.mouseDownPoint),n=Object(s.u)(t.size,this.mouseMovePoint),r=(e[0]-n[0])*a.zoom.mouseRotateDelta,i=(n[1]-e[1])*a.zoom.mousePitchDelta;re(t),t.disableRotationByUserInteraction||Bt(t,t.rotation+r,{animate:!1}),t.disablePitchByUserInteraction||Zt(t,Object(s.e)(t.pitch+i,t.minPitch,t.maxPitch),{animate:!1}),this.mouseDownPoint=this.mouseMovePoint,t.needRerender=!0},t.prototype.processMouseMoveAction=function(t){return this.mouseMovePoint=m(this.handler.container,t.clientX,t.clientY),this.handler.mapState.userHasInteracted=!0,this.update(this.handler.mapState),this},t.prototype.processMouseUpAction=function(t){switch(this.type){case"keyPrimary":if(0===t.button&&(t.ctrlKey||t.metaKey))return this.returnToInitialState();break;case"secondary":if(2===t.button)return this.returnToInitialState();break;case"auxiliary":if(1===t.button)return this.returnToInitialState()}return this},t.prototype.processKeyUpAction=function(t){return"keyPrimary"!==this.type||"Control"!==t.key&&"Meta"!==t.key?this:(this.handler.container.classList.remove("mapgl-rotating"),this.handler.modules.map.emit("interactionend",{target:"pitch/rotation"}),new va(this.mouseMovePoint,this.handler))},t.prototype.returnToInitialState=function(){return this.handler.mapState.userHasInteracted=!0,this.handler.container.classList.remove("mapgl-rotating"),this.handler.modules.map.emit("interactionend",{target:"pitch/rotation"}),new Oa(this.handler)},t}(),va=function(){function t(t,e){this.handler=e,this.toInitialOnMouseUp=!1,this.mouseDownPoint=t,this.dragStartPoint=t,this.isTimerStarted=void 0!==this.handler.dblClickTimer,this.handler.mapState.userHasInteracted=!0,this.handler.modules.map.emit("interactionstart",{target:"center"}),this.isTimerStarted&&(window.clearTimeout(this.handler.dblClickTimer),this.handler.dblClickTimer=void 0)}return t.prototype.processAction=function(t){switch(t.type){case"mousedown":return this.toInitialOnMouseUp=!0,this;case"mouseup":return this.processMouseUpAction(t);case"mousemove":return this.processMouseMoveAction(t);case"click":return this.processMouseClickAction(t);case"keydown":return this.processKeyDownAction(t);default:return this}},t.prototype.processMouseUpAction=function(t){return 0!==t.button||!this.toInitialOnMouseUp&&this.handler.modules.layout.isActionWithCanvas(t)?this:(this.handler.mapState.userHasInteracted=!0,this.handler.modules.map.emit("interactionend",{target:"center"}),new Oa(this.handler))},t.prototype.processMouseMoveAction=function(t){var e=m(this.handler.container,t.clientX,t.clientY);return T.f(this.mouseDownPoint,e)<a.events.dragThreshold?(this.dragStartPoint=e,this):new _a(e,this.dragStartPoint,this.handler)},t.prototype.processMouseClickAction=function(t){var e=this;if(!this.handler.modules.layout.isActionWithCanvas(t))return this;if(this.isTimerStarted){if(this.handler.mapState.zoom<this.handler.mapState.maxZoom){var n=this.handler.mapState,r=Math.min(n.zoom+1,n.maxZoom),i=m(this.handler.container,t.clientX,t.clientY);re(n),Wt(n,r,{duration:a.zoom.animDuration,zoomPoint:i,blockBuildingAnimation:!0}),this.handler.mapState.needRerender=!0}}else{var o=m(this.handler.container,t.clientX,t.clientY),l={originalEvent:t,lngLat:Object(c.m)(Object(s.A)(this.handler.mapState,o)),point:o};this.handler.modules.identifier.search("mouseClick",o,!0).then((function(t){l.target=Ot(t);var n=e.handler.modules.ruler;n.enabled?n.handleClick(l,t):e.handler.dblClickTimer||(e.handler.dblClickTimer=window.setTimeout((function(){ce("click",t,l,e.handler.modules),e.handler.dblClickTimer=void 0}),a.events.doubleClickTime))}))}return this.handler.mapState.userHasInteracted=!0,this.handler.modules.map.emit("interactionend",{target:"center"}),new Oa(this.handler)},t.prototype.processKeyDownAction=function(t){return"Control"===t.key||"Meta"===t.key?(this.handler.modules.map.emit("interactionend",{target:"center"}),new pa("keyPrimary",this.mouseDownPoint,this.handler)):this},t}(),_a=function(){function t(t,e,n){this.mouseMovePoint=t,this.dragStartPoint=e,this.handler=n,this.handler.container.classList.add("mapgl-dragging"),this.handler.mapState.userHasInteracted=!0,this.update(this.handler.mapState)}return t.prototype.processAction=function(t){switch(t.type){case"mousemove":return this.processMouseMoveAction(t);case"mouseup":return this.processMouseUpAction(t);case"keydown":return this.processKeyDownAction(t);default:return this}},t.prototype.update=function(t){var e=Object(s.A)(t,this.dragStartPoint),n=Object(s.A)(t,this.mouseMovePoint),r=l.b(t.center);l.a(r,r,e),l.r(r,r,n),re(t),Pt(t,r,{animate:!1}),this.dragStartPoint=this.mouseMovePoint,t.needRerender=!0},t.prototype.processMouseMoveAction=function(t){return this.mouseMovePoint=m(this.handler.container,t.clientX,t.clientY),this.handler.mapState.userHasInteracted=!0,this.update(this.handler.mapState),this},t.prototype.processMouseUpAction=function(t){return 0===t.button?this.returnToInitialState():this},t.prototype.processKeyDownAction=function(t){return"Control"===t.key||"Meta"===t.key?(this.handler.container.classList.remove("mapgl-dragging"),this.handler.modules.map.emit("interactionend",{target:"center"}),new pa("keyPrimary",this.mouseMovePoint,this.handler)):this},t.prototype.returnToInitialState=function(){return this.handler.container.classList.remove("mapgl-dragging"),this.handler.modules.map.emit("interactionend",{target:"center"}),this.handler.mapState.userHasInteracted=!0,new Oa(this.handler)},t}(),ga=function(){function t(t,e,n){this.handler=n,this.touchStartPoints=e,this.touchMovePoints=t,this.handler.mapState.userHasInteracted=!0,this.handler.mapState.disablePitchByUserInteraction||this.handler.container.classList.add("mapgl-rotating"),this.update(this.handler.mapState)}return t.prototype.processAction=function(t){switch(t.type){case"touchstart":return this.processTouchStartAction(t);case"touchmove":return this.processTouchMoveAction(t);case"touchend":return this.processTouchEndAction(t);default:return this}},t.prototype.processTouchStartAction=function(t){return this.handler.container.classList.remove("mapgl-rotating"),this.handler.modules.map.emit("interactionend",{target:"pitch/zoom/rotation"}),new xa(t,this.handler,!1)},t.prototype.processTouchMoveAction=function(t){return t.preventDefault(),this.touchMovePoints=v(t.touches,this.handler.container),this.handler.mapState.userHasInteracted=!0,this.update(this.handler.mapState),this},t.prototype.processTouchEndAction=function(t){return this.handler.container.classList.remove("mapgl-rotating"),this.handler.modules.map.emit("interactionend",{target:"pitch/zoom/rotation"}),0===t.touches.length?(this.handler.mapState.userHasInteracted=!0,new Oa(this.handler)):new xa(t,this.handler,!1)},t}(),ya=function(t){function e(e,n,r){return t.call(this,e,n,r)||this}return Object(w.c)(e,t),e.prototype.update=function(t){if(!(this.touchStartPoints.length<2||this.touchMovePoints.length<2)){var e=Object(d.e)(this.touchMovePoints[0],this.touchMovePoints[1]),n=T.e(this.touchMovePoints[0],this.touchMovePoints[1])/T.e(this.touchStartPoints[0],this.touchStartPoints[1]),r=t.zoom+Math.log(n)/Math.log(2)*a.zoom.mobilePinchDelta,i=Object(s.A)(t,this.touchStartPoints[0]),o=Object(s.A)(t,this.touchStartPoints[1]),c=Object(s.A)(t,this.touchMovePoints[0]),u=Object(s.A)(t,this.touchMovePoints[1]),f=0;i&&o&&c&&u&&(f=Object(d.b)(i,o)-Object(d.b)(c,u));var h=t.rotation+f,p=l.d();l.a(p,t.center,Object(s.k)(t,e,{zoom:r,rotation:h})),re(t),Pt(t,p,{animate:!1}),Wt(t,r,{animate:!1}),this.handler.mapState.disableRotationByUserInteraction||Bt(t,h,{animate:!1}),this.touchStartPoints=this.touchMovePoints,t.needRerender=!0}},e}(ga),ba=function(t){function e(e,n,r){return t.call(this,e,n,r)||this}return Object(w.c)(e,t),e.prototype.update=function(t){var e=this.touchStartPoints.map((function(e){return Object(s.u)(t.size,e)})),n=this.touchMovePoints.map((function(e){return Object(s.u)(t.size,e)})),r=Object(d.e)(e[0],e[1]),i=(Object(d.e)(n[0],n[1])[1]-r[1])*a.zoom.mousePitchDelta;re(t),Zt(t,Object(s.e)(t.pitch+i,t.minPitch,t.maxPitch),{animate:!1}),this.touchStartPoints=this.touchMovePoints,t.needRerender=!0},e}(ga),xa=function(){function t(t,e,n){this.handler=e,this.needClickOnTouchEnd=n,this.toZoomRotate=!1,this.touchStartPoints=v(t.touches,this.handler.container),this.handler.mapState.userHasInteracted=!0,this.isTimerStarted=void 0!==this.handler.dblClickTimer,_(t)?this.handler.modules.map.emit("interactionstart",{target:"pitch/zoom/rotation"}):this.isTimerStarted?(this.handler.modules.map.emit("interactionstart",{target:"zoom/rotation"}),window.clearTimeout(this.handler.dblClickTimer),this.handler.dblClickTimer=void 0):this.handler.modules.map.emit("interactionstart",{target:"center"})}return t.prototype.processAction=function(t){switch(t.type){case"touchstart":return this.processTouchStartAction(t);case"touchmove":return this.processTouchMoveAction(t);case"touchend":return this.processTouchEndAction(t);default:return this}},t.prototype.processTouchStartAction=function(t){return t.preventDefault(),1===this.touchStartPoints.length&&(this.needClickOnTouchEnd=!1,this.handler.modules.map.emit("interactionend",{target:"center"}),this.handler.modules.map.emit("interactionstart",{target:"pitch/zoom/rotation"}),this.handler.mapState.userHasInteracted=!0),this.touchStartPoints=v(t.touches,this.handler.container),this},t.prototype.processTouchMoveAction=function(t){var e=this;t.preventDefault();var n=v(t.touches,this.handler.container);if(!_(t))return T.f(this.touchStartPoints[0],n[0])<a.events.dragThreshold?(this.touchStartPoints=n,this):this.isTimerStarted?new Sa(n[0],this.touchStartPoints[0],this.handler):new wa(n[0],this.touchStartPoints[0],this.handler);if(this.touchStartPoints.length<2)return this.processTouchStartAction(t);var r=T.d(),i=T.d();T.p(r,n[0],this.touchStartPoints[0]),T.p(i,n[1],this.touchStartPoints[1]);var o=T.g(r,i);if(o>0){var s=T.f(this.touchStartPoints[0],n[0]),c=T.f(this.touchStartPoints[1],n[1]);return s<a.events.pitchThreshold||c<a.events.pitchThreshold?(this.touchStartPoints=n,this):this.handler.mapState.disablePitchByUserInteraction?this:new ba(n,this.touchStartPoints,this.handler)}return o<0?new ya(n,this.touchStartPoints,this.handler):Object(d.k)(r)||Object(d.k)(i)?this.pitchWaitingTimer?this:this.toZoomRotate?(this.toZoomRotate=!1,new ya(n,this.touchStartPoints,this.handler)):(this.pitchWaitingTimer=window.setTimeout((function(){e.toZoomRotate=!0,e.pitchWaitingTimer=void 0}),a.events.pitchWaitingTime),this):new ya(n,this.touchStartPoints,this.handler)},t.prototype.processTouchEndAction=function(t){return t.cancelable&&t.preventDefault(),0===t.touches.length?1===t.changedTouches.length&&this.needClickOnTouchEnd?this.processTouchClickAction(this.touchStartPoints[0],t):(this.handler.mapState.userHasInteracted=!0,this.handler.modules.map.emit("interactionend",{target:t.changedTouches.length>1?"pitch/zoom/rotation":"center"}),new Oa(this.handler)):(_(t)||(this.handler.modules.map.emit("interactionend",{target:"pitch/zoom/rotation"}),this.handler.modules.map.emit("interactionstart",{target:"center"}),this.handler.mapState.userHasInteracted=!0),this.touchStartPoints=v(t.touches,this.handler.container),this)},t.prototype.processTouchClickAction=function(t,e){var n=this;if(this.isTimerStarted){if(this.handler.mapState.zoom<this.handler.mapState.maxZoom){var r=this.handler.mapState,i=Math.min(r.zoom+1,r.maxZoom),o=t;re(r),Wt(r,i,{duration:a.zoom.animDuration,zoomPoint:o,blockBuildingAnimation:!0}),this.handler.mapState.needRerender=!0}}else if(this.handler.modules.layout.isActionWithCanvas(e)){var l={originalEvent:e,lngLat:Object(c.m)(Object(s.A)(this.handler.mapState,t)),point:t};this.handler.modules.identifier.search("mouseClick",t,!0).then((function(t){l.target=Ot(t);var e=n.handler.modules.ruler;e.enabled?e.handleClick(l,t):n.handler.dblClickTimer||(n.handler.dblClickTimer=window.setTimeout((function(){ce("click",t,l,n.handler.modules),n.handler.dblClickTimer=void 0}),a.events.doubleClickTime))}))}else{var u=e.changedTouches[0];e.target&&u&&e.target.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:u.clientX,clientY:u.clientY}))}return this.handler.mapState.userHasInteracted=!0,this.handler.modules.map.emit("interactionend",{target:"center"}),new Oa(this.handler)},t}(),wa=function(){function t(t,e,n){this.handler=n,this.touchMovePoint=t,this.touchStartPoint=e,this.handler.mapState.userHasInteracted=!0,this.handler.container.classList.add("mapgl-dragging"),this.update(this.handler.mapState)}return t.prototype.processAction=function(t){switch(t.type){case"touchstart":return this.processTouchStartAction(t);case"touchmove":return this.processTouchMoveAction(t);case"touchend":return this.processTouchEndAction();default:return this}},t.prototype.update=function(t){var e=Object(s.A)(t,this.touchStartPoint),n=Object(s.A)(t,this.touchMovePoint),r=l.b(t.center);l.a(r,r,e),l.r(r,r,n),re(t),Pt(t,r,{animate:!1}),this.touchStartPoint=this.touchMovePoint,t.needRerender=!0},t.prototype.processTouchStartAction=function(t){return this.handler.container.classList.remove("mapgl-dragging"),this.handler.modules.map.emit("interactionend",{target:"center"}),new xa(t,this.handler,!1)},t.prototype.processTouchMoveAction=function(t){t.preventDefault();var e=v(t.touches,this.handler.container);return this.touchMovePoint=e[0],this.handler.mapState.userHasInteracted=!0,this.update(this.handler.mapState),this},t.prototype.processTouchEndAction=function(){return this.handler.container.classList.remove("mapgl-dragging"),this.handler.modules.map.emit("interactionend",{target:"center"}),this.handler.mapState.userHasInteracted=!0,new Oa(this.handler)},t}(),Sa=function(){function t(t,e,n){this.handler=n,this.mapHeight=n.mapState.size[1],this.startZoom=n.mapState.zoom,this.touchMovePointY=t[1],this.touchStartPoint=e,this.handler.mapState.userHasInteracted=!0,this.update(this.handler.mapState)}return t.prototype.processAction=function(t){switch(t.type){case"touchstart":return this.processTouchStartAction(t);case"touchmove":return this.processTouchMoveAction(t);case"touchend":return this.processTouchEndAction();default:return this}},t.prototype.update=function(t){var e=this.touchMovePointY-this.touchStartPoint[1];if(0!==e){var n=e/this.mapHeight,r=Object(s.e)(this.startZoom+n*a.zoom.mobileTapDelta,t.minZoom,t.maxZoom),i=l.d();l.a(i,t.center,Object(s.k)(t,this.touchStartPoint,{zoom:r})),re(t),Pt(t,i,{animate:!1}),Wt(t,r,{animate:!1}),t.needRerender=!0}},t.prototype.processTouchStartAction=function(t){return this.handler.modules.map.emit("interactionend",{target:"zoom/rotation"}),new xa(t,this.handler,!1)},t.prototype.processTouchMoveAction=function(t){t.preventDefault();var e=v(t.touches,this.handler.container);return this.touchMovePointY=e[0][1],this.handler.mapState.userHasInteracted=!0,this.update(this.handler.mapState),this},t.prototype.processTouchEndAction=function(){return this.handler.modules.map.emit("interactionend",{target:"zoom/rotation"}),this.handler.mapState.userHasInteracted=!0,new Oa(this.handler)},t}(),Oa=function(){function t(t){this.handler=t}return t.prototype.processAction=function(t){switch(t.type){case"mousedown":return this.processMouseDownAction(t);case"touchstart":return this.processTouchStartAction(t);default:return this}},t.prototype.processMouseDownAction=function(t){var e=m(this.handler.container,t.clientX,t.clientY);switch(t.button){case 0:return t.ctrlKey||t.metaKey?new pa("keyPrimary",e,this.handler):new va(e,this.handler);case 1:return new pa("auxiliary",e,this.handler);case 2:return new pa("secondary",e,this.handler);default:return this}},t.prototype.processTouchStartAction=function(t){return t.preventDefault(),t.touches?new xa(t,this.handler,1===t.touches.length):this},t}(),Ma=function(){function t(){}return t.prototype.processAction=function(){return this},t}(),ja=function(){function t(t,e){var n=this;this.preventDefault=function(t){t.preventDefault()},this.onMouseMove=function(t){n.dblClickTimer&&(n.dblClickTimer=void 0),n.switchState(t)},this.onTouchStart=function(t){n.modules.layout.isActionWithMap(t)&&n.switchState(t)},this.switchState=function(t){n.state,n.state=n.state.processAction(t)},this.state=new Oa(this),this.mapState=t,this.modules=e,this.container=e.layout.mapContainer,document.addEventListener("mouseup",this.switchState),document.addEventListener("keydown",this.switchState),document.addEventListener("keyup",this.switchState),document.addEventListener("mouseleave",this.switchState),document.addEventListener("mousemove",this.onMouseMove),this.container.addEventListener("click",this.switchState),this.container.addEventListener("mousedown",this.switchState),this.container.addEventListener("mouseout",this.switchState),document.addEventListener("touchstart",this.onTouchStart),document.addEventListener("touchend",this.switchState),document.addEventListener("touchmove",this.switchState),this.container.addEventListener("dragstart",this.preventDefault),this.container.addEventListener("drag",this.preventDefault),this.container.addEventListener("dragend",this.preventDefault),this.container.addEventListener("contextmenu",this.preventDefault)}return t.prototype.destroy=function(){document.removeEventListener("mouseup",this.switchState),document.removeEventListener("keydown",this.switchState),document.removeEventListener("keyup",this.switchState),document.removeEventListener("mouseleave",this.switchState),document.removeEventListener("mousemove",this.onMouseMove),this.container.removeEventListener("click",this.switchState),this.container.removeEventListener("mousedown",this.switchState),this.container.removeEventListener("mouseout",this.switchState),document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchend",this.switchState),document.removeEventListener("touchmove",this.switchState),this.container.removeEventListener("dragstart",this.preventDefault),this.container.removeEventListener("drag",this.preventDefault),this.container.removeEventListener("dragend",this.preventDefault),this.container.removeEventListener("contextmenu",this.preventDefault)},t.prototype.block=function(){return this.state instanceof Ma||this.state instanceof Oa&&(this.state=new Ma,!0)},t.prototype.unblock=function(){return this.state instanceof Oa||this.state instanceof Ma&&(this.state=new Oa(this),!0)},t}(),Ia=function(){function t(t,e){this.mapState=t,this.modules=e,this.enabled=!1,this.justEnabled=!1,this.isMetaLoading=!1,this.lastUpdateTime=-1/0,this.regionIds=new Set,this.gridState=So("traffic",t.styleZoom,a.traffic.minZoom,a.traffic.maxZoom,a.traffic.minZoom,a.traffic.maxDetailLevel,e,t),this.viewportDiffer=new oe([{path:"center",type:"vec2"},{path:"zoom",type:"number"},{path:"size",type:"vec2"},{path:"rotation",type:"number"},{path:"pitch",type:"number"}])}return t.prototype.show=function(){this.enabled||(this.enabled=!0,this.justEnabled=!0,this.modules.map.emit("trafficshow"))},t.prototype.hide=function(){this.enabled&&(Oo(this.gridState),this.enabled=!1,this.modules.map.emit("traffichide"))},t.prototype.isEnabled=function(){return this.enabled},t.prototype.destroy=function(){Oo(this.gridState)},t.prototype.redraw=function(){this.enabled&&(Oo(this.gridState),jo(this.gridState,this.mapState,Object(c.e)(this.mapState)))},t.prototype.update=function(){if(this.enabled&&(Object(s.j)(this.regionIds,this.mapState.shownRegionIds)||(this.regionIds=new Set(this.mapState.shownRegionIds),this.fetchMeta()),Date.now()-this.lastUpdateTime>a.traffic.updateInterval&&this.fetchMeta(),void 0!==this.timestamp)){(this.viewportDiffer.check(this.mapState)||this.justEnabled)&&(this.justEnabled=!1,jo(this.gridState,this.mapState,Object(c.e)(this.mapState)),this.mapState.needRerender=!0);var t=Object(w.a)({},this.gridState.displayedMods);Co(this.gridState,this.mapState,this.modules),this.fetch(yo(this.gridState),this.timestamp),this.abortFetch(bo(this.gridState)),this.generate(xo(this.gridState)),this.clearTiles(wo(this.gridState)),Mo(this.modules.tileManager,this.mapState,this.gridState,t)}},t.prototype.isIdle=function(){return go(this.gridState.tiles,this.gridState.viewportTiles)},t.prototype.fetch=function(t,e){var n=this;t.sort((function(t,e){return Object(mi.a)(n.mapState.center,t,e)})).forEach((function(t){return function(t,e,n,r,i){r.size&&e.workers.parser.fetchTrafficTile({coords:t.coords,tileServer:n.trafficUrl,tileProtocol:n.tileProtocol,regionIds:Array.from(r),timestamp:i}).then((function(){t.status===io.Loading&&(t.serverMetadata=[{regionId:0,metatileHash:-2}])}))}(t,n.modules,n.mapState,n.regionIds,e)}))},t.prototype.abortFetch=function(t){var e=this;t.forEach((function(t){return e.modules.workers.parser.abortTrafficTileRequest(t.key)}))},t.prototype.generate=function(t){var e=this;t.sort((function(t,n){return Object(mi.a)(e.mapState.center,t,n)})).forEach((function(t){var n=co(t);n&&e.modules.workers.parser.generateTrafficTile({coords:t.coords,pixelRatio:window.devicePixelRatio,styleState:e.mapState.styleState}).then((function(t){var e=t.results;return oi(n,e)}))}))},t.prototype.clearTiles=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];this.modules.workers.parser.deleteTrafficTile(r.key),delete this.gridState.tiles[r.key]}},t.prototype.fetchMeta=function(){var t=this;if(!this.isMetaLoading&&this.regionIds.size){this.isMetaLoading=!0;var e=Object(s.K)(a.traffic.timestampUrl,{host:this.mapState.trafficUrl,protocol:this.mapState.tileProtocol,regions:Array.from(this.regionIds).join(",")});fetch(e).then((function(t){if(t.ok)return t.json();throw new Error("Request traffic timestamp error with status "+t.status)})).then((function(e){var n,r;if(!e.length||void 0===(null===(n=e[0])||void 0===n?void 0:n.time)||void 0===(null===(r=e[0])||void 0===r?void 0:r.score))throw new Error("Bad traffic timestamp and score response "+e);var i=0;e.forEach((function(t){return i+=t.score})),i=Math.round(i/e.length),t.modules.map.emit("trafficscore",{score:i}),t.timestamp=e[0].time,t.isMetaLoading=!1,t.lastUpdateTime=Date.now(),t.redraw()})).catch((function(t){return console.error(t)}))}},t}(),Ta=function(){function t(t){this.externalContainer=t,this.rootContainer=document.createElement("div"),this.rootContainer.style.position="relative",this.rootContainer.style.height="100%",this.rootContainer.style.width="100%",this.rootContainer.style.overflow="hidden",this.externalContainer.appendChild(this.rootContainer),this.mapContainer=document.createElement("div"),this.mapContainer.style.position="relative",this.mapContainer.style.height="100%",this.mapContainer.style.width="100%",this.mapContainer.style.touchAction="none",this.mapContainer.style.webkitUserSelect="none",this.mapContainer.style.userSelect="none",this.rootContainer.appendChild(this.mapContainer),this.canvas=document.createElement("canvas"),this.mapContainer.appendChild(this.canvas),this.htmlContainerInMap=document.createElement("div"),this.htmlContainerInMap.style.position="absolute",this.htmlContainerInMap.style.left="0",this.htmlContainerInMap.style.top="0",this.htmlContainerInMap.style.width="100%",this.htmlContainerInMap.style.height="0",this.htmlContainerInMap.style.webkitUserSelect="auto",this.htmlContainerInMap.style.userSelect="auto",this.mapContainer.appendChild(this.htmlContainerInMap),this.htmlContainerOutMap=document.createElement("div"),this.htmlContainerOutMap.style.position="absolute",this.htmlContainerOutMap.style.left="0",this.htmlContainerOutMap.style.top="0",this.htmlContainerOutMap.style.width="100%",this.htmlContainerOutMap.style.height="0",this.mapContainer.after(this.htmlContainerOutMap)}return t.prototype.setCanvasSize=function(t,e){var n=window.devicePixelRatio;return this.canvas.width=t*n,this.canvas.height=e*n,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this},t.prototype.destroy=function(){for(;this.externalContainer.lastChild;)this.externalContainer.removeChild(this.externalContainer.lastChild)},t.prototype.isActionWithCanvas=function(t){return t.target===this.canvas},t.prototype.isActionWithMap=function(t){var e=this;return t instanceof MouseEvent||t instanceof KeyboardEvent?this.isTargetInMap(t.target):Array.from(t.touches).map((function(t){return t.target})).some((function(t){return e.isTargetInMap(t)}))},t.prototype.isTargetInMap=function(t){return!!(t&&t instanceof Node)&&this.mapContainer.contains(t)},t}(),Ea=n(13);function Aa(){var t=new Ea.a(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function La(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Ca(){var t=new Ea.a(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}tn.b,tn.g,tn.c,tn.l,tn.a,tn.k,tn.d,tn.i,tn.h,tn.m,tn.j;var Pa=(tn.f,tn.e,l.d(),l.i(1,0,0),l.i(0,1,0),Ca(),Ca(),Aa(),function(){function t(){this.children=[],this.parent=null,this.visible=!0,this.scale=l.i(1,1,1),this.position=l.d(),this.quaternion=Ca(),this.localMatrix=E.b(),this.worldMatrix=E.b(),this.worldMatrixNeedsUpdate=!1,this.type=12}return t.prototype.add=function(t){return t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),this},t.prototype.remove=function(t){var e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1)),this},t.prototype.render=function(){return this.visible?(this.worldMatrixNeedsUpdate&&this.updateWorldMatrix(),this):this},t.prototype.updateLocalMatrix=function(){return E.c(this.localMatrix,this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0,this},t.prototype.updateWorldMatrix=function(){return this.parent?E.g(this.worldMatrix,this.parent.worldMatrix,this.localMatrix):E.a(this.worldMatrix,this.localMatrix),this.children.forEach((function(t){return t.updateWorldMatrix()})),this.worldMatrixNeedsUpdate=!1,this},t.prototype.getWorldPosition=function(){return l.i(this.worldMatrix[12],this.worldMatrix[13],this.worldMatrix[14])},t.prototype.traverse=function(t){return t(this),this.children.forEach((function(e){return e.traverse(t)})),this},t.prototype.traverseVisible=function(t){return this.visible?(t(this),this.children.forEach((function(e){return e.traverseVisible(t)})),this):this},t.prototype.typifyForRender=function(t){return this.visible?(t[17].addObject(this),this.children.forEach((function(e){return e.typifyForRender(t)})),this):this},t}()),ka=function(t){function e(e){var n=t.call(this)||this;return n.color=e,n}return Object(w.c)(e,t),e}(Pa),Na=(function(t){Object(w.c)((function(e){var n=t.call(this,e)||this;return n.type=3,n}),t)}(ka),{texture:"USE_TEXTURE",directionLights:"DIR_LIGHT_NUM"}),Ra={},za=function(){function t(){this._attributes=[],this._uniforms=[{name:"uColorAlpha",type:"1f"}],this._definitions=[],this._shader=null,this.opacity=1}return t.prototype.enable=function(t){return this._shaderProgram||this._prepare(t),this._shaderProgram.enable(t.gl),this._shaderProgramBind(t),this},t.prototype.disable=function(t){return this._shaderProgram&&this._shaderProgram.disable(t),this},t.prototype.define=function(t,e){return Na[t]&&this._definitions.push({type:Na[t],value:e}),this},t.prototype.typifyForRender=function(t,e){1===this.opacity?t[13].addObject(e):t[14].addObject(e)},t.prototype._getCachedProgramKey=function(){var t=this.constructor.name;return this._definitions.forEach((function(e){t+=":"+e.type+":"+(e.value||"")})),t},t.prototype._getCachedProgram=function(){return Ra[this._getCachedProgramKey()]},t.prototype._prepare=function(t){var e=this._getCachedProgram();e&&t===e.glContext?this._shaderProgram=e.program:(this._shaderProgram=new Dr({vertex:new qr("vertex",this._shader.vertex,this._definitions),fragment:new qr("fragment",this._shader.fragment,this._definitions),uniforms:this._uniforms,attributes:this._attributes}),Ra[this._getCachedProgramKey()]={glContext:t,program:this._shaderProgram})},t.prototype._shaderProgramBind=function(t){var e=t.gl,n=t.object,r={};this._attributes.forEach((function(t){r[t.name]=n.geometry.getBuffer(t.name)}));var i={uColorAlpha:this.opacity};this._shaderProgram.bind(e,i,r)},t}(),Ba={fragment:"\nprecision mediump float;\n\nuniform float uColorAlpha;\nvarying vec3 vColor;\n\nvoid main(void) {\n    gl_FragColor = vec4(vColor.rgb, uColorAlpha);\n}\n",vertex:"\nattribute vec3 position;\n\nuniform mat4 uPosition;\nuniform mat4 uCamera;\nuniform vec3 uColor;\nuniform vec3 uEmissive;\n\nvarying vec3 vColor;\n\nvoid main(void) {\n    vColor = uColor;\n\n    gl_Position = uCamera * uPosition * vec4(position, 1.0);\n}\n"},Fa=(function(t){function e(){var e=t.call(this)||this;return e._attributes=[{name:"position"}],e._uniforms=[{name:"uColorAlpha",type:"1f"},{name:"uCamera",type:"mat4"},{name:"uPosition",type:"mat4"},{name:"uColor",type:"3fv"}],e._shader=Ba,e.color=[0,0,0],e.type=5,e}Object(w.c)(e,t),e.prototype._shaderProgramBind=function(t){var e=t.gl,n=t.object,r=t.camera,i={};this._attributes.forEach((function(t){i[t.name]=n.geometry.getBuffer(t.name)}));var o={uColorAlpha:this.opacity,uPosition:new Float32Array(n.worldMatrix),uCamera:new Float32Array(r.modelViewMatrix),uColor:this.color};this._shaderProgram.bind(e,o,i)}}(za),function(t){function e(e,n){var r=t.call(this,e,n)||this;return r._array=e,r.length=e.length/r.options.itemSize,r}return Object(w.c)(e,t),e.prototype.getArray=function(){return this._array},e.prototype.getElement=function(t){return this._array.subarray(t*this.options.itemSize,(t+1)*this.options.itemSize)},e.prototype.getTriangle=function(t){return t*=3,[this.getElement(t),this.getElement(t+1),this.getElement(t+2)]},e.prototype.concat=function(t){var e=t.getArray(),n=new this._array.constructor(this._array.length+e.length);return n.set(this._array,0),n.set(e,this._array.length),this._array=n,this.length=n.length/this.options.itemSize,this},e}(P.a)),Da=function(){function t(t,e){this.min=t||l.d(),this.max=e||l.d()}return t.prototype.containsPoint=function(t){return t[0]>this.min[0]&&t[0]<this.max[0]&&t[1]>this.min[1]&&t[1]<this.max[1]&&t[2]>this.min[2]&&t[2]<this.max[2]},t.prototype.expandByPoint=function(t){return l.m(this.min,this.min,t),l.l(this.max,this.max,t),this},t}(),Ua=(function(t){function e(){var e=t.call(this)||this;return e.type=13,e}Object(w.c)(e,t),e.prototype.render=function(t){var e=t.gl;return e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),e.enable(e.CULL_FACE),e.disable(e.BLEND),t.renderer.sortObjects&&this._objects.sort(this._renderOrderSort),this._objects.forEach((function(e){return e.render(t)})),this._objects=[],this},e.prototype._renderOrderSort=function(t,e){return t.renderOrder-e.renderOrder}}(ye),{fragment:"\nprecision mediump float;\n\n#ifdef USE_TEXTURE\n    uniform sampler2D uTexture;\n    varying vec2 vTextureCoord;\n    varying float vTextureEnable;\n#endif\n\nuniform float uColorAlpha;\nvarying vec3 vLightWeighting;\nvarying vec3 vColor;\nvarying vec3 vEmissive;\n\nvoid main(void) {\n    vec4 color = vec4(vColor.rgb, uColorAlpha);\n\n    #ifdef USE_TEXTURE\n        if (vTextureEnable > 0.5) {\n            vec4 textureColor = texture2D(uTexture, vec2(vTextureCoord.s, vTextureCoord.t));\n            color = vec4(textureColor.rgb * color.rgb, color.a);\n        }\n    #endif\n\n    gl_FragColor = vec4(color.rgb * vLightWeighting + vEmissive, color.a);\n}\n",vertex:"\nattribute vec3 position;\nattribute vec3 color;\nattribute vec3 emissive;\n\n#ifdef USE_TEXTURE\n    attribute vec2 texture;\n    attribute float textureEnable;\n    varying vec2 vTextureCoord;\n    varying float vTextureEnable;\n#endif\n\n#if DIR_LIGHT_NUM > 0\n    attribute vec3 normal;\n    uniform vec3 uDirectionLightColors[DIR_LIGHT_NUM];\n    uniform vec3 uDirectionLightPositions[DIR_LIGHT_NUM];\n    uniform mat3 uNormalMatrix;\n#endif\n\nuniform mat4 uPosition;\nuniform vec3 uAmbientLightColor;\nuniform mat4 uCamera;\n\nvarying vec3 vColor;\nvarying vec3 vEmissive;\nvarying vec3 vLightWeighting;\n\nvoid main(void) {\n    vColor = color;\n    vEmissive = emissive;\n\n    #ifdef USE_TEXTURE\n        vTextureCoord = texture;\n        vTextureEnable = textureEnable;\n    #endif\n\n    vec3 vLightTemp = vec3(0.0);\n\n    #if DIR_LIGHT_NUM > 0\n        vec3 transformedNormal = uNormalMatrix * normal;\n\n        for(int i = 0; i < DIR_LIGHT_NUM; i++) {\n            float dotProduct = dot(transformedNormal, uDirectionLightPositions[i]);\n            vec3 directionalLightWeighting = vec3(max(dotProduct, 0.0));\n            vLightTemp += uDirectionLightColors[i] * directionalLightWeighting;\n        }\n    #endif\n\n    vLightWeighting = uAmbientLightColor + vLightTemp;\n\n    gl_Position = uCamera * uPosition * vec4(position, 1.0);\n}\n"}),Za=(function(t){function e(){var e=t.call(this)||this;return e._attributes=[{name:"position"},{name:"color"},{name:"emissive"}],e._uniforms=[{name:"uColorAlpha",type:"1f"},{name:"uCamera",type:"mat4"},{name:"uPosition",type:"mat4"},{name:"uAmbientLightColor",type:"3fv"}],e._shader=Ua,e._texture=null,e.type=6,e}Object(w.c)(e,t),e.prototype.setTexture=function(t){return this._texture=t,this},e.prototype.getTexture=function(){return this._texture},e.prototype._prepare=function(e){this._enableLight(e),this._texture&&this._enableTexture(),t.prototype._prepare.call(this,e)},e.prototype._enableLight=function(t){var e=t.scene,n=0;e.getLights().forEach((function(t){4===t.type&&n++})),this.define("directionLights",n),n>0&&(this._attributes.push({name:"normal"}),this._uniforms.push({name:"uDirectionLightColors",type:"3fv"},{name:"uDirectionLightPositions",type:"3fv"},{name:"uNormalMatrix",type:"mat3"}))},e.prototype._enableTexture=function(){this.define("texture"),this._attributes.push({name:"texture"},{name:"textureEnable"}),this._uniforms.push({name:"uTexture",type:"1i"})},e.prototype._shaderProgramBind=function(t){var e=t.gl,n=t.scene,r=t.camera,i=t.object,o={},a={};this._texture&&(this._texture.enable(e,0),o.uTexture=0);var s,c,u,d,f,h,p,m,v,_,g,y,b,x,w,S=n.getLights();if(S.length){var O=[],M=[];if(S.forEach((function(t){if(3===t.type)o.uAmbientLightColor=t.color;else if(4===t.type){O=O.concat(t.color);var e=l.d();l.o(e,t.position,-1),M=M.concat(Array.prototype.slice.call(e))}})),O.length&&M.length){var j=Aa();La(j,i.worldMatrix),s=j,u=(c=j)[0],d=c[1],f=c[2],h=c[3],p=c[4],m=c[5],v=c[6],_=c[7],(w=u*(y=(g=c[8])*p-m*_)+d*(b=-g*h+m*v)+f*(x=_*h-p*v))&&(w=1/w,s[0]=y*w,s[1]=(-g*d+f*_)*w,s[2]=(m*d-f*p)*w,s[3]=b*w,s[4]=(g*u-f*v)*w,s[5]=(-m*u+f*h)*w,s[6]=x*w,s[7]=(-_*u+d*v)*w,s[8]=(p*u-d*h)*w),function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(j,j),o.uNormalMatrix=new Float32Array(j),a.normal=i.geometry.getBuffer("normal")}o.uDirectionLightColors=new Float32Array(O),o.uDirectionLightPositions=new Float32Array(M)}this._attributes.forEach((function(t){"normal"!==t.name&&(a[t.name]=i.geometry.getBuffer(t.name))})),o.uPosition=new Float32Array(i.worldMatrix),o.uCamera=new Float32Array(r.modelViewMatrix),o.uColorAlpha=this.opacity,this._shaderProgram.bind(e,o,a)}}(za),function(t){Object(w.c)((function(e){var n=t.call(this,e)||this;return n.type=4,n}),t)}(ka),function(){function t(t,e){this.normal=t||l.d(),this.constant=e||0}return t.prototype.distanceToPoint=function(t){return l.g(this.normal,t)+this.constant},t.prototype.setComponents=function(t,e,n,r){return l.q(this.normal,t,e,n),this.constant=r,this},t.prototype.normalize=function(){var t=1/l.j(this.normal);return l.o(this.normal,this.normal,t),this.constant*=t,this},t}()),Ha=(function(){function t(t){this.planes=t,this.planes&&6===this.planes.length||(this.planes=[new Za,new Za,new Za,new Za,new Za,new Za]),this._v1=l.d(),this._v2=l.d()}t.prototype.setFromMatrix=function(t){var e=this.planes;return e[0].setComponents(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]).normalize(),e[1].setComponents(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]).normalize(),e[2].setComponents(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]).normalize(),e[3].setComponents(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]).normalize(),e[4].setComponents(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14]).normalize(),e[5].setComponents(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]).normalize(),this},t.prototype.intersectsBox=function(t){for(var e=this._v1,n=this._v2,r=this.planes,i=t.min,o=t.max,a=0;a<6;a++){var s=r[a],c=s.normal;e[0]=c[0]>0?i[0]:o[0],n[0]=c[0]>0?o[0]:i[0],e[1]=c[1]>0?i[1]:o[1],n[1]=c[1]>0?o[1]:i[1],e[2]=c[2]>0?i[2]:o[2],n[2]=c[2]>0?o[2]:i[2];var l=s.distanceToPoint(e),u=s.distanceToPoint(n);if(l<0&&u<0)return!1}return!0}}(),function(){function t(){this.buffers={},this._boundingBox=null}return t.prototype.setBuffer=function(t,e){return this.buffers[t]=e,this},t.prototype.getBuffer=function(t){return this.buffers[t]},t.prototype.computeNormals=function(){var t=this.buffers.position;if(!t)return this;for(var e=new Float32Array(t.length*t.options.itemSize),n=l.d(),r=l.d(),i=l.d(),o=0;o<t.length;o+=3){var a=t.getTriangle(o/3);l.r(n,a[0],a[1]),l.r(r,a[2],a[1]),l.e(i,n,r),l.n(i,i),e.set(i,3*o),e.set(i,3*(o+1)),e.set(i,3*(o+2))}return this.setBuffer("normal",new Fa(e,{itemSize:3})),this},t.prototype.getBoundingBox=function(){return this._boundingBox||this.computeBoundingBox(),this._boundingBox},t.prototype.computeBoundingBox=function(){var t=this._boundingBox=new Da,e=this.buffers.position;if(e)for(var n=0;n<e.length;n++)t.expandByPoint(e.getElement(n))},t.prototype.concat=function(t){for(var e in this.buffers)this.buffers[e].concat(t.buffers[e])},t}());!function(t){function e(e,n){var r=t.call(this)||this;return r.geometry=e,r.material=n,r.renderOrder=0,r.type=9,r}Object(w.c)(e,t),e.prototype.render=function(t){var e=t.gl;return this.visible?(this.worldMatrixNeedsUpdate&&this.updateWorldMatrix(),t.object=this,this.material.enable(t),e.drawArrays(e.TRIANGLES,0,this.geometry.getBuffer("position").length),this.material.disable(e),this):this},e.prototype.typifyForRender=function(t){return this.visible?(this.material.typifyForRender(t,this),this.children.forEach((function(e){return e.typifyForRender(t)})),this):this}}(Pa),function(){function t(t,e){this.start=t||l.d(),this.end=e||l.d()}t.prototype.closestPointToPointParameter=function(t,e){var n=l.d(),r=l.d();l.r(n,t,this.start),l.r(r,this.end,this.start);var i,o=l.g(r,r),a=l.g(r,n)/o;return e&&(a=(i=a)<0?0:i>1?1:i),a},t.prototype.closestPointToPoint=function(t,e,n){var r=this.closestPointToPointParameter(t,e),i=n||l.d();return i=this.delta(i),l.o(i,i,r),l.a(i,i,this.start),i},t.prototype.delta=function(t){var e=t||l.d();return l.r(e,this.end,this.start),e}}(),function(t){function e(e,n){var r=t.call(this)||this;return r.material=n,r.type=11,r._initArrays(e),r._initGeometry(),r}Object(w.c)(e,t),e.prototype.setOpacity=function(t,e){var n=this._data.colorAlpha.array,r=6*t;return n[r]=e,n[r+1]=e,n[r+2]=e,n[r+3]=e,n[r+4]=e,n[r+5]=e,this._data.colorAlpha.dirty=!0,this},e.prototype.setPosition=function(t,e){var n=this._data.position.array,r=18*t;return n[r]=e[0],n[r+1]=e[1],n[r+3]=e[0],n[r+4]=e[1],n[r+6]=e[0],n[r+7]=e[1],n[r+9]=e[0],n[r+10]=e[1],n[r+12]=e[0],n[r+13]=e[1],n[r+15]=e[0],n[r+16]=e[1],this._data.position.dirty=!0,this},e.prototype.setElevation=function(t,e){var n=this._data.position.array,r=18*t;return n[r+2]=e,n[r+5]=e,n[r+8]=e,n[r+11]=e,n[r+14]=e,n[r+17]=e,this._data.position.dirty=!0,this},e.prototype.setSize=function(t,e){var n=this._data.scale.array,r=12*t;return n[r]=e[0],n[r+1]=e[1],n[r+2]=e[0],n[r+3]=e[1],n[r+4]=e[0],n[r+5]=e[1],n[r+6]=e[0],n[r+7]=e[1],n[r+8]=e[0],n[r+9]=e[1],n[r+10]=e[0],n[r+11]=e[1],this._data.scale.dirty=!0,this},e.prototype.setOffset=function(t,e){var n=this._data.offset.array,r=12*t;return n[r]=e[0],n[r+1]=e[1],n[r+2]=e[0],n[r+3]=e[1],n[r+4]=e[0],n[r+5]=e[1],n[r+6]=e[0],n[r+7]=e[1],n[r+8]=e[0],n[r+9]=e[1],n[r+10]=e[0],n[r+11]=e[1],this._data.offset.dirty=!0,this},e.prototype.setUV=function(t,e){var n=this._data.texture.array,r=12*t;return n[r]=e[2],n[r+1]=1-e[3],n[r+2]=e[2],n[r+3]=1-e[1],n[r+4]=e[0],n[r+5]=1-e[3],n[r+6]=e[0],n[r+7]=1-e[1],n[r+8]=e[0],n[r+9]=1-e[3],n[r+10]=e[2],n[r+11]=1-e[1],this._data.texture.dirty=!0,this},e.prototype.render=function(t){var e=t.gl,n=t.shaderProgram,r=this._geometry;for(var i in n.bind(e,null,{texture:r.getBuffer("texture"),position:r.getBuffer("position"),colorAlpha:r.getBuffer("colorAlpha"),scale:r.getBuffer("scale"),offset:r.getBuffer("offset"),disposition:r.getBuffer("disposition")}),this._data)this._data[i].dirty&&(this._geometry.getBuffer(i).subData(e,0,this._data[i].array),this._data[i].dirty=!1);return this.material.enable(t),e.drawArrays(e.TRIANGLES,0,this._geometry.getBuffer("disposition").length),this.material.disable(),this},e.prototype.typifyForRender=function(t){return this.visible&&this.material.getTexture()?(t[16].addObject(this),this.children.forEach((function(e){return e.typifyForRender(t)})),this):this},e.prototype._initArrays=function(t){var e=t.length,n=[.5,-.5,0,.5,.5,0,-.5,-.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0],r=new Float32Array(18*e),i=new Float32Array(12*e),o=new Float32Array(18*e),a=new Float32Array(12*e),s=new Float32Array(12*e),c=new Float32Array(6*e);this._data={disposition:{array:r,dirty:!1},texture:{array:i,dirty:!1},position:{array:o,dirty:!1},scale:{array:a,dirty:!1},offset:{array:s,dirty:!1},colorAlpha:{array:c,dirty:!1}};for(var l=0;l<e;l++){var u=t[l];r.set(n,18*l),this.setUV(l,u.uv||[0,0,1,1]),this.setSize(l,u.size||[0,0]),this.setOffset(l,u.offset||[0,0]),this.setOpacity(l,void 0!==u.opacity?u.opacity:1),this.setPosition(l,u.position),this.setElevation(l,u.elevation||0)}},e.prototype._initGeometry=function(){this._geometry=new Ha;var t=new Fa(this._data.texture.array,{itemSize:2});t.drawType=Fa.DynamicDraw;var e=new Fa(this._data.position.array,{itemSize:3});e.drawType=Fa.DynamicDraw;var n=new Fa(this._data.scale.array,{itemSize:2});n.drawType=Fa.DynamicDraw;var r=new Fa(this._data.offset.array,{itemSize:2});r.drawType=Fa.DynamicDraw;var i=new Fa(this._data.colorAlpha.array,{itemSize:1});i.drawType=Fa.DynamicDraw;var o=new Fa(this._data.disposition.array,{itemSize:3});this._geometry.setBuffer("disposition",o).setBuffer("texture",t).setBuffer("position",e).setBuffer("scale",n).setBuffer("offset",r).setBuffer("colorAlpha",i)}}(Pa),function(){function t(){this.smoothing=1,this._texture=null,this.type=8}t.prototype.setTexture=function(t){return this._texture=t,this},t.prototype.getTexture=function(){return this._texture},t.prototype.enable=function(t){var e=t.gl;t.shaderProgram.bind(e,{uSmoothing:this.smoothing}),this._texture&&this._texture.enable(e)},t.prototype.disable=function(){}}();var Ga=(function(t){function e(){var e=t.call(this)||this;return e._shaderProgram=new Dr({vertex:new qr("vertex","\nattribute vec2 disposition;\nattribute vec2 texture;\n\nattribute vec3 position;\nattribute vec2 scale;\nattribute vec2 offset;\nattribute float colorAlpha;\n\nuniform float uSmoothing;\nuniform mat4 uPCamera;\nuniform vec2 uHalfSize;\n\nvarying vec2 vTextureCoord;\nvarying float vColorAlpha;\n\nvoid main(void) {\n    vTextureCoord = texture;\n    vColorAlpha = colorAlpha;\n\n    vec2 alignedPosition = disposition * scale;\n    alignedPosition += offset;\n    alignedPosition /= uHalfSize;\n\n    vec4 ndcPosition = uPCamera * vec4(position, 1.0);\n    ndcPosition.xyz = ndcPosition.xyz / ndcPosition.w;\n    ndcPosition.w = 1.0;\n    ndcPosition.xy += alignedPosition.xy;\n\n    vec2 roundedPosition = floor((ndcPosition.xy + 1.0) * uHalfSize.xy + 0.5) / uHalfSize.xy - 1.0;\n    vec2 roundingDelta = roundedPosition - ndcPosition.xy;\n\n    if (vColorAlpha == 0.0) {\n        ndcPosition.xy = vec2(-2.0, -2.0);\n    } else {\n        ndcPosition.xy = ndcPosition.xy + roundingDelta * uSmoothing;\n    }\n\n    gl_Position = ndcPosition;\n}\n"),fragment:new qr("fragment","\nprecision mediump float;\n\nuniform sampler2D uTexture;\n\nvarying vec2 vTextureCoord;\nvarying float vColorAlpha;\n\nvoid main(void) {\n    vec4 textureColor = texture2D(uTexture, vec2(vTextureCoord.s, vTextureCoord.t));\n\n    gl_FragColor = textureColor * vColorAlpha;\n}\n"),uniforms:[{name:"uPCamera",type:"mat4"},{name:"uHalfSize",type:"2f"},{name:"uTexture",type:"1i"},{name:"uSmoothing",type:"1f"}],attributes:[{name:"disposition"},{name:"texture"},{name:"position"},{name:"colorAlpha"},{name:"scale"},{name:"offset"}]}),e.type=16,e}Object(w.c)(e,t),e.prototype.render=function(t){var e=t.gl,n=t.camera,r=t.renderer.getSize();return t.shaderProgram=this._shaderProgram,e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this._shaderProgram.enable(e).bind(e,{uPCamera:new Float32Array(n.modelViewMatrix),uHalfSize:[r[0]/2,r[1]/2],uTexture:0}),e.activeTexture(e.TEXTURE0),this._objects.forEach((function(e){return e.render(t)})),this._objects=[],this._shaderProgram.disable(e),this}}(ye),function(t){function e(){var e=t.call(this)||this;return e.up=l.i(0,1,0),e.projectionMatrix=E.b(),e.modelViewMatrix=E.b(),e.worldInverseMatrix=E.b(),e._mat3=Aa(),e._mat4a=E.b(),e._mat4b=E.b(),e}return Object(w.c)(e,t),e.prototype.updateProjectionMatrix=function(){},e.prototype.updateWorldMatrix=function(){t.prototype.updateWorldMatrix.call(this),E.e(this.worldInverseMatrix,this.worldMatrix),E.h(this.modelViewMatrix,this.projectionMatrix,this.worldInverseMatrix)},e.prototype.project=function(t){var e=l.d();return l.t(e,t,this.modelViewMatrix),e},e.prototype.unproject=function(t){var e=this._mat4a,n=this._mat4b,r=l.d();return E.e(n,this.projectionMatrix),E.g(e,this.worldMatrix,n),l.t(r,t,e),r},e.prototype.lookAt=function(t){var e=this._mat4a,n=this._mat3;return E.f(e,this.position,t,this.up),E.m(e,e),La(n,e),function(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}}(this.quaternion,n),this},e}(Pa)),Wa=(function(t){function e(e,n,r,i,o,a){var s=t.call(this)||this;return s.left=e,s.right=n,s.top=r,s.bottom=i,s.near=o,s.far=a,s.type=1,s}Object(w.c)(e,t),e.prototype.updateProjectionMatrix=function(){E.i(this.projectionMatrix,this.left,this.right,this.bottom,this.top,this.near,this.far)}}(Ga),function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.fov=e,o.aspect=n,o.near=r,o.far=i,o.type=2,o}Object(w.c)(e,t),e.prototype.updateProjectionMatrix=function(){E.j(this.projectionMatrix,this.fov*Math.PI/180,this.aspect,this.near,this.far)}}(Ga),function(t){function e(){var e=t.call(this)||this;return e._lights=[],e}Object(w.c)(e,t),e.prototype.addLight=function(t){return this._lights.push(t),this},e.prototype.getLights=function(){return this._lights}}(Pa),function(t){function e(e){var n=t.call(this)||this;return n.material=e,n.offset=T.d(),n.type=10,n}Object(w.c)(e,t),e.prototype.render=function(t){if(!this.visible||!this.material.getTexture())return this;this.worldMatrixNeedsUpdate&&this.updateWorldMatrix();var e=t.gl;return t.object=this,this.material.enable(t),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),this.material.disable(t.gl),this},e.prototype.typifyForRender=function(t){return this.visible?(t[15].addObject(this),this.children.forEach((function(e){return e.typifyForRender(t)})),this):this}}(Pa),function(){function t(){this.opacity=1,this.smoothing=0,this._texture=null,this.type=7}t.prototype.setTexture=function(t){return this._texture=t,this},t.prototype.getTexture=function(){return this._texture},t.prototype.enable=function(t){var e=t.gl,n=t.object,r=t.shaderProgram,i=t.renderer.getSize();r.bind(e,{uColorAlpha:this.opacity,uSmoothing:this.smoothing,uHalfSize:[i[0]/2,i[1]/2],uOffset:n.offset,uScale:n.scale,uPosition:[n.worldMatrix[12],n.worldMatrix[13],n.worldMatrix[14]]}),this._texture&&this._texture.enable(e)},t.prototype.disable=function(){}}(),"\nprecision mediump float;\n\nuniform float uColorAlpha;\nuniform sampler2D uTexture;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n    vec4 textureColor = texture2D(uTexture, vec2(vTextureCoord.s, vTextureCoord.t));\n\n    gl_FragColor = textureColor * uColorAlpha;\n}\n"),Va=(function(t){function e(){var e=t.call(this)||this;return e._geometry=new Ha,e._geometry.setBuffer("position",new Fa(new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]))).setBuffer("texture",new Fa(new Float32Array([0,0,1,0,1,1,0,1]),{itemSize:2})).setBuffer("index",new Fa(new Uint16Array([1,2,0,3,0,2]),{itemSize:1})),e._geometry.getBuffer("index").type=Fa.ElementArrayBuffer,e._shaderProgram=new Dr({vertex:new qr("vertex","\nattribute vec2 position;\nattribute vec2 texture;\n\nuniform vec3 uPosition;\nuniform mat4 uPCamera;\nuniform vec2 uScale;\nuniform vec2 uHalfSize;\nuniform vec2 uOffset;\nuniform float uSmoothing;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n    vTextureCoord = texture;\n\n    vec2 alignedPosition = position * uScale;\n    alignedPosition += uOffset;\n    alignedPosition /= uHalfSize;\n\n    vec4 ndcPosition = uPCamera * vec4(uPosition, 1.0);\n    ndcPosition.xyz = ndcPosition.xyz / ndcPosition.w;\n    ndcPosition.w = 1.0;\n    ndcPosition.xy += alignedPosition.xy;\n\n    vec2 roundedPosition = floor((ndcPosition.xy + 1.0) * uHalfSize.xy + 0.5) / uHalfSize.xy - 1.0;\n    vec2 roundingDelta = roundedPosition - ndcPosition.xy;\n\n    ndcPosition.xy = ndcPosition.xy + roundingDelta * uSmoothing;\n\n    gl_Position = ndcPosition;\n}\n"),fragment:new qr("fragment",Wa),uniforms:[{name:"uPCamera",type:"mat4"},{name:"uPosition",type:"3f"},{name:"uColorAlpha",type:"1f"},{name:"uScale",type:"2f"},{name:"uTexture",type:"1i"},{name:"uHalfSize",type:"2f"},{name:"uOffset",type:"2f"},{name:"uSmoothing",type:"1f"}],attributes:[{name:"position"},{name:"texture"},{name:"index",index:!0}]}),e.type=15,e}Object(w.c)(e,t),e.prototype.render=function(t){var e=t.gl,n=t.camera;return t.shaderProgram=this._shaderProgram,e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this._shaderProgram.enable(e).bind(e,{uPCamera:new Float32Array(n.modelViewMatrix),uTexture:0},{position:this._geometry.getBuffer("position"),texture:this._geometry.getBuffer("texture"),index:this._geometry.getBuffer("index")}),e.activeTexture(e.TEXTURE0),this._objects.forEach((function(e){return e.render(t)})),this._objects=[],this._shaderProgram.disable(e),this}}(ye),function(){function t(t,e){this.origin=t||l.d(),this.direction=e||l.d()}return t.prototype.clone=function(){return new t(l.b(this.origin),l.b(this.direction))},t.prototype.at=function(t){var e=l.d();return l.p(e,this.origin,this.direction,t),e},t.prototype.intersectBox=function(t){var e,n,r,i,o,a,s=1/this.direction[0],c=1/this.direction[1],l=1/this.direction[2],u=this.origin;return s>=0?(e=(t.min[0]-u[0])*s,n=(t.max[0]-u[0])*s):(e=(t.max[0]-u[0])*s,n=(t.min[0]-u[0])*s),c>=0?(r=(t.min[1]-u[1])*c,i=(t.max[1]-u[1])*c):(r=(t.max[1]-u[1])*c,i=(t.min[1]-u[1])*c),e>i||r>n?null:((r>e||e!=e)&&(e=r),(i<n||n!=n)&&(n=i),l>=0?(o=(t.min[2]-u[2])*l,a=(t.max[2]-u[2])*l):(o=(t.max[2]-u[2])*l,a=(t.min[2]-u[2])*l),e>a||o>n?null:((o>e||e!=e)&&(e=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(e>=0?e:n)))},t.prototype.applyMatrix4=function(t){return l.a(this.direction,this.direction,this.origin),l.t(this.direction,this.direction,t),l.t(this.origin,this.origin,t),l.r(this.direction,this.direction,this.origin),l.n(this.direction,this.direction),this},t.prototype.intersectTriangle=function(t,e){var n=l.d(),r=l.d(),i=l.d();l.r(n,t[1],t[0]),l.r(r,t[2],t[0]),l.e(i,n,r);var o,a=l.g(this.direction,i);if(a>0){if(e)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}var s=l.d();l.r(s,this.origin,t[0]);var c=l.d();l.e(c,s,r);var u=o*l.g(this.direction,c);if(u<0)return null;var d=l.d();l.e(d,n,s);var f=o*l.g(this.direction,d);if(f<0)return null;if(u+f>a)return null;var h=-o*l.g(s,i);return h<0?null:this.at(h/a)},t.prototype.distanceToPlane=function(t){var e=l.g(t.normal,this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(l.g(this.origin,t.normal)+t.constant)/e;return n>=0?n:null},t.prototype.intersectPlane=function(t){var e=this.distanceToPlane(t);return null===e?null:this.at(e)},t}()),qa=(function(){function t(t,e,n,r){var i;this.precision=1e-4,this.ray=new Va(t,e),this.near=n||0,this.far=r||1/0,this.intersectMethodsByType=((i={})[9]="intersectMesh",i),this._vec3=l.d(),this._mat3=Aa()}t.prototype.setFromCamera=function(t,e){if(2===e.type){l.c(this.ray.origin,e.position);var n=l.q(this._vec3,t[0],t[1],.5);n=e.unproject(n),l.r(n,n,e.position),l.n(n,n),this.ray.direction=n}else if(1===e.type){var r=l.q(this._vec3,t[0],t[1],-1);this.ray.origin=e.unproject(r),l.q(this.ray.direction,0,0,-1),La(this._mat3,e.worldMatrix),l.s(this.ray.direction,this.ray.direction,this._mat3),l.n(this.ray.direction,this.ray.direction)}},t.prototype.intersectObject=function(t,e,n){n=n||[];var r=this.intersectMethodsByType[t.type];return r&&this[r]?this[r](t,e,n):e&&this.intersectObjects(t.children,e,n),n.sort(this._descSort),n},t.prototype.intersectObjects=function(t,e,n){var r=this;return n=n||[],t.forEach((function(t){return r.intersectObject(t,e,n)})),n},t.prototype.intersectMesh=function(t,e,n){n=n||[];var r=E.b();E.e(r,t.worldMatrix);var i=this.ray.clone();i.applyMatrix4(r);var o=t.geometry.getBoundingBox();if(!i.intersectBox(o))return t;for(var a=t.geometry.buffers.position,s=0;s<a.length;s+=3){var c=a.getTriangle(s/3),u=i.intersectTriangle(c,!1);if(u){l.t(u,u,t.worldMatrix);var d=l.f(this.ray.origin,u);d<this.precision||d<this.near||d>this.far||n.push({distance:d,point:u,object:t})}}return e&&this.intersectObjects(t.children,e,n),n},t.prototype._descSort=function(t,e){return t.distance-e.distance}}(),function(t){function e(){var e=t.call(this)||this;return e.type=14,e}Object(w.c)(e,t),e.prototype.render=function(t){var e=t.gl;return e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),t.renderer.sortObjects&&this._sortObjects(t),this._objects.forEach((function(e){return e.render(t)})),this._objects=[],this},e.prototype._sortObjects=function(t){var e=t.camera,n=this._reversePainterSortStable.bind(this,e);this._objects.sort(n)},e.prototype._reversePainterSortStable=function(t,e,n){if(e.renderOrder!==n.renderOrder)return e.renderOrder-n.renderOrder;var r=t.project(e.getWorldPosition())[2];return t.project(n.getWorldPosition())[2]-r}}(ye),function(){function t(t,e){this.state=t,this.modules=e,this.textureKeys=[],this.texturesMap=new Map}return t.prototype.addTexture=function(t,e){return Object(w.b)(this,void 0,Promise,(function(){var n;return Object(w.d)(this,(function(r){switch(r.label){case 0:return[4,Object(s.d)(t)];case 1:return n=r.sent(),[4,this.storeTexture(n,e)];case 2:return[2,r.sent()]}}))}))},t.prototype.loadTexture=function(t,e){return Object(w.b)(this,void 0,Promise,(function(){var n;return Object(w.d)(this,(function(r){switch(r.label){case 0:return[4,this.loadImage(t)];case 1:return(n=r.sent())?[4,this.storeTexture(n,e)]:[2];case 2:return[2,r.sent()]}}))}))},t.prototype.getTexture=function(t){return this.texturesMap.get(this.textureKeys[t])},t.prototype.destroy=function(){this.textureKeys=[],this.texturesMap.clear()},t.prototype.deleteTexture=function(t){return this.texturesMap.delete(this.textureKeys[t])},t.prototype.storeTexture=function(t,e){var n,r;return Object(w.b)(this,void 0,void 0,(function(){var i,o,c,l,u,d,f,h,p,m,v;return Object(w.d)(this,(function(_){if(i=null==e?void 0:e.size,o=null!==(n=null==e?void 0:e.pixelRatio)&&void 0!==n?n:window.devicePixelRatio,c=null!==(r=null==e?void 0:e.imagePadding)&&void 0!==r?r:1,l=t.getAttribute("src")||t.currentSrc,u=function(t,e){return t+(void 0!==e?"_"+e[0]+","+e[1]:"")}(l,i),(d=this.textureKeys.indexOf(u))>-1&&this.texturesMap.has(u))return[2,d];if(f=this.modules.renderer.getRenderingContext(),h=(i||[t.width,t.height]).map((function(t){return t*o})),p=Object(s.D)(t,h),(m=h.map((function(t){return t+2*c})))[0]>a.atlasSize[0]||m[1]>a.atlasSize[1])throw new Error("Image texture dimensions "+m+" are larger than the maximum possible "+a.atlasSize);return(v=new Se(void 0,{size:m,flipY:!1,magFilter:Se.LinearFilter,minFilter:Se.LinearFilter}).prepare(f)).subImage(f,p,c,c),this.texturesMap.set(u,v),this.textureKeys.push(u),this.state.needRerender=!0,[2,this.textureKeys.length-1]}))}))},t.prototype.loadImage=function(t){return Object(w.b)(this,void 0,Promise,(function(){return Object(w.d)(this,(function(e){return[2,new Promise((function(e){var n=new Image;n.crossOrigin="Anonymous",n.src=t,n.onload=function(){return e(n)},n.onerror=function(){return e(void 0)}}))]}))}))},t}()),Ya=function(){function t(t){this.modules=t}return t.prototype.addSource=function(t,e){this.modules.workers.source.addSource(t,e)},t.prototype.removeSource=function(t){for(var e=this.modules.layers.getLayers(),n=!0,r=0;r<e.length;r++){var i=e[r];if("getSourceName"in i&&i.getSourceName()===t){n=!1,console.error("Source "+t+" cannot be removed while layer "+i.name+" is using it");break}}n&&this.modules.workers.source.removeSource(t)},t.prototype.getTile=function(t,e,n,r){return this.modules.workers.source.getTile(t,e,n,r)},t}(),Xa={ast:{rules:{},selector:[],children:void 0},curves:[],rasterSets:{},labelingGroups:{indexToGroup:[],groupToIndex:{},table:{}},fonts:N.d,urls:{icons:{png:"",svg:""}}},Ka=function(){function t(t){this.modules=t,this.metaStyles=new Map,this.indexCounter=0,this.metatileHashToStyleId=new Map,this.singleUsedStyleId=void 0}return t.prototype.createStyle=function(t){var e={id:this.indexCounter++,ast:t.ast,curves:t.curves,fonts:t.fonts,rasterSets:Object(x.h)(t.rasterSets),labelingGroups:Object(x.f)(t.labelingGroups),urls:t.urls,styleStateKeys:t.styleStateKeys};return this.metaStyles.set(e.id,e),this.modules.workers.parser.addStyle(e),this.modules.workers.labeling.addStyle(e),e},t.prototype.createOldStyle=function(t,e){var n=this.createStyle(e);return this.metatileHashToStyleId.set(t,n.id),this.modules.workers.parser.bindStyleToMetatileHash(t,n.id),this.modules.workers.labeling.bindStyleToMetatileHash(t,n.id),n},t.prototype.useSingleStyle=function(t){this.singleUsedStyleId=t,this.modules.workers.parser.useSingleStyle(t),this.modules.workers.labeling.useSingleStyle(t)},t.prototype.setDynamicStyle=function(t){this.metaStyles.set(-1,t),this.modules.workers.parser.addStyle(t),this.modules.workers.labeling.addStyle(t)},t.prototype.getStyle=function(t){return this.metaStyles.get(t)},t.prototype.getStyleForTerrainTiles=function(t){var e,n=null!==(e=this.singleUsedStyleId)&&void 0!==e?e:this.metatileHashToStyleId.get(t);if(void 0!==n)return this.metaStyles.get(n)},t.prototype.preventOldStyle=function(){var t=Object(w.a)(Object(w.a)({id:this.indexCounter++},Xa),{styleStateKeys:[]});this.metaStyles.set(t.id,t),this.singleUsedStyleId=t.id,this.modules.workers.parser.useSingleStyle(t.id),this.modules.workers.labeling.useSingleStyle(t.id)},t}(),Ja=function(){function t(t,e,n){this.map=n,this.layout=new Ta(e),this.collector=new ge.a("main"),this.workers=new Li,this.styleManager=new Ka(this),this.assetManager=new gi(t,this),this.imageManager=new qa(t,this),this.floorManager=new Ui(t,this),this.sourceManager=new Ya(this),this.personalPoiManager=new Mi(this),this.buildingHeightAnimator=new _e(t,this),this.renderer=new ni(t,this),this.layers=new Ni(t),this.tileManager=new Fo(t,this),this.modelManager=new Si(t,this),this.dynamicStyle=new jt.a,this.imageCache=new Bi(this),this.identifier=new di(t,this),this.labeler=new Uo(t,this),this.ruler=new ha(t,this),this.trafficTileLayer=new Ia(t,this),this.handler=new ja(t,this),this.mouseMoveHandler=new me(t,this)}return t.prototype.destroy=function(){this.imageManager.destroy(),this.trafficTileLayer.destroy(),this.tileManager.destroy(),this.workers.destroy(),this.renderer.destroy(),this.handler.destroy(),this.mouseMoveHandler.destroy(),this.ruler.destroy(),this.layout.destroy()},t}(),Qa=function(){function t(e,n,r){var i=this;void 0===n&&(n={}),this.renderLoop=function(){i.requestedFrame=requestAnimationFrame(i.renderLoop),i.modules.map.emit("framestart");var t=i.state;t.time=Date.now(),t.collectStats&&(t.stats.drawCount=0,t.stats.vertexCount=0,t.stats.tileCount=0),i.modules.mouseMoveHandler.update(),i.handlers.forEach((function(t){return t.update()})),qt(t),Nt(t),Dt(t),Gt(t),i.stillnessUpdater.update(t),Lt(t,i.modules.layout.rootContainer),function(t,e,n){gt("viewport",{step:function(t,r){t.viewport={top:r[0],right:r[1],bottom:r[2],left:r[3]},Tt(t,e,n)}},t)}(t,i.modules.layout.rootContainer,i.modules.renderer),function(t,e){gt("padding",{step:function(t,n){t.padding={top:n[0],right:n[1],bottom:n[2],left:n[3]},Et(t,e)}},t)}(t,i.modules.renderer),i.modules.buildingHeightAnimator.update(),i.modules.trafficTileLayer.update(),i.modules.layers.getLayers().forEach((function(t){void 0!==t.update&&t.update()})),i.modules.tileManager.update(),i.modules.floorManager.update(),i.modules.personalPoiManager.update(),i.modules.ruler.update(),i.modules.map.emit("update"),i.modules.labeler.update(),i.performanceChecker.update(),i.modules.identifier.update(),(a.render.alwaysRerender||t.needRerender)&&(i.modules.renderer.clear(),i.modules.renderer.render(i.modules.tileManager),t.needRerender=!1,t.collectStats&&i.modules.map.emit("stats",t.stats)),i.modules.map.update(),i.modules.map.emit("frameend")},this.onWindowUnload=function(){var t=i.performanceChecker.getEarlyFps();void 0!==t&&ee({eventAction:"FPS",eventLabel:"Early",eventValue:t})};var o=Object(w.a)(Object(w.a)({},t.options),n),l=Object(w.a)(Object(w.a)({},t.options.padding),o.padding),d=Object(w.a)(Object(w.a)({},t.options.viewport),o.viewport),f=o.maxBounds?u.g(o.maxBounds):c.s,h=Object(c.l)(o.center);u.b(h,f,h);var p,m,v,_,g,y=this.state={time:Date.now(),center:h,zoom:void 0!==o.styleZoom?Object(c.h)(o.styleZoom,h):o.zoom,styleZoom:void 0!==o.styleZoom?o.styleZoom:Object(c.f)(o.zoom,h),zoomTypePreserving:void 0!==o.styleZoom?"styleZoom":"zoom",minZoom:o.minZoom,maxZoom:o.maxZoom,maxBounds:f,rotation:Object(s.h)(o.rotation),pitch:Object(s.h)(o.pitch),minPitch:Object(s.h)(o.minPitch),maxPitch:Object(s.h)(o.maxPitch),size:[Math.max(1,e.clientWidth-d.left-d.right),Math.max(1,e.clientHeight-d.top-d.bottom)],tickers:{},stillness:1,needRerender:!0,needLabeling:!1,userHasInteracted:!1,viewport:d,padding:l,labelingOpacity:0,fontUrl:o.fontUrl,tileServer:o.tileServer,tileSet:o.tileSet,tileProtocol:o.tileProtocol,subdomains:o.subdomains.split(""),floorsEnabled:o.floorsEnabled,floorsUrl:o.floorsUrl,collectStats:o.collectStats,stats:{tileCount:0,dynamicTileCount:0,drawCount:0,vertexCount:0},promoMode:o.promoMode,trafficUrl:o.trafficServer,identifyPickDistance:a.identify.pickDistance,lang:o.lang,tileServerDefaultLang:o.tileServerDefaultLang,tileKey:o.key,appId:o.appId,disableCommercialPoi:o.disableCommercialPoi,disableHoverStyles:o.disableHoverStyles,disableRotationByUserInteraction:!!o.disableRotationByUserInteraction,disablePitchByUserInteraction:!!o.disablePitchByUserInteraction,performanceCaveatEmitted:!1,sessionId:o.sessionId,shownRegionIds:new Set,preserveDrawingBuffer:!!o.preserveDrawingBuffer,styleServer:o.styleServer||a.customStyleServerUrl,defaultBackgroundColor:o.defaultBackgroundColor,styleState:{}};this.modules=new Ja(y,e,r),this.modules.styleManager.setDynamicStyle(this.modules.dynamicStyle.getStyle()),this.handlers=[new se(y,this.modules.layout.mapContainer),new le(y,this.modules)],o.disableZoomOnScroll||this.handlers.push(new ie(y,this.modules.layout.mapContainer)),Qt&&$t&&this.handlers.push(new ue(y,e,r)),this.performanceChecker=new de(y),this.stillnessUpdater=new pe,this.requestedFrame=requestAnimationFrame(this.renderLoop),o.sendAnalytics&&(p=window,m=document,v="script",p.GoogleAnalyticsObject="ga",p.ga=p.ga||function(){(p.ga.q=p.ga.q||[]).push(arguments)},p.ga.l=Date.now(),_=m.createElement(v),g=m.getElementsByTagName(v)[0],_.async=1,_.src="https://www.google-analytics.com/analytics.js",g.parentNode.insertBefore(_,g),window.ga&&(window.ga("create",a.analytics.gaCode,{storage:"none",name:a.analytics.gaName,sampleRate:80}),window.ga(a.analytics.gaName+".set","anonymizeIp",!0),window.ga(a.analytics.gaName+".send","pageview")),window.addEventListener("unload",this.onWindowUnload))}return t.prototype.destroy=function(){cancelAnimationFrame(this.requestedFrame),this.modules.destroy(),this.handlers.forEach((function(t){return t.destroy()})),window.removeEventListener("unload",this.onWindowUnload)},t.prototype.isIdle=function(){return this.modules.tileManager.isIdle()&&this.modules.assetManager.isIdle()&&this.modules.trafficTileLayer.isIdle()&&this.modules.labeler.isIdle()&&this.modules.layers.getLayers().every((function(t){return!("isIdle"in t)||t.isIdle()}))},t.options={center:[0,0],zoom:0,minZoom:a.MAP_DEFAULTS.minZoom,maxZoom:a.MAP_DEFAULTS.maxZoom,rotation:0,pitch:0,minPitch:0,maxPitch:45,viewport:{top:0,right:0,bottom:0,left:0},padding:{top:0,right:0,bottom:0,left:0},fontUrl:a.fonts.url,tileServer:a.tiles.server,tileSet:a.tiles.tileSet,tileProtocol:a.tiles.protocol,key:a.tiles.tileKey,subdomains:a.tiles.subdomains,floorsEnabled:a.floors.enabled,floorsUrl:a.floors.url,trafficServer:a.traffic.host,collectStats:!1,promoMode:!1,sendAnalytics:!0,lang:a.defaultLang,appId:a.tiles.appId,disableCommercialPoi:!1,disableHoverStyles:!1,disableZoomOnScroll:!1,disableRotationByUserInteraction:!1,disablePitchByUserInteraction:!1,defaultBackgroundColor:"#f6f2de"},t}(),$a=(n(93),n(88)),ts=n(89),es=n(33),ns=["zoom","rotation","pitch","center"],rs=function(t){function e(e,n){var r=t.call(this)||this,i=r.core=new Qa(e,n,r);if(r.state=i.state,r.modules=i.modules,r.performanceChecker=i.performanceChecker,r.values={isMoveChanging:!1,isIdle:!1},ns.forEach((function(t){r.cloneFromStateToValues(t,t+"1"),r.cloneFromStateToValues(t,t+"2"),r.cloneFromStateToValues(t,t+"End1"),r.cloneFromStateToValues(t,t+"End2"),r.values[t+"EndTime"]=0,r.values["is"+t+"Changing"]=!1})),r.cloneFromStateToValues("size","size"),r.performanceChecker.on("performancecaveat",(function(){r.emit("performancecaveat"),ee({eventAction:"FPS",eventLabel:"performancecaveat"})})),r.performanceChecker.on("fps",(function(t){return ee({eventAction:"FPS",eventLabel:"Average",eventValue:t})})),(null==n?void 0:n.defaultBackgroundColor)&&r.setBackgroundColor(n.defaultBackgroundColor),(null==n?void 0:n.style)&&(r.modules.styleManager.preventOldStyle(),"string"==typeof n.style&&r.setCustomStyleById(n.style),"object"==typeof n.style))switch(n.style.sourceType){case"style":r.setCustomStyle(n.style.source)}return r}return Object(w.c)(e,t),e.prototype.setCenter=function(t,e){if(!Object(s.s)(t))return this;this.state.userHasInteracted=!1;var n=Object(c.l)(t);return Pt(this.state,n,e),this},e.prototype.setZoom=function(t,e){return Object(s.r)(t,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)?(this.state.zoomTypePreserving="zoom",this.state.userHasInteracted=!1,Wt(this.state,t,e),this):this},e.prototype.setStyleZoom=function(t,e){if(!Object(s.r)(t,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER))return this;var n=Object(c.h)(t,this.state.center);return this.state.zoomTypePreserving="styleZoom",this.state.userHasInteracted=!1,Wt(this.state,n,e),this},e.prototype.setMinZoom=function(t,e){return this.state.minZoom=t,this.setZoom(this.state.zoom,e),this},e.prototype.setMaxZoom=function(t,e){return this.state.maxZoom=t,this.setZoom(this.state.zoom,e),this},e.prototype.setRotation=function(t,e){return Object(s.r)(t,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)?(this.state.userHasInteracted=!1,Bt(this.state,Object(s.h)(t),e),this):this},e.prototype.setPitch=function(t,e){return Object(s.r)(t,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)?(this.state.userHasInteracted=!1,Zt(this.state,Object(s.h)(t),e),this):this},e.prototype.setMinPitch=function(t,e){return this.state.minPitch=Object(s.h)(t),this.setPitch(Object(s.B)(this.state.pitch),e),this},e.prototype.setMaxPitch=function(t,e){return this.state.maxPitch=Object(s.h)(t),this.setPitch(Object(s.B)(this.state.pitch),e),this},e.prototype.setViewport=function(t,e){return this.state.userHasInteracted=!1,function(t,e,n,r,i){void 0===i&&(i={});var o=Object(w.a)({top:0,right:0,bottom:0,left:0},r);if(!1===i.animate)t.viewport=o,Tt(t,e,n);else{var a=t.viewport,s=void 0!==i.easing?i.easing:"easeOutCubic",c=void 0!==i.duration?i.duration:300;vt("viewport",{easing:s},t,[a.top,a.right,a.bottom,a.left],[o.top,o.right,o.bottom,o.left],c)}}(this.state,this.modules.layout.rootContainer,this.modules.renderer,t,e),this},e.prototype.setMaxBounds=function(t){return this.state.maxBounds=Object(u.g)(t),this},e.prototype.setPadding=function(t,e){var n=Object(w.a)({top:0,left:0,right:0,bottom:0},t);return this.state.userHasInteracted=!1,function(t,e,n,r){void 0===r&&(r={});var i=function(t,e){return function(t,e){return{top:Math.min(t.top,e[1]),bottom:Math.min(t.bottom,e[1]),left:Math.min(t.left,e[0]),right:Math.min(t.right,e[0])}}(function(t){return{top:Math.max(t.top,0),bottom:Math.max(t.bottom,0),left:Math.max(t.left,0),right:Math.max(t.right,0)}}(t),e)}(n,t.size);if(!1===r.animate)t.padding=i,Et(t,e);else{var o=t.padding,a=void 0!==r.easing?r.easing:"easeOutCubic",s=void 0!==r.duration?r.duration:300;vt("padding",{easing:a},t,[o.top,o.right,o.bottom,o.left],[i.top,i.right,i.bottom,i.left],s)}}(this.state,this.modules.renderer,n,e),this},e.prototype.getPadding=function(){return this.state.padding},e.prototype.getCenter=function(){return Object(c.m)(this.state.center)},e.prototype.getZoom=function(){return this.state.zoom},e.prototype.getStyleZoom=function(){return this.state.styleZoom},e.prototype.getMinZoom=function(){return this.state.minZoom},e.prototype.getMaxZoom=function(){return this.state.maxZoom},e.prototype.getRotation=function(){return Object(s.B)(this.state.rotation)},e.prototype.getPitch=function(){return Object(s.B)(this.state.pitch)},e.prototype.getViewport=function(){return this.state.viewport},e.prototype.getSize=function(){return[this.state.size[0],this.state.size[1]]},e.prototype.getWebGLContext=function(){return this.modules.renderer.getRenderingContext()},e.prototype.getCanvas=function(){return this.modules.layout.canvas},e.prototype.enableRuler=function(){this.modules.ruler.enable()},e.prototype.setRulerPoints=function(t){this.modules.ruler.enabled||this.modules.ruler.enable(),this.modules.ruler.setPoints(t)},e.prototype.disableRuler=function(){this.modules.ruler.disable()},e.prototype.showTraffic=function(){this.modules.trafficTileLayer.show()},e.prototype.hideTraffic=function(){this.modules.trafficTileLayer.hide()},e.prototype.setPersonalPoi=function(t){this.modules.personalPoiManager.setPersonalPoi(t)},e.prototype.setSelectedIds=function(t){return void 0===t&&(t=[]),this.modules.tileManager.setSelectedIds(t.map(wt.b).filter((function(t){return!Number.isNaN(t[0])&&!Number.isNaN(t[1])}))),this.modules.identifier.debouncedFillCache(),this},e.prototype.invalidateSize=function(){this.state.userHasInteracted=!1;var t=window.devicePixelRatio,e=this.state.viewport,n=this.modules.layout.rootContainer,r=n.clientWidth,i=n.clientHeight;return this.state.size=[Math.max(1,r-e.left-e.right),Math.max(1,i-e.top-e.bottom)],this.modules.renderer.setPixelRatio(t),this.modules.renderer.setSize(r,i),this.state.needRerender=!0,this},e.prototype.destroy=function(){this.core.destroy()},e.prototype.refresh=function(){return this.state.needRerender=!0,this.state.needLabeling=!0,this.modules.identifier.resetCache(),this},e.prototype.changeFloorNumber=function(t,e){return this.modules.floorManager.changeFloorNumber(t,e),this},e.prototype.setPromoMode=function(t){return this.state.promoMode=t,this.modules.labeler.resetHysteresis(),this},e.prototype.setBackgroundColor=function(t){return this.modules.renderer.setClearColor(t),this},e.prototype.setCustomStyleById=function(t,e){return Object(w.b)(this,void 0,void 0,(function(){var n,r;return Object(w.d)(this,(function(i){switch(i.label){case 0:return n=Object(s.K)(this.state.styleServer,{id:t}),[4,new Promise((function(t){Object(es.b)({url:n},(function(e,n){void 0!==e&&t(),t(n)}))}))];case 1:return(r=i.sent())&&r.result?[2,this.setCustomStyle(r.result,e)]:(console.error("There are no correct styles by the URL: ",n),[2])}}))}))},e.prototype.setCustomStyle=function(t,e){var n=function(t,e){var n,r,i,o=Object($a.convertMapGLStyleToZss)(t,!1);if(e){var a=function(t,e){var n="",r={},i=new Map,o=[];return e.forEach((function(e){var a=e.afterId,s=e.style,c=t.layers.findIndex((function(t){return t.id===a}));-1!==c?(Object.assign(r,function(t,e){var n=Object(w.a)({},t);for(var r in n)n[r]+=e;return n}(s.phases,c)),n+="\n\n"+s.zss+"\n\n",s.rasterSets.forEach((function(t){return i.set(t.name,t)})),o.push.apply(o,s.labelingGroups)):console.log("Not found layer "+a+" in style "+t.name)})),{zss:n,phases:r,rasterSets:Array.from(i.values()),labelingGroups:o}}(t,e);o.zss+=a.zss,i=a.phases,(n=o.rasterSets).push.apply(n,a.rasterSets),null===(r=o.labelingGroupConfig.groups)||void 0===r||r.push.apply(r,a.labelingGroups)}return{zss:Object(ts.convertStyle)({labelingGroups:o.labelingGroupConfig,rasterSets:o.rasterSets,zss:o.zss,phases:i}),styleStateKeys:o.globalVars,errors:o.errors,backgroundColor:o.backgroundColor}}(t,e),r=n.zss,i=n.backgroundColor,o=n.errors;if(o.length)return console.error("Style convertation errors: ",o),this;var s={version:t.version.toString(),ast:r.ast,curves:r.curves,fonts:r.fonts,rasterSets:r.rasterSets,labelingGroups:r.labelingGroups,urls:{icons:{png:"",svg:t.iconBaseUrl||""}},styleStateKeys:n.styleStateKeys};this.setBackgroundColor(i),t.layers.find((function(t){return function t(e){if("all"===e[0])return e.slice(1).reduce((function(e,n){return e.concat(t(n))}),[]);var n=e[0],r=e.slice(1);return"match"!==n||"get"!==r[0][0]?[]:"sublayer"===r[0][1]?Object(w.e)(r[1]):[]}(t.filter).find((function(t){return a.commercialSublayers.includes(t)}))}))&&(this.state.disableCommercialPoi=!1);var c=this.modules.styleManager.createStyle(s);return this.modules.styleManager.useSingleStyle(c.id),this.modules.tileManager.redraw(),this.modules.trafficTileLayer.redraw(),this.modules.modelManager.resetCache(),this.modules.floorManager.resetCache(),this.modules.personalPoiManager.redraw(),this},e.prototype.useOldStyles=function(){return this.modules.styleManager.useSingleStyle(void 0),this.modules.tileManager.redraw(),this.modules.trafficTileLayer.redraw(),this.modules.modelManager.resetCache(),this.modules.floorManager.resetCache(),this.modules.personalPoiManager.redraw(),this},e.prototype.waitForGpuToFinishDrawing=function(){return this.modules.renderer.getPixels(),this},e.prototype.setLang=function(t){this.state.lang=t,this.modules.tileManager.redraw()},e.prototype.getContainer=function(){return this.modules.layout.mapContainer},e.prototype.getExternalContainer=function(){return this.modules.layout.externalContainer},e.prototype.fitBounds=function(t,e){var n,r,i=t.northEast,o=t.southWest,a=Object(w.a)({top:0,left:0,right:0,bottom:0},(null==e?void 0:e.padding)?e.padding:{}),c=this.getViewport(),l=this.getPadding(),u=(null==e?void 0:e.skipMapPadding)?a:(r=a,{top:(n=l).top+r.top,bottom:n.bottom+r.bottom,left:n.left+r.left,right:n.right+r.right}),d=this.getSize(),h=(null==e?void 0:e.considerRotation)?this.getRotation():0;if(d[0]-u.left-u.right<=0||d[1]-u.top-u.bottom<=0)return console.warn("Map cannot fit within canvas with the given bounds and padding."),this;(null==e?void 0:e.considerRotation)||Bt(this.state,h,{animate:!1});var p=f([[o[0],i[1]],i,[i[0],o[1]],o],h,[d[0]-u.left-u.right,d[1]-u.top-u.bottom]);if(!p)return console.warn("Map cannot fit within canvas with the given bounds and padding."),this;var m=[(d[0]-u.left-u.right)/2+u.left+c.left,(d[1]-u.top-u.bottom)/2+u.top+c.top],v=Object(s.A)(Object(w.a)(Object(w.a)({},this.state),{center:p.center,zoom:Object(s.e)(p.zoom,this.state.minZoom,this.state.maxZoom),pitch:0}),m),_=[0,0];T.p(_,p.center,v);var g=[0,0,0];return T.a(g,p.center,_),Pt(this.state,g,null==e?void 0:e.animation),Wt(this.state,p.zoom,null==e?void 0:e.animation),Zt(this.state,0,null==e?void 0:e.animation),this},e.prototype.update=function(){var t=this,e=this.state,n=e.time,r=e.userHasInteracted,i=this.values,o={};ns.forEach((function(r){var a=e[r];"zoom"===r&&"styleZoom"===e.zoomTypePreserving&&(a=e.styleZoom),o[r+"start"]=!i["is"+r+"Changing"]&&!t.areEqual(a,i[r+"1"])&&t.areEqual(i[r+"1"],i[r+"2"]),o[r+"start"]&&(i["is"+r+"Changing"]=!0),i["is"+r+"Changing"]&&(o[r]=!t.areEqual(a,i[r+"1"]),n-i[r+"EndTime"]>150&&(o[r+"end"]=t.areEqual(a,i[r+"End1"])&&!t.areEqual(i[r+"End1"],i[r+"End2"]),o[r+"end"]&&(i["is"+r+"Changing"]=!1),t.copyFromValuesToValues(r+"End2",r+"End1"),t.copyFromStateToValues(a,r+"End1"),i[r+"EndTime"]=n)),t.copyFromValuesToValues(r+"2",r+"1"),t.copyFromStateToValues(a,r+"1")})),o.resize=!this.areEqual(e.size,i.size),this.copyFromStateToValues(e.size,"size"),o.movestart=(o.zoomstart||o.rotationstart||o.centerstart||o.pitchstart)&&!i.isMoveChanging,o.movestart&&(i.isMoveChanging=!0),o.move=i.iszoomChanging||i.isrotationChanging||i.iscenterChanging||i.ispitchChanging,o.moveend=(o.zoomend||o.rotationend||o.centerend||o.pitchend)&&!o.move,o.moveend&&(i.isMoveChanging=!1);var a=i.isIdle;for(var s in i.isIdle=!i.isMoveChanging&&this.core.isIdle(),o.idle=!a&&i.isIdle,o){var c=s;o[c]&&this.emit(c,{isUser:r})}},e.prototype.setAutoHoverMode=function(t){this.modules.tileManager.regionalTileLayer.resetHoverId(),this.modules.tileManager.universeTileLayer.resetHoverId(),this.state.disableHoverStyles=!t},e.prototype.setStyleState=function(t){this.state.styleState=t},e.prototype.patchStyleState=function(t){var e=this.state;e.styleState=Object(w.a)(Object(w.a)({},e.styleState),t)},e.prototype.copyFromStateToValues=function(t,e){is(t)?T.c(this.values[e],t):this.values[e]=t},e.prototype.cloneFromStateToValues=function(t,e){var n=this.state[t];is(n)?this.values[e]=T.b(n):this.values[e]=n},e.prototype.copyFromValuesToValues=function(t,e){var n=this.values[e];is(n)?T.c(this.values[t],n):this.values[t]=n},e.prototype.areEqual=function(t,e){return is(t)&&is(e)?T.i(t,e):t===e},e}(S.a);function is(t){return void 0!==t.length}function os(t,e,n){var r=Object(s.m)(t,e),i=r.a,o=r.b,a=r.c;return l.i(-(o*n+a)/i,n,0)}var as=u.e(),ss=u.e();function cs(t,e){var n=t[0];u.h(as),u.f(as,n);for(var r,i,o,a,c,d,f,h=[n],p=[h],m=1;m<t.length;){var v=t[m],_=!1,g=v;u.d(ss,as),u.f(ss,g),ss.max[0]-ss.min[0]>e&&(r=n,i=g,o=ss.max[0]===g[0]?ss.min[0]+e:ss.max[0]-e,c=(a=Object(s.m)(r,i)).a,d=a.b,f=a.c,g=l.i(o,-(c*o+f)/d,0),_=!0),_&&(u.d(ss,as),u.f(ss,g)),ss.max[1]-ss.min[1]>e&&(g=os(n,g,ss.max[1]===g[1]?ss.min[1]+e:ss.max[1]-e),_=!0),_?(h.push(g),u.h(as),u.f(as,g),h=[g],p.push(h),n=g):(h.push(v),u.f(as,v),n=v,m++)}return p}function ls(t,e,n){var r=t[0]-e[0],i=t[1]-e[1],o=n[0]-e[0],a=n[1]-e[1],s=o*o+a*a,c=0!==s?(r*o+i*a)/s:0;return c<0?e:c>1?n:[e[0]+c*o,e[1]+c*a]}var us=function(t){function e(n,r){var i=t.call(this,n)||this;i.removed=!1,i.options=Object(s.b)(r,e.options),i.geoPoints=i.options.coordinates.filter((function(t,e,n){return 0===e||!Object(s.i)(n[e],n[e-1])})),i.points=i.geoPoints.map(c.l);var o=0;i.distances=[],i.distances.push(o);for(var a=1;a<i.geoPoints.length;a++)o+=Object(c.a)(i.geoPoints[a-1],i.geoPoints[a]),i.distances.push(o);i.stateDiffer=new oe([{path:"center",type:"vec2"},{path:"zoom",type:"number"},{path:"size",type:"vec2"},{path:"rotation",type:"number"},{path:"pitch",type:"number"},{path:"padding",type:"padding"}]),i.debouncedGenerate=Object(he.a)((function(){i.generate()}),200);var l=i.modules,u=l.dynamicStyle,d=l.layers;return i.style=u.extractCurvesFromStyle({phase:i.options.phase,phase2:i.options.phase2,phase3:i.options.phase3,minZoom:i.options.minZoom,maxZoom:i.options.maxZoom,color:Object(jt.b)(i.options.color),color2:Object(jt.b)(i.options.color2),color3:Object(jt.b)(i.options.color3),width:Object(jt.c)(i.options.width),width2:Object(jt.c)(i.options.width2),width3:Object(jt.c)(i.options.width3)}),i.styleAttrs=Object(jt.e)(i.style),i.tileAttrs=Object(jt.f)({id:i.options.interactive?[0,0]:NaN,beginningIsCut:0,endingIsCut:0}),d.addLayer(i),i.generate(),i}return Object(w.c)(e,t),e.prototype.update=function(){this.stateDiffer.check(this.mapState)&&this.debouncedGenerate()},e.prototype.remove=function(){this.removed=!0,this.options.interactive&&this.modules.identifier.resetCache(),t.prototype.destroy.call(this)},e.prototype.snapPoint=function(t){for(var e=this.mapState,n=this.points.map((function(t){return Object(s.y)(e,t)})),r=1/0,i=n[0],o=0,a=0;a<n.length-1;a++){var l=ls(t,n[a],n[a+1]),u=l[0]-t[0],d=l[1]-t[1],f=u*u+d*d;f<r&&(r=f,i=l,o=a)}var h=Object(c.m)(Object(s.A)(e,i));return{point:h,distance:this.distances[o]+Object(c.a)(h,this.geoPoints[o])}},e.prototype.setStyle=function(t){var e=t.color,n=t.color2,r=t.color3,i=this.modules.dynamicStyle;void 0!==e&&i.updateCurve(this.style.color,Object(jt.b)(e)),void 0!==n&&void 0!==this.style.color2&&i.updateCurve(this.style.color2,Object(jt.b)(n)),void 0!==r&&void 0!==this.style.color3&&i.updateCurve(this.style.color3,Object(jt.b)(r)),this.mapState.needRerender=!0},e.prototype.generate=function(){var t=this;if(!(this.points.length<2||this.removed)){var e=this.modules,n=e.dynamicStyle,r=e.collector,i=e.renderer,o=e.tileManager,a=e.identifier,s=e.map,d=x.a.tileProps,f=Math.min(Math.floor(s.getZoom()),12),h=Object(c.r)(f),p=cs(this.points,h),m=l.d(),v=u.e();this.tileObjects.forEach((function(e){e.clean(t.mapState),o.removeObject(e)})),this.tileObjects=[];for(var _=0;_<p.length;_++){var g=p[_];u.h(v);for(var y=0;y<g.length;y++)u.f(v,g[y]);u.a(m,v);var b=Object(c.g)(m,f);if(Object(mi.n)(b,o.getViewportVertices())){if(this.options.displayTileBounds){Object(ri.a)(r,b);var w=r.getAccumulatedData(),S=new xt("dynamicObject",w.data,i,b);this.tileObjects.push(S),o.addObject(S)}var O=Object(mi.e)(b),M=[[],[]];for(y=0;y<g.length;y++)Object(c.k)(m,g[y],O),M[0][y]=m[0],M[1][y]=m[1];this.tileAttrs[d.beginningIsCut]=0,this.tileAttrs[d.endingIsCut]=0,0!==_&&(this.tileAttrs[d.beginningIsCut]=1),_+1!==p.length&&(this.tileAttrs[d.endingIsCut]=1),Object(A.c)("polyline",n.getStyle(),x.a,r,this.styleAttrs,this.tileAttrs,M,g.length,b,-1,-1);var j=r.getAccumulatedData(),I=new xt("dynamicObject",j.data,i,O.coords);o.addObject(I),this.tileObjects.push(I),this.options.interactive&&this.identifyIds.push(j.identifyIds)}}this.options.interactive&&a.resetCache(),r.reset(),this.mapState.needRerender=!0}},e.options={coordinates:[],phase:0,phase2:-1,phase3:-2,minZoom:NaN,maxZoom:NaN,width:3,width2:0,width3:0,color:"#3388ff",color2:"#00000000",color3:"#00000000",interactive:!0,displayTileBounds:!1},e}(j),ds=function(t){function e(n,r){var i=t.call(this,n)||this;i.removed=!1,i.options=Object(s.b)(r,e.options),i.points=i.options.coordinates.map(c.l),i.stateDiffer=new oe([{path:"center",type:"vec2"},{path:"zoom",type:"number"},{path:"size",type:"vec2"},{path:"rotation",type:"number"},{path:"pitch",type:"number"},{path:"padding",type:"padding"}]),i.debouncedGenerate=Object(he.a)((function(){i.generate()}),200);var o=i.modules,a=o.dynamicStyle,l=o.layers;return i.style=a.extractCurvesFromStyle({phase:i.options.phase,phase2:i.options.phase2,minZoom:i.options.minZoom,maxZoom:i.options.maxZoom,dashColor:Object(jt.b)(i.options.dashColor),dash2Color:Object(jt.b)(i.options.dash2Color),dashLength:Object(jt.c)(i.options.dashLength),dash2Length:Object(jt.c)(i.options.dash2Length),spaceLength:Object(jt.c)(i.options.gapLength),width:Object(jt.c)(i.options.width),width2:Object(jt.c)(i.options.width2),spaceColor:Object(jt.b)(i.options.gapColor)}),i.styleAttrs=Object(jt.e)(i.style),i.tileAttrs=Object(jt.f)({previousPointX:0,previousPointY:0,nextPointX:0,nextPointY:0,beginningIsCut:0,endingIsCut:0,componentDistanceStart:0,objectLength:0,id:i.options.interactive?[0,0]:NaN}),l.addLayer(i),i.generate(),i}return Object(w.c)(e,t),e.prototype.update=function(){this.stateDiffer.check(this.mapState)&&this.debouncedGenerate()},e.prototype.remove=function(){this.removed=!0,this.options.interactive&&this.modules.identifier.resetCache(),t.prototype.destroy.call(this)},e.prototype.setStyle=function(t){var e=t.dashColor,n=t.dash2Color,r=t.gapColor,i=this.modules.dynamicStyle;void 0!==e&&i.updateCurve(this.style.dashColor,Object(jt.b)(e)),void 0!==n&&i.updateCurve(this.style.dash2Color,Object(jt.b)(n)),void 0!==r&&void 0!==this.style.spaceColor&&i.updateCurve(this.style.spaceColor,Object(jt.b)(r)),this.mapState.needRerender=!0},e.prototype.generate=function(){var t=this;if(!(this.points.length<2||this.removed)){var e=this.modules,n=e.dynamicStyle,r=e.collector,i=e.renderer,o=e.tileManager,a=e.map,s=e.identifier,d=x.a.tileProps,f=Math.min(Math.floor(a.getZoom()),12),h=Object(c.r)(f),p=cs(this.points,h),m=l.d(),v=u.e();this.tileObjects.forEach((function(e){e.clean(t.mapState),o.removeObject(e)})),this.tileObjects=[];for(var _=[],g=0,y=0,b=p;y<b.length;y++){var w=b[y];u.h(v);for(var S=0;S<w.length;S++)u.f(v,w[S]);u.a(m,v);var O=Object(c.g)(m,f),M=Object(mi.e)(O),j=[[],[]],I=0;for(S=0;S<w.length;S++)if(Object(c.k)(m,w[S],M),j[0][S]=m[0],j[1][S]=m[1],0!==S){var T=j[0][S]-j[0][S-1],E=j[1][S]-j[1][S-1];I+=Math.sqrt(T*T+E*E)}g+=I,_.push({vertices:j,tileInfo:M,distance:I})}var L=0;_.forEach((function(e,a){var s,l=e.tileInfo,u=e.distance,f=e.vertices;if(t.options.displayTileBounds){Object(ri.a)(r,l.coords);var h=r.getAccumulatedData(),v=new xt("dynamicObject",h.data,i,l.coords);t.tileObjects.push(v),o.addObject(v)}if(t.tileAttrs[d.beginningIsCut]=0,t.tileAttrs[d.endingIsCut]=0,t.tileAttrs[d.previousPointX]=0,t.tileAttrs[d.previousPointY]=0,t.tileAttrs[d.nextPointX]=0,t.tileAttrs[d.nextPointY]=0,t.tileAttrs[d.componentDistanceStart]=L,L+=u,t.tileAttrs[d.objectLength]=g,0!==a){var y=(s=p[a-1])[s.length-2];Object(c.k)(m,y,l),t.tileAttrs[d.beginningIsCut]=1,t.tileAttrs[d.previousPointX]=m[0],t.tileAttrs[d.previousPointY]=m[1]}if(a!==_.length-1&&(y=(s=p[a+1])[1],Object(c.k)(m,y,l),t.tileAttrs[d.endingIsCut]=1,t.tileAttrs[d.nextPointX]=m[0],t.tileAttrs[d.nextPointY]=m[1]),Object(mi.n)(l.coords,o.getViewportVertices())){Object(A.c)("dashedLine",n.getStyle(),x.a,r,t.styleAttrs,t.tileAttrs,f,f[0].length,l.coords,-1,-1);var b=r.getAccumulatedData(),w=new xt("dynamicObject",b.data,i,l.coords);o.addObject(w),t.tileObjects.push(w),t.options.interactive&&t.identifyIds.push(b.identifyIds)}})),this.options.interactive&&s.resetCache(),r.reset(),this.mapState.needRerender=!0}},e.options={coordinates:[],phase:0,phase2:-1,minZoom:NaN,maxZoom:NaN,width:8,width2:12,dashColor:"#2480ff",dash2Color:"#ffffff",dashLength:6,dash2Length:10,gapLength:20,gapColor:"#ffffff00",interactive:!0,displayTileBounds:!1},e}(j),fs=n(51),hs=function(t){function e(n,r){var i=t.call(this,n)||this;i.options=Object(s.b)(r,e.options),i.rings=i.options.coordinates.map((function(t){return t.map(c.l)})),i.points=[],i.holeIndices=[],i.rings.forEach((function(t){var e;i.points.length&&i.holeIndices.push(i.points.length),(e=i.points).push.apply(e,t)}));var o=i.modules,a=o.dynamicStyle,d=o.collector,f=o.renderer,h=o.tileManager,p=o.identifier,m=o.layers,v={phase:i.options.phase,minZoom:i.options.minZoom,maxZoom:i.options.maxZoom,color:Object(jt.b)(i.options.color)};i.style=a.extractCurvesFromStyle(v);for(var _=Object(jt.e)(i.style),g=Object(jt.f)({id:i.options.interactive?[0,0]:NaN}),y=i.points,b=u.e(),w=0;w<y.length;w++)u.f(b,y[w]);for(var S=Object(c.d)(b),O=Object(mi.e)(S),M=[],j=0;j<y.length;j++)M.push(y[j][0]),M.push(y[j][1]);var I=fs(M,i.holeIndices),T=l.d(),E=[[],[],[]];for(j=0;j<I.length;j+=3){for(w=0;w<3;w++)Object(c.k)(T,y[I[j+w]],O),E[0][w]=T[0],E[1][w]=T[1],E[2][w]=0;Object(A.c)("polygon",a.getStyle(),x.a,d,_,g,E,3,S,-1,-1)}var L={phase:i.options.phase+1,minZoom:i.options.minZoom,maxZoom:i.options.maxZoom,width:i.options.borderWidth,color:Object(jt.b)(i.options.borderColor)};i.borderStyle=a.extractCurvesFromStyle(L);var C=Object(jt.e)(i.borderStyle),P=Object(jt.f)({id:i.options.interactive?[0,0]:NaN,beginningIsCut:0,endingIsCut:0});0!==i.options.borderWidth&&i.rings.forEach((function(t){t.forEach((function(t,e){Object(c.k)(T,t,O),E[0][e]=T[0],E[1][e]=T[1]})),Object(A.c)("polyline",a.getStyle(),x.a,d,C,P,E,t.length,S,-1,-1)}));var k=d.getAccumulatedData(),N=new xt("dynamicObject",k.data,f,O.coords);return h.addObject(N),i.tileObjects.push(N),i.options.interactive&&i.identifyIds.push(k.identifyIds),m.addLayer(i),d.reset(),i.mapState.needRerender=!0,i.options.interactive&&p.resetCache(),i}return Object(w.c)(e,t),e.prototype.remove=function(){this.options.interactive&&this.modules.identifier.resetCache(),this.borderStyle&&this.modules.dynamicStyle.removeExtractedCurves(this.borderStyle),t.prototype.destroy.call(this)},e.options={coordinates:[],phase:0,minZoom:NaN,maxZoom:NaN,color:"#3388ff33",borderColor:"#3388ff",borderWidth:3,interactive:!0},e}(j),ps=function(t){function e(n,r){var i=t.call(this,n)||this;i.options=Object(s.b)(r,e.options),i.points=i.createCircle(Object(c.l)(i.options.coordinates),Object(c.b)(i.options.coordinates,i.options.radius));var o=i.modules,a=o.dynamicStyle,d=o.collector,f=o.renderer,h=o.tileManager,p=o.identifier,m=o.layers,v={phase:i.options.phase,minZoom:i.options.minZoom,maxZoom:i.options.maxZoom,borderWidth:i.options.borderWidth,color:Object(jt.b)(i.options.color),borderColor:Object(jt.b)(i.options.borderColor)};i.style=a.extractCurvesFromStyle(v);for(var _=Object(jt.e)(i.style),g=Object(jt.f)({id:i.options.interactive?[0,0]:NaN}),y=i.points,b=u.e(),w=0;w<y.length;w++)u.f(b,y[w]);var S=Object(c.d)(b),O=Object(mi.e)(S),M=[[],[],[]],j=l.d();for(w=0;w<y.length;w++)Object(c.k)(j,y[w],O),M[0][w]=j[0],M[1][w]=j[1],M[2][w]=1;Object(A.c)("polygon",a.getStyle(),x.a,d,_,g,M,y.length,S,-1,-1);var I=d.getAccumulatedData(),T=new xt("dynamicObject",I.data,f,O.coords);return i.options.interactive&&i.identifyIds.push(I.identifyIds),i.tileObjects.push(T),h.addObject(T),m.addLayer(i),d.reset(),i.mapState.needRerender=!0,i.options.interactive&&p.resetCache(),i}return Object(w.c)(e,t),e.prototype.remove=function(){this.options.interactive&&this.modules&&this.modules.identifier.resetCache(),t.prototype.destroy.call(this)},e.prototype.createCircle=function(t,e){var n=[],r=Math.PI/Math.ceil(this.options.segments/2);n.push(l.i(t[0]+e,t[1],t[2]));for(var i=r;i<Math.PI;i+=r){var o=e*Math.cos(i),a=e*Math.sin(i);n.push(l.i(t[0]+o,t[1]+a,t[2]),l.i(t[0]+o,t[1]-a,t[2]))}return n.push(l.i(t[0]-e,t[1],t[2])),n},e.options={coordinates:[0,0],radius:0,phase:0,minZoom:NaN,maxZoom:NaN,color:"#3388ff33",borderColor:"#3388ff",borderWidth:1,segments:150,interactive:!0},e}(j),ms=n(28),vs=n(80),_s=n(74),gs=function(t){function e(e,n){var r=t.call(this,e)||this;r.options=n,r.isHidden=!1,r.position=Object(c.l)(r.options.coordinates);var i=r.modules,o=i.dynamicStyle,a=i.collector,s=i.renderer,l=i.tileManager,u=i.identifier,d=i.layers,f=i.imageManager;return Promise.resolve().then((function(){var t=r.options.image,e=t.url,n=t.size,i=t.pixelRatio;return f.loadTexture(e,{size:n,pixelRatio:i,imagePadding:N.a})})).then((function(t){if(void 0!==t){Object(A.a)({collector:a,generator:cr.generateStretchableImage,args:[r.options.image,r.options.targetSize,r.options.offset||[0,0],[0,0],o.getStyle(),x.a,Object(jt.e)({minZoom:r.options.minZoom||NaN,maxZoom:r.options.maxZoom||NaN,phase:r.options.zIndex||0}),Object(jt.f)({id:r.options.interactive?[0,0]:void 0}),t]});var e=a.getAccumulatedData();r.tileObject=new xt("dynamicObject",e.data,s,Object(c.j)(r.position)),r.options.interactive&&r.identifyIds.push(e.identifyIds),l.addObject(r.tileObject),r.tileObjects.push(r.tileObject),d.addLayer(r),a.reset(),r.mapState.needRerender=!0,r.options.interactive&&u.resetCache()}})),r}return Object(w.c)(e,t),e.prototype.destroy=function(){this.options.interactive&&this.modules&&this.modules.identifier.resetCache(),t.prototype.destroy.call(this)},e.prototype.hide=function(){this.isHidden||(this.isHidden=!0,this.tileObject&&this.modules.tileManager.removeObject(this.tileObject))},e.prototype.show=function(){this.isHidden&&(this.isHidden=!1,this.tileObject&&this.modules.tileManager.addObject(this.tileObject))},e.prototype.setCoordinates=function(t){var e=this;this.position=Object(c.l)(t),this.tileObjects.forEach((function(t){t.setTileCoords(Object(c.j)(e.position))})),0===this.tileObjects.length||this.isHidden||(this.mapState.needRerender=!0)},e}(j),ys=function(t){function e(e,n){var r,i=t.call(this,e)||this;i.options=Object(w.a)(Object(w.a)({},n),{font:n.font||"Open_Sans",fontSize:n.fontSize||a.fonts.baseSize,color:n.color||"#000000",haloRadius:n.haloRadius||0,haloColor:n.haloColor||"#ffffff",letterSpacing:n.letterSpacing||0,lineHeight:n.lineHeight||a.fonts.baseLineHeight,zIndex:n.zIndex||0,minZoom:n.minZoom||NaN,maxZoom:n.maxZoom||NaN,anchor:(r=n.anchor,[r&&void 0!==r[0]?Object(s.e)(r[0],0,1):.5,r&&void 0!==r[1]?Object(s.e)(r[1],0,1):.5]),offset:n.offset||[0,0]}),i.position=Object(c.l)(i.options.coordinates),i.isHidden=!1;var o=i.modules,l=o.dynamicStyle,u=o.collector,d={phase:i.options.zIndex+(i.options.image?1e-5:0),minZoom:i.options.minZoom,maxZoom:i.options.maxZoom,color:Object(jt.b)(i.options.color),font:l.getFontIndex(i.options.font),fontSize:i.options.fontSize,symbol:ii.b.labelPoint,haloRadius:i.options.haloRadius,haloColor:Object(jt.b)(i.options.haloColor),lineHeight:i.options.lineHeight,letterSpacing:i.options.letterSpacing,offsetX:i.options.offset[0],offsetY:i.options.offset[1]};i.style=l.extractCurvesFromStyle(d);var f=Object(jt.e)(i.style),h=Object(jt.f)({label:Object(ms.d)(i.options.text)}),p=Object(c.j)(i.position);Object(A.c)("labelPoint",l.getStyle(),x.a,u,f,h,[[0],[0]],1,p,-1,-1);var m=Object(mi.e)(p),v=u.getAccumulatedData(m).labels;if(!v)return i;var _=[{metatileHash:-1,labels:v,styleId:-1}],g=Object(vs.a)(_,Oi.b.DynamicObject);if(1!==g.length)return i;var y=g[0];return Promise.all(y.ranges.map((function(t){return i.modules.assetManager.loadFont(i.options.font,t)}))).then((function(){y.textMetrics=Object(pi.a)(y.label,y.letterSpacing,i.modules.assetManager.getFontGlyphs(i.options.font));var t=i.options,n=t.image,r=t.fontSize,o=t.lineHeight,s=t.anchor,l=r/a.fonts.baseSize,d=r*o*y.textMetrics.lines.length,f=l*y.textMetrics.maxWidth,h=[-f*(s[0]-.5),-d*(s[1]-.5)];Object(_s.generateLabelPoint)(u,y,[0,0,0],0,h);var p=u.getAccumulatedData();if(i.tileObject=new xt("dynamicObject",p.data,i.modules.renderer,Object(c.j)(i.position)),i.isHidden||i.modules.tileManager.addObject(i.tileObject),i.modules.layers.addLayer(i),i.tileObjects.push(i.tileObject),u.reset(),i.mapState.needRerender=!0,n){var m=n.padding||[0,0,0,0],v=m[0],_=m[1],g=m[2],b=m[3],x=i.options.offset,w=x[0],S=x[1],O=h[0],M=h[1];i.backgroundImage=new gs(e,{image:n,coordinates:i.options.coordinates,targetSize:[f+b+_,d+v+g],offset:[(_-b)/2+w+O,(g-v)/2+S+M],zIndex:i.options.zIndex,minZoom:i.options.minZoom,maxZoom:i.options.maxZoom})}})),i}return Object(w.c)(e,t),e.prototype.hide=function(){this.isHidden||(this.isHidden=!0,this.tileObject&&this.modules.tileManager.removeObject(this.tileObject),this.backgroundImage&&this.backgroundImage.hide())},e.prototype.show=function(){this.isHidden&&(this.isHidden=!1,this.tileObject&&this.modules.tileManager.addObject(this.tileObject),this.backgroundImage&&this.backgroundImage.show())},e.prototype.remove=function(){t.prototype.destroy.call(this),this.backgroundImage&&this.backgroundImage.destroy()},e.prototype.setCoordinates=function(t){var e=this;this.position=Object(c.l)(t),this.tileObjects.forEach((function(t){t.setTileCoords(Object(c.j)(e.position))})),this.backgroundImage&&this.backgroundImage.setCoordinates(t),0===this.tileObjects.length||this.isHidden||(this.mapState.needRerender=!0)},e.prototype.getCoordinates=function(){return Object(c.m)(this.position)},e}(j),bs=function(t){function e(e,n){var r=t.call(this,e,n.draggable)||this,i=n.coordinates,o=n.size,s=n.zIndex,l=n.minZoom,u=n.maxZoom,d=n.interactive,f=n.hoverIcon,h=n.hoverSize,p=n.hoverAnchor,m=n.label;r.status="normal",r.isHidden=!1,r.needDestroy=!1,r.position=Object(c.l)(i),r.phase=void 0!==s?s:0,r.minZoom=void 0!==l?l:NaN,r.maxZoom=void 0!==u?u:NaN,r.interactive=void 0===d||d;var v=r.modules,_=v.tileManager,g=v.identifier,y=v.imageCache,b=v.layers,x=void 0!==n.icon?n.icon:a.defaultMarkerIcon,S=void 0!==n.icon?n.anchor:a.defaultMarkerAnchor,O=[y.getRasterSet(x,void 0,o,S)];return m&&(r.label=new ys(e,Object(w.a)({coordinates:i,zIndex:r.phase+1e-5},Object(w.a)(Object(w.a)({},m),{fontSize:m.fontSize||18,anchor:m.anchor||[.5,.5],offset:m.offset||[0,18]})))),void 0!==f&&(O.push(y.getRasterSet(f,void 0,h,p)),r.on("mouseover",r.switchToHoveredStyle),r.on("mouseout",r.switchToNormalStyle)),r.rasterSetsAreLoading=!0,Promise.all(O).then((function(t){var e=r.interactive,n=t[0],i=t[1];r.normalStateData=r.getMarkerStateData(n,x,o),r.isHidden||_.addObject(r.normalStateData.tileObject),r.tileObjects.push(r.normalStateData.tileObject),b.addLayer(r),e&&r.identifyIds.push(r.normalStateData.identifyIds),f&&i&&(r.hoverStateData=r.getMarkerStateData(i,f,h),r.tileObjects.push(r.hoverStateData.tileObject),e&&r.identifyIds.push(r.hoverStateData.identifyIds)),r.rasterSetsAreLoading=!1,r.needDestroy?r.destroy():(r.mapState.needRerender=!0,e&&g.resetCache())})),r}return Object(w.c)(e,t),e.prototype.destroy=function(){var e;if(null===(e=this.label)||void 0===e||e.remove(),this.rasterSetsAreLoading)this.needDestroy=!0;else{var n=this.modules;this.interactive&&n.identifier.resetCache(),this.normalStateData&&n.dynamicStyle.removeExtractedCurves(this.normalStateData.style),this.hoverStateData&&(n.dynamicStyle.removeExtractedCurves(this.hoverStateData.style),this.off("mouseover",this.switchToHoveredStyle),this.off("mouseout",this.switchToNormalStyle)),t.prototype.destroy.call(this)}},e.prototype.getCoordinates=function(){return Object(c.m)(this.getPosition())},e.prototype.show=function(){var t;if(null===(t=this.label)||void 0===t||t.show(),this.isHidden)if(this.rasterSetsAreLoading)this.isHidden=!1;else if("normal"===this.status&&this.normalStateData){var e=this.modules,n=e.tileManager,r=e.identifier;n.addObject(this.normalStateData.tileObject),this.isHidden=!1,this.mapState.needRerender=!0,r.resetCache()}},e.prototype.hide=function(){var t;if(null===(t=this.label)||void 0===t||t.hide(),!this.isHidden)if(this.rasterSetsAreLoading)this.isHidden=!0;else if("normal"===this.status){if(this.normalStateData){var e=this.modules,n=e.tileManager,r=e.identifier;n.removeObject(this.normalStateData.tileObject),this.isHidden=!0,this.mapState.needRerender=!0,r.resetCache()}}else if(this.hoverStateData){var i=this.modules;n=i.tileManager,r=i.identifier,n.removeObject(this.hoverStateData.tileObject),this.status="normal",this.isHidden=!0,this.mapState.needRerender=!0,r.resetCache()}},e.prototype.setCoordinates=function(t){var e;this.setPosition(Object(c.l)(t)),null===(e=this.label)||void 0===e||e.setCoordinates(t)},e.prototype.setPosition=function(t){var e=this.mapState;(0!==this.tileObjects.length||this.rasterSetsAreLoading)&&(this.position=t,0!==this.tileObjects.length&&(this.tileObjects.forEach((function(e){e.setTileCoords(Object(c.j)(t))})),this.isHidden||(e.needRerender=!0)))},e.prototype.getPosition=function(){return this.position},e.prototype.isInteractive=function(){return this.interactive},e.prototype.contains=function(t){if(!this.normalStateData)return!1;var e=this.mapState,n=this.hoverStateData,r=this.normalStateData,i=void 0!==n?n.size:r.size,o=void 0!==n?n.anchor:r.anchor,a=Object(s.y)(e,this.position),c=a[0]-i[0]*o[0],l=a[0]+i[0]*(1-o[0]),u=a[1]-i[1]*o[1],d=a[1]+i[1]*(1-o[1]);return t[0]>c&&t[0]<l&&t[1]>u&&t[1]<d},e.prototype.switchToHoveredStyle=function(){if("normal"===this.status&&!this.isHidden&&this.hoverStateData&&this.normalStateData){var t=this.modules.tileManager;t.removeObject(this.normalStateData.tileObject),t.addObject(this.hoverStateData.tileObject),this.status="hover",this.mapState.needRerender=!0}},e.prototype.switchToNormalStyle=function(){if("hover"===this.status&&!this.isHidden&&this.normalStateData&&this.hoverStateData){var t=this.modules.tileManager;t.removeObject(this.hoverStateData.tileObject),t.addObject(this.normalStateData.tileObject),this.status="normal",this.mapState.needRerender=!0}},e.prototype.getMarkerStateData=function(t,e,n){var r=this,i=r.phase,o=r.minZoom,a=r.maxZoom,s=r.interactive,l=r.position,u=this.modules,d=u.collector,f=u.renderer,h=u.dynamicStyle,p={phase:i,minZoom:o,maxZoom:a,rasterSet:t.index,minWidth:0,maxWidth:0,minWidthZLevel:0,maxWidthZLevel:0},m=Object(jt.e)(p),v=Object(jt.f)({id:s?[0,0]:NaN,dpi:96*window.devicePixelRatio}),_=Object(c.j)(l);Object(A.c)("point",h.getStyle(),x.a,d,m,v,[[0],[0]],1,_,-1,-1);var g=d.getAccumulatedData(),y=g.data,b=g.identifyIds;return d.reset(),{style:p,tileObject:new xt("dynamicObject",y,f,_,this),identifyIds:b,icon:e,anchor:[t.rasters[0].anchorX,t.rasters[0].anchorY],size:n||[t.rasters[0].w/window.devicePixelRatio,t.rasters[0].h/window.devicePixelRatio]}},e}(Mt),xs=n(73),ws=function(t){function e(e,n){var r=t.call(this,e)||this,i=r.modules,o=i.dynamicStyle,a=i.collector,s=i.renderer,d=i.tileManager,f=i.identifier,h=i.layers;r.options=n;var p,m,v,_,g,y,b={color:Object(jt.b)(r.options.color||"#ff0000ff"),phase:r.options.zIndex||0,minZoom:r.options.minZoom||NaN,maxZoom:r.options.maxZoom||NaN};r.style=o.extractCurvesFromStyle(b),r.points=(p=Object(c.l)(r.options.center),m=Object(c.b)(r.options.center,r.options.width)/2,v=Object(c.b)(r.options.center,r.options.height)/2,[[(_=p[0])-m,(g=p[1])-v,y=p[2]],[_+m,g-v,y],[_-m,g+v,y],[_+m,g+v,y]]);for(var w=u.e(),S=0;S<r.points.length;S++)u.f(w,r.points[S]);var O=Object(c.d)(w),M=Object(mi.e)(O),j=[[],[]],I=l.d();for(S=0;S<r.points.length;S++)Object(c.k)(I,r.points[S],M),j[0][S]=I[0],j[1][S]=I[1];Object(A.a)({collector:a,generator:xs.generateRect,args:[j,Object(jt.e)(r.style),Object(jt.f)({id:r.options.interactive?[0,0]:NaN}),o.getStyle(),x.a]});var T=a.getAccumulatedData(),E=new xt("dynamicObject",T.data,s,O);return d.addObject(E),r.tileObjects.push(E),r.options.interactive&&r.identifyIds.push(T.identifyIds),h.addLayer(r),a.reset(),r.mapState.needRerender=!0,r.options.interactive&&f.resetCache(),r}return Object(w.c)(e,t),e.prototype.destroy=function(){this.options.interactive&&this.modules&&this.modules.identifier.resetCache(),t.prototype.destroy.call(this)},e}(j),Ss=n(71),Os=n(23),Ms=function(t){function e(e,n){var r=t.call(this,e)||this;return r.position=Object(c.l)(n.coordinates),r.phase=n.zIndex,r.isDestroyed=!1,r.labelKey="onlineMarker-"+r.uniqId,r.modules.layers.addLayer(r),r.setIcon(n.icon),r}return Object(w.c)(e,t),e.prototype.destroy=function(){this.isDestroyed=!0,this.modules.identifier.resetCache(),this.modules.labeler.removeLabels(this.labelKey),t.prototype.destroy.call(this)},e.prototype.setIcon=function(t){var e=this,n=t.url,r=t.transformer,i=t.size,o=t.anchor;this.modules.imageCache.getRasterSet(n,r,i,o).then((function(t){if(!e.isDestroyed){e.removeIcon();var n=Object(jt.e)({phase:e.phase,rasterSet:t.index,minWidth:0,maxWidth:0,minWidthZLevel:0,maxWidthZLevel:0}),r=Object(jt.f)({id:[0,0],dpi:Object(Os.d)(window.devicePixelRatio)}),a=e.modules.collector;Object(Ss.generatePoint)(a,e.modules.dynamicStyle.getStyle(),x.a,n,r,0,0);var s=a.getAccumulatedData(),l=s.data,u=s.identifyIds;a.reset();var d=new xt("dynamicObject",l,e.modules.renderer,Object(c.j)(e.position),e);e.tileObjects.push(d),e.identifyIds=[u],e.modules.tileManager.addObject(d),e.modules.identifier.debouncedFillCache(),e.modules.labeler.removeLabels(e.labelKey),e.modules.labeler.addLabelBox(e.labelKey,{id:e.uniqId,width:i[0],height:i[1],position:e.position,offset:[-o[0],-o[1]],labelingGroup:"marker"}),e.mapState.needRerender=!0}}))},e.prototype.removeIcon=function(){var t=this.tileObjects[0];t&&(t.clean(this.mapState),this.modules.tileManager.removeObject(t),this.tileObjects=[])},e}(j),js=n(36),Is=n(59),Ts=n(42),Es=n(62);function As(t){return{type:"data",key:Object(mi.c)(t),coords:t,zoomLevel:t[2],detailLevel:t[3],needFetch:!1,needAbortFetch:!1,status:io.Initial}}var Ls=function(){function t(t){this.dataType=t,this.cache=new Map,this.pendingRequests=new Map}return t.prototype.fetch=function(t,e){var n=this;return new Promise((function(r){var i=e(t),o=Object(mi.c)(t),a=("json"===n.dataType?es.b:es.a)({url:i},(function(t,e){if(n.pendingRequests.delete(o),void 0!==t)return 204!==t.status&&console.error(t),n.cache.set(o,void 0),void r();n.cache.set(o,e),r(e)}));n.pendingRequests.set(o,{xhr:a,resolve:r})}))},t.prototype.get=function(t){return this.cache.get(t)},t.prototype.delete=function(t){this.cache.delete(t)},t.prototype.destroy=function(){var t=this;this.cache.clear(),this.pendingRequests.forEach((function(e,n){t.abortRequest(n)}))},t.prototype.abortRequest=function(t){var e=this.pendingRequests.get(t);void 0!==e&&(e.xhr.abort(),e.resolve(),this.pendingRequests.delete(t))},t}(),Cs=function(t){function e(e,n,r){var i,o,a,l,u,d=t.call(this)||this;return d.prevZoomLevel=0,d.update=function(){var t=!0;if(d.viewportDiffer.check(d.mapState)){var e=Math.floor(d.mapState.styleZoom);e!==d.prevZoomLevel&&(t=!1),d.prevZoomLevel=e,d.gridState.zoomLevel=e,function(t,e,n){if(t.zoomLevel<t.minZoomLevel)t.viewportTiles=[];else{var r=Object(s.e)(t.zoomLevel,t.minZoomLevel,t.maxZoomLevel),i=Object(s.e)(t.zoomLevel,t.minDetailLevel,t.maxDetailLevel);t.viewportTiles=Object(mi.h)(e,r,i);for(var o=0;o<t.viewportTiles.length;o++){var a=t.viewportTiles[o],c=t.tiles[a];c||(c=t.tiles[a]=n(Object(mi.o)(a)))}}}(d.gridState,Object(c.e)(d.mapState),As),d.emit("tilesSetChanged",{tileIds:d.gridState.viewportTiles})}for(var n in d.gridState.tiles)d.gridState.viewportTiles.includes(n)?d.gridState.tiles[n].status===io.Initial&&(d.gridState.tiles[n].needFetch=!0,d.gridState.tiles[n].status=io.Loading):d.gridState.tiles[n].status===io.Loading&&(d.gridState.tiles[n].needAbortFetch=!0);t&&(d.fetch(function(t){var e=[];for(var n in t.tiles){var r=t.tiles[n];r.needFetch&&(r.needFetch=!1,e.push(r))}return e}(d.gridState)),d.abortFetch(function(t){var e=[];for(var n in t.tiles){var r=t.tiles[n];r.needAbortFetch&&(r.needAbortFetch=!1,e.push(r))}return e}(d.gridState)),d.clearTiles(function(t,e){var n=new Set(t.viewportTiles),r=[];for(var i in t.tiles){var o=t.tiles[i];!n.has(i)&&r.push(o)}return r}(d.gridState)))},d.mapState=e,d.modules=n,d.config=r,d.gridState=(i=e.styleZoom,o=r.minZoom,a=r.maxZoom,l=r.minZoom,u=r.maxZoom,Object(Es.a)("data",i,o,a,l,u)),d.viewportDiffer=new oe([{path:"center",type:"vec2"},{path:"zoom",type:"number"},{path:"size",type:"vec2"},{path:"rotation",type:"number"},{path:"pitch",type:"number"}]),d.dataTileLoader=new Ls("json"),d.modules.layers.addLayer(d),d}return Object(w.c)(e,t),e.prototype.destroy=function(){Object(Es.b)(this.gridState),this.modules.layers.removeLayer(this)},e.prototype.fetch=function(t){var e=this;t.sort((function(t,n){return Object(mi.a)(e.mapState.center,t,n)})).forEach((function(t){return e.fetchTile(t)}))},e.prototype.abortFetch=function(t){var e=this;t.forEach((function(t){e.dataTileLoader.abortRequest(t.key)}))},e.prototype.clearTiles=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];this.dataTileLoader.delete(r.key),delete this.gridState.tiles[r.key],this.emit("dataTileCleared",{tileId:r.key})}},e.prototype.fetchTile=function(t){var e=this,n=this.config.tsURLTemplate;this.dataTileLoader.fetch(t.coords,n).then((function(n){e.emit("dataTileLoaded",{tileId:t.key,data:n})}))},e}(S.a),Ps=function(){function t(t,e){var n=this;this.mapState=t.state,this.modules=t.modules,this.options=e,this.textureIndices={},this.tilesUrl=function(t){var e=t[0],r=t[1],i=t[2],o=t[3];return n.options.tilesUrl([e,Math.pow(2,i)-1-r,i,o])},this.gridState=So("raster",this.mapState.styleZoom,this.options.minZoom||a.MAP_DEFAULTS.minZoom,this.options.maxZoom||a.MAP_DEFAULTS.maxZoom,this.options.minZoom||a.MAP_DEFAULTS.minZoom,this.options.maxZoom||a.MAP_DEFAULTS.maxZoom,this.modules,this.mapState,this.options.maxDisplayZoom||a.MAP_DEFAULTS.maxZoom),this.viewportDiffer=new oe([{path:"center",type:"vec2"},{path:"zoom",type:"number"},{path:"size",type:"vec2"},{path:"rotation",type:"number"},{path:"pitch",type:"number"}]),this.tileLoader=new Ls("arrayBuffer"),this.modules.layers.addLayer(this)}return t.prototype.destroy=function(){for(var t in this.modules.layers.removeLayer(this),this.textureIndices)this.modules.imageManager.deleteTexture(this.textureIndices[t]);this.textureIndices={},Oo(this.gridState)},t.prototype.update=function(){this.viewportDiffer.check(this.mapState)&&jo(this.gridState,this.mapState,Object(c.e)(this.mapState));var t=Object(w.a)({},this.gridState.displayedMods);Co(this.gridState,this.mapState,this.modules),this.fetch(yo(this.gridState)),this.abortFetch(bo(this.gridState)),this.generate(xo(this.gridState)),this.clearTiles(wo(this.gridState)),Mo(this.modules.tileManager,this.mapState,this.gridState,t)},t.prototype.isIdle=function(){return go(this.gridState.tiles,this.gridState.viewportTiles)},t.prototype.fetch=function(t){var e=this;t.sort((function(t,n){return Object(mi.a)(e.mapState.center,t,n)})).forEach((function(t){return e.fetchTile(t)}))},t.prototype.abortFetch=function(t){var e=this;t.forEach((function(t){return e.tileLoader.abortRequest(t.key)}))},t.prototype.generate=function(t){var e=this;t.sort((function(t,n){return Object(mi.a)(e.mapState.center,t,n)})).forEach((function(t){return e.generateTile(t)}))},t.prototype.clearTiles=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=this.textureIndices[r.key];i&&this.modules.imageManager.deleteTexture(i),this.tileLoader.delete(r.key),delete this.gridState.tiles[r.key]}},t.prototype.fetchTile=function(t){this.tileLoader.fetch(t.coords,this.tilesUrl).then((function(){t.status===io.Loading&&(t.serverMetadata=[{regionId:0,metatileHash:-1}])}))},t.prototype.generateTile=function(t){return Object(w.b)(this,void 0,Promise,(function(){var e,n,r,i,o,a,s,u,d,f,h,p,m,v;return Object(w.d)(this,(function(_){switch(_.label){case 0:return e=co(t),n=this.tileLoader.get(t.key),e&&n?(r={minZoom:NaN,maxZoom:NaN,phase:this.options.zIndex||0,opacity:this.options.opacity},i=this.modules,o=i.dynamicStyle,a=i.collector,s=o.extractCurvesFromStyle(r),[4,this.modules.imageManager.addTexture(n,{imagePadding:0})]):[2];case 1:if(void 0===(u=_.sent()))return[2];for(this.textureIndices[t.key]=u,d=[[],[]],f=l.d(),g=Object(c.p)(t.coords),y=Object(c.r)(t.coords[2]),b=g[0],x=g[1],w=g[2],h=[[b,x,w],[b+y,x,w],[b,x+y,w],[b+y,x+y,w]],p=Object(mi.e)(t.coords),m=0;m<h.length;m++)Object(c.k)(f,h[m],p),d[0][m]=f[0],d[1][m]=f[1];return Object(A.a)({collector:a,generator:lr.generateRectWithTexture,args:[d,Object(jt.e)(s),o.getStyle(),u]}),v=a.getAccumulatedData(),oi(e,[{regionId:0,metatileHash:-1,styleId:-1,collectorOutput:v}]),[2]}var g,y,b,x,w}))}))},t}(),ks=n(83);n.d(e,"config",(function(){return a})),n.d(e,"utils",(function(){return r})),n.d(e,"mapglUtils",(function(){return i})),n.d(e,"DynamicObject",(function(){return j})),n.d(e,"CircleMarker",(function(){return It})),n.d(e,"Map",(function(){return rs})),n.d(e,"MapClass",(function(){return rs})),n.d(e,"Entrance",(function(){return Bo})),n.d(e,"Polyline",(function(){return us})),n.d(e,"DashedPolyline",(function(){return ds})),n.d(e,"Polygon",(function(){return hs})),n.d(e,"Circle",(function(){return ps})),n.d(e,"StretchableImage",(function(){return gs})),n.d(e,"StretchableImageOptions",(function(){})),n.d(e,"Rect",(function(){return ws})),n.d(e,"RectOptions",(function(){})),n.d(e,"PointLabel",(function(){return ys})),n.d(e,"PointLabelOptions",(function(){})),n.d(e,"HtmlMarker",(function(){return Ci})),n.d(e,"Placement",(function(){return St.a})),n.d(e,"Marker",(function(){return bs})),n.d(e,"MarkerOptions",(function(){})),n.d(e,"OnlineMarker",(function(){return Ms})),n.d(e,"OnlineMarkerIcon",(function(){})),n.d(e,"OnlineMarkerOptions",(function(){})),n.d(e,"MapEvent",(function(){return js.MapEvent})),n.d(e,"MapPointerEvent",(function(){return js.MapPointerEvent})),n.d(e,"TileLoadEvent",(function(){return js.TileLoadEvent})),n.d(e,"FloorComplexHideEvent",(function(){return js.FloorComplexHideEvent})),n.d(e,"FloorComplexShowEvent",(function(){return js.FloorComplexShowEvent})),n.d(e,"InteractionEvent",(function(){return js.InteractionEvent})),n.d(e,"InteractionTarget",(function(){return js.InteractionTarget})),n.d(e,"RulerChangeEvent",(function(){return js.RulerChangeEvent})),n.d(e,"TrafficScoreEvent",(function(){return js.TrafficScoreEvent})),n.d(e,"HTMLMarkerShownEvent",(function(){return js.HTMLMarkerShownEvent})),n.d(e,"IconTransformerParams",(function(){})),n.d(e,"PolylineOptions",(function(){return Is.PolylineOptions})),n.d(e,"PolygonOptions",(function(){return Is.PolygonOptions})),n.d(e,"CircleOptions",(function(){return Is.CircleOptions})),n.d(e,"EntranceOptions",(function(){return Is.EntranceOptions})),n.d(e,"HtmlMarkerOptions",(function(){return Is.HtmlMarkerOptions})),n.d(e,"FontName",(function(){return fi.FontName})),n.d(e,"SourceMetatile",(function(){return fi.SourceMetatile})),n.d(e,"TileCoords",(function(){return Ts.TileCoords})),n.d(e,"Viewport",(function(){return Ts.Viewport})),n.d(e,"MapOptions",(function(){return Ts.MapOptions})),n.d(e,"Stats",(function(){return Ts.Stats})),n.d(e,"PersonalPoi",(function(){return Ts.PersonalPoi})),n.d(e,"StyleId",(function(){return Ts.StyleId})),n.d(e,"Padding",(function(){return Ts.Padding})),n.d(e,"FirmsToFloorIndexMap",(function(){return en.FirmsToFloorIndexMap})),n.d(e,"DataTileLayer",(function(){return Cs})),n.d(e,"DataTileLayerOptions",(function(){})),n.d(e,"RasterTileLayer",(function(){return Ps})),n.d(e,"RasterTileLayerOptions",(function(){})),n.d(e,"SourceStyle",(function(){return ks.SourceStyle})),n.d(e,"SourceLabelingGroupConfig",(function(){return Oi.SourceLabelingGroupConfig})),n.d(e,"SourceRasterSet",(function(){return fi.SourceRasterSet})),n.d(e,"RawStyleNode",(function(){return fi.RawStyleNode})),n.d(e,"FontNames",(function(){return fi.FontNames})),n.d(e,"Curve",(function(){return fi.Curve})),n.d(e,"AdditionalZssStyle",(function(){})),n.d(e,"ZssStyle",(function(){}))},function(t,e,n){"use strict";n.r(e);var r=n(5),i=n(52),o=n.n(i),a=n(1),s=n(8),c=n(2),l=n(35),u=n(51),d=n(55),f=n(56),h=n(68),p=n(57),m=n(23),v=n(28),_=n(11),g=n(22),y=n(20),b=n(25),x=n(26),w=n(32),S=n(27),O=n(0),M=n(31),j=[[0],[0],[0]],I=[[0],[0],[0]];function T(t,e,n,r,i,o,a,s,c,l,u,d){var f=n.tileProps,p=n.classes,m=n.sublayers;e[f.class]=p.area,e[f.sublayer]=m[t.sublayer],s.applyStyle(a,i,l,d,u,c,!1);for(var v=0;v<s.styleCount;v++){var _=s.styleAttrsByDraws[v];if(Object(h.checkRequiredAttrs)(_,r))do{Object(h.processComponent)(r,o,t,_,e,f)}while(o.isOverloaded());else Object(w.c)(t.sublayer)}}function E(t,e,n,r,i,o,c,l,u,d,h,p,m){var v=n.tileProps,_=n.classes,g=n.sublayers;e[v.class]=_.building,e[v.height]=a.floors.islandHeight,e[v.sublayer]=g[t.areaSublayer],l.applyStyle(c,i,h,m,p,u,!1);for(var y=0;y<l.styleCount;y++){var x=l.styleAttrsByDraws[y];if(Object(f.checkRequiredAttrs)(x,r))for(var I=b.a[x[O.i.symbol]],T=0;T<t.area.length;T++){for(var E=Object(M.a)(t.area[T]),A=Object(M.b)(E),L=A.x,C=A.y,P=A.count,k=0;k<P;k++){var N=Object(S.a)(k,P);j[0][N]=L[k],j[1][N]=C[k],j[2][N]=1}do{Object(f.processComponent)(I,r,n,o,x,e,j,P,d,s.i,u,void 0,void 0,void 0,!0)}while(o.isOverloaded())}else Object(w.c)(t.sublayer)}}function A(t,e,n,r,i,o,a,c,l,f,h,p,m){var v=n.tileProps,_=n.classes,g=n.sublayers;e[v.class]=_.area,e[v.sublayer]=g[t.areaSublayer],c.applyStyle(a,i,h,m,p,l,!1);for(var y=0;y<c.styleCount;y++){var x=c.styleAttrsByDraws[y];if(Object(d.checkRequiredAttrs)(x,r))for(var S=b.a[x[O.i.symbol]],I=0;I<t.area.length;I++)for(var T=Object(M.a)(t.area[I]),E=Object(M.b)(T),A=E.x,L=E.y,C=u(T),P=0;P<C.length;P+=3){for(var k=0;k<3;k++)j[0][k]=A[C[P+k]],j[1][k]=L[C[P+k]],j[2][k]=0;do{Object(d.processComponent)(S,r,n,o,x,e,j,3,f,s.i,l)}while(o.isOverloaded())}else Object(w.c)(t.sublayer)}}function L(t,e,n,r,i,o,c,l,u,d,h,p,m){if(t.wallSublayer){var v=n.tileProps,_=n.classes,g=n.sublayers;e[v.class]=_.building,e[v.height]=a.floors.wallHeight,e[v.sublayer]=g[t.wallSublayer],l.applyStyle(c,i,h,m,p,u,!1);for(var y=0;y<l.styleCount;y++){var x=l.styleAttrsByDraws[y];if(Object(f.checkRequiredAttrs)(x,r))for(var I=b.a[x[O.i.symbol]],T=0;T<t.wallTop.length;T++){for(var E=Object(M.a)(t.wallTop[T]),A=Object(M.b)(E),L=A.x,C=A.y,P=A.count,k=0;k<P;k++){var N=Object(S.a)(k,P);j[0][N]=L[k],j[1][N]=C[k],j[2][N]=1}do{Object(f.processComponent)(I,r,n,o,x,e,j,P,d,s.i,u,void 0,void 0,void 0,!0)}while(o.isOverloaded())}else Object(w.c)(t.sublayer)}}}var C=n(4),P=n(18),k=n(65),N={1:function(t){for(var e=0,n=0;n<t.length;n++)e=e+t[n]&255,t[n]=e},2:function(t){for(var e=0,n=0;n<t.length;n++)e=e+t[n]&65535,t[n]=e},4:function(t){for(var e=0,n=0;n<t.length;n++)e=e+t[n]>>>0,t[n]=e},8:function(t){for(var e=0,n=0,r=0,i=0;i<t.length;i+=2)n=(r=n+t[i])>>>0,t[i]=n,e=e+t[i+1]+(r>4294967295?1:0)>>>0,t[i+1]=e}},R=function(){function t(t){this.offset=0,this.buffer=t,this.u8=new Uint8Array(t),this.u16=new Uint16Array(t),this.u32=new Uint32Array(t),this.s8=new Int8Array(t),this.s16=new Int16Array(t),this.s32=new Int32Array(t),this.f32=new Float32Array(t)}return t.prototype.readS8=function(){return this.s8[this.offset++]},t.prototype.readU16=function(){var t=this.u16[this.offset>>1];return this.offset+=2,t},t.prototype.readU32=function(){var t=this.u32[this.offset>>2];return this.offset+=4,t},t.prototype.readF32=function(){var t=this.f32[this.offset>>2];return this.offset+=4,t},t.prototype.readU8Vector=function(t){void 0===t&&(t=1);var e=this.readU32()*t,n=3&-e,r=this.u8.subarray(this.offset,this.offset+e);return this.offset+=e+n,r},t.prototype.readU16Vector=function(t){void 0===t&&(t=1);var e=this.readU32()*t*2,n=3&-e,r=this.u16.subarray(this.offset>>1,this.offset+e>>1);return this.offset+=e+n,r},t}();function z(t,e,n,r){var i=e.BYTES_PER_ELEMENT;t.offset+=-t.offset&i-1;var o=new e(t.buffer,t.offset,n);return t.offset+=i*n,r&&N[i](o),o}function B(t,e,n){t.offset+=7&-t.offset;var r=new Uint32Array(t.buffer,t.offset,2*e);return t.offset+=8*e,n&&N[8](r),r}function F(t,e,n){t.offset+=3&-t.offset;var r,i=new Uint32Array(t.buffer,t.offset,e),o=new Float32Array(t.buffer,t.offset,e);if(t.offset+=4*e,n){var a=0;for(r=0;r<e;r++)a=a+i[r]>>>0,o[r]=a/1e3}else for(r=0;r<e;r++)o[r]=i[r]/1e3;return o}function D(t,e,n){t.offset+=3&-t.offset;var r,i=new Int32Array(t.buffer,t.offset,e),o=new Float32Array(t.buffer,t.offset,e);if(t.offset+=4*e,n){var a=0;for(r=0;r<e;r++)a=a+i[r]>>>0,o[r]=(0|a)/1e3}else for(r=0;r<e;r++)o[r]=i[r]/1e3;return o}function U(t,e,n){switch(n){case 2:return z(t,Uint8Array,e);case 3:return z(t,Uint8Array,e,!0);case 4:return z(t,Uint16Array,e);case 5:return z(t,Uint16Array,e,!0);case 6:return z(t,Uint32Array,e);case 7:return z(t,Uint32Array,e,!0);case 8:return B(t,e);case 9:return B(t,e,!0);case 10:return z(t,Uint8Array,e);case 11:return function(t,e){for(var n=t.offset,r=t.u8,i=t.buffer,o=[];e--;)o.push(0|r[n++]);for(var a=[];++e<o.length;){var s=o[e];255===s&&(s=r[n++]|r[n++]<<8|r[n++]<<16|0),a.push(new Uint8Array(i,n,s)),n+=s}return t.offset=n,a}(t,e);case 12:return function(t,e){t.offset+=3&-t.offset;for(var n=t.offset,r=t.u32,i=t.buffer,o=[],a=0;a<e;a++)o.push(r[n>>2]),n+=4;var s=[];for(a=0;a<e;a++){var c=o[a];n+=7&-n,s.push(new Uint8Array(i,n,c)),n+=c}return t.offset=n,s}(t,e);case 13:return z(t,Int8Array,e);case 14:return z(t,Int8Array,e,!0);case 15:return z(t,Int16Array,e);case 16:return z(t,Int16Array,e,!0);case 17:return z(t,Int32Array,e);case 18:return z(t,Int32Array,e,!0);case 19:return B(t,e);case 20:return B(t,e,!0);case 21:return F(t,e);case 22:return F(t,e,!0);case 23:return D(t,e);case 24:return D(t,e,!0);case 25:return z(t,Uint32Array,e);default:throw new Error("Unknown stream type "+n)}}function Z(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function H(t,e,n){return new t.constructor(t.buffer,t.byteOffset+e*t.BYTES_PER_ELEMENT,n)}function G(t,e,n,r,i,o,a,s,c){for(var l=n.readU32(),u=0;u<l;u++){var d=n.readU32(),f=C.i(n.readF32(),n.readF32(),n.readF32()),h=C.i(n.readF32(),n.readF32(),n.readF32()),p=C.r(C.d(),h,f),m=P.b();P.l(m,r,f),P.k(m,m,p),m[12]+=i[0],m[13]+=i[1];for(var v=n.readU16Vector(5),_=n.readU32(),g=0;g<_;g++){var y=n.readU32(),b=n.readU16Vector();do{k.processSubmesh(t,o,e,a,s,v,b,y,d,m,c)}while(e.isOverloaded())}var x=n.readU16Vector();do{k.processOuterEdge(t,o,e,a,s,v,x,m)}while(e.isOverloaded())}}n(49);var W,V=n(19),q=[],Y=new Int32Array(256),X=[],K=[],J=[0,0,0,0,0],Q=0,$=0,tt=0,et=0,nt=0,rt=0,it=0,ot=!1,at=!1,st=!0,ct=[];function lt(t,e,n,r,i,o,a,s,c,l){var u=r.tileInfo,d=r.pixelRatio,f=r.selectedIds,h=r.floorsEnabled,p=r.disableCommercialPoi,v=r.hoverId,g=r.generateOnlySelectedPoi,y=i.metatileHash,b=i.data,w=new x.a(f),S=Object(_.d)(b);if(S.byteLength<8)return n.getAccumulatedData(u);q.length=0;var O=new R(S);if(1279676242!==O.readU32())return n.getAccumulatedData(u);if(2!==O.readU16())return console.error("Unsupported tile format version"),n.getAccumulatedData(u);O.readU16();var M=u.coords,j=Object(m.d)(d),I=Object(m.a)(j);return function(t){var e=t.u8,n=t.offset,r=t.u32[n>>2];for(Q=r,$=n+=4;r--;)n=2*e[n++]+n,n=e[n++]+n;t.offset=n+(3&-n)}(O),function(t){var e=t.u32[t.offset>>2];t.offset+=4,W=z(t,Uint8Array,e);for(var n=z(t,Uint32Array,e),r=0;r<e;r++){var i=W[r];q[r]=U(t,n[r],i),Y[r]=0}}(O),function(t,e,n,r,i,o,a,s,c,l,u,d,f,h,p,m,v,_){var g=l.tileAttrs,y=Q,b=z(r,Int32Array,y),x=Z(b),w=z(r,Uint8Array,x,!0),S=z(r,Uint8Array,Z(w),!0),O=z(r,Uint8Array,x,!0),M=z(r,Uint8Array,Z(O),!0),j=z(r,Uint16Array,x,!0),I=0,T=0,E=0;l.setMetatile(s),st=!0;for(var A=0;A<y;A++){var L=b[A];if(ht(r,s,g),0===A){var C=q[K[1]];n.setGeoIds(C)}for(var P=0;P<L;P++){var k=w[I];k>0&&(ut(g,k,S,T,s.tileProps),T+=k);var N=O[I];N>0&&(dt(g,N,M,E),E+=N);var R=j[I];R>0&&ft(t,e,n,R,i,o,a,s,c,l,u,d,f,h,p,m,v,_),I++}}pt()}(t,e,n,O,M,j,w,o,a,s,y,l,c,I,h,p,v,g),n.getAccumulatedData(u)}function ut(t,e,n,r,i){for(;e--;){var o=n[r++],a=K[o],s=X[o],c=W[a];if(8===c||9===c||19===c||20===c)t[s]=[q[a][Y[a]],q[a][Y[a]+1]],Y[a]+=2;else{var l=q[a][Y[a]];i.objectClass===s?t[s]=[l,0]:t[s]=l,Y[a]++}}}function dt(t,e,n,r){for(;e--;){var i=n[r++];t[X[i]]=NaN}}function ft(t,e,n,r,i,o,s,c,l,u,d,f,h,p,m,v,_,g){for(var y=c.tileProps,x=u.tileAttrs,w=i[3],S=0;S<tt;S++){var M=J[S];ct[S]=H(q[M],Y[M],r),Y[M]=Y[M]+r}var j=x[y.id],I=!Number.isNaN(j)&&s.has(j),T=!1;if(g&&(I=!0),void 0!==_){if(_[0]!==j[0]||_[1]!==j[1])return;T=!0}m&&x[y.hiddenByPlanBuildingId]&&w>=Math.floor(a.floors.displayStyleZoom)&&(h.add(j),n.addFloorHidingMap(j,x[y.hiddenByPlanBuildingId])),function(t,e,n,r){return!st&&t[e.class]===et&&t[e.sublayer]===nt&&n===ot&&r===at&&(i=it,o=t[e.dbLabelPriority],Number.isNaN(i)&&Number.isNaN(o)||i===o)&&function(t,e){var n=Number.isNaN(t)&&Number.isNaN(e),r=!Number.isNaN(t)&&!Number.isNaN(e);return n||r&&t[0]===e[0]&&t[1]===e[1]}(rt,t[e.objectClass]);var i,o}(x,y,I,T)||u.applyStyle(l,e,o,I,p,f,T);for(var E=0;E<u.styleCount;E++){var A=u.styleAttrsByDraws[E];if(!(A[O.i.maxZoom]<=w||A[O.i.minZoom]>=w+1&&w!==a.tiles.maxDetailLevel)){var L=b.a[A[O.i.symbol]];g&&"poi"!==L&&"point"!==L||Object(V.c)(L,t,c,n,A,x,ct,r,i,d,f,h,v,g)}}et=x[y.class],nt=x[y.sublayer],rt=x[y.objectClass],it=x[y.dbLabelPriority],ot=I,at=T,st=!1}function ht(t,e,n){var r,i,o=Object.keys(e.tileProps).length,a=t.u8,s=$;for(i=1;i<o;i++)n[i]=NaN;for(r=a[s++],i=0;i<r;i++)X[i]=a[s++],K[i]=a[s++];for(r=a[s++],i=0;i<r;i++)J[i]=a[s++];tt=r,$=s,pt()}function pt(){ct.length=0}var mt=n(63),vt=n(33),_t=n(85),gt=function(){function t(){this.tileAttrs=[],this.styleAttrsByDraws=[[]],this.styleCount=0,this.defaultProps={}}return t.prototype.setMetatile=function(t){this.tileProps=t.tileProps,this.defaultProps=t.defaultProps},t.prototype.applyStyle=function(t,e,n,r,i,o,a){if(this.tileProps){var s=this.tileAttrs,c=t[s[this.tileProps.sublayer]];if(this.styleCount=0,c){c.reset();for(var l=0,u=!0;u;){l>this.styleAttrsByDraws.length-1&&(this.styleAttrsByDraws[l]=[]);for(var d=this.styleAttrsByDraws[l],f=0;f<O.j;f++)d[f]=NaN;for(var h in s[this.tileProps.selected]=r?1:0,s[this.tileProps.hovered]=a?1:0,s[this.tileProps.dpi]=n,s[this.tileProps.pixelDensityPreset]=i,s[this.tileProps.isRealtime]=1,s[this.tileProps.region]=o,this.defaultProps){var p=this.defaultProps[h];Number.isNaN(s[p.index])&&(s[p.index]=p.value)}for(var h in a&&(d[O.i.phase]+=1e-4),e)if(this.tileProps){var m=this.tileProps[h];void 0===e[h]?s[m]=NaN:s[m]=e[h]?1:0}u=c.harvest(d,s),l++}this.styleCount=l-1}}},t}(),yt=n(24),bt=n(44),xt=n(45),wt=n(16),St=function(){function t(){this.cache=new Map,this.pendingRequests=new Map}return t.prototype.fetch=function(t){var e=this,n=t.coords,r=t.tileServer,i=t.tileSet,o=t.tileProtocol,a=t.subdomains,s=t.tileKey,c=t.appId,l=t.lang,u=t.defaultLang,d=t.sessionId;return new Promise((function(t){var f=Object(_.k)(r,i,o,a,n,s,c,l,u,d),h=Object(_.c)(n),p=Object(vt.a)({url:f},(function(n,r){var i=!1;if(e.pendingRequests.delete(h),void 0!==n||0===r.byteLength)return void 0!==n&&(console.error(n),403===n.status&&(i=!0)),e.cache.set(h,[]),void t({metadata:[],invalidTileKey:i});var o=Object(_.r)(r),a=Object(_.s)(o);e.cache.set(h,o),t({metadata:a,invalidTileKey:i})}));e.pendingRequests.set(h,{xhr:p,resolve:t})}))},t.prototype.get=function(t){return this.cache.get(t)||[]},t.prototype.delete=function(t){this.cache.delete(t)},t.prototype.abortRequest=function(t){var e=this.pendingRequests.get(t);void 0!==e&&(e.xhr.abort(),e.resolve(),this.pendingRequests.delete(t))},t}();function Ot(t,e,n,r){var i=Math.max(Math.abs(t[e.phase]-t[e.phase2])||0,Math.abs(t[e.phase]-t[e.phase3])||0,Math.abs(t[e.phase2]-t[e.phase3])||0);return i>=.01&&Object(w.a)("Warning! Difference between traffic phases is too large."),10*i*n+i/100*r}var Mt=n(14),jt=n(3),It=function(){function t(){this.cache=new Map,this.pendingRequests=new Map}return t.prototype.fetch=function(t,e,n,r,i){var o=this;return new Promise((function(s){var l=function(t,e,n,r,i){var o=Math.pow(2,t[2])-1,s=t[0],l=(o-t[1]&16777215)*(1<<24)+(16777215&s);return Object(c.K)(a.traffic.url,{protocol:i,host:r,z:String(t[2]),tiles:String(l),regions:e.join(","),time:String(n)})}(t,r,i,e,n),u=Object(_.c)(t),d=Object(vt.b)({url:l},(function(t,e){if(o.pendingRequests.delete(u),void 0!==t)return 204!==t.status&&console.error(t),o.cache.set(u,void 0),void s();var n=e[0];n?o.cache.set(u,n):o.cache.set(u,void 0),s()}));o.pendingRequests.set(u,{xhr:d,resolve:s})}))},t.prototype.get=function(t){return this.cache.get(t)},t.prototype.delete=function(t){this.cache.delete(t)},t.prototype.abortRequest=function(t){var e=this.pendingRequests.get(t);void 0!==e&&(e.xhr.abort(),e.resolve(),this.pendingRequests.delete(t))},t}(),Tt=n(79),Et=n(48),At=Object.create(null),Lt=function(){function t(t){this.styles=t,this.traverseDepth=0,this.resultDepth=0,this.traverseStack=[t,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At],this.resultStack=[t,At,At,At,At,At,At,At,At,At,At,At,At,At,At,At],this.traversePath=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}return t.prototype.harvest=function(t,e){if(-1===this.traverseDepth)return this.reset(),!1;for(var n=0;n<5e3;){var r=this.traverseStack[this.traverseDepth],i=0===r.children.length&&!r.isMod,o=this.checkSelector(r.selector,e,!1);if(o||(this.traversePath[this.traverseDepth]=r.children.length),o&&i)return this.recordResult(t),this.resume(o),!0;if(this.resume(o),-1===this.traverseDepth)return this.reset(),!1;n++}return!1},t.prototype.getSublayerSet=function(t){var e=new Set;return this.collectSublayers(e,this.styles,t),e},t.prototype.prune=function(e){var n=this.innerPrune(this.styles,e);if(n)return new t(n)},t.prototype.reset=function(){this.traverseDepth=0,this.resultDepth=0,this.traverseStack[this.traverseDepth]=this.styles,this.resultStack[this.resultDepth]=this.styles,this.traversePath[this.traverseDepth]=0},t.prototype.resume=function(t){for(var e=this.traverseStack[this.traverseDepth];this.traversePath[this.traverseDepth]>=e.children.length;){if(!e.isMod||!t){for(;this.resultStack[this.resultDepth]!==e;)this.resultDepth--;this.resultDepth--}if(this.traverseDepth--,this.traverseDepth<0)return;e=this.traverseStack[this.traverseDepth]}var n=e.children[this.traversePath[this.traverseDepth]];this.traverseStack[this.traverseDepth+1]=n,this.resultStack[this.resultDepth+1]=n,this.traversePath[this.traverseDepth]++,this.traverseDepth++,this.resultDepth++,this.traversePath[this.traverseDepth]=0},t.prototype.recordResult=function(t){var e,n,r,i,o=this.resultDepth+1;for(e=0;e<o;e++)for(r=this.resultStack[e].rules,n=0;n<r.length;n++)t[(i=r[n]).key]=i.value},t.prototype.innerPrune=function(t,e){var n;if(this.checkSelector(t.selector,e,!0)){if(0===t.children.length)return t;var r=[];for(n=0;n<t.children.length;n++){var i=this.innerPrune(t.children[n],e);i&&r.push(i)}if(0!==r.length)return{selector:t.selector,rules:t.rules,children:r,isMod:t.isMod}}},t.prototype.collectSublayers=function(t,e,n){for(var r=e.selector,i=e.children,o=0;o<r.length;o++)for(var a=0;a<r[o].length;a++){var s=r[o][a];s[0]===n&&t.add(s[2])}for(o=0;o<i.length;o++)this.collectSublayers(t,i[o],n)},t.prototype.checkRule=function(t,e,n){var r=n;if(!Number.isNaN(t[0])&&!Number.isNaN(e[t[0]])){var i=Array.isArray(e[t[0]])?e[t[0]][0]:e[t[0]];switch(t[1]){case 0:r=i===t[2];break;case 1:r=i>t[2];break;case 2:r=i<t[2];break;case 3:r=i>=t[2];break;case 4:r=i<=t[2];break;case 5:r=i!==t[2]}}return r},t.prototype.checkSelector=function(t,e,n){for(var r=0;r<t.length;r++){for(var i=!0,o=0;o<t[r].length;o++)if(!this.checkRule(t[r][o],e,n)){i=!1;break}if(i)return!0}return!1},t}(),Ct=n(70);function Pt(t,e){for(var n=t.tileProps.sublayer,r=t.tileProps,i=0,o=e.styleStateKeys;i<o.length;i++){var a=o[i];if(void 0===r[a]){var s=Object.keys(r).length;r[a]=s}}var c=Object.keys(t.tileProps).length,l=function t(e,n){var r=[];for(var i in e.rules)r.push({key:parseInt(i,10),value:e.rules[i]});var o=e.selector.map((function(t){return t.map((function(t){var e=[NaN,t[1],t[2]],r=t[0];"string"==typeof r&&(r=Object(O.e)(r));var i=t[2];return"string"==typeof i&&("sublayer"===r?void 0!==n.sublayers[i]&&(e[2]=n.sublayers[i]):"class"===r?void 0!==n.classes[i]&&(e[2]=n.classes[i]):"objectClass"===r&&n.objectClasses&&void 0!==n.objectClasses[i]&&(e[2]=n.objectClasses[i])),void 0!==n.tileProps[r]&&(e[0]=n.tileProps[r]),e}))})),a=[];return e.children&&(a=e.children.map((function(e){return t(e,n)}))),{rules:r,isMod:!!e.isMod,selector:o,children:a}}(function t(e){var n,r={};for(var i in e.rules){var o=Ct.a[i];void 0!==o?r[o]=e.rules[i]:console.warn("Not found prop "+i)}return e.children&&(n=e.children.map((function(e){return t(e)}))),{rules:r,selector:e.selector,children:n,isMod:e.isMod}}(e.ast),t),u=new Lt(l),d={};return u.getSublayerSet(n).forEach((function(t){var e=u.prune(function(t,e,n){for(var r=[],i=0;i<n;i++)r[i]=NaN;return r[e]=t,r}(t,n,c));e&&(d[t]=e)})),d}var kt=function(){function t(t,e){this.metatiles=t,this.styleManager=e,this.bindedStyles=new Et.a}return t.prototype.get=function(t,e){var n=this.bindedStyles.get(t,e);if(n)return n;var r=this.metatiles[e],i=this.styleManager.getStyle(t);if(i){var o=Pt(r,i);return this.bindedStyles.set(t,e,o),o}},t.prototype.update=function(t,e){var n=this.styleManager.getStyle(t);if(n){var r=Pt(this.metatiles[e],n);return this.bindedStyles.set(t,e,r),r}},t}(),Nt=function(t){function e(e){var n=t.call(this)||this;return n.obClassEnumIndex=0,n.sublayerEnumIndex=0,n.syncFunctions=[e.get(wt.b.Main,"syncMetatile"),e.get(wt.b.Labeling,"syncMetatile")],n}return Object(r.c)(e,t),e.prototype.addData=function(t){var e=this;t.sublayers.forEach((function(t){if(void 0===e.sublayers[t]){var n=e.sublayerEnumIndex++;e.sublayers[t]=n,e.sublayersByIndex[n]=t}})),t.objectClasses.forEach((function(t){if(void 0===e.objectClasses[t]){var n=e.obClassEnumIndex++;e.objectClasses[t]=n,e.objectClassesByIndex[n]=t}})),this.syncFunctions.forEach((function(t){return t({sublayers:e.sublayers,sublayersByIndex:e.sublayersByIndex,objectClasses:e.objectClasses,objectClassesByIndex:e.objectClassesByIndex})}))},e}(n(78).a);e.default=function(t){var e=new bt.b(t),n=new xt.a(e),i=new St,u=new It,d=new Tt.a,f={main:{addNewRasterSets:n.get(wt.b.Main,"addNewRasterSets")},labeling:{addNewRasterSets:n.get(wt.b.Labeling,"addNewRasterSets")}},h={},S=new x.a,M=new kt(h,d),j={},P=new mt.a("parser"),N=new gt,z=function(){var t=P.atlasPacker.getNewRasterSets();t.size&&t.forEach((function(t,e){f.main.addNewRasterSets(e,t),f.labeling.addNewRasterSets(e,t)}))},B=Object(l.a)((function(){return P.reset()}),a.workerResetDebounceTime),F=function(t,e){h[t]=e};n.set("setMetatile",F);var D=new Nt(n);function U(t){var e=d.getStyleForTerrainTiles(t);if(e){var n=M.get(e.id,t);if(n)return{style:e,bindedStyle:n};console.error("Not found binded style for "+e.id+" and hash "+t+" in parser")}else console.error("Not found style for hash "+t+" in parser")}F(s.i,D),n.set("appendHiddenObjectIds",(function(t){t.forEach((function(t){return S.add(t)}))})),n.set("prepareAtlas",(function(e){return new Promise((function(n){Object(vt.a)({url:e},(function(e,r){if(e||0===r.byteLength)n(void 0);else if(t.createImageBitmap){var i=new Blob([r],{type:"image/png"});createImageBitmap(i).then((function(t){n({isBitmap:!0,data:[t],transferable:[t]})}))}else n({isBitmap:!1,data:[r],transferable:[r]})}))}))})),n.set("fetchTile",(function(t){return i.fetch(t)})),n.set("deleteTile",(function(t){i.delete(t)})),n.set("abortTileRequest",(function(t){i.abortRequest(t)})),n.set("generateTile",(function(t){var e=t.tileInfo.coords,n=Object(_.c)(e),r=i.get(n),o=[],a=[];return r.forEach((function(e){var n=e.regionId,r=e.metatileHash,i=U(r);if(i){var s=lt(i.style,t.styleState,P,t,e,h[r],i.bindedStyle,N,S,n);o.push({regionId:n,metatileHash:r,collectorOutput:s,styleId:i.style.id}),a.push.apply(a,s.transferable)}})),B(),z(),{results:o,transferable:a}})),n.set("fetchTrafficTile",(function(t){return u.fetch(t.coords,t.tileServer,t.tileProtocol,t.regionIds,t.timestamp)})),n.set("deleteTrafficTile",(function(t){u.delete(t)})),n.set("abortTrafficTileRequest",(function(t){u.abortRequest(t)})),n.set("generateTrafficTile",(function(t){var e=t.coords,n=t.pixelRatio,r=t.styleState,i=Object(_.c)(e),o=[],a=[],s=U(-2);if(!s)return{results:o,transferable:a};var c=u.get(i);if(c){var l=function(t,e,n,r,i,o,a,s,c,l,u){var d=r.tileProps,f=r.sublayers,h=r.classes,p=Object.keys(d).length,v=s.tileAttrs;s.setMetatile(r);for(var _=Object(m.d)(c),g=Object(m.a)(_),y=0,b=l.tile;y<b.length;y++){for(var x=b[y],w=x.color,S=void 0===w?0:w,M=x.geo,j=x.road,I=x.normals,T=x.zLevel,E=void 0===T?0:T,A=[[],[],[],[]],L=0;L<p;L++)v[L]=NaN;for(v[d.class]=h.line,v[d.sublayer]=f.Traffic_jams,v[d.trafficColor]=S,v[d.trafficRoadClass]=j,s.applyStyle(a,n,_,!1,g,1,!1),L=0;L<M.length;L++){for(var C=M[L],P=I[L],k=0;k<C.length;k++)A[0][k]=C[k][0],A[1][k]=C[k][1],A[2][k]=P[k][0],A[3][k]=P[k][1];for(var N=0;N<s.styleCount;N++){var R=s.styleAttrsByDraws[N],z=Ot(R,O.i,E,S);R[O.i.phase]+=z,R[O.i.phase2]+=z,R[O.i.phase3]+=z,Object(V.c)("shiftedLine",e,r,t,R,v,A,C.length,u,-2,1)}}}return t.getAccumulatedData()}(P,s.style,r,h[-2],0,0,s.bindedStyle,N,n,c,e);o.push({collectorOutput:l,regionId:1,metatileHash:-2,styleId:s.style.id})}return{results:o,transferable:a}})),n.set("packRasters",(function(t){for(var e=0;e<t.length;e+=3){var n=t[e+2],r={type:yt.d.Loaded,isSvg:!1,index:n,name:"",fileName:"",rasters:[{w:t[e],h:t[e+1],atlasIndex:0,x:0,y:0,isPacked:!1,anchorX:0,anchorY:0}]},i=[[0,t[e],0]];P.atlasPacker.pack(r,i,1)}var o=P.atlasPacker.getPackedRasters(),a=[];return void 0!==o&&a.push(o.buffer),{packedRasters:o,transferable:a}})),n.set("generateModel",(function(e){var n=e.regionId,i=e.metatileHash,o=e.fileName,a=e.tileServer,s=e.tileProtocol,l=e.tileSet,u=e.subdomain,d=Object(c.p)("model",{host:a,tileSet:l,protocol:s,subdomain:u,regionId:n.toString(),name:o});return new Promise((function(o){Object(vt.a)({url:d},(function(a,s){if(a||0===s.byteLength)o({objects:P.getAccumulatedData(),textures:{isBitmap:!1,data:[]}});else{var c=U(i);if(c){var l=function(t,e,n,r,i,o,a,s,c){var l=i.pixelRatio,u=i.modelIndex,d=i.matrix,f=i.offset,h=i.id,p=i.selected,v=new R(r),_=[];if(1296191066!==v.readU32()||1!==v.readU16())return{objects:n.getAccumulatedData(),textures:[]};v.readU16(),s.setMetatile(o);for(var g=v.readU32(),y=0;y<g;y++)_.push(v.readU8Vector());var b=o.tileProps,x=s.tileAttrs,S=Object.keys(b).length;for(y=0;y<S;y++)x[y]=NaN;x[b.class]=o.classes.class_model,x[b.sublayer]=o.sublayers.Building_model,x[b.id]=h,n.setGeoIds(new Uint32Array(h));var O=Object(m.d)(l),M=Object(m.a)(O),j=v.offset;for(s.applyStyle(a,e,O,p,M,c,!1),y=0;y<s.styleCount;y++){v.offset=j;var I=s.styleAttrsByDraws[y];k.checkRequiredAttrs(I,t)?G(t,n,v,d,f,o,I,x,u):Object(w.c)(o.sublayersByIndex[x[b.sublayer]])}return{objects:n.getAccumulatedData(),textures:_}}(c.style,e.styleState,P,s,e,h[i],c.bindedStyle,N,n),u=l.objects,d=l.textures;if(t.createImageBitmap){var f=d.map((function(t){var e=new Blob([t],{type:"image/png"});return createImageBitmap(e)}));Promise.all(f).then((function(t){o({objects:u,textures:{isBitmap:!0,data:t},transferable:Object(r.e)(u.transferable,t)}),B()}))}else o({objects:u,textures:{isBitmap:!1,data:d},transferable:Object(r.e)(u.transferable,[s])}),B()}else o({objects:P.getAccumulatedData(),textures:{isBitmap:!1,data:[]}})}}))}))})),n.set("loadFloor",(function(t,e){return new Promise((function(n){Object(vt.a)({url:e+"/complexes/"+t+"?fields=floorGeometries&format=pbf"},(function(e,i){if(e||0===i.byteLength)n({type:"error",errorStatus:e?e.status:0});else{var a=new o.a(i),s=_t.Complex.read(a),c=s.tileCoords;j[t]=Object(r.a)(Object(r.a)({},s),{tileCoords:[c[0],c[1],c[2],c[2]]}),D.addData(function(t){for(var e=new Set,n=new Set,r=t.floorGeometries,i=t.entities,o=0;o<r.length;o++)for(var a=r[o].rooms,s=0;s<a.length;s++){var c=a[s],l=c.sublayer,u=c.areaSublayer,d=c.wallSublayer;e.add(l),d&&e.add(d),e.add(u)}for(o=0;o<i.length;o++){var f=i[o],h=f.humanReadableIconId;l=f.sublayer,e.add(l),h&&n.add(h)}return{sublayers:e,objectClasses:n}}(j[t]));var l={};s.entities.forEach((function(t){t.firmId&&(l[t.firmId]=t.floorIndex)})),n({type:"success",center:s.center,bound:s.bound,defaultFloor:s.defaultFloor,floorNames:s.floorNames,buildings:s.buildings.concat(s.hybrids),firmsToFloorIndexMap:l})}}))}))})),n.set("generateFloor",(function(t,e,n,r,i,o,c,l){var u={tileCoords:j[t].tileCoords,collectorOutput:P.getAccumulatedData(),styleId:0},f=d.getStyle(n);if(!f)return u;var h=M.update(n,s.i);if(!h)return u;var w=function(t,e,n,r,i,o,c,l,u,d,f,h,w){var S=r.floorGeometries,M=r.defaultFloor,j=r.tileCoords,C=r.entities,P=i.tileProps,k=i.classes,N=i.sublayers,R=Object.keys(P).length,z=c.tileAttrs,B=new x.a,F=new x.a(f),D=Object(_.e)(j);Number.isNaN(d)&&(d=M);var U=S[d];c.setMetatile(i);for(var Z=Object(m.d)(u),H=Object(m.a)(Z),G=0;G<U.rooms.length;G++){for(var W=U.rooms[G],V=0;V<R;V++)z[V]=NaN;var q=!1;if(W.firmIds.length){var Y=Object(y.b)(W.firmIds[0]);B.add(Y),q=F.has(Y),z[P.id]=Y}if(w){if(W.isIsland){E(W,z,i,t,e,n,o,c,l,j,Z,H,q);continue}A(W,z,i,t,e,n,o,c,l,j,Z,H,q),L(W,z,i,t,e,n,o,c,l,j,Z,H,q)}else T(W,z,i,t,e,n,o,c,l,Z,H,q)}for(G=0;G<C.length;G++){var X=C[G],K=N[X.sublayer];if(X.floorIndex===d){I[0]=[X.coordinates[0]],I[1]=[X.coordinates[1]];for(var J=0;J<R;J++)z[J]=NaN;h&&Object(g.e)(K,i)&&(K=N[a.floorsDefaultPoiSublayer]),z[P.class]=k.point,z[P.sublayer]=K,q=!1;var Q,$=X.firmId||X.id;$&&(Y=Object(y.b)($),q=F.has(Y),B.add(Y),z[P.id]=Y),Object(g.e)(K,i)||(Q=i.objectClasses?i.objectClasses[X.humanReadableIconId]:X.iconId,z[P.objectClass]=void 0!==Q?[Q,0]:NaN),z[P.label]=X.text?Object(v.d)(X.text):NaN,z[P.label2]=X.text2?Object(v.d)(X.text2):NaN,z[P.dbIconPriority]=X.priority,z[P.dbLabelPriority]=X.textPriority,c.applyStyle(o,{},Z,q,H,l,!1);for(var tt=0;tt<c.styleCount;tt++){var et=c.styleAttrsByDraws[tt];Object(p.processComponent)(b.a[et[O.i.symbol]],t,i,n,et,z,I,1,j,s.i,l)}}}return n.setGeoIds(new Uint32Array(B.toFlatArray())),n.getAccumulatedData(D)}(f,l,P,j[t],D,h,N,e,r,i,o,c,d.isCustomStyle());return B(),z(),{tileCoords:j[t].tileCoords,collectorOutput:w,transferable:w.transferable,styleId:f.id}})),n.set("generatePersonalPoi",(function(t,e,n,r,i,o){var a=d.getStyleForTerrainTiles(n),s=M.get(a.id,n),c=function(t,e,n,r,i,o,a,s,c,l,u){var d,f=r.tileProps,h=r.sublayers,p=r.classes,g=Object.keys(f).length,b=new x.a(l);if(void 0===h.s_personal_poi)return t.getAccumulatedData();var w=s.tileAttrs;s.setMetatile(r);for(var S=Object(m.d)(c),O=Object(m.a)(S),M=Mt.e(),j=[],I=0,T=u;I<T.length;I++){var E=T[I],A=Object(jt.l)(E.point);Mt.f(M,A),j.push(A)}for(var L=Object(jt.d)(M),P=Object(_.e)(L),k=0;k<u.length;k++){E=u[k],A=C.d(),Object(jt.k)(A,j[k],P);for(var N=Object(y.b)(E.id),R=[[A[0]],[A[1]]],z=0;z<g;z++)w[z]=NaN;w[f.id]=Object(y.b)(E.id),w[f.class]=p.point,w[f.sublayer]=h.s_personal_poi;var B=E.classId;r.objectClasses&&E.humanReadableClassId&&(B=null!==(d=r.objectClasses[E.humanReadableClassId])&&void 0!==d?d:E.humanReadableClassId),w[f.objectClass]=B,w[f.label]=void 0!==E.name?Object(v.d)(E.name):NaN,w[f.dbIconPriority]=1,w[f.dbLabelPriority]=0,s.applyStyle(i,n,S,b.has(N),O,o,!1);for(var F=0;F<s.styleCount;F++){var D=s.styleAttrsByDraws[F];Object(V.c)("poi",e,r,t,D,w,R,1,L,a,o)}}return t.getAccumulatedData(P)}(P,a,o,h[n],s,e,n,N,r,i,t);return B(),z(),{collectorOutput:c,transferable:c.transferable,styleId:a.id}})),n.set("addStyle",(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d.proxyAddStyle.apply(d,t)})),n.set("bindStyleToMetatileHash",(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d.proxyBindStyleToMetatileHash.apply(d,t)})),n.set("useSingleStyle",(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d.proxyUseSingleStyle.apply(d,t)}))}},function(t,e,n){"use strict";n.r(e);var r=n(5),i=n(1),o=n(8),a=n(19),s=n(35),c=n(80),l=n(15);function u(t,e,n){var r=t[e];if(void 0!==r)return r[n]}var d=n(86);function f(t,e,n,r){var i=t.anchorScreen,o=t.boxes[e];return{element:t,minX:i[0]+o[0]-n|0,maxX:i[0]+o[2]+n|0,minY:i[1]+o[1]-r|0,maxY:i[1]+o[3]+r|0}}function h(t,e){if(t.parent===e||t.firstLabel===e)return!1;var n=t.labelingGroup,r=e.labelingGroup;return function(t,e,n,r){var i=u(t,n,r),o=u(e,n,r);return void 0===i&&void 0===o||(void 0===i?void 0===o||o:void 0===o?void 0===i||i:i||o)}(t.labelingGroupTable,e.labelingGroupTable,n,r)}function p(t,e,n,r,i,o){var a=f(e,n,r,i);if(a.minX>o.maxX||a.maxX<o.minX||a.minY>o.maxY||a.maxY<o.minY)return!0;for(var s=t.search(a),c=0;c<s.length;c++)if(h(e,s[c].element))return!0;return!1}function m(t,e,n,r,i){var o,a;r.has(t.id)?(o=t.visibleMarginLeftRight,a=t.visibleMarginTopBottom):(o=t.appearMarginLeftRight,a=t.appearMarginTopBottom);for(var s=!0,c=0;c<t.boxes.length;c++)if(p(e,t,c,o,a,n)){s=!1;break}if(s)for(c=0;c<t.boxes.length;c++){var l=f(t,c,t.visibleMarginLeftRight,t.visibleMarginTopBottom);e.insert(l)}t.placementIndex=s?0:-1}function v(t,e,n,r,i){var o,a;t.placementIndex=-1,r.has(t.id)?(o=t.visibleMarginLeftRight,a=t.visibleMarginTopBottom):(o=t.appearMarginLeftRight,a=t.appearMarginTopBottom);for(var s=0;s<t.boxes.length;s++)if(!(t.firstLabel&&t.firstLabel.placementIndex!==s||p(e,t,s,o,a,n))){var c=f(t,s,t.visibleMarginLeftRight,t.visibleMarginTopBottom);e.insert(c),t.placementIndex=s;break}}function _(t,e,n,r){for(var i=0;i<t.boxes.length;i++){var o=f(t,i,t.visibleMarginLeftRight,t.visibleMarginTopBottom);o.minX>n.maxX||o.maxX<n.minX||o.minY>n.maxY||o.maxY<n.minY||e.insert(o)}t.placementIndex=0}function g(t){return t.type!==l.c.Box&&void 0!==t.commercialPriority}function y(t,e,n,r){var o=e.size,a=e.viewport,s=o[0],c=o[1],u=(i.labeling.tileMultiplier-1)/2,h=Math.round(s*u),y=Math.round(c*u),b={minX:a.left-h,maxX:a.left+s+h,minY:a.top-y,maxY:a.top+c+y},x=d();t.filter(g).sort((function(t,e){return(n.has(e.id)?1:0)-(n.has(t.id)?1:0)||t.commercialPriority-e.commercialPriority})).forEach((function(t){!function(t,e,n,r,i,o){var a,s;if(r.has(t.id)?(a=i.visibleLeftRight,s=i.visibleTopBottom):(a=i.appearLeftRight,s=i.appearTopBottom),p(e,t,0,a,s,n))t.placementIndex=-1;else{t.placementIndex=0;var c=f(t,0,i.visibleLeftRight,i.visibleTopBottom);e.insert(c)}}(t,x,b,n,r)})),x.clear();for(var w=t.sort((function(t,e){return e.groupPriority-t.groupPriority||(g(e)?1:0)-(g(t)?1:0)||(n.has(e.id)?1:0)-(n.has(t.id)?1:0)||e.itemPriority-t.itemPriority||e.label.idHi-t.label.idHi||e.label.idLo-t.label.idLo||e.label.phase-t.label.phase||e.anchorWorld[0]-t.anchorWorld[0]||e.anchorWorld[1]-t.anchorWorld[1]})),S=0;S<w.length;S++){var O=w[S],M=O.label,j=O.type,I=M.symbol;if(-1!==O.placementIndex)if("marker"!==I||j!==l.c.Icon)switch(O.type){case l.c.Text:case l.c.LineText:case l.c.Icon:m(O,x,b,n);break;case l.c.Box:if(!O.parent||O.parent&&-1!==O.parent.placementIndex){m(O,x,b,n);break}O.placementIndex=-1;break;case l.c.PoiText:case l.c.PoiText2:!O.parent||-1===O.parent.placementIndex||O.firstLabel&&-1===O.firstLabel.placementIndex?O.placementIndex=-1:v(O,x,b,n)}else _(O,x,b)}return[]}var b=n(63),x=n(4),w=n(18),S=function(){function t(t,e,n){this.line=t,this.lengths=[],this.angles=[];for(var r=e,i=t[0],o=t[1],a=t.length/3,s=0;s<a;s++){var c=t[3*s]-i,l=t[3*s+1]-o;r+=Math.sqrt(c*c+l*l),this.lengths.push(r),i+=c,o+=l}for(this.finishLength=this.lengths[this.lengths.length-1],this.startLength=this.lengths[0],this.midLength=n/2,this.vertexCount=a,this.angles.push(0),s=1;s<a;s++){var u=this.line[3*(s-1)],d=this.line[3*s],f=this.line[3*(s-1)+1],h=this.line[3*s+1];this.angles.push(Math.atan2(h-f,d-u))}}return t.prototype.interpolate=function(t,e){var n=e,r=n-1,i=this.lengths[r],o=(t-i)/(this.lengths[n]-i);return[(1-o)*this.line[3*r]+o*this.line[3*n],(1-o)*this.line[3*r+1]+o*this.line[3*n+1],0,this.angles[e]]},t.prototype.getSegmentIndex=function(t){for(var e=0;e<this.lengths.length;e++)if(t<this.lengths[e])return e;return this.lengths.length},t}(),O=function(){function t(){this.labels={}}return t.prototype.add=function(t){var e=t.id,n=t.componentDistanceStart;void 0===this.labels[e]&&(this.labels[e]={});var r=this.labels[e];void 0===r[n]&&(r[n]=[]),r[n].push(t)},t.prototype.merge=function(){var t=[];for(var e in this.labels)for(var n=this.labels[e],r=Object.keys(n).sort((function(t,e){return Number(t)-Number(e)})),i=0;i<r.length;){var o=r[i];if(0!==n[o].length){for(var a=[],s=n[o].pop();void 0!==s;)a.push(s),s=0===s.componentDistanceStart&&0===s.componentDistanceEnd||void 0===n[s.componentDistanceEnd]?void 0:n[s.componentDistanceEnd].pop();if(1===a.length){var c=a[0];c.axis=new S(c.anchorWorld,c.componentDistanceStartWorld,c.objectLengthWorld),t.push(c)}else a.length>1&&t.push(this.stitch(a))}else i++}return t},t.prototype.stitch=function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n].anchorWorld.length;e-=3*(t.length-1);var r=new Int32Array(e),i=0;for(n=0;n<t.length;n++)for(var o=t[n].anchorWorld,a=n>0?3:0;a<o.length;a++)r[i++]=o[a];var s=t[0];return s.axis=new S(r,s.componentDistanceStartWorld,s.objectLengthWorld),t[0]},t}(),M=n(47),j=n(7),I=n(2),T=function(t,e,n,r,i,a,s,c,u,d,f,h){this.type=l.c.Box,this.id=String(t),this.label={idLo:t,idHi:0,symbol:"nevermind",phase:NaN},this.groupPriority=null!=h?h:o.g,this.itemPriority=null!=f?f:1,this.parent=d,this.placementIndex=0,this.labelingGroup=u,this.labelingGroupTable=c.labelingGroups.table,this.anchorWorld=x.d(),x.c(this.anchorWorld,r),this.anchorWorld[2]*=a.buildingHeight,this.anchorScreen=[0,0],Object(I.z)(this.anchorScreen,this.anchorWorld,s,a.size,a.viewport),j.a(this.anchorScreen,this.anchorScreen,i),this.appearMarginTopBottom=0,this.appearMarginLeftRight=0,this.visibleMarginTopBottom=0,this.visibleMarginLeftRight=0,this.boxes=[[0,0,e,n]]},E=n(10),A=n(3),L=n(17),C=n(54),P=n(22),k=Object(I.h)(i.labeling.axisAngleToleranceDeg),N=i.labeling.axisCheckDistancePx,R=Object(I.h)(i.labeling.lineLabelsHidePitchDeg),z=w.b(),B=x.d();function F(t,e,n,r,i,o,a,s,c,u){var d=[],f=[],h=[],p=[],m={},v=function(t,e,n){for(var r={personalPoi:new Set,commercialPoi:new Set},i=0,o=t;i<o.length;i++){var a=o[i],s=e.get(a);if(void 0!==s)for(var c=0,u=s;c<u.length;c++){var d=u[c],f=n[d.metatileHash];d.source===l.b.PersonalPoi?r.personalPoi.add(d.id):Object(P.e)(d.sublayer,f)&&r.commercialPoi.add(d.id)}}return r}(t,r,s);Object(I.G)(z,e),Object(I.F)(B,e);for(var _=new O,g=0;g<t.length;g++){var y=t[g],b=r.get(y);if(void 0!==b)for(var x=0;x<b.length;x++){var w=s[(E=b[x]).metatileHash];if(j=n.getStyle(E.styleId)){var S=Object(P.e)(E.sublayer,w);if((E.source!==l.b.Tile||!u.has(E.id))&&(E.source===l.b.PersonalPoi||!v.personalPoi.has(E.id)||S)&&!(E.source===l.b.PersonalPoi&&v.commercialPoi.has(E.id)||e.promoMode&&"poi"===E.symbol&&(S||Object(P.j)(E.sublayer,w)||Object(P.g)(E.sublayer,w))))switch(E.symbol){case"labelPoint":case"poi":case"marker":D(E,o,a,j),E.ready&&q(E,e.styleZoom)&&U(p,h,m,E,z,e,w,j,c);break;case"labelLine":D(E,o,a,j),E.ready&&q(E,e.styleZoom)&&_.add(E);break;case"oneWayLine":q(E,e.styleZoom)&&_.add(E)}}else console.error("Not found style "+E.styleId+" in labeling#collectLabelingElements")}}var M=_.merge();for(g=0;g<M.length;g++){var j,E=M[g];(j=n.getStyle(E.styleId))?Z(f,p,E,j,z,B,e):console.error("Not found style "+E.styleId+" in labeling#collectLabelingElements")}return i.forEach((function(t){var r,i=t.id,o=t.width,a=t.height,s=t.position,c=t.offset,l=t.labelingGroup,u=t.parentPoiId;if(!u||(r=m[u])){var f=n.getStyle(-1);if(f){var h=new T(i,o,a,s,c,e,z,f,l,r,null==r?void 0:r.itemPriority,null==r?void 0:r.groupPriority);d.push(h)}else console.error("Not found style -1 in labeling#collectLabelingElements")}})),{boxElements:d,oneWayTileElements:f,noLabelingElements:h,otherTileElements:p}}function D(t,e,n,r){if(!t.ready){var i=t.symbol,o=t.ranges,a=t.font,s=t.font2;if("poi"!==i&&"marker"!==i||!Number.isNaN(a)||t.label2&&!Number.isNaN(s)){for(var c=r.fonts[a],l=0,u=o;l<u.length;l++){var d=u[l];if(!n.has(c,d))return}if(t.textMetrics=Object(C.a)(t.label,t.letterSpacing,e[c]),t.label2&&!Number.isNaN(s)){for(var f=r.fonts[s],h=0,p=o;h<p.length;h++)if(d=p[h],!n.has(f,d))return;t.textMetrics2=Object(C.a)(t.label2,t.letterSpacing,e[f]),t.ready=!0}else t.ready=!0}else t.ready=!0}}function U(t,e,n,r,i,o,s,c,u){var d;Object(a.b)(r.symbol,r,c,s,o,i,u);for(var f=0;f<r.labelingElements.length;f++){var h=r.labelingElements[f];"__overlapped"!==h.labelingGroup&&"__overlapped"!==(null===(d=h.parent)||void 0===d?void 0:d.labelingGroup)?(t.push(h),h.type===l.c.Icon&&(n[h.label.id]=h)):e.push(h)}}function Z(t,e,n,r,o,a,s){var c,l,u=s.zoom,d=s.styleZoom,f=Math.floor(d),h=u+(f-d),p=n.axis,m=p.startLength,v=p.midLength,_=p.finishLength,g=r.curves,y="oneWayLine"===n.symbol;if(y)c=Y(n,d,r),l=Y(n,f,r);else{var b=Object(L.c)(g[n.fontSize],d)/i.fonts.baseSize,x=Object(L.c)(g[n.fontSize],f)/i.fonts.baseSize;c=n.textMetrics.maxWidth*b,l=n.textMetrics.maxWidth*x}for(var w=Object(E.r)(Object(L.c)(g[n.duplicationSpacing],f),h),S=Object(E.r)(l,h),O=Object(E.r)(c,u)/2,M=w+S,j=Object(E.r)(n.lineEndingOffsets,u),I=m+O+j,T=_-O-j,A=y?t:e,C=m+(v-m)%M;C<T;C+=M)C>I&&H(A,n,C,O,c,o,a,s,r)}function H(t,e,n,r,o,a,s,c,u){var d=e.axis,f=c.zoom,h=c.styleZoom,p=d.startLength,m=d.finishLength,v=d.getSegmentIndex(n),_=d.interpolate(n,v);if(!(Object(I.t)(s,_,c)>R)&&function(t,e,n,r,o,a){if("oneWayLine"===t.symbol)return!0;for(var s=a.curves,c=t.axis,l=Object(L.c)(s[t.fontSize],o)/i.fonts.baseSize,u=c.getSegmentIndex(e-n),d=c.getSegmentIndex(e+n),f=Object(E.r)(N*l,r),h=u;h<d;h++){if(G(c.angles[h-1],c.angles[h])>k)return!1;if(G(c.angles[c.getSegmentIndex(c.lengths[h]-f)],c.angles[c.getSegmentIndex(c.lengths[h]+f)])>k)return!1}return!0}(e,n,r,f,h,u)){var g="oneWayLine"===e.symbol,y=g?l.c.OneWayLine:l.c.LineText,b=new M.a(e,y,_,c,a,u);b.anchorPosition=n,b.anchorSegmentIndex=v,b.halfLabelWidth=r,g||(b.overflowStyleZoom=Object(A.f)(Object(E.q)(o,m-p),_),function(t,e,n,r,i,o,a){for(var s=i.zoom,c=i.styleZoom,l=a.curves,u=e.fontSize,d=e.axis,f=Object(L.c)(l[u],c),h=f/2,p=Object(E.r)(f,s),m=Object(E.r)(e.labelMargins,s),v=n-r+p/2-m,_=n+r-p/2+m,g=d.getSegmentIndex(v),y=v;y<_;y+=p){for(;d.lengths[g]<y;)g++;V(t,d,y,g,o,i,h)}for(;d.lengths[g]<_;)g++;V(t,d,_,g,o,i,h)}(b,e,n,r,c,a,u)),t.push(b)}}function G(t,e){var n=Math.abs(t-e);return n>Math.PI?2*Math.PI-n:n}var W=[0,0];function V(t,e,n,r,i,o,a){Object(I.z)(W,e.interpolate(n,r),i,o.size,o.viewport),W[0]=W[0]-t.anchorScreen[0],W[1]=W[1]-t.anchorScreen[1],t.boxes.push([W[0]-a,W[1]-a,W[0]+a,W[1]+a])}function q(t,e){var n=t.source,r=t.minStyleZoom,o=t.maxStyleZoom,a=t.detailLevel,s=n===l.b.PersonalPoi,c=s||r>a,u=s||o<a+1||a===i.tiles.maxDetailLevel;return(!c||e>=r)&&(!u||e<o)}function Y(t,e,n){return Object(L.c)(n.curves[t.length],e)}var X=n(44),K=n(45),J=n(48),Q=n(16),$=n(79),tt=n(77),et=new Map;e.default=function(t){var e=new X.b(t),n=new K.a(e),u=new b.a("labeling"),d=new $.a,f=n.get(Q.b.Main,"loadFont"),h=new Map,p=new Map,m=[],v=new Map,_=new J.a,g=new J.a,x={},w={},S=Object(s.a)((function(){return u.reset()}),i.workerResetDebounceTime),O=function(t,e){w[t]=e};n.set("setMetatile",O);var M=new tt.a(n);function j(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];_.has(t,i)||(f(t,i),_.set(t,i,!0))}}function I(t,e){var n=t.get(e.id);return void 0===n?1:n===e.placementIndex?0:1}O(o.i,M),n.set("appendLabels",(function(t,e,n){for(var r=Object(c.a)(n,e),i=0,o=r;i<o.length;i++){var a=o[i],s=a.styleId,l=a.font,u=a.font2,f=a.ranges,p=d.getStyle(s);p?(Number.isNaN(l)||j(p.fonts[l],f),Number.isNaN(u)||j(p.fonts[u],f)):console.error("Not found style "+s+" in labeling#appendLabels")}h.set(t,r)})),n.set("appendLabelBox",(function(t,e){p.set(t,e)})),n.set("removeEmptyBoxLabel",(function(t){p.delete(t)})),n.set("removeLabels",(function(t){h.delete(t),p.delete(t)})),n.set("processLabels",(function(t,e,n,i,o,s,c){for(var f=new Set(o),_=F(t,e,d,h,p,x,g,w,i,f),b=_.boxElements,O=_.oneWayTileElements,M=_.otherTileElements,j=_.noLabelingElements,T=(y(Object(r.e)(M,b),e,c?et:v,s),Object(r.e)(j,O,M)),E=new Map,A=0;A<T.length;A++)-1!==(Y=T[A]).placementIndex&&E.set(Y.id,Y.placementIndex);for(A=0;A<T.length;A++){var L=(Y=T[A]).type,C=Y.label,P=C.symbol,k=C.metatileHash,N=C.styleId;if(("marker"!==P||L!==l.c.Icon)&&-1!==Y.placementIndex){var R=w[k],z=I(v,Y);(U=d.getStyle(N))?Object(a.d)(P,U,R,u,Y,z,i,e,n):console.error("Not found style "+N+" in labeling#processLabels")}}for(A=0;A<m.length;A++){var B=(Y=m[A]).id,D=(L=Y.type,Y.label);if(P=D.symbol,k=D.metatileHash,N=D.styleId,"marker"!==P||L!==l.c.Icon){var U,Z=Y.placementIndex,H=E.get(B);-1===Z||Z===H||e.styleZoom<Y.overflowStyleZoom||e.styleZoom<D.minDisplayStyleZoom||e.styleZoom>=D.maxDisplayStyleZoom||(R=w[k],(U=d.getStyle(N))?Object(a.d)(P,U,R,u,Y,-1,i,e,n):console.error("Not found style "+N+" in labeling#processLabels"))}}m=T,v=E;for(var G=u.getAccumulatedData(),W=[],V=0,q=b;V<q.length;V++){var Y;-1!==(Y=q[V]).placementIndex&&W.push(Y.label.idLo)}var X={survivedLabelBoxIds:W,collectorOutput:G,transferable:G.transferable};return S(),X})),n.set("appendFont",(function(t,e){x[t]||(x[t]={});var n=x[t];for(var r in e)n[r]=e[r]})),n.set("markFontAsLoaded",(function(t,e){g.set(t,e,!0)})),n.set("addNewRasterSets",(function(t,e){var n=d.getStyle(t);if(n){var r=n.rasterSets;e.forEach((function(t){r[t.index]=t}))}else console.error("Not found style "+t+" in labeling#addNewRasterSets")})),n.set("updatePackingInfo",(function(t,e){var n=d.getStyle(t);if(n)for(var r=n.rasterSets,i=e.length/7,o=0;o<i;o++){var a=e[7*o],s=e[7*o+1],c=e[7*o+6],l=e[7*o+2],u=e[7*o+3],f=e[7*o+4],h=e[7*o+5],p=r[a];if(void 0!==p)if(p.isSvg)p.rasters[s]={x:l,y:u,w:f,h:h,anchorX:p.anchorX,anchorY:p.anchorY,atlasIndex:c,isPacked:!0};else{var m=p.rasters[s];if(void 0===m){console.error("Not found raster with index "+s+" and raster set index "+a);continue}m.x=l,m.y=u,m.atlasIndex=c,m.isPacked=!0}else console.error("Not found raster set with index "+a)}else console.error("Not found style "+t+" in labeling#updatePackingInfo")})),n.set("clearPreviousLabels",(function(){m=[],v.clear()})),n.set("addStyle",(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d.proxyAddStyle.apply(d,t)})),n.set("bindStyleToMetatileHash",(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d.proxyBindStyleToMetatileHash.apply(d,t)})),n.set("useSingleStyle",(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d.proxyUseSingleStyle.apply(d,t)}))}},function(t,e,n){"use strict";n.r(e);var r=n(44),i=n(45),o=(n(62),n(87)),a=n.n(o),s=(n(58),n(2),4096),c=function(){function t(t,e){this.type="geoJson",this.geoJsonData=void 0,this.data=e.data,this.id=t,this.setData(e.data),this.status="loading"}return t.prototype.setData=function(t){this.status="loading","string"==typeof t?this.loadData(t):this.initGeoTiles(t)},t.prototype.getTile=function(t,e,n){var r,i;return null===(i=null===(r=this.tilesCollector)||void 0===r?void 0:r.getTile(n,t,e))||void 0===i?void 0:i.features},t.prototype.initGeoTiles=function(t){var e;this.geoJsonData=t,this.tilesCollector=(e=this.geoJsonData,a()(e,{maxZoom:24,tolerance:3,extent:s,buffer:1,debug:0,lineMetrics:!1,promoteId:null,generateId:!1,indexMaxZoom:8,indexMaxPoints:1e5})),this.status="success"},t.prototype.loadData=function(t){var e=this;fetch(t).then((function(t){return t.json()})).then((function(t){e.initGeoTiles(t)})).catch((function(t){e.status="error",console.error(t)}))},t}();e.default=function(t){var e=new r.b(t),n=new i.a(e),o=new Map;n.set("addSource",(function(t,e){if("geoJson"===e.type){var n=new c(t,e);o.set(t,n)}})),n.set("removeSource",(function(t){return new Promise((function(e){o.delete(t),e()}))})),n.set("getTile",(function(t,e,n,r){return new Promise((function(i){var a=o.get(t);i({type:"tiles",tiles:null==a?void 0:a.getTile(e,n,r)})}))}))}}])},function(t,e,n){var r=n(5),i=n(14);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.i,i,""]]);var o={insert:"head",singleton:!1};r(i,o);t.exports=i.locals||{}},function(t,e,n){var r=n(5),i=n(12);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.i,i,""]]);var o={insert:"head",singleton:!1};r(i,o);t.exports=i.locals||{}},function(t,e,n){var r=n(5),i=n(10);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.i,i,""]]);var o={insert:"head",singleton:!1};r(i,o);t.exports=i.locals||{}},function(t,e,n){var r=n(5),i=n(11);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.i,i,""]]);var o={insert:"head",singleton:!1};r(i,o);t.exports=i.locals||{}},function(t,e,n){"use strict";var r,i=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},o=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),a=[];function s(t){for(var e=-1,n=0;n<a.length;n++)if(a[n].identifier===t){e=n;break}return e}function c(t,e){for(var n={},r=[],i=0;i<t.length;i++){var o=t[i],c=e.base?o[0]+e.base:o[0],l=n[c]||0,u="".concat(c," ").concat(l);n[c]=l+1;var d=s(u),f={css:o[1],media:o[2],sourceMap:o[3]};-1!==d?(a[d].references++,a[d].updater(f)):a.push({identifier:u,updater:v(f,e),references:1}),r.push(u)}return r}function l(t){var e=document.createElement("style"),r=t.attributes||{};if(void 0===r.nonce){var i=n.nc;i&&(r.nonce=i)}if(Object.keys(r).forEach((function(t){e.setAttribute(t,r[t])})),"function"==typeof t.insert)t.insert(e);else{var a=o(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var u,d=(u=[],function(t,e){return u[t]=e,u.filter(Boolean).join("\n")});function f(t,e,n,r){var i=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(t.styleSheet)t.styleSheet.cssText=d(e,i);else{var o=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function h(t,e,n){var r=n.css,i=n.media,o=n.sourceMap;if(i?t.setAttribute("media",i):t.removeAttribute("media"),o&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}var p=null,m=0;function v(t,e){var n,r,i;if(e.singleton){var o=m++;n=p||(p=l(e)),r=f.bind(null,n,o,!1),i=f.bind(null,n,o,!0)}else n=l(e),r=h.bind(null,n,e),i=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else i()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=i());var n=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var r=0;r<n.length;r++){var i=s(n[r]);a[i].references--}for(var o=c(t,e),l=0;l<n.length;l++){var u=s(n[l]);0===a[u].references&&(a[u].updater(),a.splice(u,1))}n=o}}}},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var i=(a=r,s=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(c," */")),o=r.sources.map((function(t){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(t," */")}));return[n].concat(o).concat([i]).join("\n")}var a,s,c;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,r){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(r)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(i[a]=!0)}for(var s=0;s<t.length;s++){var c=[].concat(t[s]);r&&i[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}},function(t,e,n){var r=n(5),i=n(9);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.i,i,""]]);var o={insert:"head",singleton:!1};r(i,o);t.exports=i.locals||{}},function(t,e,n){var r=n(5),i=n(13);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[t.i,i,""]]);var o={insert:"head",singleton:!1};r(i,o);t.exports=i.locals||{}},function(t,e,n){(e=n(6)(!1)).push([t.i,".mapgl_3l-UxdpsHoVB9FmXokikzc {\n    position: absolute;\n    display: flex;\n    z-index: 50;\n}\n\n.mapgl_1fPsFwMV9ObLP13-K761VI {\n    top: 10px;\n    flex-direction: column;\n}\n\n.mapgl_3PeAm37tqGwGiSsfLRJTsz {\n    bottom: 10px;\n    flex-direction: column-reverse;\n}\n\n.mapgl_1uV6SAc5RT5nqIsrNUcIfw {\n    left: 10px;\n}\n\n.mapgl_o9F7cjpOIBahfU_wE8RMp {\n    right: 10px;\n    align-items: flex-end;\n}\n\n.mapgl_1fPsFwMV9ObLP13-K761VI > div + div {\n    margin-top: 10px;\n}\n\n.mapgl_3PeAm37tqGwGiSsfLRJTsz > div + div {\n    margin-bottom: 10px;\n}\n",""]),e.locals={container:"mapgl_3l-UxdpsHoVB9FmXokikzc",top:"mapgl_1fPsFwMV9ObLP13-K761VI",bottom:"mapgl_3PeAm37tqGwGiSsfLRJTsz",left:"mapgl_1uV6SAc5RT5nqIsrNUcIfw",right:"mapgl_o9F7cjpOIBahfU_wE8RMp"},t.exports=e},function(t,e,n){(e=n(6)(!1)).push([t.i,".mapgl_v40Pms0--hwyOQ8UjPcWr {\n    width: 32px;\n    box-shadow: 0 1px 3px 0 rgba(38, 38, 38, 0.5);\n    border-radius: 4px;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    background: #fff;\n}\n\n.mapgl_100uyFkiYndX6GvJkrNTro {\n    padding: 0;\n    outline: 0;\n    border: none;\n    cursor: pointer;\n\n    background: #fff;\n    width: 32px;\n    height: 32px;\n    color: #262626;\n    box-sizing: border-box;\n}\n\n.mapgl_100uyFkiYndX6GvJkrNTro:hover {\n    opacity: 0.7;\n}\n\n.mapgl_100uyFkiYndX6GvJkrNTro:active {\n    color: #028eff;\n}\n\n.mapgl_100uyFkiYndX6GvJkrNTro:disabled {\n    background: #f2f2f2;\n    color: #929292;\n    cursor: default;\n}\n\n.mapgl_1VMXd7ruCY-OWQf4wLOXlX {\n    border-bottom: 1px solid #e6e6e6;\n}\n\n.mapgl_3VR3BMH_pT81tH5FCB4UKu {\n    border-bottom: none;\n}\n",""]),e.locals={root:"mapgl_v40Pms0--hwyOQ8UjPcWr",button:"mapgl_100uyFkiYndX6GvJkrNTro",zoomIn:"mapgl_1VMXd7ruCY-OWQf4wLOXlX",zoomOut:"mapgl_3VR3BMH_pT81tH5FCB4UKu"},t.exports=e},function(t,e,n){(e=n(6)(!1)).push([t.i,".mapgl_1dJRjtTADjfrWEBK1VP-yH {\n    background: #fff;\n    box-shadow: 0 1px 3px 0 rgba(38, 38, 38, 0.5);\n    border-radius: 4px;\n    overflow: hidden;\n}\n\n.mapgl_3zhJcxK1WUkZT4OIb0F0ju {\n    padding: 0;\n    outline: 0;\n    border: none;\n    cursor: pointer;\n    box-sizing: border-box;\n    font-size: 18px;\n    font-weight: 400;\n    width: 32px;\n    height: 32px;\n    color: #262626;\n    background: #fff;\n}\n\n.mapgl_xj2Lg9Z4A-XYFDPMCk-2-:hover {\n    opacity: 0.7;\n}\n\n.mapgl_hvKpkuZ-HybGjVfMvZkJB {\n    background: #299400;\n    color: #fff;\n}\n.mapgl_2MVzHnca_pzo15AMUqLG1Y {\n    background: #ffb81c;\n    color: #fff;\n}\n.mapgl_2Lex5zOJIAmz1em4-jc3kD {\n    background: #fe5000;\n    color: #fff;\n}\n\n.mapgl_hvKpkuZ-HybGjVfMvZkJB:hover,\n.mapgl_2MVzHnca_pzo15AMUqLG1Y:hover,\n.mapgl_2Lex5zOJIAmz1em4-jc3kD:hover {\n    color: rgba(38, 38, 38, 0.7);\n}\n",""]),e.locals={root:"mapgl_1dJRjtTADjfrWEBK1VP-yH",button:"mapgl_3zhJcxK1WUkZT4OIb0F0ju",none:"mapgl_xj2Lg9Z4A-XYFDPMCk-2-",easy:"mapgl_hvKpkuZ-HybGjVfMvZkJB",medium:"mapgl_2MVzHnca_pzo15AMUqLG1Y",hard:"mapgl_2Lex5zOJIAmz1em4-jc3kD"},t.exports=e},function(t,e,n){(e=n(6)(!1)).push([t.i,".mapgl_1mf4dGW5YwpxRisgDjNvYa {\n    font-family: Helvetica, Arial, sans-serif !important;\n    font-size: 8px !important;\n    line-height: 8px !important;\n    text-align: right !important;\n    display: flex;\n    align-items: flex-start;\n    color: #6d7173 !important;\n}\n\n.mapgl_1evexfkL98VWP7vg3WdM_n {\n    display: flex;\n    flex-direction: column;\n    padding-right: 4px;\n}\n\n.mapgl_1-ZxJHDJR4_0HjgadmGoyz {\n    display: flex;\n    flex-direction: row;\n}\n\n.mapgl_2rKXcK6rBLVDts2nY7Soj8 {\n    animation: mapgl_1V_Npc20wdT6RNVr-h_CuO 5s forwards;\n}\n\na.mapgl_B9UnieOsCT3RFtxHKh-re {\n    color: #6d7173 !important;\n    text-decoration: none !important;\n}\n\na.mapgl_B9UnieOsCT3RFtxHKh-re:hover {\n    color: #929292 !important;\n}\n@keyframes mapgl_1V_Npc20wdT6RNVr-h_CuO {\n    85% {\n        opacity: 1;\n    }\n    100% {\n        opacity: 0;\n    }\n}\n",""]),e.locals={container:"mapgl_1mf4dGW5YwpxRisgDjNvYa",text:"mapgl_1evexfkL98VWP7vg3WdM_n",copyrights:"mapgl_1-ZxJHDJR4_0HjgadmGoyz",autoHide:"mapgl_2rKXcK6rBLVDts2nY7Soj8",hideAnimation:"mapgl_1V_Npc20wdT6RNVr-h_CuO",link:"mapgl_B9UnieOsCT3RFtxHKh-re"},t.exports=e},function(t,e,n){(e=n(6)(!1)).push([t.i,".mapgl_F_tU1ilxWO8LMOuimXOaK {\n    pointer-events: none;\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 10px;\n    background-color: rgba(0, 0, 0, 0.2);\n    cursor: default;\n}\n\n.mapgl_38fZM-7XxSI9BVB93wwLZS {\n    text-align: center;\n    font-size: 24px;\n    font-family: Helvetica, Arial, sans-serif;\n    font-weight: bold;\n    color: white;\n}\n",""]),e.locals={wrap:"mapgl_F_tU1ilxWO8LMOuimXOaK",container:"mapgl_38fZM-7XxSI9BVB93wwLZS"},t.exports=e},function(t,e,n){(e=n(6)(!1)).push([t.i,".mapgl_39boxHsSrpYLUd1Q_TLWNE {\n    position: relative;\n}\n\n.mapgl_XndZ8Gq86AwHiI9OL2rrI {\n    display: flex;\n    max-height: 40vh;\n    background: #ffffff;\n    width: 32px;\n    overflow: hidden;\n    border-radius: 4px;\n    box-shadow: 0 1px 3px 0 rgba(38, 38, 38, 0.5);\n}\n\n.mapgl_1KjXIyKXx3cKlGOuH7iOqm {\n    width: 100%;\n    overflow-x: hidden;\n    overflow-y: auto;\n    -moz-padding-end: 17px;\n    -webkit-padding-end: 17px;\n    -webkit-margin-end: -17px;\n}\n\n.mapgl_3YmAJvPYAFZnAd-ueoYpoZ {\n    display: flex;\n    flex-direction: column-reverse;\n}\n\n.mapgl_1Q3q5ldrXhqbptc76FSJrD {\n    padding: 0;\n\n    border: none;\n    background: #ffffff;\n    height: 32px;\n    width: 32px;\n    color: #262626;\n    cursor: pointer;\n    border-bottom: 1px solid #e6e6e6;\n    box-sizing: border-box;\n    flex-shrink: 0;\n}\n.mapgl_1Q3q5ldrXhqbptc76FSJrD:focus {\n    outline: 0;\n}\n.mapgl_1Q3q5ldrXhqbptc76FSJrD:first-child {\n    border-bottom: none;\n}\n.mapgl_1Q3q5ldrXhqbptc76FSJrD:hover {\n    color: rgba(38, 38, 38, 0.7);\n}\n.mapgl_1Q3q5ldrXhqbptc76FSJrD:active {\n    color: #028eff;\n}\n.mapgl_1Q3q5ldrXhqbptc76FSJrD:disabled {\n    background: #f2f2f2;\n    color: #929292;\n    cursor: default;\n}\n\n.mapgl_vtN8BO05QrwsIJqLj2gQP {\n    font-size: 18px;\n    line-height: 32px;\n    font-weight: 400;\n    overflow-wrap: break-word;\n\n    position: relative;\n    text-align: center;\n    height: 100%;\n}\n\n.mapgl_26bMfdsaLACTmUYdHiXRmw:after {\n    content: '';\n    position: absolute;\n    top: 4px;\n    bottom: 4px;\n    width: 4px;\n    height: 4px;\n    border-radius: 50%;\n    background: #028eff;\n}\n",""]),e.locals={root:"mapgl_39boxHsSrpYLUd1Q_TLWNE",container:"mapgl_XndZ8Gq86AwHiI9OL2rrI",scroller:"mapgl_1KjXIyKXx3cKlGOuH7iOqm",content:"mapgl_3YmAJvPYAFZnAd-ueoYpoZ",control:"mapgl_1Q3q5ldrXhqbptc76FSJrD",label:"mapgl_vtN8BO05QrwsIJqLj2gQP",_hasResult:"mapgl_26bMfdsaLACTmUYdHiXRmw"},t.exports=e},function(t,e){setTimeout((function(){if("__mapglPlugins"in window)for(var t in window.__mapglPlugins)window.mapgl[t]=window.__mapglPlugins[t]}),0)},function(t,e,n){"use strict";n.r(e),n.d(e,"Map",(function(){return Z})),n.d(e,"Marker",(function(){return H})),n.d(e,"Label",(function(){return G})),n.d(e,"HtmlMarker",(function(){return W})),n.d(e,"Control",(function(){return h})),n.d(e,"ZoomControl",(function(){return _})),n.d(e,"TrafficControl",(function(){return b})),n.d(e,"FloorControl",(function(){return N})),n.d(e,"CircleMarker",(function(){return q})),n.d(e,"Circle",(function(){return V})),n.d(e,"Polygon",(function(){return X})),n.d(e,"Polyline",(function(){return Y})),n.d(e,"LngLatBounds",(function(){})),n.d(e,"LngLatBoundsClass",(function(){return L})),n.d(e,"AnimationOptions",(function(){})),n.d(e,"RotationAnimationOptions",(function(){})),n.d(e,"Easing",(function(){})),n.d(e,"MapOptions",(function(){})),n.d(e,"MarkerOptions",(function(){})),n.d(e,"LabelOptions",(function(){})),n.d(e,"ControlOptions",(function(){})),n.d(e,"HtmlMarkerOptions",(function(){})),n.d(e,"CircleMarkerOptions",(function(){})),n.d(e,"CircleOptions",(function(){})),n.d(e,"PolygonOptions",(function(){})),n.d(e,"PolylineOptions",(function(){})),n.d(e,"MapSupportOptions",(function(){})),n.d(e,"MapEventTable",(function(){})),n.d(e,"DynamicObjectEventTable",(function(){})),n.d(e,"MapEvent",(function(){})),n.d(e,"MapPointerEvent",(function(){})),n.d(e,"EventTarget",(function(){})),n.d(e,"isSupported",(function(){return K})),n.d(e,"notSupportedReason",(function(){return J}));var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))}function s(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var c=n(0),l=function(){function t(){this.events={}}return t.prototype.on=function(t,e){var n=this.events[t];return n||(n=this.events[t]=[]),n.push(e),this},t.prototype.once=function(t,e){var n=this,r=function(i){n.off(t,r),e.call(n,i)};return this.on(t,r),this},t.prototype.off=function(t,e){var n=this.events[t];if(!n)return this;var r=n.indexOf(e);return-1!==r&&n.splice(r,1),this},t.prototype.emit=function(t,e){var n=this.events[t];if(!n)return this;for(var r=n.slice(),i=0;i<r.length;i++)r[i].call(this,e);return this},t}();var u=n(7),d=n.n(u),f=function(){function t(t){this.controlPane=t,this.containers={topLeft:this._initControlContainer("left","top"),topRight:this._initControlContainer("right","top"),bottomRight:this._initControlContainer("right","bottom"),bottomLeft:this._initControlContainer("left","bottom")}}return t.prototype.getContainerByPosition=function(t){return this.containers[t]},t.prototype._initControlContainer=function(t,e){var n,r=document.createElement("div");return r.className=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce((function(t,e){var n=[];return"object"==typeof e&&Object.keys(e).forEach((function(t){e[t]&&n.push(t)})),"string"==typeof e&&n.push(e),t.concat(n)}),[]).join(" ")}(d.a.container,((n={})[d.a.top]="top"===e,n[d.a.bottom]="bottom"===e,n[d.a.left]="left"===t,n[d.a.right]="right"===t,n)),this.controlPane.appendChild(r),r},t}(),h=function(){function t(t,e,n){var r=n.position;this._wrap=document.createElement("div"),this._wrap.style.userSelect="none",this._wrap.innerHTML=e,this._position=r,this._containers=t._controlContainers,this._container=this._containers.getContainerByPosition(r),this._container.append(this._wrap)}return t.prototype.destroy=function(){this._wrap.remove()},t.prototype.getPosition=function(){return this._position},t.prototype.setPosition=function(t){this._container.removeChild(this._wrap),this._container=this._containers.getContainerByPosition(t),this._container.append(this._wrap),this._position=t},t.prototype.getContainer=function(){return this._wrap},t}(),p=n(3),m=n.n(p),v='\n    <div class="'+m.a.root+'">\n        <button class="'+m.a.button+" "+m.a.zoomIn+'">\n            <svg\n                xmlns="http://www.w3.org/2000/svg"\n                viewBox="0 0 32 32"\n                width="32"\n                height="32"\n                fill="currentColor"\n            >\n                <path d="M24 15h-7V8h-2v7H8v2h7v7h2v-7h7v-2z"></path>\n            </svg>\n        </button>\n        <button class="'+m.a.button+" "+m.a.zoomOut+'">\n            <svg\n                xmlns="http://www.w3.org/2000/svg"\n                viewBox="0 0 32 32"\n                fill="currentColor"\n                width="32"\n                height="32"\n            >\n                <path d="M8 15h16v2H8z"></path>\n            </svg>\n        </button>\n    </div>\n',_=function(t){function e(e,n){var r=t.call(this,e,v,n)||this;return r._zoomIn=function(){r._map.setZoom(r._map.getZoom()+1,{duration:400})},r._zoomOut=function(){r._map.setZoom(r._map.getZoom()-1,{duration:400})},r._checkZoom=function(){var t=r._map.getZoom();t<=r._map.getMinZoom()?r._zoomOutButton.disabled=!0:r._zoomOutButton.disabled=!1,t>=r._map.getMaxZoom()?r._zoomInButton.disabled=!0:r._zoomInButton.disabled=!1},r._map=e,r._zoomInButton=r._wrap.querySelector("."+m.a.zoomIn),r._zoomOutButton=r._wrap.querySelector("."+m.a.zoomOut),r._zoomInButton.addEventListener("click",r._zoomIn),r._zoomOutButton.addEventListener("click",r._zoomOut),r._map.on("zoom",r._checkZoom),r}return i(e,t),e.prototype.destroy=function(){this._map.off("zoom",this._checkZoom),this._zoomInButton.removeEventListener("click",this._zoomIn),this._zoomOutButton.removeEventListener("click",this._zoomOut),t.prototype.destroy.call(this)},e}(h),g=n(4),y=n.n(g),b=function(t){function e(e,n){var r=t.call(this,e,"",n)||this;return r._onClick=function(){r._trafficVisible?(r._map.hideTraffic(),r._map.patchStyleState({trafficOn:!1})):(r._map.showTraffic(),r._map.patchStyleState({trafficOn:!0}))},r._map=e,r._trafficVisible=!1,r._render(),e.on("trafficscore",(function(t){var e=t.score;r._score=e,r._render()})),e.on("trafficshow",(function(){r._trafficVisible=!0,r._render()})),e.on("traffichide",(function(){r._trafficVisible=!1,r._render()})),r}return i(e,t),e.prototype._render=function(){var t=this._trafficVisible?function(t){if(void 0===t)return"";if(t>6)return y.a.hard;if(t>3)return y.a.medium;return y.a.easy}(this._score):y.a.none,e='\n            <div class="'+y.a.root+'">\n                <button class="'+y.a.button+" "+t+'">\n                    '+(this._trafficVisible&&void 0!==this._score?this._score:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="14" viewBox="0 0 20 14" style="margin-top: 4px">\n    <path d="M 18,5 C 18,4 17,1 15,1 H 12 10 C 8,1 7,4 7,5 H 5 v 2 h 1 v 4 c 0,0.6 0,1 1,1 v 2 h 2 v -2 h 7 v 2 h 2 v -2 c 1,0 1,-0.4 1,-1 V 7 h 1 V 5 H 18 z M 10,3 h 2 3 c 2,0 2,1 2,3 H 8 C 8,4 8,3 10,3 z M 9,10 H 8 C 7.4,10 7,9.6 7,9 7,8.4 7.4,8 8,8 h 1 c 0.6,0 1,0.4 1,1 0,0.6 -0.4,1 -1,1 z m 8,0 H 16 C 15.4,10 15,9.6 15,9 15,8.4 15.4,8 16,8 h 1 c 0.6,0 1,0.4 1,1 0,0.6 -0.4,1 -1,1 z M 4,4 H 6 V 3 H 4 C 1,3 1,6 1,7 H 0 v 1 h 1 v 4 H 3 V 11 H 5 V 7 H 2 C 2,6 2,4 4,4 z M 3,9 4,10 H 2 V 9 h 1 z" fill="#616161" fill-rule="evenodd"/>\n    <g fill="#fff">\n        <path d="m 16,8 h 1 c 0.4,0 0.7,0.2 0.8,0.5 C 17.9,8.4 18,8.2 18,8 18,7.4 17.6,7 17,7 h -1 c -0.6,0 -1,0.4 -1,1 0,0.2 0.1,0.4 0.2,0.5 C 15.3,8.2 15.6,8 16,8 z"/>\n        <path d="M 8,8 H 9 C 9.4,8 9.7,8.2 9.8,8.5 9.9,8.4 10,8.2 10,8 10,7.4 9.6,7 9,7 H 8 C 7.4,7 7,7.4 7,8 7,8.2 7.1,8.4 7.2,8.5 7.3,8.2 7.6,8 8,8 z"/>\n        <path d="M 6,3 H 4 C 4,3 4,3 4,3 2,3 2,5 2,6 H 2 C 2.1,5 2.5,4 4,4 H 5 6 V 3 z"/>\n        <path d="M0 7H1V8H0z"/>\n        <path d="M 15,2 H 12 10 C 8,2 8,3 8,5 H 8 C 8,3.7 8.3,3 10,3 h 2 3 c 1.7,0 1.9,0.7 2,2 h 0 C 17,3 17,2 15,2 z"/>\n        <path d="M3 9L4 9 3 8 2 8 2 9 2 9 2 9 3 9z"/>\n        <path d="M 7,11 C 6,11 6,10.6 6,10 v 1 c 0,0.6 0,1 1,1 v -1 z"/>\n        <path d="m 18,11 v 1 c 1,0 1,-0.4 1,-1 v -1 c 0,0.6 0,1 -1,1 z"/>\n        <path d="M19 6H20V7H19z"/>\n        <path d="M3 11L1 11 1 12 3 12 3 11 5 11 5 7 5 7 5 10 3 10z"/>\n        <path d="M16 13H18V14H16z"/>\n        <path d="M5 6H6V7H5z"/>\n        <path d="M9 13L7 13 7 14 9 14 9 12 16 12 16 11 9 11z"/>\n    </g>\n    <g fill="#444">\n        <path d="M 2,6 C 2,6.4 2,6.7 2,7 H 5 V 6 H 2 z"/>\n        <path d="M2 9L2 10 4 10 3 9z"/>\n        <path d="M 4,3 H 6 V 2 H 4 C 1,2 1,5 1,6 H 0 V 7 H 1 C 1,6 1,3 4,3 z"/>\n        <path d="M 18,4 C 18,3 17,0 15,0 H 12 10 C 8,0 7,3 7,4 H 6 5 V 5 H 7 C 7,4 8,1 10,1 h 2 3 c 2,0 3,3 3,4 h 2 V 4 h -2 z"/>\n        <path d="M 8,10 H 9 C 9.6,10 10,9.6 10,9 10,8.8 9.9,8.6 9.8,8.5 9.7,8.8 9.4,9 9,9 H 8 C 7.6,9 7.3,8.8 7.2,8.5 7.1,8.6 7,8.8 7,9 c 0,0.6 0.4,1 1,1 z"/>\n        <path d="M 17,6 C 17,5.6 17,5.3 17,5 H 8 c 0,0.3 0,0.6 0,1 h 9 z"/>\n        <path d="M 17.8,8.5 C 17.7,8.8 17.4,9 17,9 H 16 C 15.6,9 15.3,8.8 15.2,8.5 15.1,8.6 15,8.8 15,9 c 0,0.6 0.4,1 1,1 h 1 c 0.6,0 1,-0.4 1,-1 0,-0.2 -0.1,-0.4 -0.2,-0.5 z"/>\n    </g>\n</svg>\n')+"\n                </button>\n            </div>\n        ";this._wrap.innerHTML=e,this._wrap.querySelector("."+y.a.button).addEventListener("click",this._onClick)},e}(h);var x,w=n(2),S=n.n(w);!function(t){t.osm="osm",t.api="api",t.license="license"}(x||(x={}));var O=function(t){function e(e,n){var r,i=t.call(this,e,(r=n.autoHide,"\n    <div class="+S.a.container+">\n        <div class="+S.a.text+">\n            <div class="+S.a.copyrights+">\n                <div class="+(r?S.a.autoHide:"")+'>\n                    <a\n                        href="https://www.openstreetmap.org/copyright"\n                        target="_blank"\n                        class='+S.a.link+"\n                        data-type="+x.osm+'\n                        >OpenStreetMap.&nbsp;</a\n                    >\n                </div>\n                <a\n                    href="https://dev.2gis.ru"\n                    target="_blank"\n                    class='+S.a.link+"\n                    data-type="+x.api+'\n                    >API</a\n                >\n            </div>\n            <div>\n                <a\n                    href="https://law.2gis.ru/api-rules/"\n                    target="_blank"\n                    class='+S.a.link+"\n                    data-type="+x.license+'\n                    >License agreement</a\n                >\n            </div>\n        </div>\n        <div>\n            <svg xmlns="http://www.w3.org/2000/svg" width="45" height="14">\n                <path\n                    fill-rule="evenodd"\n                    clip-rule="evenodd"\n                    fill="#6D7173"\n                    d="M6.964 0c3.865 0 6.99 3.144 6.99 6.994 0 3.862-3.125 7.006-6.99 7.006C3.136 14 0 10.856 0 6.994 0 3.144 3.136 0 6.964 0zm.025 2.45c-2.297 0-3.85 1.805-3.85 3.735 0 .772.172 1.457.575 2.304 2.33.012 2.794 1.446 2.943 2.712l.014.126.061.573h.501l.061-.573.014-.126c.15-1.266.605-2.7 3.017-2.712.416-.847.489-1.532.489-2.291 0-1.955-1.528-3.748-3.825-3.748zm34.142-.21c2.094 0 3.6 1.04 3.869 3.017h-2.12c-.14-.735-.753-1.305-1.775-1.305-.88 0-1.404.418-1.404 1.102 0 .778.884.942 1.757 1.074l.196.029c1.367.203 3.32.596 3.32 2.776 0 2.029-1.698 2.967-3.767 2.967-2.234 0-3.754-1.116-3.881-3.195h2.094c.179.964.894 1.496 1.966 1.496.869 0 1.482-.355 1.482-1.077 0-1.065-1.226-1.09-2.478-1.332-.97-.19-2.796-.659-2.796-2.623 0-1.851 1.417-2.929 3.537-2.929zm-12.365.21c2.174 0 4.013 1.217 4.374 3.338h-2.1c-.323-.941-1.168-1.468-2.299-1.468-1.85 0-2.646 1.443-2.646 2.861 0 1.406.845 2.824 2.659 2.824 1.031 0 1.926-.464 2.323-1.443H28.53V7.006h4.61v.74c0 2.535-1.926 4.154-4.386 4.154-2.498 0-4.684-1.744-4.684-4.694 0-2.911 2.013-4.756 4.696-4.756zm-9.156 0c2.12 0 3.574 1.217 3.574 3.148 0 1.574-.966 2.496-2.658 3.234-1.116.48-1.225.548-2.386.898h5.232v1.82h-7.599V8.845c1.09-.37 2.157-.787 3.65-1.44 1.09-.479 1.68-.921 1.68-1.709 0-.787-.59-1.475-1.593-1.475-1.154 0-1.806.922-1.78 1.93h-2.032C15.685 3.84 17.353 2.45 19.61 2.45zm16.764 0v9.1h-1.978v-9.1h1.978z"\n                />\n            </svg>\n        </div>\n    </div>\n'),n)||this;return i._onClick=function(t){if(t.target&&((n=t.target)&&"href"in n&&"dataset"in n)){var e=t.target.dataset.type;e&&function(t){return t in x}(e)&&i._map.emit("copyrightclick",{type:e,href:t.target.href,originalEvent:t})}var n},i._map=e,n.interactive||(i._wrap.style.pointerEvents="none"),i._wrap.querySelector("."+S.a.container).addEventListener("click",i._onClick),i}return i(e,t),e.prototype.destroy=function(){this._wrap.querySelector("."+S.a.container).removeEventListener("click",this._onClick),t.prototype.destroy.call(this)},e}(h);var M=n(8),j=n.n(M),I=function(){function t(t,e){this.rootContainer=t._impl.modules.layout.rootContainer,this.content=e,this.isShown=!1}return t.prototype.display=function(){this.isShown||(this.wrap||(this.wrap=this.initWrap()),this.rootContainer.appendChild(this.wrap),this.isShown=!0)},t.prototype.hide=function(){this.isShown&&(this.wrap&&this.rootContainer.removeChild(this.wrap),this.isShown=!1)},t.prototype.isDisplayed=function(){return this.isShown},t}(),T="\n    <div class="+j.a.container+">\n        Your MapGL key is invalid. Please contact api@2gis.com to get MapGL key.\n    </div>\n",E=function(t){function e(e){var n=t.call(this,e,T)||this;return e._impl.on("invalidtilekey",(function(){n.isDisplayed()||n.display()})),n}return i(e,t),e.prototype.initWrap=function(){var t=document.createElement("div");return t.classList.add(""+j.a.wrap),t.innerHTML=this.content,t},e}(I),A=function(t){void 0===t&&(t=21);for(var e="";0<t--;)e+="bjectSymhasOwnProp-0123456789ABCDEFGHIJKLMNQRTUVWXYZ_dfgiklquvxz"[64*Math.random()|0];return e},L=function(){function t(t){this.northEast=t.northEast,this.southWest=t.southWest}return t.prototype.extend=function(t){return this.southWest=[Math.min(this.southWest[0],t[0]),Math.min(this.southWest[1],t[1])],this.northEast=[Math.max(this.northEast[0],t[0]),Math.max(this.northEast[1],t[1])],this},t}(),C=n(1),P=n.n(C),k='\n    <div class="'+P.a.root+'">\n        <div class="'+P.a.container+'">\n            <div class="'+P.a.scroller+'">\n                <div class="'+P.a.content+'" />\n            </div>\n        </div>\n    </div>\n',N=function(t){function e(e,n){var r=t.call(this,e,k,n)||this;return r._removeButtonsEventListeners=function(){r._content&&r._content.childNodes.forEach((function(t){if(r._handlers.has(t)){var e=r._handlers.get(t);void 0!==e&&t.removeEventListener("click",e)}}))},r._showControl=function(t){var e,n=t.currentFloorLevelIndex,i=t.floorPlanId,o=t.floorLevels;r._floor={currentFloorLevelIndex:n,floorPlanId:i},r._root.style.display="block",r._content.innerHTML="",o.forEach((function(t){var i=t.floorLevelIndex,o=t.floorLevelName,a=document.createElement("button");a.className=P.a.control,a.innerHTML='<div class="'+P.a.label+'">'+o+"</div>",a.name=i.toLocaleString(),n===i&&(a.disabled=!0,e=a);var s=r._controlHandler(i);a.addEventListener("click",s),r._handlers.set(a,s),r._content.append(a)})),e&&e.scrollIntoView()},r._hideControl=function(){r._removeButtonsEventListeners(),r._floor=void 0,r._root.style.display="none"},r._onLevelChange=function(t){r._switchCurrentFloorLevel(t.floorLevelIndex)},r._controlHandler=function(t){return function(){r._switchCurrentFloorLevel(t),r._floor&&r._map.setFloorPlanLevel(r._floor.floorPlanId,t)}},r._switchCurrentFloorLevel=function(t){r._floor&&(r._wrap.querySelector("."+P.a.control+'[name="'+r._floor.currentFloorLevelIndex+'"]').disabled=!1,r._wrap.querySelector("."+P.a.control+'[name="'+t+'"]').disabled=!0,r._floor.currentFloorLevelIndex=t)},r._map=e,r._root=r._wrap.querySelector("."+P.a.root),r._content=r._wrap.querySelector("."+P.a.content),r._handlers=new WeakMap,r._root.style.display="none",e.on("floorplanshow",r._showControl),e.on("floorplanhide",r._hideControl),e.on("floorlevelchange",r._onLevelChange),r}return i(e,t),e.prototype.destroy=function(){this._map.off("floorplanshow",this._showControl),this._map.off("floorplanhide",this._hideControl),this._map.off("floorlevelchange",this._onLevelChange),this._removeButtonsEventListeners(),t.prototype.destroy.call(this)},e}(h),R=c.mapglUtils.getBounds,z=c.mapglUtils.projectMapToGeo,B=c.mapglUtils.projectGeoToMap,F=c.mapglUtils.projectMapToScreen,D=c.mapglUtils.projectScreenToMap,U=c.mapglUtils.setVPMatrix,Z=function(t){function e(e,n){var r,i=t.call(this)||this;if("string"==typeof e){var a=document.getElementById(e);if(!a)throw new Error("Could not found html element with id: "+e);r=a}else r=e;return i._impl=new c.Map(r,o(o({},n),{disableCommercialPoi:!0,disableHoverStyles:!0,tileServer:"tile{subdomain}-sdk.maps.2gis.com",styleServer:n.styleServer||"https://styles.api.2gis.com/styles/{id}",sessionId:A()})),n.styleState&&i._impl.setStyleState(n.styleState),i._impl.on("idle",(function(){return i._emitMapEvent("idle")})).on("resize",(function(){return i._emitMapEvent("resize")})).on("move",(function(){return i._emitMapEvent("move")})).on("movestart",(function(){return i._emitMapEvent("movestart")})).on("moveend",(function(){return i._emitMapEvent("moveend")})).on("center",(function(){return i._emitMapEvent("center")})).on("centerstart",(function(){return i._emitMapEvent("centerstart")})).on("centerend",(function(){return i._emitMapEvent("centerend")})).on("zoom",(function(){return i._emitMapEvent("zoom")})).on("zoomstart",(function(){return i._emitMapEvent("zoomstart")})).on("zoomend",(function(){return i._emitMapEvent("zoomend")})).on("rotation",(function(){return i._emitMapEvent("rotation")})).on("rotationstart",(function(){return i._emitMapEvent("rotationstart")})).on("rotationend",(function(){return i._emitMapEvent("rotationend")})).on("pitch",(function(){return i._emitMapEvent("pitch")})).on("pitchstart",(function(){return i._emitMapEvent("pitchstart")})).on("pitchend",(function(){return i._emitMapEvent("pitchend")})).on("trafficshow",(function(){return i._emitMapEvent("trafficshow")})).on("traffichide",(function(){return i._emitMapEvent("traffichide")})).on("floorcomplexshow",(function(t){var e=t.id,n=t.currentFloor,r=t.floorNames;return i.emit("floorplanshow",{floorPlanId:e,currentFloorLevelIndex:n,floorLevels:r.map((function(t,e){return{floorLevelIndex:e,floorLevelName:t}}))})})).on("floorcomplexhide",(function(t){return i.emit("floorplanhide",{floorPlanId:t.id})})).on("floorcomplexlevelchange",(function(t){return i.emit("floorlevelchange",{floorLevelName:t.floorName,floorLevelIndex:t.floorIndex,floorPlanId:t.id})})),i._impl.on("click",(function(t){return i._emitMapPointerEvent("click",t)})).on("dblclick",(function(t){return i._emitMapPointerEvent("dblclick",t)})).on("mousemove",(function(t){return i._emitMapPointerEvent("mousemove",t)})).on("mouseover",(function(t){return i._emitMapPointerEvent("mouseover",t)})).on("mouseout",(function(t){return i._emitMapPointerEvent("mouseout",t)})).on("mousedown",(function(t){return i._emitMapPointerEvent("mousedown",t)})).on("mouseup",(function(t){return i._emitMapPointerEvent("mouseup",t)})).on("touchstart",(function(t){return i._emitMapPointerEvent("touchstart",t)})).on("touchend",(function(t){return i._emitMapPointerEvent("touchend",t)})),i._impl.on("trafficscore",(function(t){var e=t.score;return i.emit("trafficscore",{score:e})})),i._controlPane=document.createElement("div"),i._controlContainers=new f(i._controlPane),i._initControls(n),new E(i),i}return i(e,t),e.prototype.setCenter=function(t,e){return this._impl.setCenter(t,e),this},e.prototype.getCenter=function(){return this._impl.getCenter()},e.prototype.setZoom=function(t,e){return this._impl.setZoom(t,e),this},e.prototype.getZoom=function(){return this._impl.getZoom()},e.prototype.getStyleZoom=function(){return this._impl.getStyleZoom()},e.prototype.setStyleZoom=function(t,e){return this._impl.setStyleZoom(t,e),this},e.prototype.setRotation=function(t,e){return this._impl.setRotation(t,e),this},e.prototype.getRotation=function(){return this._impl.getRotation()},e.prototype.setPitch=function(t,e){return this._impl.setPitch(t,e),this},e.prototype.getPitch=function(){return this._impl.getPitch()},e.prototype.setMinZoom=function(t,e){return this._impl.setMinZoom(t,e),this},e.prototype.getMinZoom=function(){return this._impl.getMinZoom()},e.prototype.getMaxZoom=function(){return this._impl.getMaxZoom()},e.prototype.setMaxZoom=function(t,e){return this._impl.setMaxZoom(t,e),this},e.prototype.setMinPitch=function(t,e){return this._impl.setMinPitch(t,e),this},e.prototype.setMaxPitch=function(t,e){return this._impl.setMaxPitch(t,e),this},e.prototype.getSize=function(){return this._impl.getSize()},e.prototype.getBounds=function(){var t=R(this._impl.state);return new L({southWest:z(t.min),northEast:z(t.max)})},e.prototype.project=function(t){return F(this._impl.state,B(t))},e.prototype.unproject=function(t){var e=D(this._impl.state,t);return z(e)},e.prototype.getProjectionMatrix=function(){var t=[];return U(t,this._impl.state),t},e.prototype.getWebGLContext=function(){return this._impl.getWebGLContext()},e.prototype.getCanvas=function(){return this._impl.getCanvas()},e.prototype.getContainer=function(){return this._impl.getExternalContainer()},e.prototype.invalidateSize=function(){return this._impl.invalidateSize(),this},e.prototype.showTraffic=function(){return this._impl.showTraffic(),this},e.prototype.hideTraffic=function(){return this._impl.hideTraffic(),this},e.prototype.setSelectedObjects=function(t){return void 0===t&&(t=[]),this._impl.setSelectedIds(t),this},e.prototype.setStyleById=function(t){return a(this,void 0,void 0,(function(){return s(this,(function(e){return this._impl.setCustomStyleById(t),[2,this]}))}))},e.prototype.setLanguage=function(t){return this._impl.setLang(t),this},e.prototype.getLanguage=function(){return this._impl.state.lang},e.prototype.setFloorPlanLevel=function(t,e){this._impl.changeFloorNumber(t,e)},e.prototype.setMaxBounds=function(t){return this._impl.setMaxBounds(t),this},e.prototype.getPadding=function(){return this._impl.getPadding()},e.prototype.setPadding=function(t,e){return this._impl.setPadding(t,e),this},e.prototype.setStyle=function(t){return this._impl.setCustomStyle(t),this},e.prototype.setAutoHoverMode=function(t){return this._impl.setAutoHoverMode(t),this},e.prototype.fitBounds=function(t,e){return this._impl.fitBounds(t,e),this},e.prototype.setStyleState=function(t){return this._impl.setStyleState(t),this},e.prototype.setStyleOptions=function(t){return this._impl.patchStyleState({trafficOn:t.traffic}),this},e.prototype.patchStyleState=function(t){return this._impl.patchStyleState(t),this},e.prototype.destroy=function(){this._controlPane.remove(),this._impl.destroy()},e.prototype._emitMapEvent=function(t){this.emit(t,{})},e.prototype._emitMapPointerEvent=function(t,e){var n=e.originalEvent,r=e.lngLat,i=e.point,o=e.target;this.emit(t,{originalEvent:n,lngLat:r,point:i,target:void 0!==o?{id:o.id}:void 0})},e.prototype._initControls=function(t){this._impl.modules.layout.rootContainer.appendChild(this._controlPane),!1!==t.copyright&&new O(this,{position:"bottomRight",interactive:!1!==t.interactiveCopyright,autoHide:!0===t.autoHideOSMCopyright}),!1!==t.zoomControl&&new _(this,{position:"topRight"}),t.trafficControl&&new b(this,{position:"topRight"}),t.floorControl&&new N(this,{position:"topRight"})},e}(l),H=function(t){function e(e,n){var r,i,o=t.call(this)||this,a=n.label,s=a?{text:a.text,image:a.image,minZoom:a.minZoom,maxZoom:a.maxZoom,color:a.color,fontSize:a.fontSize,haloRadius:a.haloRadius,haloColor:a.haloColor,letterSpacing:a.letterSpacing,lineHeight:a.lineHeight,zIndex:a.zIndex,offset:null!==(r=a.offset)&&void 0!==r?r:null===(i=a.anchor)||void 0===i?void 0:i.map((function(t){return-t})),anchor:a.relativeAnchor}:void 0;return o._impl=new c.Marker(e._impl,{coordinates:n.coordinates,icon:n.icon,size:n.size,anchor:n.anchor,hoverIcon:n.hoverIcon,hoverSize:n.hoverSize,hoverAnchor:n.hoverAnchor,zIndex:n.zIndex,minZoom:n.minZoom,maxZoom:n.maxZoom,interactive:n.interactive,label:s}),o._impl.on("click",(function(t){return o._emitMapPointerEvent("click",t)})).on("dblclick",(function(t){return o._emitMapPointerEvent("dblclick",t)})).on("mousemove",(function(t){return o._emitMapPointerEvent("mousemove",t)})).on("mouseover",(function(t){return o._emitMapPointerEvent("mouseover",t)})).on("mouseout",(function(t){return o._emitMapPointerEvent("mouseout",t)})).on("mousedown",(function(t){return o._emitMapPointerEvent("mousedown",t)})).on("mouseup",(function(t){return o._emitMapPointerEvent("mouseup",t)})).on("touchstart",(function(t){return o._emitMapPointerEvent("touchstart",t)})).on("touchend",(function(t){return o._emitMapPointerEvent("touchend",t)})),o}return i(e,t),e.prototype.setCoordinates=function(t){return this._impl.setCoordinates(t),this},e.prototype.getCoordinates=function(){return this._impl.getCoordinates()},e.prototype.show=function(){return this._impl.show(),this},e.prototype.hide=function(){return this._impl.hide(),this},e.prototype.destroy=function(){this._impl.destroy()},e.prototype._emitMapPointerEvent=function(t,e){var n=e.originalEvent,r=e.lngLat,i=e.point;this.emit(t,{originalEvent:n,lngLat:r,point:i})},e}(l),G=function(){function t(t,e){var n,r;this._impl=new c.PointLabel(t._impl,{coordinates:e.coordinates,text:e.text,image:e.image,minZoom:e.minZoom,maxZoom:e.maxZoom,color:e.color,fontSize:e.fontSize,haloRadius:e.haloRadius,haloColor:e.haloColor,letterSpacing:e.letterSpacing,lineHeight:e.lineHeight,zIndex:e.zIndex,offset:null!==(n=e.offset)&&void 0!==n?n:null===(r=e.anchor)||void 0===r?void 0:r.map((function(t){return-t})),anchor:e.relativeAnchor})}return t.prototype.destroy=function(){this._impl.remove()},t.prototype.show=function(){return this._impl.show(),this},t.prototype.hide=function(){return this._impl.hide(),this},t.prototype.setCoordinates=function(t){return this._impl.setCoordinates(t),this},t.prototype.getCoordinates=function(){return this._impl.getCoordinates()},t}(),W=function(){function t(t,e){var n=e.coordinates,r=e.html,i=e.anchor,o=e.minZoom,a=e.maxZoom,s=e.zIndex,l=e.preventMapInteractions;this._impl=new c.HtmlMarker(t._impl,{coordinates:n,html:r,offset:i?[-i[0],-i[1]]:void 0,minZoom:o,maxZoom:a,zIndex:s,animate:!1,interactive:!0,preventMapInteractions:null==l||l})}return t.prototype.destroy=function(){this._impl.destroy()},t.prototype.setCoordinates=function(t){return this._impl.setPosition(t),this},t.prototype.setAnchor=function(t){return this._impl.setOffset([-t[0],-t[1]]),this},t.prototype.setContent=function(t){return this._impl.setContent(t),this},t.prototype.getCoordinates=function(){return this._impl.getPosition()},t.prototype.getAnchor=function(){var t=this._impl.getOffset();return[-t[0],-t[1]]},t.prototype.getContent=function(){return this._impl.getHtmlElement()},t}(),V=function(t){function e(e,n){var r=t.call(this)||this,i=n.strokeColor,o=n.strokeWidth,a=n.color,s=n.coordinates,l=n.interactive,u=n.maxZoom,d=n.minZoom,f=n.radius,h=n.zIndex;return r._impl=new c.Circle(e._impl,{coordinates:s,radius:f,minZoom:d,maxZoom:u,interactive:l,color:a,phase:h,borderWidth:o,borderColor:i}),r._impl.on("click",(function(t){return r._emitMapPointerEvent("click",t)})).on("dblclick",(function(t){return r._emitMapPointerEvent("dblclick",t)})).on("mousemove",(function(t){return r._emitMapPointerEvent("mousemove",t)})).on("mouseover",(function(t){return r._emitMapPointerEvent("mouseover",t)})).on("mouseout",(function(t){return r._emitMapPointerEvent("mouseout",t)})).on("mousedown",(function(t){return r._emitMapPointerEvent("mousedown",t)})).on("mouseup",(function(t){return r._emitMapPointerEvent("mouseup",t)})).on("touchstart",(function(t){return r._emitMapPointerEvent("touchstart",t)})).on("touchend",(function(t){return r._emitMapPointerEvent("touchend",t)})),r}return i(e,t),e.prototype.destroy=function(){this._impl.remove()},e.prototype._emitMapPointerEvent=function(t,e){var n=e.originalEvent,r=e.lngLat,i=e.point;this.emit(t,{originalEvent:n,lngLat:r,point:i})},e}(l),q=function(t){function e(e,n){var r=t.call(this)||this,i=n.stroke2Color,o=n.stroke2Width,a=n.strokeColor,s=n.strokeWidth,l=n.color,u=n.coordinates,d=n.interactive,f=n.maxZoom,h=n.minZoom,p=n.radius,m=n.diameter,v=n.zIndex;return r._impl=new c.CircleMarker(e._impl,{coordinates:u,interactive:d,maxZoom:f,minZoom:h,color:l,width:void 0!==m?m:p,phase:v,borderWidth:s,border2Width:o,borderColor:a,border2Color:i}),r._impl.on("click",(function(t){return r._emitMapPointerEvent("click",t)})).on("dblclick",(function(t){return r._emitMapPointerEvent("dblclick",t)})).on("mousemove",(function(t){return r._emitMapPointerEvent("mousemove",t)})).on("mouseover",(function(t){return r._emitMapPointerEvent("mouseover",t)})).on("mouseout",(function(t){return r._emitMapPointerEvent("mouseout",t)})).on("mousedown",(function(t){return r._emitMapPointerEvent("mousedown",t)})).on("mouseup",(function(t){return r._emitMapPointerEvent("mouseup",t)})).on("touchstart",(function(t){return r._emitMapPointerEvent("touchstart",t)})).on("touchend",(function(t){return r._emitMapPointerEvent("touchend",t)})),r}return i(e,t),e.prototype.destroy=function(){this._impl.remove()},e.prototype._emitMapPointerEvent=function(t,e){var n=e.originalEvent,r=e.lngLat,i=e.point;this.emit(t,{originalEvent:n,lngLat:r,point:i})},e}(l),Y=function(t){function e(e,n){var r=t.call(this)||this,i=n.zIndex3,o=n.zIndex2,a=n.color,s=n.color2,l=n.color3,u=n.coordinates,d=n.interactive,f=n.maxZoom,h=n.minZoom,p=n.width,m=n.width2,v=n.width3,_=n.zIndex,g=n.gapLength,y=n.gapColor,b=n.dashLength;return b?(r._impl=new c.DashedPolyline(e._impl,{coordinates:u,interactive:d,maxZoom:f,minZoom:h,width:null!=p?p:3,width2:null!=p?p:3,dashColor:a,gapColor:y,dashLength:b,dash2Length:0,gapLength:null!=g?g:b,phase:_,phase2:o}),r._impl.on("click",(function(t){return r._emitMapPointerEvent("click",t)})).on("dblclick",(function(t){return r._emitMapPointerEvent("dblclick",t)})).on("mousemove",(function(t){return r._emitMapPointerEvent("mousemove",t)})).on("mouseover",(function(t){return r._emitMapPointerEvent("mouseover",t)})).on("mouseout",(function(t){return r._emitMapPointerEvent("mouseout",t)})).on("mousedown",(function(t){return r._emitMapPointerEvent("mousedown",t)})).on("mouseup",(function(t){return r._emitMapPointerEvent("mouseup",t)})).on("touchstart",(function(t){return r._emitMapPointerEvent("touchstart",t)})).on("touchend",(function(t){return r._emitMapPointerEvent("touchend",t)}))):(r._impl=new c.Polyline(e._impl,{coordinates:u,interactive:d,maxZoom:f,minZoom:h,width:p,width2:m,color:a,color2:s,color3:l,width3:v,phase:_,phase2:o,phase3:i}),r._impl.on("click",(function(t){return r._emitMapPointerEvent("click",t)})).on("dblclick",(function(t){return r._emitMapPointerEvent("dblclick",t)})).on("mousemove",(function(t){return r._emitMapPointerEvent("mousemove",t)})).on("mouseover",(function(t){return r._emitMapPointerEvent("mouseover",t)})).on("mouseout",(function(t){return r._emitMapPointerEvent("mouseout",t)})).on("mousedown",(function(t){return r._emitMapPointerEvent("mousedown",t)})).on("mouseup",(function(t){return r._emitMapPointerEvent("mouseup",t)})).on("touchstart",(function(t){return r._emitMapPointerEvent("touchstart",t)})).on("touchend",(function(t){return r._emitMapPointerEvent("touchend",t)}))),r}return i(e,t),e.prototype.destroy=function(){this._impl.remove()},e.prototype._emitMapPointerEvent=function(t,e){var n=e.originalEvent,r=e.lngLat,i=e.point;this.emit(t,{originalEvent:n,lngLat:r,point:i})},e}(l),X=function(t){function e(e,n){var r=t.call(this)||this,i=n.strokeColor,o=n.strokeWidth,a=n.color,s=n.coordinates,l=n.interactive,u=n.maxZoom,d=n.minZoom,f=n.zIndex;return r._impl=new c.Polygon(e._impl,{coordinates:s,interactive:l,maxZoom:u,minZoom:d,color:a,phase:f,borderWidth:o,borderColor:i}),r._impl.on("click",(function(t){return r._emitMapPointerEvent("click",t)})).on("dblclick",(function(t){return r._emitMapPointerEvent("dblclick",t)})).on("mousemove",(function(t){return r._emitMapPointerEvent("mousemove",t)})).on("mouseover",(function(t){return r._emitMapPointerEvent("mouseover",t)})).on("mouseout",(function(t){return r._emitMapPointerEvent("mouseout",t)})).on("mousedown",(function(t){return r._emitMapPointerEvent("mousedown",t)})).on("mouseup",(function(t){return r._emitMapPointerEvent("mouseup",t)})).on("touchstart",(function(t){return r._emitMapPointerEvent("touchstart",t)})).on("touchend",(function(t){return r._emitMapPointerEvent("touchend",t)})),r}return i(e,t),e.prototype.destroy=function(){this._impl.remove()},e.prototype._emitMapPointerEvent=function(t,e){var n=e.originalEvent,r=e.lngLat,i=e.point;this.emit(t,{originalEvent:n,lngLat:r,point:i})},e}(l);function K(t){return!J(t)}function J(t){if("undefined"==typeof window||"undefined"==typeof document)return"not a browser";if(!Boolean(Function.prototype&&Function.prototype.bind))return"insufficient Function support";if(!("JSON"in window&&"parse"in JSON&&"stringify"in JSON))return"insufficient JSON support";if(!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(e),r=null;try{r=new Worker(n),t=!0}catch(e){t=!1}r&&r.terminate();return URL.revokeObjectURL(n),t}())return"insufficient worker support";if(!ArrayBuffer.isView)return"insufficient ArrayBuffer support";if(!function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}())return"insufficient Canvas/getImageData support";var e,n=function(t){var e=String(t);void 0===Q[e]&&(Q[e]=function(t){var e,n=function(t){var e=document.createElement("canvas"),n={antialias:!1,stencil:!0,failIfMajorPerformanceCaveat:t};if(!("WebGLRenderingContext"in window))return!1;return e.getContext("webgl",n)||e.getContext("experimental-webgl",n)}(t);if(!n)return{ok:!1,msg:"error on get context"};for(var r=0,i=["OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object"];r<i.length;r++){var o=i[r];if(!n.getExtension(o))return{ok:!1,msg:o+" extension is not supported"}}try{e=n.createShader(n.VERTEX_SHADER)}catch(t){return{ok:!1,msg:"browser block shader API"}}if(!e||n.isContextLost())return{ok:!1};return n.shaderSource(e,"void main() {}"),n.compileShader(e),{ok:!0===n.getShaderParameter(e,n.COMPILE_STATUS)}}(t));return Q[e]}(t&&t.failIfMajorPerformanceCaveat||!1);return n.ok?Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.isArray?Boolean(Object.keys&&Object.assign&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.freeze)?(e=document.createElement("div"))&&"function"==typeof e.after?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient DOM support":"insufficient Object support":"insufficient Array support":"insufficient WebGL support"+(n.msg?": "+n.msg:"")}var Q={};setTimeout((function(){var t=Array.from(document.querySelectorAll("script")).find((function(t){return t.src.match("https://mapgl.2gis.com/api/js")}));if(t){var e=function(t){var e=t.split("?")[1];if(e){var n=e.split("&").map((function(t){return t.split("=")})).find((function(t){return"callback"===t[0]}));if(n)return n[1]}}(t.src);if(e){if("function"!=typeof window[e])throw new Error('Not found callback function with name "'+e+'"');window[e]()}}}),0);n(15)}])}));
//# sourceMappingURL=index.js.map